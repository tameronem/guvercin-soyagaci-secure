<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Güvercin Soyağacı Takip Sistemi</title>
    <!-- Tailwind CSS via CDN - For development only. Replace with production build for deployment -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Supabase Scripts -->
    <script src="js/supabase-client.js"></script>
    <script src="js/auth-supabase.js"></script>
    <script src="js/database-supabase.js"></script>
    <script src="js/storage-supabase.js"></script>
    <script src="js/elderly-friendly-captcha.js"></script>
    <script src="js/premium-system.js"></script>
    
    <script>
        // Critical functions that need to be available immediately for onclick handlers
        window.showHomepage = function() {
            console.log('showHomepage called - waiting for initialization');
            // This will be replaced by the real function after DOM loads
        };
        
        window.showPigeons = function() {
            console.log('showPigeons called - waiting for initialization');
        };
        
        window.showMatings = function() {
            console.log('showMatings called - waiting for initialization');
        };
        
        window.showHealthRecords = function() {
            console.log('showHealthRecords called - waiting for initialization');
        };
        
        window.showPerformanceRecords = function() {
            console.log('showPerformanceRecords called - waiting for initialization');
        };
        
        window.showAIBreeding = function() {
            console.log('showAIBreeding called - waiting for initialization');
        };
        
        window.showPricing = function() {
            console.log('showPricing called - waiting for initialization');
        };
        
        window.openAuthModal = function(type) {
            console.log('openAuthModal called with type:', type, '- waiting for initialization');
        };
        
        window.closeAuthModal = function() {
            console.log('closeAuthModal called - waiting for initialization');
        };
        
        window.toggleMobileMenu = function() {
            console.log('toggleMobileMenu called - waiting for initialization');
        };
        
        window.changeLanguage = function(lang) {
            console.log('changeLanguage called with lang:', lang, '- waiting for initialization');
        };
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        :root {
            --bg-primary: #0f0f0f;
            --bg-secondary: #1a1a2e;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            transition: background 0.3s ease;
            position: relative;
        }
        /* Animated Background */
        .animated-bg {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Floating particles */
        .particle {
            position: fixed;
            pointer-events: none;
            opacity: 0.5;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.5; }
            90% { opacity: 0.5; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }
        
        /* Decorative Background Animations */
        @keyframes gentleFloat {
            0%, 100% {
                transform: translateY(0) rotate(12deg);
            }
            50% {
                transform: translateY(-20px) rotate(12deg);
            }
        }
        
        .fa-dove.text-\[200px\] {
            animation: gentleFloat 6s ease-in-out infinite;
        }
        
        .fa-feather-alt.text-\[150px\] {
            animation: gentleFloat 8s ease-in-out infinite;
            animation-delay: 2s;
        }
        
        /* Premium Floating Animation */
        @keyframes premiumFloat {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
                opacity: 0.8;
            }
            25% {
                transform: translateY(-15px) rotate(3deg);
                opacity: 1;
            }
            50% {
                transform: translateY(-10px) rotate(-2deg);
                opacity: 0.9;
            }
            75% {
                transform: translateY(-20px) rotate(1deg);
                opacity: 1;
            }
        }
        
        .floating-animation {
            animation: premiumFloat 6s ease-in-out infinite;
        }
        
        /* Pulse animation for incubation alert */
        @keyframes urgentPulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
        }
        
        .animate-pulse {
            animation: urgentPulse 1s ease-in-out infinite;
        }
        
        /* Statistics Mini Cards */
        .stat-mini-card {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .stat-mini-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .stat-mini-card::before {
            content: '';
            position: absolute;
            top: -100%;
            left: -100%;
            width: 300%;
            height: 300%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 40%);
            transition: all 0.5s ease;
        }
        
        .stat-mini-card:hover::before {
            top: -150%;
            left: -150%;
        }
        
        .stat-counter {
            transition: all 0.3s ease;
        }
        
        /* Pedigree Preview Styles */
        .pedigree-preview-container {
            max-height: 400px;
            position: relative;
        }
        
        @media (max-width: 768px) {
            .pedigree-preview-container {
                max-height: 500px;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
        }
        
        .pedigree-preview-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            min-width: 150px;
        }
        
        .pedigree-preview-card:hover {
            transform: scale(1.05);
            border-color: rgba(139, 92, 246, 0.4);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.2);
        }
        
        .pedigree-preview-card.main {
            min-width: 200px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.05));
            border-color: rgba(139, 92, 246, 0.3);
        }
        
        .pedigree-preview-card.parent {
            min-width: 160px;
        }
        
        .pedigree-preview-card.mini {
            min-width: 100px;
            padding: 15px;
        }
        
        .pedigree-preview-header {
            margin-bottom: 15px;
        }
        
        .pedigree-connection-line {
            width: 40px;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.5), transparent);
            position: relative;
        }
        
        .pedigree-connection-line::before,
        .pedigree-connection-line::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: rgba(139, 92, 246, 0.5);
            border-radius: 50%;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .pedigree-connection-line::before {
            left: -4px;
        }
        
        .pedigree-connection-line::after {
            right: -4px;
        }

        /* Glass morphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }

        /* Neon glow effect */
        .neon-border {
            position: relative;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            padding: 2px;
            border-radius: 20px;
        }

        .neon-border::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #00ffff, #ff00ff, #00ffff);
            border-radius: 20px;
            opacity: 0.5;
            filter: blur(10px);
            z-index: -1;
            animation: neonPulse 3s ease-in-out infinite;
        }

        @keyframes neonPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.8; }
        }

        /* Button styles */
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 12px 30px;
            border-radius: 30px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-block;
            text-decoration: none;
            position: relative;
            overflow: hidden;
            border: none;
            cursor: pointer;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        /* Card hover effect - removed 3D transform */
        .card-3d {
            transition: all 0.3s ease;
        }

        .card-3d:hover {
            /* Removed transform effects to prevent button click issues */
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.2);
        }

        /* Stats counter animation */
        @keyframes countUp {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .stat-number {
            animation: countUp 1s ease-out;
        }

        /* Premium Dashboard Styles */
        .premium-hero-section {
            position: relative;
            overflow: hidden;
        }

        .premium-hero-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.1) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Enhanced Stat Cards */
        .stat-card-premium {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 24px;
            border: 1px solid rgba(148, 163, 184, 0.1);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card-premium:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(148, 163, 184, 0.2);
        }

        .stat-card-premium::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.8), transparent);
            transform: translateX(-100%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            to { transform: translateX(100%); }
        }

        .stat-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            position: relative;
            overflow: hidden;
        }

        .stat-icon::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.5s ease;
        }

        .stat-card-premium:hover .stat-icon::after {
            transform: translate(-50%, -50%) scale(2);
        }

        .stat-trend {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: rgba(0, 0, 0, 0.2);
        }

        .progress-bar {
            height: 6px;
            background: rgba(148, 163, 184, 0.1);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 1s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: translateX(-100%);
            animation: progress-shimmer 2s infinite;
        }

        @keyframes progress-shimmer {
            to { transform: translateX(100%); }
        }

        /* Quick Actions Grid */
        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .quick-action-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.05));
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .quick-action-card::before {
            content: '';
            position: absolute;
            top: -100%;
            left: -100%;
            width: 300%;
            height: 300%;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 40%);
            transition: all 0.5s ease;
        }

        .quick-action-card:hover::before {
            top: -150%;
            left: -150%;
        }

        .quick-action-card:hover {
            transform: translateY(-3px) scale(1.02);
            border-color: rgba(99, 102, 241, 0.4);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.2);
        }

        .quick-action-icon {
            font-size: 32px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }

        /* Activity Timeline Enhanced */
        .activity-timeline {
            position: relative;
            padding-left: 30px;
        }

        .activity-timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, rgba(99, 102, 241, 0.4), transparent);
        }

        .activity-item {
            position: relative;
            padding-bottom: 24px;
            animation: slideInLeft 0.5s ease;
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .activity-dot {
            position: absolute;
            left: -22px;
            top: 5px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #6366f1;
            border: 3px solid #1e293b;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); }
            50% { box-shadow: 0 0 0 6px rgba(99, 102, 241, 0); }
            100% { box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); }
        }

        .activity-content {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s ease;
        }

        .activity-content:hover {
            background: rgba(30, 41, 59, 0.8);
            border-color: rgba(148, 163, 184, 0.2);
            transform: translateX(5px);
        }

        /* Featured Pigeons Grid */
        .featured-pigeon-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 20px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .featured-pigeon-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .featured-pigeon-card:hover::before {
            left: 100%;
        }

        .featured-pigeon-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .featured-pigeon-avatar {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            background: rgba(148, 163, 184, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: #6366f1;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .featured-pigeon-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
        }

        .featured-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #1e293b;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(251, 191, 36, 0.4);
        }

        /* Enhanced Pigeon Card */
        .pigeon-card-premium {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .pigeon-card-premium::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #6366f1, #8b5cf6, #ec4899);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .pigeon-card-premium:hover::before {
            transform: scaleX(1);
        }

        .pigeon-card-premium:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .pigeon-card-image {
            height: 150px;
            background: rgba(148, 163, 184, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .pigeon-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .pigeon-card-premium:hover .pigeon-card-image img {
            transform: scale(1.1);
        }

        /* Suggestion Items */
        .suggestion-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: rgba(139, 92, 246, 0.05);
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .suggestion-item:hover {
            background: rgba(139, 92, 246, 0.1);
            transform: translateX(5px);
        }

        /* Weather Widget Animation */
        .weather-icon-animated {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Responsive Grid Adjustments */
        @media (max-width: 1024px) {
            .quick-actions-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .premium-hero-section .glass {
                padding: 20px;
            }
            
            .premium-hero-section h1 {
                font-size: 1.875rem;
            }

            .stat-card-premium {
                padding: 20px;
            }

            .quick-actions-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            /* Mobile Dashboard Layout */
            .grid.lg\:grid-cols-3 {
                grid-template-columns: 1fr;
            }
            
            /* Care Tips Mobile */
            .glass h3 {
                font-size: 1.25rem;
            }
            
            /* Incubation Cards Mobile */
            .text-4xl {
                font-size: 2rem;
            }
            
            /* Decorative Elements Mobile */
            .fa-dove.text-\[200px\] {
                font-size: 120px;
            }
            
            .fa-feather-alt.text-\[150px\] {
                font-size: 100px;
            }
        }
        
        @media (max-width: 480px) {
            .premium-hero-section h1 {
                font-size: 1.5rem;
            }
            
            .glass {
                padding: 16px;
            }
            
            /* Small Incubation Cards */
            .bg-gradient-to-br.p-5 {
                padding: 16px;
            }
            
            .text-4xl {
                font-size: 1.75rem;
            }
            
            .text-2xl {
                font-size: 1.25rem;
            }
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: relative;
            margin: 5% auto;
            width: 90%;
            max-width: 600px;
            animation: slideIn 0.3s ease-out;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes slideIn {
            0% { transform: translateY(-50px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        /* Tab styles */
        .tab-active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .tab-btn {
            color: var(--text-primary);
        }
        
        .tab-btn:hover {
            background: rgba(102, 126, 234, 0.2);
        }
        
        /* Mobile menu */
        .mobile-menu {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(26, 26, 46, 0.98);
            backdrop-filter: blur(10px);
            z-index: 100;
            padding-top: 100px;
            overflow-y: auto;
        }
        
        .mobile-menu.active {
            display: block;
        }
        
        /* Ensure homepage button is always visible in mobile menu */
        .mobile-menu .tab-btn:first-child {
            display: flex !important;
            align-items: center;
            background: rgba(102, 126, 234, 0.2);
            border: 2px solid rgba(102, 126, 234, 0.4);
            margin-bottom: 12px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }
        
        .mobile-menu .tab-btn:first-child:hover {
            background: rgba(102, 126, 234, 0.3);
            border-color: rgba(102, 126, 234, 0.6);
            transform: translateY(-1px);
        }
        
        /* Mobile menu close button */
        .mobile-menu-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .mobile-menu-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* Pigeon card styles - removed animation effects */
        .pigeon-card {
            position: relative;
        }

        /* Modern Pedigree Styles */
        .pedigree-container {
            position: relative;
            min-height: 600px;
            overflow: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .pedigree-wrapper {
            display: inline-block;
            min-width: 100%;
            padding: 40px;
        }
        
        /* Pedigree tree styles - Modern redesign */
        .pedigree-tree {
            display: flex;
            align-items: center;
            position: relative;
            padding: 2rem;
            min-height: 600px;
            overflow-x: auto;
            overflow-y: hidden;
            background: radial-gradient(ellipse at center, rgba(99, 102, 241, 0.05) 0%, transparent 70%);
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            /* Ensure proper stacking context for SVG */
            z-index: 0;
            transform: translateZ(0);
        }
        
        /* Custom scrollbar for pedigree tree */
        .pedigree-tree::-webkit-scrollbar {
            height: 8px;
        }
        
        .pedigree-tree::-webkit-scrollbar-track {
            background: rgba(148, 163, 184, 0.1);
            border-radius: 4px;
        }
        
        .pedigree-tree::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.3);
            border-radius: 4px;
            transition: background 0.3s ease;
        }
        
        .pedigree-tree::-webkit-scrollbar-thumb:hover {
            background: rgba(99, 102, 241, 0.5);
        }
        
        .generation {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 2rem;
            margin-right: 6rem;
            position: relative;
            animation: fadeInLeft 0.6s ease-out;
        }
        
        .generation:last-child {
            margin-right: 0;
        }
        
        @keyframes fadeInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .pigeon-node {
            position: relative;
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 1.25rem;
            min-width: 240px;
            max-width: 280px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(148, 163, 184, 0.1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            animation: nodeAppear 0.5s ease-out;
            animation-fill-mode: backwards;
            z-index: 20; /* Ensure nodes are above connection lines */
        }
        
        .pigeon-node:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-color: rgba(148, 163, 184, 0.3);
        }
        
        @keyframes nodeAppear {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* Add animation delay based on generation */
        .pigeon-node[data-gen="0"] { animation-delay: 0.1s; }
        .pigeon-node[data-gen="1"] { animation-delay: 0.2s; }
        .pigeon-node[data-gen="2"] { animation-delay: 0.3s; }
        .pigeon-node[data-gen="3"] { animation-delay: 0.4s; }
        
        /* Tooltip styles for pigeon details */
        .pigeon-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(17, 24, 39, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 100;
            min-width: 250px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .pigeon-node:hover .pigeon-tooltip {
            opacity: 1;
        }
        
        .pigeon-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: rgba(99, 102, 241, 0.3);
        }
        
        .pigeon-node.male {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(37, 99, 235, 0.05));
            border-color: rgba(59, 130, 246, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .pigeon-node.male::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 20px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s ease;
        }
        
        .pigeon-node.male:hover::before {
            opacity: 0.1;
        }
        
        .pigeon-node.female {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.15), rgba(219, 39, 119, 0.05));
            border-color: rgba(236, 72, 153, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .pigeon-node.female::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, #ec4899, #db2777);
            border-radius: 20px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s ease;
        }
        
        .pigeon-node.female:hover::before {
            opacity: 0.1;
        }
        
        .pigeon-node.unknown {
            background: linear-gradient(135deg, rgba(156, 163, 175, 0.15), rgba(107, 114, 128, 0.05));
            border-color: rgba(156, 163, 175, 0.4);
        }
        
        .pigeon-node.empty {
            opacity: 0.5;
            cursor: default;
            border-style: dashed;
        }
        
        .pigeon-node.empty:hover {
            transform: none;
            box-shadow: none;
        }
        
        .pigeon-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }
        
        .pigeon-image {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            object-fit: cover;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .pigeon-node:hover .pigeon-image {
            transform: scale(1.05);
        }
        
        .pigeon-icon {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            flex-shrink: 0;
            background: rgba(148, 163, 184, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .pigeon-icon::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at center, transparent 30%, currentColor 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .pigeon-node:hover .pigeon-icon {
            transform: scale(1.05);
            background: rgba(148, 163, 184, 0.2);
        }
        
        .pigeon-node:hover .pigeon-icon::after {
            opacity: 0.1;
        }
        
        .pigeon-node.male .pigeon-icon {
            color: #60a5fa;
        }
        
        .pigeon-node.female .pigeon-icon {
            color: #f472b6;
        }
        
        .pigeon-info {
            flex-grow: 1;
            text-align: left;
        }
        
        .pigeon-role {
            font-size: 0.75rem;
            font-weight: 500;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.125rem;
            opacity: 0.8;
        }
        
        .pigeon-node.male .pigeon-role {
            color: #93c5fd;
        }
        
        .pigeon-node.female .pigeon-role {
            color: #fbbf24;
        }
        
        .pigeon-name {
            font-weight: 600;
            font-size: 1.125rem;
            margin-bottom: 0.25rem;
            color: #f3f4f6;
            letter-spacing: -0.025em;
            line-height: 1.2;
        }
        
        .pigeon-alt-name {
            font-size: 0.875rem;
            color: #9ca3af;
            font-style: italic;
            opacity: 0.8;
        }
        
        .pigeon-details {
            font-size: 0.875rem;
            color: #9ca3af;
            text-align: left;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .pigeon-detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.375rem 0.75rem;
            background: rgba(148, 163, 184, 0.05);
            border-radius: 8px;
            transition: background 0.2s ease;
        }
        
        .pigeon-detail-item:hover {
            background: rgba(148, 163, 184, 0.1);
        }
        
        .pigeon-detail-item span:first-child {
            font-weight: 500;
            color: #94a3b8;
        }
        
        .pigeon-detail-item span:last-child {
            font-weight: 600;
            color: #e5e7eb;
        }
        
        /* Connection lines - Enhanced */
        .connection-line {
            position: absolute;
            background: linear-gradient(90deg, rgba(99, 102, 241, 0.4), rgba(168, 85, 247, 0.4));
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.3);
            animation: lineGlow 3s ease-in-out infinite;
            z-index: 1;
        }
        
        /* SVG Connection styles */
        .connection-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .connection-svg path {
            fill: none;
            stroke-width: 2;
            opacity: 0.8;
            animation: lineGlow 3s ease-in-out infinite;
        }
        
        .connection-svg circle {
            opacity: 0.9;
            animation: pulseGlow 2s ease-in-out infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% {
                r: 4;
                opacity: 0.9;
            }
            50% {
                r: 6;
                opacity: 1;
            }
        }
        
        @keyframes lineGlow {
            0%, 100% {
                opacity: 0.6;
                box-shadow: 0 0 10px rgba(99, 102, 241, 0.3);
            }
            50% {
                opacity: 1;
                box-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
            }
        }
        
        /* Connection joints - add dots at elbow corners */
        .connection-joint {
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #6366f1, #8b5cf6);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.6);
            transform: translate(-50%, -50%);
            z-index: 2;
        }
        
        .vertical-line {
            position: absolute;
            background: rgba(102, 126, 234, 0.3);
            width: 2px;
        }
        
        /* Mobile optimization */
        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .pedigree-wrapper {
                padding: 1rem;
            }
            
            .pedigree-tree {
                padding: 1rem;
                min-height: 400px;
                /* Removed transform scale - using smaller sizes instead */
                font-size: 0.85rem;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .generation {
                margin-right: 2rem;
                gap: 0.75rem;
            }
            
            .pigeon-node {
                min-width: 140px;
                max-width: 160px;
                padding: 0.5rem;
                font-size: 0.8rem;
            }
            
            .pigeon-header {
                gap: 0.75rem;
                margin-bottom: 0.75rem;
                padding-bottom: 0.75rem;
            }
            
            .pigeon-image,
            .pigeon-icon {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
            
            .pigeon-role {
                font-size: 0.625rem;
            }
            
            .pigeon-name {
                font-size: 1rem;
            }
            
            .pigeon-alt-name {
                font-size: 0.75rem;
            }
            
            .pigeon-details {
                font-size: 0.75rem;
                gap: 0.375rem;
            }
            
            .pigeon-detail-item {
                padding: 0.25rem 0.5rem;
            }
            
            /* Adjust connection lines */
            .connection-line::before,
            .connection-line::after {
                width: 6px;
                height: 6px;
            }
            
            /* Mobile-specific connection line improvements */
            .connection-line {
                /* Stronger lines for better visibility on mobile */
                background: linear-gradient(90deg, rgba(99, 102, 241, 0.6), rgba(168, 85, 247, 0.6)) !important;
                z-index: 10;
                min-height: 3px !important;
                min-width: 3px !important;
            }
            
            /* Keep connection joints for better visual guidance */
            .connection-joint {
                width: 10px !important;
                height: 10px !important;
                background: radial-gradient(circle, #6366f1, #8b5cf6) !important;
                z-index: 11;
            }
            
            /* Mobile SVG specific styles */
            .connection-svg {
                touch-action: none;
                will-change: transform;
            }
            
            .connection-svg path {
                stroke-width: 3 !important;
                stroke: url(#lineGradient) !important;
                opacity: 0.9 !important;
            }
            
            .connection-svg circle {
                r: 5 !important;
                opacity: 1 !important;
            }
            
            /* Ensure lines are properly positioned relative to viewport */
            .pedigree-tree {
                position: relative;
                overflow-x: auto;
                overflow-y: hidden;
            }
            
            /* Adjust line positioning for mobile viewport */
            .pedigree-connection-line {
                margin: 0 10px;
                width: 30px;
                height: 3px;
                background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.7), transparent) !important;
            }
        }
        
        /* Very small screens */
        @media (max-width: 480px) {
            .pedigree-tree {
                /* Removed transform scale - using even smaller sizes */
                font-size: 0.75rem;
                padding: 0.5rem;
            }
            
            .generation {
                margin-right: 1.5rem;
                gap: 0.5rem;
            }
            
            .pigeon-node {
                min-width: 120px;
                max-width: 140px;
                padding: 0.4rem;
                font-size: 0.75rem;
            }
            
            .pigeon-avatar {
                width: 35px;
                height: 35px;
            }
            
            .pigeon-image {
                width: 30px;
                height: 30px;
            }
            
            .pigeon-detail-item {
                font-size: 0.65rem;
                padding: 0.2rem 0.4rem;
            }
        }
        
        /* Print styles */
        @media print {
            .pedigree-tree {
                background: white !important;
                color: black !important;
                transform: none !important;
            }
            
            .pigeon-node {
                background: white !important;
                border: 2px solid #333 !important;
                color: black !important;
                box-shadow: none !important;
            }
            
            .pigeon-node.male {
                border-color: #2563eb !important;
            }
            
            .pigeon-node.female {
                border-color: #db2777 !important;
            }
            
            .connection-line {
                background: #333 !important;
                animation: none !important;
                box-shadow: none !important;
            }
            
            .connection-joint {
                display: none !important;
            }
            
            .pigeon-tooltip {
                display: none !important;
            }
            
            .pigeon-name,
            .pigeon-detail-item span {
                color: black !important;
            }
            
            .pigeon-detail-item {
                background: #f3f4f6 !important;
            }
        }
        
        /* RTL support */
        [dir="rtl"] .generation {
            margin-right: 0;
            margin-left: 80px;
        }
        
        [dir="rtl"] .generation:last-child {
            margin-left: 0;
        }
        
        [dir="rtl"] .connection-line {
            transform-origin: right center;
        }

        .tree-node:last-child::before {
            border-right: 2px solid #667eea;
            border-radius: 0 5px 0 0;
        }

        .tree-node:first-child::after {
            border-radius: 5px 0 0 0;
        }

        /* Image upload styles */
        .image-upload-area {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .image-upload-area:hover {
            border-color: #764ba2;
            background: rgba(102, 126, 234, 0.1);
        }

        .image-preview {
            max-width: 200px;
            max-height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin: 10px;
        }

        /* Filter styles */
        .filter-chip {
            display: inline-block;
            padding: 5px 15px;
            margin: 5px;
            background: rgba(102, 126, 234, 0.2);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-chip.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        /* Language selector */
        .lang-selector {
            position: relative;
            display: inline-block;
        }

        .lang-flag {
            width: 24px;
            height: 18px;
            margin-right: 5px;
            vertical-align: middle;
        }

        /* Theme toggle */
        /* Race results table */
        .race-table {
            width: 100%;
            border-collapse: collapse;
        }

        .race-table th,
        .race-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .race-table th {
            background: rgba(102, 126, 234, 0.2);
            font-weight: 600;
        }

        .race-table tr:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        /* Loading spinner */
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #764ba2, #667eea);
        }

        /* QR Code modal */
        #qrcode {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background: white;
            border-radius: 10px;
            margin: 20px auto;
        }

        /* Chart container */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            margin: 20px 0;
        }
        /* Date input calendar icon color */
        .date-input::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
        }
        
        /* Button hover fix */
        button {
            cursor: pointer !important;
            user-select: none;
        }
        
        button:active {
            transform: scale(0.98);
        }
        
        /* Language selector dropdown fix */
        #langSelector {
            background-color: var(--bg-secondary) !important;
            color: var(--text-primary) !important;
        }
        
        #langSelector option {
            background-color: var(--bg-secondary) !important;
            color: var(--text-primary) !important;
            padding: 5px;
        }
        
        #langSelector:focus {
            outline: 2px solid #667eea;
            outline-offset: 2px;
        }
        /* Premium Landing Page Animations */
        @keyframes heroFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-10px) rotate(-2deg); }
            50% { transform: translateY(-20px) rotate(2deg); }
            75% { transform: translateY(-10px) rotate(-1deg); }
        }
        
        @keyframes featherFall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        
        .floating-pigeon {
            animation: heroFloat 6s ease-in-out infinite;
        }
        
        .feather {
            position: fixed;
            color: rgba(255, 255, 255, 0.3);
            animation: featherFall 15s linear infinite;
            pointer-events: none;
            z-index: 1;
        }
        
        /* Video Background Overlay */
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, 
                rgba(15, 15, 15, 0.8) 0%, 
                rgba(15, 15, 15, 0.6) 50%, 
                rgba(15, 15, 15, 0.9) 100%);
            z-index: 1;
        }
        
        /* Feature Cards Premium Style */
        .feature-card-premium {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.05) 0%, 
                rgba(255, 255, 255, 0.02) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2rem;
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .feature-card-premium::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .feature-card-premium:hover::before {
            opacity: 1;
        }
        
        .feature-card-premium:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
        }
        
        /* Testimonial Cards */
        .testimonial-card {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.08) 0%, 
                rgba(255, 255, 255, 0.03) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2rem;
            position: relative;
        }
        
        .testimonial-card::before {
            content: '"';
            position: absolute;
            top: 1rem;
            left: 1.5rem;
            font-size: 4rem;
            color: rgba(102, 126, 234, 0.3);
            font-family: Georgia, serif;
        }
        
        /* Pricing Cards */
        .pricing-card {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.05) 0%, 
                rgba(255, 255, 255, 0.02) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2rem;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .pricing-card.featured {
            border: 2px solid rgba(102, 126, 234, 0.5);
            transform: scale(1.05);
        }
        
        .pricing-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        /* FAQ Accordion */
        .faq-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 1rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .faq-question {
            padding: 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
        }
        
        .faq-question:hover {
            background: rgba(255, 255, 255, 0.08);
        }
        
        .faq-answer {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            padding: 0 1.5rem;
        }
        
        .faq-item.active .faq-answer {
            max-height: 500px;
            padding: 0 1.5rem 1.5rem;
        }
        
        .faq-item.active .faq-icon {
            transform: rotate(180deg);
        }
        
        /* Performance Showcase */
        .performance-showcase {
            position: relative;
            overflow: hidden;
            border-radius: 20px;
            background: linear-gradient(135deg, 
                rgba(102, 126, 234, 0.1) 0%, 
                rgba(236, 72, 153, 0.1) 100%);
            padding: 3rem;
        }
        
        .performance-metric {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        
        .performance-metric:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(10px);
        }
        
        /* Animated Background Shapes */
        .bg-shape {
            position: absolute;
            opacity: 0.05;
            animation: float 20s ease-in-out infinite;
        }
        
        .bg-shape-1 {
            top: 10%;
            left: 10%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, #667eea 0%, transparent 70%);
            animation-delay: 0s;
        }
        
        .bg-shape-2 {
            top: 60%;
            right: 10%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, #764ba2 0%, transparent 70%);
            animation-delay: 5s;
        }
        
        .bg-shape-3 {
            bottom: 10%;
            left: 30%;
            width: 250px;
            height: 250px;
            background: radial-gradient(circle, #f093fb 0%, transparent 70%);
            animation-delay: 10s;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -30px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
        }
        
        /* Call to Action Buttons */
        .cta-button {
            position: relative;
            padding: 1rem 2.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .cta-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .cta-button:hover::before {
            left: 100%;
        }
        
        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
        }
        
        /* Badge Styles */
        .badge-new {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            background: linear-gradient(45deg, #f093fb, #f5576c);
            border-radius: 20px;
            color: white;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .badge-popular {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            border-radius: 20px;
            color: white;
        }
        
        /* Scroll Animations */
        .scroll-reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s ease;
        }
        
        .scroll-reveal.active {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Interactive Demo Widget */
        .demo-widget {
            position: relative;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 2rem;
            overflow: hidden;
        }
        
        .demo-widget::before {
            content: 'DEMO';
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.25rem 0.75rem;
            background: rgba(102, 126, 234, 0.2);
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.05em;
        }
        
        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .feature-card-premium {
                padding: 1.5rem;
            }
            .performance-showcase {
                padding: 1.5rem;
            }
            h3 {
                font-size: 2rem;
            }
            h4 {
                font-size: 1.25rem;
            }
            .text-4xl {
                font-size: 2rem;
            }
            .text-2xl {
                font-size: 1.25rem;
            }
            .text-xl {
                font-size: 1rem;
            }
            .text-5xl {
                font-size: 2.5rem;
            }
            .md\\:text-7xl {
                font-size: 3rem;
            }
            /* Navigation adjustments */
            nav .container {
                padding: 0.75rem 1rem;
            }
            /* Trust indicators mobile size */
            .glass p-6 {
                padding: 1rem;
            }
            /* Section padding reduction */
            section {
                padding-top: 2rem !important;
                padding-bottom: 2rem !important;
            }
            /* Background shapes mobile adjustment */
            .bg-shape {
                display: none;
            }
            /* Hide badges on very small screens */
            @media (max-width: 360px) {
                .badge-new, .badge-popular {
                    font-size: 0.6rem;
                    padding: 0.2rem 0.5rem;
                }
            }
        }
        /* Premium Dashboard Styles */
        .premium-hero-section {
            position: relative;
            overflow: hidden;
        }
        
        .premium-hero-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Quick Action Buttons */
        .quick-action-btn {
            @apply flex flex-col items-center justify-center p-4 rounded-xl transition-all duration-300;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .quick-action-btn:hover {
            transform: translateY(-4px);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .quick-action-icon {
            @apply w-16 h-16 rounded-full flex items-center justify-center mb-2;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .quick-action-btn:hover .quick-action-icon {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        /* Enhanced Stat Cards */
        .stat-card-premium {
            @apply relative p-6 rounded-2xl overflow-hidden transition-all duration-300;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .stat-card-premium::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, currentColor, transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .stat-card-premium:hover::before {
            opacity: 1;
            animation: shimmer 2s ease-in-out infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .stat-card-premium:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .stat-card-header {
            @apply flex items-center justify-between mb-4;
        }
        
        .stat-icon {
            @apply w-12 h-12 rounded-full flex items-center justify-center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .stat-trend {
            @apply text-xs font-semibold;
        }
        
        /* Progress Bar */
        .progress-bar {
            @apply w-full h-2 bg-gray-700 rounded-full overflow-hidden;
        }
        
        .progress-fill {
            @apply h-full rounded-full transition-all duration-1000 ease-out;
            box-shadow: 0 0 10px currentColor;
        }
        
        /* Counter Animation */
        .counter {
            @apply inline-block;
            font-variant-numeric: tabular-nums;
        }
        
        /* Activity Timeline */
        .suggestion-item {
            @apply flex items-start space-x-2 p-3 rounded-lg;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.2s ease;
        }
        
        .suggestion-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
            transform: translateX(4px);
        }
        
        /* Featured Pigeon Cards */
        .featured-pigeon-card {
            @apply relative rounded-2xl overflow-hidden cursor-pointer transition-all duration-300;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .featured-pigeon-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }
        
        .featured-pigeon-image {
            @apply relative h-48 bg-gray-800 flex items-center justify-center overflow-hidden;
        }
        
        .featured-pigeon-image img {
            @apply transition-transform duration-300;
        }
        
        .featured-pigeon-card:hover .featured-pigeon-image img {
            transform: scale(1.1);
        }
        
        /* Pigeon Card Premium */
        .pigeon-card-premium {
            @apply relative rounded-xl overflow-hidden cursor-pointer transition-all duration-300;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .pigeon-card-premium:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border-color: rgba(99, 102, 241, 0.5);
        }
        
        .pigeon-card-image {
            @apply h-32 bg-gray-800 flex items-center justify-center overflow-hidden;
        }
        
        .pigeon-card-image img {
            @apply transition-transform duration-300;
        }
        
        .pigeon-card-premium:hover .pigeon-card-image img {
            transform: scale(1.05);
        }
        
        /* Badge Champion */
        .badge-champion {
            @apply px-3 py-1 rounded-full text-xs font-semibold;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            box-shadow: 0 2px 10px rgba(255, 215, 0, 0.5);
        }
        
        /* Avatar Placeholder */
        .avatar-placeholder {
            @apply inline-block;
            filter: drop-shadow(0 4px 10px rgba(0, 0, 0, 0.3));
        }
        
        /* Pulse Animation */
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
        
        /* Floating Animation */
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .quick-action-btn {
                @apply p-3;
            }
            
            .quick-action-icon {
                @apply w-12 h-12;
            }
            
            .quick-action-btn span {
                @apply text-xs;
            }
            
            .stat-card-premium {
                @apply p-4;
            }
            
            .featured-pigeon-image {
                @apply h-40;
            }
            
            /* Mobile header layout fixes */
            #authSection {
                flex-direction: row;
                gap: 4px;
                align-items: center;
                flex-wrap: nowrap;
            }
            
            #langSelector {
                font-size: 12px;
            }
            
            /* Mobile menu button spacing */
            .md\\:hidden {
                margin-left: 8px;
            }
            
            /* Hamburger menu button styling */
            button[onclick*="toggleMobileMenu"]:not(.mobile-menu-close) {
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                color: white;
                min-width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            button[onclick*="toggleMobileMenu"]:not(.mobile-menu-close):hover {
                background: rgba(255, 255, 255, 0.2);
            }
            
            /* Navigation spacing for mobile */
            nav .container {
                padding-left: 1rem;
                padding-right: 1rem;
                height: 100%;
                padding-top: 12px;
                padding-bottom: 12px;
            }
            
            nav .flex.items-center.justify-between {
                gap: 12px;
                height: 100%;
                align-items: center;
            }
            
            /* Logo size limitation on mobile */
            nav .fa-dove {
                font-size: 24px !important;
            }
            
            nav h1 {
                font-size: 18px !important;
                line-height: 1.2 !important;
            }
            
            /* Mobile content spacing */
            #content {
                padding-top: 90px !important;
                position: relative;
                z-index: 1;
            }
            
            /* Nav bar fixed height */
            nav {
                height: 80px;
                max-height: 80px;
                overflow: hidden;
            }
            
            /* Remove glass effect on mobile */
            nav.glass {
                backdrop-filter: none !important;
                background: rgba(26, 26, 46, 0.98) !important;
                border-radius: 0 !important;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            }
            
            /* Ensure nav container doesn't overflow */
            nav > div {
                max-height: 80px;
                overflow: hidden;
            }
            
            /* Dynamic content first child spacing */
            #content > div:first-child,
            #content > section:first-child {
                padding-top: 20px;
                margin-top: 0 !important;
            }
            
            /* All direct children margin reset */
            #content > * {
                margin-top: 0 !important;
            }
            
            /* Hero section mobile spacing */
            .hero-section-mobile {
                padding-top: 20px;
            }
            
            /* Auth section elements size control */
            #authSection button,
            #authSection select {
                max-height: 36px;
            }
            
            /* Premium badge section mobile margin */
            .premium-badge-mobile {
                margin-top: 32px;
            }
            
            /* Hide desktop nav tabs completely on mobile */
            #navTabs {
                display: none !important;
            }
        }
        
        /* Additional responsive fixes for small screens */
        @media (max-width: 390px) {
            #langSelector {
                font-size: 11px;
                padding: 2px 4px;
            }
            
            .mobile-menu {
                padding-top: 90px;
            }
            
            #content {
                padding-top: 95px !important;
                position: relative;
                z-index: 1;
            }
            
            .mobile-menu .tab-btn {
                padding: 12px 16px;
            }
            
            /* Smaller buttons on very small screens */
            button[data-tr="btn_login"] {
                font-size: 11px;
                padding: 4px 6px;
            }
        }
        
        /* Fixes for larger mobile screens */
        @media (min-width: 390px) and (max-width: 768px) {
            .premium-badge-mobile {
                margin-top: 24px;
            }
            
            nav .container {
                padding-left: 1.5rem;
                padding-right: 1.5rem;
            }
        }

        /* Image preview animations */
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: scale(1); 
            }
        }

        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateX(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateX(0); 
            }
        }

        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out;
        }

        .animate-slideIn {
            animation: slideIn 0.4s ease-out;
        }
        
        /* Yarış Analizleri - Kompakt Tasarım */
        .speed-gauge-container {
            position: relative;
            width: 96px;
            height: 96px;
        }
        
        .mini-bar-chart {
            display: flex;
            align-items: flex-end;
            height: 4rem;
            gap: 0.5rem;
        }
        
        .mini-bar {
            flex: 1;
            background: #374151;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        
        .mini-bar-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            border-radius: 4px;
            transition: height 0.5s ease-out;
        }
        
        /* Mobile Optimizasyonları */
        @media (max-width: 768px) {
            .glass {
                padding: 1rem !important;
            }
            
            .speed-gauge-container {
                width: 80px;
                height: 80px;
            }
            
            .mini-bar-chart {
                height: 3rem;
            }
            
            canvas {
                max-height: 180px !important;
            }
        }
        
        /* Progress Bar Animasyonları */
        .progress-fill {
            transition: width 1s ease-out;
        }
        
        /* Hover Efektleri */
        .medal-item:hover .progress-fill {
            filter: brightness(1.2);
        }
        
        /* Gradient Progress Bars */
        .gradient-gold {
            background: linear-gradient(to right, #facc15, #f59e0b);
        }
        
        .gradient-silver {
            background: linear-gradient(to right, #d1d5db, #9ca3af);
        }
        
        .gradient-bronze {
            background: linear-gradient(to right, #fb923c, #ea580c);
        }
        
        .gradient-blue {
            background: linear-gradient(to right, #60a5fa, #3b82f6);
        }
        
        .gradient-gray {
            background: linear-gradient(to right, #6b7280, #4b5563);
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-bg"></div>
    
    <!-- Floating Particles -->
    <div id="particles"></div>

    <!-- Navigation Bar -->
    <nav class="fixed w-full top-0 z-50 glass">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" style="cursor: pointer;">
                    <i class="fas fa-dove text-3xl text-cyan-400"></i>
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent">
                        <span class="lang-text" data-tr="app_title">Güvercin Soyağacı</span>
                    </h1>
                </div>

                <!-- Navigation Tabs - Desktop -->
                <div id="navTabs" class="hidden md:flex items-center space-x-2 glass p-1 rounded-full">
                    <button onclick="showHomepage()" class="tab-btn px-4 py-2 rounded-full transition">
                        <i class="fas fa-home mr-2"></i> <span class="lang-text" data-tr="nav_home">Anasayfa</span>
                    </button>
                    <button onclick="showPigeons()" class="nav-auth-required tab-btn px-4 py-2 rounded-full transition" style="display: none;">
                        <i class="fas fa-dove mr-2"></i> <span class="lang-text" data-tr="nav_pigeons">Güvercinler</span>
                    </button>
                    <button onclick="showMatings()" class="nav-auth-required tab-btn px-4 py-2 rounded-full transition" style="display: none;">
                        <i class="fas fa-heart mr-2"></i> <span class="lang-text" data-tr="nav_matings">Eşleştirmeler</span>
                    </button>
                    <button onclick="showHealthRecords()" class="nav-auth-required tab-btn px-4 py-2 rounded-full transition" style="display: none;">
                        <i class="fas fa-notes-medical mr-2"></i> <span class="lang-text" data-tr="nav_health">Sağlık</span>
                    </button>
                    <button onclick="showPerformanceRecords()" class="nav-auth-required tab-btn px-4 py-2 rounded-full transition" style="display: none;">
                        <i class="fas fa-chart-line mr-2"></i> <span class="lang-text" data-tr="nav_performance">Performans</span>
                    </button>
                    <button onclick="showRacingPerformance()" class="nav-auth-required tab-btn px-4 py-2 rounded-full transition" style="display: none;">
                        <i class="fas fa-flag-checkered mr-2"></i> <span class="lang-text" data-tr="nav_racing">Yarış</span>
                    </button>
                    <button onclick="showAIBreeding()" class="nav-auth-required tab-btn px-4 py-2 rounded-full transition" style="display: none;">
                        <i class="fas fa-robot mr-2"></i> <span class="lang-text" data-tr="nav_ai_breeding">AI Eşleştirme</span>
                    </button>
                    <button onclick="showPricing()" class="tab-btn px-4 py-2 rounded-full transition">
                        <i class="fas fa-tags mr-2"></i> <span class="lang-text" data-tr="nav_pricing">Fiyatlandırma</span>
                    </button>
                </div>

                <div id="authSection" class="flex items-center space-x-2 md:space-x-4">
                    <!-- Language Selector -->
                    <select id="langSelector" onchange="changeLanguage(this.value)" class="bg-transparent border border-gray-600 rounded px-2 py-1 text-xs md:text-sm">
                        <option value="tr">🇹🇷 TR</option>
                        <option value="en">🇬🇧 EN</option>
                    </select>
                    
                    <button onclick="openAuthModal('login')" class="block px-2 md:px-4 py-1 md:py-2 text-xs md:text-sm hover:text-cyan-400 transition lang-text" data-tr="btn_login">
                        Giriş Yap
                    </button>
                    <button onclick="openAuthModal('register')" class="hidden sm:block btn-primary text-xs md:text-sm px-2 md:px-4 py-1 md:py-2 lang-text" data-tr="btn_register">
                        Üye Ol
                    </button>
                    
                    <!-- Mobile Menu Button -->
                    <button onclick="toggleMobileMenu()" class="md:hidden text-2xl p-2 hover:bg-white/10 rounded-lg transition">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Mobile Menu -->
    <div id="mobileMenu" class="mobile-menu">
        <button onclick="toggleMobileMenu()" class="mobile-menu-close">
            <i class="fas fa-times"></i>
        </button>
        <div class="p-4 space-y-2" id="mobileMenuItems">
            <button onclick="showHomepage(); toggleMobileMenu();" class="w-full tab-btn px-4 py-3 rounded-lg text-left">
                <i class="fas fa-home mr-2"></i> <span class="lang-text" data-tr="nav_home">Anasayfa</span>
            </button>
            <button onclick="showPigeons(); toggleMobileMenu();" class="w-full tab-btn px-4 py-3 rounded-lg text-left">
                <i class="fas fa-dove mr-2"></i> <span class="lang-text" data-tr="nav_pigeons">Güvercinler</span>
            </button>
            <button onclick="showMatings(); toggleMobileMenu();" class="w-full tab-btn px-4 py-3 rounded-lg text-left">
                <i class="fas fa-heart mr-2"></i> <span class="lang-text" data-tr="nav_matings">Eşleştirmeler</span>
            </button>
            <button onclick="showHealthRecords(); toggleMobileMenu();" class="w-full tab-btn px-4 py-3 rounded-lg text-left">
                <i class="fas fa-notes-medical mr-2"></i> <span class="lang-text" data-tr="nav_health">Sağlık</span>
            </button>
            <button onclick="showPerformanceRecords(); toggleMobileMenu();" class="w-full tab-btn px-4 py-3 rounded-lg text-left">
                <i class="fas fa-chart-line mr-2"></i> <span class="lang-text" data-tr="nav_performance">Performans</span>
            </button>
            <button onclick="showRacingPerformance(); toggleMobileMenu();" class="w-full tab-btn px-4 py-3 rounded-lg text-left">
                <i class="fas fa-flag-checkered mr-2"></i> <span class="lang-text" data-tr="nav_racing">Yarış</span>
            </button>
            <button onclick="showAIBreeding(); toggleMobileMenu();" class="w-full tab-btn px-4 py-3 rounded-lg text-left">
                <i class="fas fa-robot mr-2"></i> <span class="lang-text" data-tr="nav_ai_breeding">AI Eşleştirme</span>
            </button>
            <button onclick="showPricing(); toggleMobileMenu();" class="w-full tab-btn px-4 py-3 rounded-lg text-left">
                <i class="fas fa-tags mr-2"></i> <span class="lang-text" data-tr="nav_pricing">Fiyatlandırma</span>
            </button>
        </div>
    </div>





    <!-- Main Content Area -->
    <div id="content" class="pt-20 pb-12 px-4 md:px-6">
        <div class="container mx-auto">
            <!-- Varsayılan içerik -->
            <noscript>
                <div class="text-center py-20">
                    <i class="fas fa-exclamation-triangle text-4xl text-yellow-400 mb-4"></i>
                    <p class="text-xl">JavaScript is disabled. Please enable JavaScript in your browser.</p>
                </div>
            </noscript>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="authModal" class="modal">
        <div class="modal-content glass p-8 rounded-3xl">
            <span class="absolute top-4 right-4 text-3xl cursor-pointer hover:text-red-400" onclick="closeAuthModal()">&times;</span>
            
            <div id="authContent">
                <!-- Auth forms will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Pigeon Detail Modal -->
    <div id="pigeonModal" class="modal">
        <div class="modal-content glass p-8 rounded-3xl max-w-4xl">
            <span class="absolute top-4 right-4 text-3xl cursor-pointer hover:text-red-400" onclick="closePigeonModal()">&times;</span>
            
            <div id="pigeonDetail">
                <!-- Pigeon details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="qrModal" class="modal">
        <div class="modal-content glass p-8 rounded-3xl">
            <span class="absolute top-4 right-4 text-3xl cursor-pointer hover:text-red-400" onclick="closeQRModal()">&times;</span>
            <h3 class="text-2xl font-bold text-center mb-4 lang-text" data-tr="qr_title">QR Kod</h3>
            <div id="qrcode"></div>
            <div class="text-center mt-4">
                <button onclick="downloadQRCode()" class="btn-primary">
                    <i class="fas fa-download mr-2"></i> <span class="lang-text" data-tr="qr_download">İndir</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Immediately execute to ensure functions are available
        (function() {
            console.log('Starting script initialization...');
        })();
        
        // Create floating particles
        const translations = {
            tr: {
                app_title: "Güvercin Soyağacı",
                nav_home: "Anasayfa",
                good_morning: "Günaydın",
                good_afternoon: "İyi günler", 
                good_evening: "İyi akşamlar",
                dashboard_subtitle: "Güvercin koloninizi yönetim panelinize hoş geldiniz",
                active_rate: "aktif",
                this_month: "bu ay",
                champions: "Şampiyonlar",
                with_achievements: "başarılı",
                recent_activities: "Son Aktiviteler",
                no_recent_activities: "Henüz aktivite yok",
                view_all: "Tümünü Gör",
                featured_pigeons: "Öne Çıkan Güvercinler",
                upcoming_events: "Yaklaşan Etkinlikler",
                no_upcoming_events: "Yaklaşan etkinlik yok",
                expected_hatching: "Yumurtadan çıkma bekleniyor",
                days: "gün",
                ai_suggestions: "Akıllı Öneriler",
                suggestion_add_pigeons: "Koloninizi genişletmek için yeni güvercinler ekleyin",
                suggestion_start_breeding: "Üreme programınıza başlamak için eşleştirmeler yapın",
                suggestion_join_race: "İlk yarışınızı oluşturun ve performans takibi başlatın",
                suggestion_view_reports: "Detaylı analizler için raporlar sayfasını ziyaret edin",
                weather_conditions: "Hava Durumu",
                good_for_flying: "Uçuş için uygun",
                all_pigeons: "Tüm Güvercinler",
                add_first_pigeon: "İlk Güvercinizi Ekleyin",
                performance_overview: "Performans Özeti",
                years_old: "yaşında",
                added: "eklendi",
                new_mating_recorded: "Yeni eşleştirme kaydedildi",
                completed: "tamamlandı",
                years_ago: "yıl önce",
                months_ago: "ay önce",
                days_ago: "gün önce",
                hours_ago: "saat önce",
                minutes_ago: "dakika önce",
                seconds_ago: "saniye önce",
                nav_pigeons: "Güvercinlerim",
                nav_matings: "Kuluçka Takibi",
                nav_health: "Sağlık Kayıtları",
                nav_performance: "Performans",
                nav_racing: "Yarış",
                nav_ai_breeding: "AI Eşleştirme",
                nav_pricing: "Fiyatlandırma",
                ai_breeding_title: "AI Güvercin Eşleştirme Sistemi",
                ai_breeding_subtitle: "Yapay zeka destekli genetik analiz ve optimal eşleştirme önerileri",
                select_male: "Erkek Seç",
                select_female: "Dişi Seç",
                select_pigeon: "Güvercin Seçin",
                breeding_preferences: "Eşleştirme Tercihleri",
                priority_health: "Sağlık öncelikli",
                priority_performance: "Performans öncelikli",
                priority_color: "Renk öncelikli",
                priority_diversity: "Genetik çeşitlilik öncelikli",
                inbreeding_tolerance: "Akrabalık toleransı",
                run_ai_analysis: "AI Analiz Et",
                compatibility_score: "Uyumluluk Skoru",
                score_genetic: "Genetik",
                score_health: "Sağlık",
                score_performance: "Performans",
                score_phenotype: "Fenotip",
                score_fertility: "Doğurganlık",
                score_experience: "Deneyim",
                kinship_analysis: "Akrabalık Analizi",
                relationship: "İlişki",
                kinship_coefficient: "Akrabalık Katsayısı",
                common_ancestors: "Ortak Atalar",
                offspring_predictions: "Yavru Tahminleri",
                warnings: "Uyarılar",
                advantages: "Avantajlar",
                save_recommendation: "Öneriyi Kaydet",
                create_mating: "Eşleştirme Oluştur",
                print_report: "Rapor Yazdır",
                smart_recommendations: "Akıllı Öneriler",
                select_pigeon_for_recommendations: "Bir güvercin seçin, size en uygun eşleri önerelim",
                loading_recommendations: "Öneriler hazırlanıyor...",
                no_recommendations: "Uygun öneri bulunamadı",
                best_match: "En İyi Eş",
                season_planning: "Sezon Planlama",
                optimal_pairing_description: "Tüm güvercinleriniz için optimal eşleştirme planı oluşturun",
                generate_optimal_plan: "Optimal Plan Oluştur",
                generating_optimal_plan: "Optimal plan oluşturuluyor...",
                total_pairings: "Toplam Eşleştirme",
                average_score: "Ortalama Skor",
                genetic_diversity: "Genetik Çeşitlilik",
                expected_offspring: "Beklenen Yavru",
                phase: "Faz",
                priority: "Öncelik",
                apply_plan: "Planı Uygula",
                export_plan: "Planı İndir",
                please_select_both: "Lütfen hem erkek hem dişi güvercin seçin",
                recommendation_saved: "Öneri kaydedildi!",
                error_saving: "Kaydetme hatası!",
                mating_created: "Eşleştirme oluşturuldu!",
                error_creating_mating: "Eşleştirme oluşturma hatası!",
                confirm_apply_plan: "Tüm eşleştirmeler oluşturulacak. Onaylıyor musunuz?",
                plan_applied: "Plan uygulandı!",
                error_loading_recommendations: "Öneriler yüklenirken hata oluştu",
                error_generating_plan: "Plan oluşturulurken hata oluştu",
                btn_login: "Giriş Yap",
                btn_register: "Üye Ol",
                hero_title1: "Profesyonel Güvercin",
                hero_title2: "Soyağacı Takibi",
                hero_description: "Güvercinlerinizin soyağacını takip edin, sağlık kayıtlarını tutun, eşleştirmeleri yönetin ve 10 nesile kadar detaylı raporlar alın.",
                btn_start: "Hemen Başla",
                stat_pigeons: "Kayıtlı Güvercin",
                stat_breeders: "Aktif Üretici",
                stat_matings: "Başarılı Eşleştirme",
                stat_champions: "Şampiyon Güvercin",
                features_title: "Özellikler",
                feature1_title: "Detaylı Soyağacı",
                feature1_desc: "10 nesile kadar soyağacı takibi yapın. Görsel ağaç yapısı ile anne-baba ilişkilerini kolayca görüntüleyin.",
                feature2_title: "Fotoğraf Galerisi",
                feature2_desc: "Her güvercin için sınırsız fotoğraf yükleyin. Gelişim sürecini görsel olarak takip edin.",
                feature3_title: "Premium Pedigree Tasarımı",
                feature3_desc: "Özel tasarlanmış profesyonel soyağacı belgelerini tek tıkla indirin. PDF ve görsel formatlarında hazır şablonlar.",
                feature4_title: "Sağlık Takibi",
                feature4_desc: "Aşı takvimi, veteriner kontrolleri ve tedavi geçmişini tek yerden yönetin.",
                feature5_title: "Eşleştirme Yönetimi",
                feature5_desc: "Çiftleşme kayıtları tutun, yumurtlama tarihlerini takip edin ve yavru sayılarını görüntüleyin.",
                feature6_title: "İstatistikler",
                feature6_desc: "Detaylı raporlar ve grafiklerle güvercinlerinizin performansını analiz edin.",
                tab_dashboard: "Özet",
                tab_pigeons: "Güvercinler",
                tab_matings: "Eşleştirmeler",
                tab_health: "Sağlık",
                tab_races: "Yarışlar",
                tab_reports: "Raporlar",
                welcome: "Hoşgeldin",
                total_pigeons: "Toplam Güvercin",
                male: "Erkek",
                female: "Dişi",
                pairing: "Eşleştirme",
                recent_pigeons: "Son Eklenen Güvercinler",
                upcoming_health: "Yaklaşan Sağlık Kontrolleri",
                no_pigeons: "Henüz güvercin eklenmemiş",
                no_health_checks: "Yaklaşan kontrol bulunmuyor",
                my_pigeons: "Güvercinlerim",
                add_pigeon: "Güvercin Ekle",
                breed: "Irk",
                gender: "Cinsiyet",
                color: "Renk",
                birth: "Doğum",
                detail: "Detay",
                pedigree: "Soyağacı",
                add_new_pigeon: "Yeni Güvercin Ekle",
                name: "Adı",
                band_number: "Künye No",
                select: "Seçiniz",
                birth_date: "Doğum Tarihi",
                father: "Babası",
                mother: "Annesi",
                description: "Açıklama",
                save: "Kaydet",
                cancel: "İptal",
                edit: "Düzenle",
                basic_info: "Temel Bilgiler",
                parent_info: "Ebeveyn Bilgileri",
                health_records: "Sağlık Kayıtları",
                unknown: "Bilinmeyen",
                no_health_records: "Henüz sağlık kaydı bulunmuyor",
                view_pedigree: "Soyağacını Görüntüle",
                create_qr: "QR Kod Oluştur",
                back: "Geri Dön",
                download_pdf: "PDF İndir",
                download_pdf_hd: "HD PDF İndir (Gelişmiş)",
                new_mating: "Yeni Kuluçka Kaydı",
                male_pigeon: "Erkek Güvercin",
                female_pigeon: "Dişi Güvercin",
                mating_date: "Eşleştirme Tarihi",
                egg_laying_date: "Yumurtlama Tarihi",
                expected_hatch: "Tahmini Çıkış Tarihi",
                hatched: "Çıkış Gerçekleşti",
                notes: "Notlar",
                no_matings: "Henüz kuluçka kaydı bulunmuyor",
                add_record: "Kayıt Ekle",
                record_type: "Kayıt Türü",
                date: "Tarih",
                veterinarian: "Veteriner",
                cost: "Maliyet",
                next_check: "Sonraki Kontrol",
                vaccination: "Aşılama",
                illness: "Hastalık",
                treatment: "Tedavi",
                checkup: "Kontrol",
                medication: "İlaçlama",
                reports_stats: "Raporlar ve İstatistikler",
                breed_dist: "Irk Dağılımı",
                general_stats: "Genel İstatistikler",
                cost_analysis: "Maliyet Analizi",
                gender_ratio: "Erkek/Dişi Oranı",
                total_health_cost: "Toplam Sağlık Harcaması",
                avg_health_cost: "Ortalama Sağlık Maliyeti",
                participants: "Katılımcı Sayısı",
                upload_photo: "Fotoğraf Yükle",
                drag_drop: "Sürükle bırak veya tıkla",
                max_size: "Maksimum dosya boyutu: 5MB",
                supported_formats: "Desteklenen formatlar: JPG, PNG, GIF",
                filter_by_breed: "Irka Göre Filtrele",
                filter_by_gender: "Cinsiyete Göre Filtrele",
                clear_filters: "Filtreleri Temizle",
                search: "Ara",
                sort_by: "Sırala",
                sort_name: "İsme Göre",
                sort_date: "Tarihe Göre",
                sort_age: "Yaşa Göre",
                export_excel: "Excel'e Aktar",
                import_data: "Veri İçe Aktar",
                backup_data: "Yedekle",
                restore_data: "Geri Yükle",
                settings: "Ayarlar",
                profile: "Profil",
                logout: "Çıkış Yap",
                email: "E-posta",
                password: "Şifre",
                confirm_password: "Şifre Tekrar",
                first_name: "Ad",
                last_name: "Soyad",
                already_member: "Zaten hesabınız var mı?",
                no_account: "Hesabınız yok mu?",
                login_title: "Giriş Yap",
                register_title: "Üye Ol",
                success: "Başarılı",
                error: "Hata",
                invalid_credentials: "E-posta veya şifre hatalı",
                email_exists: "Bu e-posta adresi zaten kayıtlı",
                info: "Bilgi",
                warning: "Uyarı",
                delete_confirm: "Silmek istediğinizden emin misiniz?",
                yes: "Evet",
                no: "Hayır",
                qr_title: "QR Kod",
                qr_download: "İndir",
                loading: "Yükleniyor...",
                no_data: "Veri bulunamadı",
                all: "Tümü",
                active: "Aktif",
                inactive: "Pasif",
                public: "Herkese Açık",
                private: "Özel",
                share: "Paylaş",
                edit: "Düzenle",
                delete: "Sil",
                view: "Görüntüle",
                print: "Yazdır",
                copy: "Kopyala",
                paste: "Yapıştır",
                cut: "Kes",
                select_all: "Tümünü Seç",
                racing_homer: "Yarış Güvercini",
                tumbler: "Taklacı",
                fantail: "Kumru",
                jacobin: "Jakobeni",
                pouter: "Kursak",
                carrier: "Posta Güvercini",
                other: "Diğer",
                white: "Beyaz",
                black: "Siyah",
                blue: "Mavi",
                red: "Kırmızı",
                yellow: "Sarı",
                silver: "Gümüş",
                brown: "Kahverengi",
                grey: "Gri",
                mixed: "Karışık",
                login_required: "Lütfen ilgili bölümü görebilmek için üye girişi yapın",
                welcome: "Hoş geldiniz",
                
                // Landing Page - New sections
                demo_button: "Demo Görüntüle",
                video_play: "Videoyu Oynat",
                performance_showcase_title: "Gelişmiş Performans Takibi",
                performance_showcase_desc: "Güvercinlerinizin performansını profesyonel seviyede takip edin",
                
                // Performance Features
                feature_tumbler_title: "Kelebek Güvercin Performansı",
                feature_tumbler_desc: "Uçuş stilleri, dayanıklılık ve estetik performans metriklerini detaylı takip edin",
                feature_racing_title: "Posta Güvercini Yarış Performansı",
                feature_racing_desc: "Detaylı yarış analizleri, hız trendleri, sıralama istatistikleri ve performans grafikleri",
                feature_breeding_title: "Akıllı Eşleştirme",
                feature_breeding_desc: "Genetik uyumluluk analizi ve optimum eş önerileri",
                
                // Combined Features for Homepage
                feature_combined_pedigree_title: "Soyağacı & Görsel Yönetim",
                feature_combined_pedigree_desc: "10 nesile kadar detaylı soyağacı takibi, görsel ağaç yapısı ve sınırsız fotoğraf galerisi ile güvercinlerinizin geçmişini ve gelişimini takip edin.",
                feature_combined_pedigree_item1: "Detaylı soyağacı görselleştirme",
                feature_combined_pedigree_item2: "Sınırsız fotoğraf yükleme", 
                feature_combined_pedigree_item3: "Aile ağacı takibi",
                feature_combined_health_title: "Sağlık & Performans Analitik",
                feature_combined_health_desc: "Aşı takvimi, veteriner kontrolleri ve tedavi geçmişi ile birlikte detaylı performans analizleri ve trend raporları.",
                feature_combined_health_item1: "Kapsamlı sağlık takibi",
                feature_combined_health_item2: "Performans trend analizleri",
                feature_combined_health_item3: "Detaylı istatistik raporları",
                feature_combined_ai_title: "AI Destekli Akıllı Sistemler",
                feature_combined_ai_desc: "Yapay zeka ile genetik uyumluluk analizi, optimal eşleştirme önerileri ve otomatik performans tahminleri.",
                feature_combined_ai_item1: "Akıllı eşleştirme önerileri",
                feature_combined_ai_item2: "Genetik uyumluluk analizi",
                feature_combined_ai_item3: "Çoklu dil desteği",
                feature_combined_ai_badge: "AI POWERED",
                more_info: "Daha fazla bilgi",
                detailed_analyses_login: "Detaylı analizler için giriş yapın",
                
                // Performance Showcase
                performance_real_time: "GERÇEK ZAMANLI ANALİTİK",
                performance_new_badge: "YENİ",
                performance_popular_badge: "POPÜLER",
                performance_flight_style: "Uçuş Stili",
                performance_flight_style_desc: "Estetik uçuş paternleri ve stil analizi",
                performance_endurance: "Dayanıklılık",
                performance_endurance_desc: "Uzun süreli uçuş performansı ve kondisyon",
                performance_aesthetic_score: "Estetik Puan",
                performance_aesthetic_score_desc: "Güzellik ve form değerlendirmesi",
                performance_detailed_analysis: "Detaylı Yarış Analizleri",
                performance_detailed_analysis_desc: "Hız trendleri, sıralama dağılımları ve performans metrikleri",
                performance_success_stats: "Başarı İstatistikleri",
                performance_success_stats_desc: "Madalya dağılımı ve podyum performansları",
                performance_distance_correlation: "Mesafe-Hız Korelasyonu",
                performance_distance_correlation_desc: "Mesafeye göre optimal performans analizi",
                performance_genetic_map: "Genetik Haritası",
                performance_genetic_map_desc: "DNA analizi ve kalıtsal özellik takibi",
                performance_compatibility_score: "Uyumluluk Skoru",
                performance_compatibility_score_desc: "AI destekli optimal eşleştirme önerileri",
                performance_next_generation: "Sonraki Nesil",
                performance_next_generation_desc: "Yavru potansiyeli ve özellik tahminleri",
                
                // Racing Analytics
                racing_analytics_title: "Yarış Analizleri",
                racing_analytics_filters: "Filtreler",
                racing_analytics_date_range: "Tarih Aralığı",
                racing_analytics_all_time: "Tüm Zamanlar",
                racing_analytics_last_30_days: "Son 30 Gün",
                racing_analytics_last_3_months: "Son 3 Ay",
                racing_analytics_last_6_months: "Son 6 Ay",
                racing_analytics_last_year: "Son 1 Yıl",
                racing_analytics_pigeon: "Güvercin",
                racing_analytics_all_pigeons: "Tüm Güvercinler",
                racing_analytics_export_report: "Rapor İndir",
                racing_analytics_avg_speed: "Ortalama Hız",
                racing_analytics_win_rate: "Kazanma Oranı",
                racing_analytics_avg_rank: "Ortalama Sıralama",
                racing_analytics_avg_distance: "Ortalama Mesafe",
                racing_analytics_best: "En iyi",
                racing_analytics_wins: "birincilik",
                racing_analytics_race: "yarış",
                racing_analytics_podium: "podyum",
                racing_analytics_total: "Toplam",
                racing_analytics_speed_performance: "Hız Performansı",
                racing_analytics_ranking_performance: "Sıralama Performansı",
                racing_analytics_last_races: "Son Yarışlar",
                racing_analytics_1st_place: "1. Sıra",
                racing_analytics_2nd_place: "2. Sıra",
                racing_analytics_3rd_place: "3. Sıra",
                racing_analytics_top_10: "İlk 10",
                racing_analytics_other: "Diğer",
                racing_analytics_detailed_analysis: "Detaylı Analiz",
                racing_analytics_best_performances: "En İyi Performanslar",
                racing_analytics_development_suggestions: "Gelişim Önerileri",
                racing_analytics_report_preparing: "Rapor hazırlanıyor...",
                racing_analytics_report_downloaded: "Rapor indirildi",
                racing_analytics_report_error: "Rapor oluşturulurken hata oluştu",
                racing_analytics_error_loading: "Analizler yüklenirken hata oluştu",
                
                // Racing Analytics Suggestions
                suggestion_speed_improvement: "Hız Geliştirme Gerekli",
                suggestion_speed_improvement_desc: "Ortalama hızınız düşük. Antrenman programını gözden geçirin.",
                suggestion_excellent_speed: "Mükemmel Hız Performansı",
                suggestion_excellent_speed_desc: "Güvercinleriniz harika hız performansı gösteriyor!",
                suggestion_ranking_improvement: "Sıralama İyileştirmesi",
                suggestion_ranking_improvement_desc: "Yarış stratejisini gözden geçirmeyi düşünün.",
                suggestion_competitive_power: "Rekabet Gücü",
                suggestion_competitive_power_desc: "Daha rekabetçi sonuçlar için eşleştirme stratejisini değiştirin.",
                suggestion_long_distance: "Uzun Mesafe Uzmanı",
                suggestion_long_distance_desc: "Güvercinleriniz uzun mesafe yarışlarında başarılı.",
                
                // Testimonials
                testimonials_title: "Kullanıcı Deneyimleri",
                testimonial1_text: "Bu sistem sayesinde güvercinlerimin performansını çok daha iyi takip edebiliyorum. Özellikle oyun dönüş kuşu performans takibi harika!",
                testimonial1_author: "Ahmet Yılmaz",
                testimonial1_role: "Profesyonel Güvercin Yetiştiricisi",
                testimonial2_text: "10 yıldır güvercin yetiştiriyorum. Bu kadar detaylı ve kullanışlı bir sistem görmedim. Yarış sonuçlarım %40 iyileşti.",
                testimonial2_author: "Mehmet Demir",
                testimonial2_role: "Yarış Güvercini Uzmanı",
                testimonial3_text: "Soyağacı takibi ve genetik analizler muhteşem. Hangi güvercinleri eşleştireceğime artık çok daha kolay karar verebiliyorum.",
                testimonial3_author: "Fatma Kaya",
                testimonial3_role: "Güvercin Üreticisi",
                
                // Pricing
                pricing_title: "Size Uygun Planı Seçin",
                pricing_monthly: "Aylık",
                pricing_yearly: "Yıllık (2 ay ücretsiz)",
                plan_free: "Ücretsiz",
                plan_premium: "Premium",
                plan_price_free: "0₺",
                plan_price_premium: "₺39.90",
                plan_period: "/ay",
                btn_choose_plan: "Planı Seç",
                btn_current_plan: "Mevcut Plan",
                btn_upgrade: "Yükselt",
                
                // Free Plan Features
                free_feature1: "7 güvercin kaydı",
                free_feature2: "Temel soyağacı takibi",
                free_feature3: "Sağlık kayıtları",
                free_feature4: "QR kod paylaşımı",
                
                // Premium Plan Features
                premium_feature1: "Sınırsız güvercin kaydı",
                premium_feature2: "Gelişmiş 10 nesil soyağacı takibi",
                premium_feature3: "Yapay zeka eşleştirme ve genetik renk analizi",
                premium_feature4: "Yarış ve performans takibi",
                premium_feature5: "Excel dışa aktarım",
                premium_feature6: "Topluluk erişimi",
                premium_feature7: "7/24 destek",
                
                // Pricing Additional
                badge_popular: "EN POPÜLER",
                trial_info: "Tüm planlar 7 günlük ücretsiz deneme süresi içerir",
                no_cc_required: "Kredi kartı gerekmez • İstediğiniz zaman iptal edebilirsiniz",
                
                // FAQ
                faq_title: "Sıkça Sorulan Sorular",
                faq_q1: "Sistem nasıl çalışır?",
                faq_a1: "Üye olduktan sonra güvercinlerinizi kaydedebilir, soyağaçlarını takip edebilir, performans kayıtları tutabilir ve detaylı raporlar alabilirsiniz.",
                faq_q2: "Güvercin kaydı sınırı var mı?",
                faq_a2: "Ücretsiz planda 7 güvercin kaydedebilirsiniz. Premium planda sınır yoktur.",
                faq_q3: "Verilerin güvenliği nasıl sağlanıyor?",
                faq_a3: "Tüm verileriniz şifreli olarak saklanır ve sadece sizin erişiminize açıktır. Verileriniz asla üçüncü taraflarla paylaşılmaz.",
                faq_q4: "Mobil uygulama var mı?",
                faq_a4: "Web uygulamamız mobil uyumludur. Native mobil uygulama üzerinde çalışıyoruz.",
                faq_q5: "Ödeme yöntemleri nelerdir?",
                faq_a5: "Kredi kartı, banka havalesi ve sanal pos ile ödeme yapabilirsiniz.",
                
                // CTA
                cta_title: "Hemen Başlayın",
                cta_subtitle: "Güvercinlerinizin geleceği için bugün adım atın",
                cta_button: "Ücretsiz Deneyin",
                total_pigeons: "Toplam Güvercin",
                active_pigeons: "Aktif Güvercin",
                total_matings: "Eşleştirmeler",
                total_races: "Yarışlar",
                recent_pigeons: "Son Eklenen Güvercinler",
                upcoming_hatching: "Yaklaşan Kuluçka Çıkımları",
                no_pigeons: "Henüz güvercin eklenmemiş",
                no_hatching: "Yaklaşan kuluçka çıkımı yok",
                logout: "Çıkış",
                
                // Performans takibi
                performance: "Performans",
                performance_type: "Performans Türü",
                tumbling_performance: "Taklacı Performansı",
                postal_performance: "Posta Performansı",
                butterfly_performance: "Kelebek Güvercini Performansı",
                racing_performance: "Yarış Performansı",
                racing_performance_title: "Yarış Performans Yönetimi",
                race_speed: "Hız",
                race_distance: "Mesafe", 
                race_rank: "Sıralama",
                total_participants: "Toplam Katılımcı",
                add_performance_record: "Performans Kaydı Ekle",
                performance_date: "Performans Tarihi",
                weather_conditions: "Hava Koşulları",
                
                // Taklacı metrikleri
                tumble_count: "Takla Sayısı (sefer başına)",
                session_count: "Sefer Sayısı",
                flight_duration: "Uçuş Süresi",
                discipline_score: "Disiplin Skoru",
                height_control: "Yükseklik Kontrolü",
                
                // Posta metrikleri
                flight_speed: "Uçuş Hızı",
                navigation_accuracy: "Navigasyon Doğruluğu",
                weather_adaptation: "Hava Uyumu",
                endurance_score: "Dayanıklılık Skoru",
                distance_performance: "Mesafe Performansı",
                
                // Kelebek Güvercini metrikleri
                bonkorluk: "Bonkörlük (Oyun Sıklığı)",
                flight_time_distance: "Uçuş Süresi",
                flight_style: "Uçuş Stili",
                consistency: "İstikrar (Performans Sürekliliği)",
                home_loyalty_control: "Ev Sadakati ve Kontrol",
                
                // Performans skorları
                overall_score: "Genel Skor",
                race_performance: "Yarış Performansı",
                breeding_performance: "Üreme Performansı",
                health_performance: "Sağlık Performansı",
                avg_speed: "Ortalama Hız",
                success_rate: "Başarı Oranı",
                no_performance: "Henüz performans kaydı bulunmuyor",
                summary: "Özeti",
                list: "Listesi",
                comparison: "Karşılaştırma",
                analysis: "Analiz",
                system: "Sistemi",
                image_added: "Resim eklendi",
                image_added_success: "Resim başarıyla eklendi",
                select_valid_image: "Lütfen geçerli bir resim dosyası seçin",
                error_loading: "Yüklenirken hata oluştu",
                
                // Renk genetiği çevirileri
                color_predictions: "Yavru Renk Tahminleri",
                white_color_details: "Beyaz Renk Detayları",
                hidden_color_genes: "Gizli Renk Genleri",
                color_compatibility: "Renk Uyumu",
                select_color: "Renk Seçin",
                parent_colors: "Ebeveyn Renkleri",
                color_distribution: "Renk Dağılımı",
                color_genetic_info: "Renk Genetik Bilgisi",
                color_inheritance: "Renk Kalıtımı",
                white_carrier_note: "Beyaz güvercinler gizli renk genleri taşıyabilir",
                color_risk_factors: "Renk Risk Faktörleri"
            },
            en: {
                app_title: "Pigeon Pedigree",
                nav_home: "Homepage",
                nav_pigeons: "My Pigeons",
                nav_matings: "Matings",
                nav_health: "Health Records",
                nav_performance: "Performance",
                nav_racing: "Racing",
                nav_ai_breeding: "AI Breeding",
                nav_pricing: "Pricing",
                ai_breeding_title: "AI Pigeon Breeding System",
                ai_breeding_subtitle: "AI-powered genetic analysis and optimal pairing recommendations",
                select_male: "Select Male",
                select_female: "Select Female",
                select_pigeon: "Select Pigeon",
                breeding_preferences: "Breeding Preferences",
                priority_health: "Health priority",
                priority_performance: "Performance priority",
                priority_color: "Color priority",
                priority_diversity: "Genetic diversity priority",
                inbreeding_tolerance: "Inbreeding tolerance",
                run_ai_analysis: "Run AI Analysis",
                compatibility_score: "Compatibility Score",
                score_genetic: "Genetic",
                score_health: "Health",
                score_performance: "Performance",
                score_phenotype: "Phenotype",
                score_fertility: "Fertility",
                score_experience: "Experience",
                kinship_analysis: "Kinship Analysis",
                relationship: "Relationship",
                kinship_coefficient: "Kinship Coefficient",
                common_ancestors: "Common Ancestors",
                offspring_predictions: "Offspring Predictions",
                warnings: "Warnings",
                advantages: "Advantages",
                save_recommendation: "Save Recommendation",
                create_mating: "Create Mating",
                print_report: "Print Report",
                smart_recommendations: "Smart Recommendations",
                select_pigeon_for_recommendations: "Select a pigeon to get the best matching partners",
                loading_recommendations: "Loading recommendations...",
                no_recommendations: "No suitable recommendations found",
                best_match: "Best Match",
                season_planning: "Season Planning",
                optimal_pairing_description: "Create an optimal pairing plan for all your pigeons",
                generate_optimal_plan: "Generate Optimal Plan",
                generating_optimal_plan: "Generating optimal plan...",
                total_pairings: "Total Pairings",
                average_score: "Average Score",
                genetic_diversity: "Genetic Diversity",
                expected_offspring: "Expected Offspring",
                phase: "Phase",
                priority: "Priority",
                apply_plan: "Apply Plan",
                export_plan: "Export Plan",
                please_select_both: "Please select both male and female pigeon",
                recommendation_saved: "Recommendation saved!",
                error_saving: "Error saving!",
                mating_created: "Mating created!",
                error_creating_mating: "Error creating mating!",
                confirm_apply_plan: "All pairings will be created. Do you confirm?",
                plan_applied: "Plan applied!",
                error_loading_recommendations: "Error loading recommendations",
                error_generating_plan: "Error generating plan",
                btn_login: "Login",
                btn_register: "Register",
                hero_title1: "Professional Pigeon",
                hero_title2: "Pedigree Tracking",
                hero_description: "Track your pigeons' pedigree, maintain health records, manage matings and get detailed reports up to 10 generations.",
                btn_start: "Get Started",
                stat_pigeons: "Registered Pigeons",
                stat_breeders: "Active Breeders",
                stat_matings: "Successful Matings",
                stat_champions: "Champion Pigeons",
                features_title: "Features",
                feature1_title: "Detailed Pedigree",
                feature1_desc: "Track pedigree up to 10 generations. Easily view parent-child relationships with visual tree structure.",
                feature2_title: "Photo Gallery",
                feature2_desc: "Upload unlimited photos for each pigeon. Track development process visually.",
                feature3_title: "Premium Pedigree Design",
                feature3_desc: "Download professionally designed pedigree certificates with one click. Ready templates in PDF and image formats.",
                feature4_title: "Health Tracking",
                feature4_desc: "Manage vaccination schedule, veterinary checks and treatment history in one place.",
                feature5_title: "Mating Management",
                feature5_desc: "Keep mating records, track hatching dates and view offspring counts.",
                feature6_title: "Statistics",
                feature6_desc: "Analyze your pigeons' performance with detailed reports and charts.",
                login_required: "Please login to view this section",
                welcome: "Welcome",
                total_pigeons: "Total Pigeons",
                active_pigeons: "Active Pigeons",
                total_matings: "Matings",
                recent_pigeons: "Recent Pigeons",
                upcoming_hatching: "Upcoming Hatching",
                no_pigeons: "No pigeons added yet",
                no_hatching: "No upcoming hatching",
                logout: "Logout",
                save: "Save",
                cancel: "Cancel",
                edit: "Edit",
                name: "Name",
                band_number: "Band Number",
                gender: "Gender",
                breed: "Breed",
                birth_date: "Birth Date",
                father: "Father",
                mother: "Mother",
                description: "Description",
                male: "Male",
                female: "Female",
                select: "Select",
                success: "Success",
                upload_photo: "Upload Photo",
                drag_drop: "Drag and drop or click",
                max_size: "Maximum file size: 5MB",
                supported_formats: "Supported formats: JPG, PNG, GIF",
                error: "Error",
                invalid_credentials: "Invalid email or password",
                email_exists: "This email is already registered",
                info: "Info",
                warning: "Warning",
                first_name: "First Name",
                last_name: "Last Name",
                email: "Email",
                password: "Password",
                already_member: "Already have an account?",
                no_account: "Don't have an account?",
                rotation_direction: "Rotation Direction",
                right_wing: "Right Wing",
                left_wing: "Left Wing", 
                double_wing: "Double Wing",
                airtime_duration: "Airtime Duration (minutes)",
                
                // Landing Page - New sections
                demo_button: "View Demo",
                video_play: "Play Video",
                performance_showcase_title: "Advanced Performance Tracking",
                performance_showcase_desc: "Track your pigeons' performance at a professional level",
                
                // Performance Features
                feature_tumbler_title: "Butterfly Pigeon Performance",
                feature_tumbler_desc: "Track flight styles, endurance and aesthetic performance metrics in detail",
                feature_racing_title: "Post Pigeon Racing Performance",
                feature_racing_desc: "Detailed race analytics, speed trends, ranking statistics and performance charts",
                feature_breeding_title: "Smart Mating",
                feature_breeding_desc: "Genetic compatibility analysis and optimal mate suggestions",
                
                // Combined Features for Homepage
                feature_combined_pedigree_title: "Pedigree & Visual Management",
                feature_combined_pedigree_desc: "Track your pigeons' history and development with detailed pedigree tracking up to 10 generations, visual tree structure and unlimited photo gallery.",
                feature_combined_pedigree_item1: "Detailed pedigree visualization",
                feature_combined_pedigree_item2: "Unlimited photo upload", 
                feature_combined_pedigree_item3: "Family tree tracking",
                feature_combined_health_title: "Health & Performance Analytics",
                feature_combined_health_desc: "Vaccination calendar, veterinary controls and treatment history along with detailed performance analyses and trend reports.",
                feature_combined_health_item1: "Comprehensive health tracking",
                feature_combined_health_item2: "Performance trend analyses",
                feature_combined_health_item3: "Detailed statistical reports",
                feature_combined_ai_title: "AI Powered Smart Systems",
                feature_combined_ai_desc: "Genetic compatibility analysis, optimal mating recommendations and automatic performance predictions with artificial intelligence.",
                feature_combined_ai_item1: "Smart mating recommendations",
                feature_combined_ai_item2: "Genetic compatibility analysis",
                feature_combined_ai_item3: "Multi-language support",
                feature_combined_ai_badge: "AI POWERED",
                more_info: "More info",
                detailed_analyses_login: "Login for detailed analyses",
                
                // Performance Showcase
                performance_real_time: "REAL-TIME ANALYTICS",
                performance_new_badge: "NEW",
                performance_popular_badge: "POPULAR",
                performance_flight_style: "Flight Style",
                performance_flight_style_desc: "Aesthetic flight patterns and style analysis",
                performance_endurance: "Endurance",
                performance_endurance_desc: "Long-term flight performance and condition",
                performance_aesthetic_score: "Aesthetic Score",
                performance_aesthetic_score_desc: "Beauty and form assessment",
                performance_detailed_analysis: "Detailed Race Analyses",
                performance_detailed_analysis_desc: "Speed trends, ranking distributions and performance metrics",
                performance_success_stats: "Success Statistics",
                performance_success_stats_desc: "Medal distribution and podium performances",
                performance_distance_correlation: "Distance-Speed Correlation",
                performance_distance_correlation_desc: "Optimal performance analysis by distance",
                performance_genetic_map: "Genetic Map",
                performance_genetic_map_desc: "DNA analysis and hereditary trait tracking",
                performance_compatibility_score: "Compatibility Score",
                performance_compatibility_score_desc: "AI-powered optimal mating suggestions",
                performance_next_generation: "Next Generation",
                performance_next_generation_desc: "Offspring potential and trait predictions",
                
                // Racing Analytics
                racing_analytics_title: "Race Analytics",
                racing_analytics_filters: "Filters",
                racing_analytics_date_range: "Date Range",
                racing_analytics_all_time: "All Time",
                racing_analytics_last_30_days: "Last 30 Days",
                racing_analytics_last_3_months: "Last 3 Months",
                racing_analytics_last_6_months: "Last 6 Months",
                racing_analytics_last_year: "Last Year",
                racing_analytics_pigeon: "Pigeon",
                racing_analytics_all_pigeons: "All Pigeons",
                racing_analytics_export_report: "Export Report",
                racing_analytics_avg_speed: "Average Speed",
                racing_analytics_win_rate: "Win Rate",
                racing_analytics_avg_rank: "Average Ranking",
                racing_analytics_avg_distance: "Average Distance",
                racing_analytics_best: "Best",
                racing_analytics_wins: "win",
                racing_analytics_race: "race",
                racing_analytics_podium: "podium",
                racing_analytics_total: "Total",
                racing_analytics_speed_performance: "Speed Performance",
                racing_analytics_ranking_performance: "Ranking Performance",
                racing_analytics_last_races: "Last Races",
                racing_analytics_1st_place: "1st Place",
                racing_analytics_2nd_place: "2nd Place",
                racing_analytics_3rd_place: "3rd Place",
                racing_analytics_top_10: "Top 10",
                racing_analytics_other: "Other",
                racing_analytics_detailed_analysis: "Detailed Analysis",
                racing_analytics_best_performances: "Best Performances",
                racing_analytics_development_suggestions: "Development Suggestions",
                racing_analytics_report_preparing: "Preparing report...",
                racing_analytics_report_downloaded: "Report downloaded",
                racing_analytics_report_error: "Error creating report",
                racing_analytics_error_loading: "Error loading analytics",
                
                // Racing Analytics Suggestions
                suggestion_speed_improvement: "Speed Improvement Needed",
                suggestion_speed_improvement_desc: "Your average speed is low. Review your training program.",
                suggestion_excellent_speed: "Excellent Speed Performance",
                suggestion_excellent_speed_desc: "Your pigeons are showing great speed performance!",
                suggestion_ranking_improvement: "Ranking Improvement",
                suggestion_ranking_improvement_desc: "Consider reviewing your racing strategy.",
                suggestion_competitive_power: "Competitive Power",
                suggestion_competitive_power_desc: "Change mating strategy for more competitive results.",
                suggestion_long_distance: "Long Distance Specialist",
                suggestion_long_distance_desc: "Your pigeons are successful in long distance races.",
                
                // Testimonials
                testimonials_title: "User Testimonials",
                testimonial1_text: "Thanks to this system, I can track my pigeons' performance much better. The tumbler performance tracking is especially amazing!",
                testimonial1_author: "John Smith",
                testimonial1_role: "Professional Pigeon Breeder",
                testimonial2_text: "I've been breeding pigeons for 10 years. I've never seen such a detailed and useful system. My race results improved by 40%.",
                testimonial2_author: "Michael Brown",
                testimonial2_role: "Racing Pigeon Expert",
                testimonial3_text: "The pedigree tracking and genetic analysis are fantastic. I can now decide much more easily which pigeons to mate.",
                testimonial3_author: "Sarah Wilson",
                testimonial3_role: "Pigeon Breeder",
                
                // Pricing
                pricing_title: "Choose Your Plan",
                pricing_monthly: "Monthly",
                pricing_yearly: "Yearly (2 months free)",
                plan_free: "Free",
                plan_premium: "Premium",
                plan_price_free: "$0",
                plan_price_premium: "$9.99",
                plan_period: "/month",
                btn_choose_plan: "Choose Plan",
                btn_current_plan: "Current Plan",
                btn_upgrade: "Upgrade",
                
                // Free Plan Features
                free_feature1: "7 pigeon records",
                free_feature2: "Basic pedigree tracking",
                free_feature3: "Health records",
                free_feature4: "QR code sharing",
                
                // Premium Plan Features
                premium_feature1: "Unlimited pigeon records",
                premium_feature2: "Advanced 10 generation pedigree tracking",
                premium_feature3: "AI matching and genetic color analysis",
                premium_feature4: "Racing and performance tracking",
                premium_feature5: "Excel export",
                premium_feature6: "Community access",
                premium_feature7: "24/7 support",
                
                // Pricing Additional
                badge_popular: "MOST POPULAR",
                trial_info: "All plans include a 7-day free trial",
                no_cc_required: "No credit card required • Cancel anytime",
                
                // FAQ
                faq_title: "Frequently Asked Questions",
                faq_q1: "How does the system work?",
                faq_a1: "After signing up, you can register your pigeons, track their pedigrees, keep performance records and get detailed reports.",
                faq_q2: "Is there a pigeon record limit?",
                faq_a2: "You can register 7 pigeons in the free plan. There's no limit in the Premium plan.",
                faq_q3: "How is data security ensured?",
                faq_a3: "All your data is stored encrypted and is only accessible to you. Your data is never shared with third parties.",
                faq_q4: "Is there a mobile app?",
                faq_a4: "Our web app is mobile-friendly. We're working on a native mobile app.",
                faq_q5: "What are the payment methods?",
                faq_a5: "You can pay by credit card, bank transfer and virtual POS.",
                
                // CTA
                cta_title: "Get Started Now",
                cta_subtitle: "Take a step today for the future of your pigeons",
                cta_button: "Try Free",
                
                // Missing translations
                good_morning: "Good morning",
                good_afternoon: "Good afternoon",
                good_evening: "Good evening",
                dashboard_subtitle: "Welcome to your pigeon colony management panel",
                active_rate: "active",
                this_month: "this month",
                champions: "Champions",
                with_achievements: "successful",
                recent_activities: "Recent Activities",
                no_recent_activities: "No activities yet",
                view_all: "View All",
                featured_pigeons: "Featured Pigeons",
                upcoming_events: "Upcoming Events",
                no_upcoming_events: "No upcoming events",
                expected_hatching: "Expected hatching",
                days: "days",
                ai_suggestions: "Smart Suggestions",
                suggestion_add_pigeons: "Add new pigeons to expand your colony",
                suggestion_start_breeding: "Start matings to begin your breeding program",
                suggestion_join_race: "Create your first race and start performance tracking",
                suggestion_view_reports: "Visit reports page for detailed analysis",
                weather_conditions: "Weather Conditions",
                good_for_flying: "Good for flying",
                all_pigeons: "All Pigeons",
                add_first_pigeon: "Add Your First Pigeon",
                performance_overview: "Performance Overview",
                years_old: "years old",
                added: "added",
                new_mating_recorded: "New mating recorded",
                completed: "completed",
                years_ago: "years ago",
                months_ago: "months ago",
                days_ago: "days ago",
                hours_ago: "hours ago",
                minutes_ago: "minutes ago",
                seconds_ago: "seconds ago",
                last_30_days_activity: "Last 30 Days Activity",
                new_pigeon: "New Pigeon",
                occupancy: "Occupancy",
                incubation_tracking: "Incubation Tracking",
                incubation_info: "Incubating eggs appear here 4 days before hatching",
                performance_analytics: "Performance Analytics",
                general_statistics: "General Statistics",
                ai_performance_analysis: "AI Performance Analysis",
                try_performance_analysis: "Try Performance Analysis",
                tumbler_performance_analysis: "Tumbler Performance Analysis",
                postal_performance_analysis: "Postal Performance Analysis",
                butterfly_performance_analysis: "Butterfly Performance Analysis",
                racing_performance_analysis: "Racing Performance Analysis",
                include_statistics: "Include detailed statistics",
                performance_tracking_desc: "Track and analyze your pigeons' performance",
                health_records_desc: "Manage health records and vaccination schedules",
                performance_reporting: "Performance Reporting",
                performance_count: "Performance Count",
                performance_description: "Performance Description",
                performance_record: "Performance Record",
                performance_score: "Performance Score",
                tumble_statistics: "Tumbler Statistics",
                avg_tumbles: "Avg. Tumbles",
                max_tumbles: "Max Tumbles",
                avg_sessions: "Avg. Sessions",
                avg_duration_min: "Avg. Duration (min)",
                postal_statistics: "Postal Statistics",
                avg_speed_kmh: "Avg. Speed (km/h)",
                max_speed: "Max Speed",
                total_distance_km: "Total Distance (km)",
                avg_navigation: "Avg. Navigation",
                total_records: "Total Records",
                avg_performance: "Avg. Performance",
                logging_in: "Logging in...",
                login_failed: "Login failed",
                registering: "Registering...",
                registration_failed: "Registration failed",
                demo_mode_coming_soon: "Demo mode coming soon!",
                logout_failed: "Logout failed",
                form_load_error: "Form could not be loaded",
                pigeon_info_load_error: "Pigeon information could not be loaded",
                pigeon_updating: "Updating pigeon...",
                pigeon_limit_reached: "Pigeon limit reached. Please upgrade your plan.",
                page_load_error: "Error loading page. Please refresh.",
                pigeon_pedigree_system: "Pigeon Pedigree Tracking System",
                page_number: "Page",
                pigeon_added_success: "Pigeon added successfully!",
                pigeon_updated_success: "Pigeon updated successfully!",
                pigeon_deleted_success: "Pigeon deleted successfully!",
                pigeon_updating_error: "Pigeon could not be updated",
                pigeon_deleting: "Deleting pigeon...",
                pigeon_delete_error: "Pigeon could not be deleted",
                pigeon_not_found: "Pigeon not found",
                pigeon_details_load_error: "Pigeon details could not be loaded",
                pedigree_load_error: "Pedigree could not be loaded",
                pdf_creating: "Creating PDF...",
                pdf_created_success: "PDF created successfully!",
                pdf_creation_error: "Error creating PDF",
                pdf_downloaded_success: "PDF downloaded successfully!",
                pdf_preparing: "Preparing PDF, please wait...",
                pdf_preparing_advanced: "Preparing PDF (Advanced mode)...",
                pedigree_not_found: "Pedigree not found!",
                pigeon_info_fetch_error: "Pigeon information could not be retrieved!",
                security_error_canvas: "Security error: Canvas access issue. Please refresh the page.",
                pdf_creation_failed: "PDF could not be created",
                high_quality_pdf_created: "High quality PDF created successfully!",
                excel_preparing: "Preparing Excel file...",
                health_records_load_error: "Health records could not be loaded",
                health_record_adding: "Adding health record...",
                health_record_add_error: "Health record could not be added",
                health_record_deleted: "Health record deleted",
                health_record_delete_error: "Health record could not be deleted",
                mating_adding: "Adding mating...",
                mating_add_error: "Mating could not be added",
                matings_load_error: "Matings could not be loaded",
                mating_info_load_error: "Mating information could not be loaded",
                mating_updating: "Updating mating...",
                brood_record_updated: "Brood record updated!",
                mating_update_error: "Mating could not be updated",
                brood_record_deleting: "Deleting brood record...",
                brood_record_deleted: "Brood record deleted!",
                mating_delete_error: "Mating could not be deleted",
                select_two_pigeons: "Please select two pigeons",
                select_different_pigeons: "Select different pigeons",
                pigeons_not_found: "Pigeons not found",
                select_two_for_comparison: "Please select two pigeons for comparison",
                cannot_compare_same: "Cannot compare the same pigeon",
                performance_record_deleted: "Performance record deleted",
                need_pigeons_for_pdf: "You must add pigeons to create a PDF report",
                pdf_report_created: "PDF report created for",
                pdf_report_error: "An error occurred while creating the PDF report",
                no_performance_for_report: "No performance records found for report",
                excel_report_created: "Excel report created successfully",
                error_with_message: "Error",
                generating_report: "Generating report...",
                report_generated: "Report generated!",
                error_generating_report: "Error generating report!",
                invalid_format: "Invalid format!",
                tab_dashboard: "Summary",
                tab_pigeons: "Pigeons",
                tab_matings: "Matings",
                tab_health: "Health",
                tab_races: "Races",
                tab_reports: "Reports",
                pairing: "Pairing",
                upcoming_health: "Upcoming Health Checks",
                no_health_checks: "No upcoming checks",
                my_pigeons: "My Pigeons",
                add_pigeon: "Add Pigeon",
                color: "Color",
                birth: "Birth",
                detail: "Detail",
                pedigree: "Pedigree",
                add_new_pigeon: "Add New Pigeon",
                basic_info: "Basic Info",
                parent_info: "Parent Info",
                health_records: "Health Records",
                unknown: "Unknown",
                no_health_records: "No health records yet",
                view_pedigree: "View Pedigree",
                create_qr: "Create QR Code",
                back: "Back",
                download_pdf: "Download PDF",
                download_pdf_hd: "HD PDF Download (Advanced)",
                new_mating: "New Mating Record",
                male_pigeon: "Male Pigeon",
                female_pigeon: "Female Pigeon",
                mating_date: "Mating Date",
                egg_laying_date: "Egg Laying Date",
                expected_hatch: "Expected Hatch Date",
                hatched: "Hatched",
                notes: "Notes",
                no_matings: "No mating records yet",
                add_record: "Add Record",
                record_type: "Record Type",
                date: "Date",
                veterinarian: "Veterinarian",
                cost: "Cost",
                next_check: "Next Check",
                vaccination: "Vaccination",
                illness: "Illness",
                treatment: "Treatment",
                checkup: "Checkup",
                medication: "Medication",
                reports_stats: "Reports and Statistics",
                breed_dist: "Breed Distribution",
                general_stats: "General Statistics",
                cost_analysis: "Cost Analysis",
                gender_ratio: "Male/Female Ratio",
                total_health_cost: "Total Health Cost",
                avg_health_cost: "Average Health Cost",
                participants: "Participants",
                filter_by_breed: "Filter by Breed",
                filter_by_gender: "Filter by Gender",
                clear_filters: "Clear Filters",
                search: "Search",
                sort_by: "Sort By",
                sort_name: "By Name",
                sort_date: "By Date",
                sort_age: "By Age",
                export_excel: "Export to Excel",
                import_data: "Import Data",
                backup_data: "Backup",
                restore_data: "Restore",
                settings: "Settings",
                profile: "Profile",
                confirm_password: "Confirm Password",
                login_title: "Login",
                register_title: "Register",
                delete_confirm: "Are you sure you want to delete?",
                yes: "Yes",
                no: "No",
                qr_title: "QR Code",
                qr_download: "Download",
                loading: "Loading...",
                no_data: "No data found",
                all: "All",
                active: "Active",
                inactive: "Inactive",
                public: "Public",
                private: "Private",
                share: "Share",
                delete: "Delete",
                view: "View",
                print: "Print",
                copy: "Copy",
                paste: "Paste",
                cut: "Cut",
                select_all: "Select All",
                racing_homer: "Racing Pigeon",
                tumbler: "Tumbler",
                fantail: "Fantail",
                jacobin: "Jacobin",
                pouter: "Pouter",
                carrier: "Carrier Pigeon",
                other: "Other",
                white: "White",
                black: "Black",
                blue: "Blue",
                red: "Red",
                yellow: "Yellow",
                silver: "Silver",
                brown: "Brown",
                grey: "Grey",
                mixed: "Mixed",
                performance: "Performance",
                performance_type: "Performance Type",
                tumbling_performance: "Tumbler Performance",
                postal_performance: "Postal Performance",
                butterfly_performance: "Butterfly Pigeon Performance",
                racing_performance: "Racing Performance",
                racing_performance_title: "Racing Performance Management",
                race_speed: "Speed",
                race_distance: "Distance", 
                race_rank: "Rank",
                total_participants: "Total Participants",
                add_performance_record: "Add Performance Record",
                performance_date: "Performance Date",
                tumble_count: "Tumble Count (per session)",
                session_count: "Session Count",
                flight_duration: "Flight Duration",
                discipline_score: "Discipline Score",
                height_control: "Height Control",
                flight_speed: "Flight Speed",
                navigation_accuracy: "Navigation Accuracy",
                weather_adaptation: "Weather Adaptation",
                endurance_score: "Endurance Score",
                distance_performance: "Distance Performance",
                bonkorluk: "Play Frequency",
                flight_time_distance: "Flight Duration",
                flight_style: "Flight Style",
                consistency: "Consistency (Performance Continuity)",
                home_loyalty_control: "Home Loyalty and Control",
                overall_score: "Overall Score",
                race_performance: "Race Performance",
                breeding_performance: "Breeding Performance",
                health_performance: "Health Performance",
                avg_speed: "Average Speed",
                success_rate: "Success Rate",
                no_performance: "No performance records yet",
                summary: "Summary",
                list: "List",
                comparison: "Comparison",
                analysis: "Analysis",
                system: "System",
                image_added: "Image added",
                image_added_success: "Image added successfully",
                select_valid_image: "Please select a valid image file",
                error_loading: "Error loading",
                
                // Color genetics translations
                color_predictions: "Offspring Color Predictions",
                white_color_details: "White Color Details",
                hidden_color_genes: "Hidden Color Genes",
                color_compatibility: "Color Compatibility",
                select_color: "Select Color",
                parent_colors: "Parent Colors",
                color_distribution: "Color Distribution",
                color_genetic_info: "Color Genetic Information",
                color_inheritance: "Color Inheritance",
                white_carrier_note: "White pigeons can carry hidden color genes",
                color_risk_factors: "Color Risk Factors"
            }
        };

        // Current language
        let currentLang = localStorage.getItem('language') || 'tr';

        // Change language
        window._changeLanguageImpl = function(lang) {
            currentLang = lang;
            localStorage.setItem('language', lang);
            updateLanguage();
        }
        window.changeLanguage = window._changeLanguageImpl;

        // Update language texts
        function updateLanguage() {
            // Update HTML lang attribute
            document.documentElement.lang = currentLang;
            
            document.querySelectorAll('.lang-text').forEach(element => {
                const key = element.getAttribute('data-tr');
                if (translations[currentLang] && translations[currentLang][key]) {
                    element.textContent = translations[currentLang][key];
                }
            });
            
            // Update dynamic pricing
            document.querySelectorAll('[data-price-tr][data-price-en]').forEach(element => {
                const price = currentLang === 'tr' ? element.getAttribute('data-price-tr') : element.getAttribute('data-price-en');
                element.textContent = price;
            });
        }
        
        // Helper function for locale-aware date formatting
        function formatDate(date, options = {}) {
            const locale = currentLang === 'tr' ? 'tr-TR' : 'en-US';
            return new Date(date).toLocaleDateString(locale, options);
        }

        
        // Auth Modal Functions - Moved here to be available before HTML loads
        window._openAuthModalImpl = function(type) {
            const modal = document.getElementById('authModal');
            const content = document.getElementById('authContent');
            
            if (type === 'login') {
                content.innerHTML = `
                    <h3 class="text-3xl font-bold mb-6 text-center bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent">
                        ${translations[currentLang].login_title}
                    </h3>
                    <form onsubmit="handleLogin(event)">
                        <div class="mb-4">
                            <label class="block text-gray-300 mb-2">${translations[currentLang].email}</label>
                            <input type="email" id="loginEmail" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                        </div>
                        <div class="mb-6">
                            <label class="block text-gray-300 mb-2">${translations[currentLang].password}</label>
                            <input type="password" id="loginPassword" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                        </div>
                        <button type="submit" class="w-full btn-primary py-3 font-semibold">
                            ${translations[currentLang].btn_login}
                        </button>
                        <p class="text-center mt-4 text-gray-400">
                            ${translations[currentLang].no_account}
                            <a href="#" onclick="openAuthModal('register')" class="text-cyan-400 hover:underline">
                                ${translations[currentLang].btn_register}
                            </a>
                        </p>
                    </form>
                `;
            } else {
                content.innerHTML = `
                    <h3 class="text-3xl font-bold mb-6 text-center bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent">
                        ${translations[currentLang].register_title}
                    </h3>
                    <form onsubmit="handleRegister(event)">
                        <div class="mb-4">
                            <label class="block text-gray-300 mb-2">${translations[currentLang].name}</label>
                            <input type="text" id="registerName" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-300 mb-2">${translations[currentLang].email}</label>
                            <input type="email" id="registerEmail" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-300 mb-2">${translations[currentLang].password}</label>
                            <input type="password" id="registerPassword" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                        </div>
                        
                        <!-- Elderly-Friendly Captcha -->
                        <div class="mb-6">
                            <div id="captcha-container"></div>
                        </div>
                        
                        <button type="submit" class="w-full btn-primary py-3 font-semibold">
                            ${translations[currentLang].btn_register}
                        </button>
                        <p class="text-center mt-4 text-gray-400">
                            ${translations[currentLang].have_account}
                            <a href="#" onclick="openAuthModal('login')" class="text-cyan-400 hover:underline">
                                ${translations[currentLang].btn_login}
                            </a>
                        </p>
                    </form>
                `;
            }
            
            modal.style.display = 'block';
            
            // Register formuna captcha ekle
            if (type === 'register') {
                setTimeout(() => {
                    ElderlyFriendlyCaptcha.refresh();
                }, 100);
            }
        }
        
        // Override the placeholder with the real implementation
        window.openAuthModal = window._openAuthModalImpl;

        // Close Auth Modal
        window._closeAuthModalImpl = function() {
            document.getElementById('authModal').style.display = 'none';
        }
        window.closeAuthModal = window._closeAuthModalImpl;

        // Handle Login
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            showNotification('Giriş yapılıyor...', 'info');
            
            try {
                const result = await SupabaseAuth.login(email, password);
                
                if (result.success) {
                    storage.currentUser = result.user;
                    closeAuthModal();
                    showNotification(result.message, 'success');
                    updateNavigation();
                    showHomepage();
                } else {
                    showNotification(result.message, 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showNotification('Giriş yapılamadı', 'error');
            }
        }

        // Handle Register
        async function handleRegister(event) {
            event.preventDefault();
            
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            // Check captcha
            const captchaInput = document.getElementById('captchaInput');
            if (captchaInput) {
                const captchaResult = ElderlyFriendlyCaptcha.verify(captchaInput.value);
                if (!captchaResult.valid) {
                    showNotification(captchaResult.message, 'error');
                    ElderlyFriendlyCaptcha.refresh();
                    return;
                }
            }
            
            showNotification('Kayıt yapılıyor...', 'info');
            
            try {
                const result = await SupabaseAuth.register(email, password, firstName, lastName);
                
                if (result.success) {
                    showNotification(result.message, 'success');
                    // Auto login after registration
                    const loginResult = await SupabaseAuth.login(email, password);
                    if (loginResult.success) {
                        storage.currentUser = loginResult.user;
                        closeAuthModal();
                        updateNavigation();
                        showHomepage();
                    }
                } else {
                    showNotification(result.message, 'error');
                }
            } catch (error) {
                console.error('Register error:', error);
                showNotification('Kayıt yapılamadı', 'error');
            }
        }

        // Initialize theme
        function initTheme() {
            // Theme is always dark
        }

        // Show Notification Function
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white shadow-lg z-50 transform transition-all duration-300 translate-x-96`;
            
            // Set background color based on type
            const bgColors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            
            notification.classList.add(bgColors[type] || bgColors.info);
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-96');
                notification.classList.add('translate-x-0');
            }, 10);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.classList.remove('translate-x-0');
                notification.classList.add('translate-x-96');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }
        
        // Toggle FAQ
        function toggleFAQ(element) {
            const faqItem = element.parentElement;
            faqItem.classList.toggle('active');
        }
        
        // Show Demo
        function showDemo() {
            showNotification('Demo modu yakında eklenecek!', 'info');
        }
        
        // Scroll reveal animation
        function initScrollReveal() {
            const reveals = document.querySelectorAll('.scroll-reveal');
            
            function reveal() {
                reveals.forEach(element => {
                    const windowHeight = window.innerHeight;
                    const elementTop = element.getBoundingClientRect().top;
                    const elementVisible = 150;
                    
                    if (elementTop < windowHeight - elementVisible) {
                        element.classList.add('active');
                    }
                });
            }
            
            window.addEventListener('scroll', reveal);
            reveal();
        }

        // Show Pigeon Detail Function
        function showPigeonDetail(pigeonId) {
            cleanupPreviousViews();
            const pigeon = storage.pigeons.find(p => p.id === pigeonId);
            if (!pigeon) return;
            
            const father = pigeon.fatherId ? storage.pigeons.find(p => p.id === pigeon.fatherId) : null;
            const mother = pigeon.motherId ? storage.pigeons.find(p => p.id === pigeon.motherId) : null;
            const healthRecords = storage.healthRecords.filter(h => h.pigeonId === pigeonId);
            const t = translations[currentLang];
            
            document.getElementById('pigeonDetail').innerHTML = `
                <h2 class="text-3xl font-bold mb-6">${pigeon.name}</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        ${pigeon.image ? `
                            <img src="${pigeon.image}" alt="${pigeon.name}" class="w-full rounded-2xl mb-6">
                        ` : `
                            <div class="bg-gradient-to-r from-cyan-400 to-purple-400 p-8 rounded-2xl flex items-center justify-center mb-6">
                                <i class="fas fa-dove text-6xl"></i>
                            </div>
                        `}
                        
                        <div class="glass p-6 rounded-2xl">
                            <h3 class="text-xl font-bold mb-4">${t.basic_info || 'Temel Bilgiler'}</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">${t.band_number || 'Künye No'}:</span>
                                    <span class="font-bold">${pigeon.bandNumber}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">${t.gender || 'Cinsiyet'}:</span>
                                    <span>${pigeon.gender === 'male' ? (t.male || 'Erkek') : (t.female || 'Dişi')}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">${t.breed || 'Irk'}:</span>
                                    <span>${pigeon.breed}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">${t.birth_date || 'Doğum Tarihi'}:</span>
                                    <span>${formatDate(pigeon.birthDate)}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="glass p-6 rounded-2xl mb-6">
                            <h3 class="text-xl font-bold mb-4">${t.parent_info || 'Ebeveyn Bilgileri'}</h3>
                            <div class="space-y-3">
                                <div>
                                    <span class="text-gray-400 font-semibold">${t.father || 'Babası'}:</span>
                                    ${father ? `
                                        <div class="mt-2 p-4 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 border border-blue-500/20 rounded-lg">
                                            <p class="font-bold text-lg">${father.name}</p>
                                            <div class="flex items-center gap-2 mt-1">
                                                <i class="fas fa-ring text-xs text-gray-400"></i>
                                                <p class="text-sm text-gray-300">Künye: ${father.bandNumber}</p>
                                            </div>
                                            ${father.breed ? `
                                                <div class="flex items-center gap-2 mt-1">
                                                    <i class="fas fa-dove text-xs text-gray-400"></i>
                                                    <p class="text-sm text-gray-300">Irk: ${t[father.breed] || father.breed}</p>
                                                </div>
                                            ` : ''}
                                        </div>
                                    ` : `<p class="text-gray-500 italic mt-2">${t.unknown || 'Bilinmeyen'}</p>`}
                                </div>
                                <div>
                                    <span class="text-gray-400 font-semibold">${t.mother || 'Annesi'}:</span>
                                    ${mother ? `
                                        <div class="mt-2 p-4 bg-gradient-to-r from-pink-500/10 to-rose-500/10 border border-pink-500/20 rounded-lg">
                                            <p class="font-bold text-lg">${mother.name}</p>
                                            <div class="flex items-center gap-2 mt-1">
                                                <i class="fas fa-ring text-xs text-gray-400"></i>
                                                <p class="text-sm text-gray-300">Künye: ${mother.bandNumber}</p>
                                            </div>
                                            ${mother.breed ? `
                                                <div class="flex items-center gap-2 mt-1">
                                                    <i class="fas fa-dove text-xs text-gray-400"></i>
                                                    <p class="text-sm text-gray-300">Irk: ${t[mother.breed] || mother.breed}</p>
                                                </div>
                                            ` : ''}
                                        </div>
                                    ` : `<p class="text-gray-500 italic mt-2">${t.unknown || 'Bilinmeyen'}</p>`}
                                </div>
                            </div>
                        </div>
                        
                        <div class="glass p-6 rounded-2xl">
                            <h3 class="text-xl font-bold mb-4">${t.health_records || 'Sağlık Kayıtları'}</h3>
                            <div class="space-y-3">
                                ${healthRecords.slice(-3).map(record => {
                                    const typeIcons = {
                                        vaccination: 'fa-syringe',
                                        illness: 'fa-virus',
                                        treatment: 'fa-pills',
                                        checkup: 'fa-stethoscope',
                                        medication: 'fa-prescription'
                                    };
                                    
                                    const typeColors = {
                                        vaccination: 'from-green-500/10 to-teal-500/10',
                                        illness: 'from-red-500/10 to-pink-500/10',
                                        treatment: 'from-yellow-500/10 to-orange-500/10',
                                        checkup: 'from-blue-500/10 to-cyan-500/10',
                                        medication: 'from-purple-500/10 to-indigo-500/10'
                                    };
                                    
                                    return `
                                        <div class="p-4 bg-gradient-to-r ${typeColors[record.type] || 'from-gray-500/10 to-gray-600/10'} border border-white/10 rounded-lg">
                                            <div class="flex items-start justify-between">
                                                <div class="flex items-center gap-2">
                                                    <i class="fas ${typeIcons[record.type] || 'fa-notes-medical'} text-lg"></i>
                                                    <div>
                                                        <p class="font-semibold">${t[record.type] || record.type}</p>
                                                        <p class="text-sm text-gray-300 mt-1">${record.description}</p>
                                                        <p class="text-xs text-gray-400 mt-2">
                                                            <i class="far fa-calendar mr-1"></i>
                                                            ${formatDate(record.date)}
                                                            ${record.veterinarian ? ` • <i class="fas fa-user-md mr-1"></i>${record.veterinarian}` : ''}
                                                        </p>
                                                    </div>
                                                </div>
                                                ${record.cost ? `
                                                    <span class="text-sm font-semibold text-green-400">₺${record.cost}</span>
                                                ` : ''}
                                            </div>
                                        </div>
                                    `;
                                }).join('') || `<p class="text-gray-500">${t.no_health_records || 'Henüz sağlık kaydı bulunmuyor'}</p>`}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Performans Kartı -->
                <div class="glass p-6 rounded-2xl mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">
                            <i class="fas fa-chart-line mr-2"></i> ${t.performance || 'Performans'}
                        </h3>
                        <button onclick="try { showAddPerformance('${pigeon.id}') } catch(e) { console.error('Performance button error:', e); showNotification('Hata: ' + e.message, 'error') }" class="px-4 py-2 bg-purple-500 rounded-lg hover:bg-purple-600 transition text-sm">
                            <i class="fas fa-plus mr-1"></i> ${t.add_performance_record || 'Performans Ekle'}
                        </button>
                    </div>
                    
                    ${(() => {
                        const breed = pigeon.breed;
                        let performanceType;
                        let score = 0;
                        
                        // Irka göre performans türünü belirle
                        const breedPerformanceMap = {
                            taklaci: 'tumbling',
                            adana: 'tumbling',
                            bursa_oynari: 'tumbling',
                            dolapci: 'tumbling',
                            hunkari: 'tumbling',
                            sebap: 'tumbling',
                            van: 'tumbling',
                            posta: 'postal',
                            kelebek: 'butterfly'
                        };
                        
                        performanceType = breedPerformanceMap[breed] || 'racing';
                        
                        if (performanceType === 'tumbling') {
                            score = calculateTumblingScore(pigeon.id);
                        } else if (performanceType === 'postal') {
                            score = calculatePostalScore(pigeon.id);
                        } else if (performanceType === 'butterfly') {
                            score = calculateButterflyScore(pigeon.id);
                        } else {
                            score = calculateRacingScore(pigeon.id);
                        }
                        
                        // Sadece ilgili ırka uygun performans kayıtlarını filtrele
                        const records = storage.performanceRecords
                            .filter(r => r.pigeonId === pigeon.id && r.performanceType === performanceType)
                            .sort((a, b) => new Date(b.date) - new Date(a.date));
                        
                        if (records.length === 0) {
                            return `<p class="text-gray-400 text-center">${t.no_performance || 'Henüz performans kaydı bulunmuyor'}</p>`;
                        }
                        
                        return `
                            <div class="text-center mb-4">
                                <div class="relative inline-flex items-center justify-center">
                                    <svg class="w-32 h-32">
                                        <circle
                                            cx="64"
                                            cy="64"
                                            r="56"
                                            stroke="#374151"
                                            stroke-width="12"
                                            fill="none"
                                        />
                                        <circle
                                            cx="64"
                                            cy="64"
                                            r="56"
                                            stroke="#22d3ee"
                                            stroke-width="12"
                                            fill="none"
                                            stroke-dasharray="${Math.PI * 2 * 56}"
                                            stroke-dashoffset="${Math.PI * 2 * 56 * (1 - score / 100)}"
                                            transform="rotate(-90 64 64)"
                                            style="transition: stroke-dashoffset 0.5s ease"
                                        />
                                    </svg>
                                    <div class="absolute">
                                        <div class="text-3xl font-bold">${score}</div>
                                        <div class="text-xs text-gray-400">/100</div>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-400 mt-2">${t[performanceType + '_performance'] || 'Performans'}</p>
                            </div>
                            
                            <div class="space-y-2">
                                <div class="text-sm font-semibold text-gray-300 mb-2">Son Kayıtlar:</div>
                                ${records.slice(0, 3).map(record => {
                                    let detailText = '';
                                    if (record.performanceType === 'tumbling') {
                                        detailText = `${record.tumbleCount || 0} takla/dk, ${record.tumbleQuality || 0}/10 kalite`;
                                    } else if (record.performanceType === 'postal') {
                                        detailText = `${record.flightSpeed || 0} km/h, ${record.flightDistance || 0} km`;
                                    }
                                    
                                    return `
                                        <div class="p-3 bg-black/30 rounded-lg text-sm">
                                            <div class="flex justify-between">
                                                <span>${formatDate(record.date)}</span>
                                                <span class="text-gray-400">${record.weatherConditions === 'sunny' ? '☀️' : record.weatherConditions === 'rainy' ? '🌧️' : record.weatherConditions === 'cloudy' ? '☁️' : '💨'}</span>
                                            </div>
                                            <p class="text-gray-400">${detailText}</p>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        `;
                    })()}
                </div>
                
                <div class="flex gap-4 mt-6">
                    <button onclick="showPedigree('${pigeon.id}')" class="btn-primary">
                        <i class="fas fa-sitemap mr-2"></i> ${t.view_pedigree || 'Soyağacını Görüntüle'}
                    </button>
                    <button onclick="showEditPigeon('${pigeon.id}')" class="px-6 py-3 bg-purple-500 rounded-full hover:bg-purple-600 transition">
                        <i class="fas fa-edit mr-2"></i> ${t.edit || 'Düzenle'}
                    </button>
                </div>
                </div>
                </div>
            `;
            
            document.getElementById('pigeonModal').style.display = 'block';
        }

        // DEPRECATED: Old localStorage-based pedigree function - moved to async Supabase version

        // Create floating particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 20;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.innerHTML = '<i class="fas fa-feather text-cyan-400 opacity-20"></i>';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.fontSize = Math.random() * 20 + 10 + 'px';
                particlesContainer.appendChild(particle);
            }
        }

        // Initialize particles on load
        createParticles();

        // Storage object - Supabase migration
        const storage = {
            // Users ve currentUser artık Supabase Auth üzerinden yönetiliyor
            get currentUser() {
                // LocalStorage'dan oku (geçici uyumluluk için)
                return JSON.parse(localStorage.getItem('currentUser')) || null;
            },
            set currentUser(value) {
                if (value) {
                    localStorage.setItem('currentUser', JSON.stringify(value));
                } else {
                    localStorage.removeItem('currentUser');
                }
            },
            // Cache for Supabase data - updated on each fetch
            _pigeonsCache: [],
            _matingsCache: [],
            _healthRecordsCache: [],
            _racesCache: [],
            _performanceCache: [],
            
            // Getter'lar cache döndürür - gerçek veri için her zaman Supabase fonksiyonları kullanılmalı
            get pigeons() { return this._pigeonsCache; },
            get matings() { return this._matingsCache; },
            get healthRecords() { return this._healthRecordsCache; },
            get races() { return this._racesCache; },
            get performanceRecords() { return this._performanceCache; },
            
            // Cache güncelleme fonksiyonları
            updatePigeonsCache(data) { this._pigeonsCache = data || []; },
            updateMatingsCache(data) { this._matingsCache = data || []; },
            updateHealthRecordsCache(data) { this._healthRecordsCache = data || []; },
            updateRacesCache(data) { this._racesCache = data || []; },
            updatePerformanceCache(data) { this._performanceCache = data || []; }
        };

        // Save to local storage (DEPRECATED - Sadece performans kayıtları için geçici olarak kullanılıyor)
        function saveToStorage() {
            // Artık çoğu veri Supabase'de saklanıyor
            // Sadece henüz migrate edilmemiş performans kayıtları için kullanılıyor
            localStorage.setItem('performanceRecords', JSON.stringify(storage.performanceRecords));
        }

        // Auth Modal Functions
        function openAuthModal(type) {
            const modal = document.getElementById('authModal');
            const content = document.getElementById('authContent');
            
            if (type === 'login') {
                content.innerHTML = `
                    <h3 class="text-3xl font-bold mb-6 text-center bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent">
                        ${translations[currentLang].login_title}
                    </h3>
                    <form onsubmit="handleLogin(event)">
                        <div class="mb-4">
                            <label class="block text-gray-300 mb-2">${translations[currentLang].email}</label>
                            <input type="email" id="loginEmail" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                        </div>
                        <div class="mb-6">
                            <label class="block text-gray-300 mb-2">${translations[currentLang].password}</label>
                            <input type="password" id="loginPassword" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                        </div>
                        <button type="submit" class="btn-primary w-full">${translations[currentLang].btn_login}</button>
                    </form>
                    <p class="text-center mt-4 text-gray-400">
                        ${translations[currentLang].no_account} 
                        <a href="#" onclick="openAuthModal('register')" class="text-cyan-400 hover:underline">${translations[currentLang].btn_register}</a>
                    </p>
                    </div>
                </div>
            `;
            } else {
                content.innerHTML = `
                    <h3 class="text-3xl font-bold mb-6 text-center bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent">
                        ${translations[currentLang].register_title}
                    </h3>
                    <form onsubmit="handleRegister(event)">
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-gray-300 mb-2">${translations[currentLang].first_name}</label>
                                <input type="text" id="firstName" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                            </div>
                            <div>
                                <label class="block text-gray-300 mb-2">${translations[currentLang].last_name}</label>
                                <input type="text" id="lastName" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-300 mb-2">${translations[currentLang].email}</label>
                            <input type="email" id="registerEmail" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                        </div>
                        <div class="mb-6">
                            <label class="block text-gray-300 mb-2">${translations[currentLang].password}</label>
                            <input type="password" id="registerPassword" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                        </div>
                        <div class="captcha-wrapper mb-6"></div>
                        <button type="submit" class="btn-primary w-full">${translations[currentLang].btn_register}</button>
                    </form>
                    <p class="text-center mt-4 text-gray-400">
                        ${translations[currentLang].already_member} 
                        <a href="#" onclick="openAuthModal('login')" class="text-cyan-400 hover:underline">${translations[currentLang].btn_login}</a>
                    </p>
                    </div>
                </div>
            `;
            }
            
            modal.style.display = 'block';
            
            // Register formuna captcha ekle
            if (type === 'register') {
                setTimeout(() => {
                    ElderlyFriendlyCaptcha.refresh();
                }, 100);
            }
        }

        function closeAuthModal() {
            document.getElementById('authModal').style.display = 'none';
        }

        // Update navigation based on login state
        function updateNavigation() {
            const authSection = document.getElementById('authSection');
            const mobileMenuItems = document.getElementById('mobileMenuItems');
            const authRequiredButtons = document.querySelectorAll('.nav-auth-required');
            
            if (storage.currentUser) {
                // Show auth-required navigation buttons
                authRequiredButtons.forEach(btn => {
                    btn.style.display = 'inline-block';
                });
                
                // Show mobile menu items
                if (mobileMenuItems) mobileMenuItems.style.display = 'block';
                
                // Update auth buttons to show user info and logout
                if (authSection) {
                    const buttons = authSection.querySelectorAll('button[onclick*="openAuthModal"]');
                    buttons.forEach(btn => btn.style.display = 'none');
                    
                    // Add user info and logout if not exists
                    if (!authSection.querySelector('.user-info')) {
                        const userInfoHtml = `
                            <span class="text-gray-300 user-info">${translations[currentLang].welcome || 'Hoş geldiniz'}, ${storage.currentUser.name}!</span>
                            <button onclick="logout()" class="px-4 py-2 text-sm bg-red-500 rounded-lg hover:bg-red-600 transition">
                                ${translations[currentLang].logout || 'Çıkış'}
                            </button>
                        `;
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = userInfoHtml;
                        while (tempDiv.firstChild) {
                            authSection.appendChild(tempDiv.firstChild);
                        }
                    }
                }
            } else {
                // Hide auth-required navigation buttons
                authRequiredButtons.forEach(btn => {
                    btn.style.display = 'none';
                });
                
                // Hide mobile menu items except homepage
                if (mobileMenuItems) {
                    const mobileAuthButtons = mobileMenuItems.querySelectorAll('.nav-auth-required');
                    mobileAuthButtons.forEach(btn => btn.style.display = 'none');
                }
                
                // Show login/register buttons
                if (authSection) {
                    const buttons = authSection.querySelectorAll('button[onclick*="openAuthModal"]');
                    buttons.forEach(btn => btn.style.display = 'inline-block');
                    
                    // Remove user info
                    const userInfo = authSection.querySelector('.user-info');
                    if (userInfo) userInfo.remove();
                    const logoutBtn = authSection.querySelector('button[onclick="logout()"]');
                    if (logoutBtn) logoutBtn.remove();
                }
            }
            
            // Premium badge kontrolü
            if (storage.currentUser) {
                updateNavbarForPremium();
            }
        }

        // Show main app
        function showApp() {
            updateNavigation();
            showHomepage();
            return;
            /*
                <div class="container mx-auto px-6 py-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-dove text-3xl text-cyan-400"></i>
                            <h1 class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent">
                                ${translations[currentLang].app_title}
                            </h1>
                        </div>
                        
                        <div class="hidden md:flex items-center space-x-8">
                            <a href="#" onclick="showHomepage()" class="hover:text-cyan-400 transition">${translations[currentLang].nav_home}</a>
                            <a href="#" onclick="showPigeons()" class="hover:text-cyan-400 transition">${translations[currentLang].nav_pigeons}</a>
                            <a href="#" onclick="showMatings()" class="hover:text-cyan-400 transition">${translations[currentLang].nav_matings}</a>
                            <a href="#" onclick="showHealthRecords()" class="hover:text-cyan-400 transition">${translations[currentLang].nav_health}</a>
                            <a href="#" onclick="showRaces()" class="hover:text-cyan-400 transition">${translations[currentLang].nav_races}</a>
                        </div>

                        <div class="flex items-center space-x-4">
                            <!-- Language Selector -->
                            <select id="langSelector" onchange="changeLanguage(this.value)" class="bg-transparent border border-gray-600 rounded px-2 py-1 text-sm">
                                <option value="tr" ${currentLang === 'tr' ? 'selected' : ''}>🇹🇷 TR</option>
                                <option value="en" ${currentLang === 'en' ? 'selected' : ''}>🇬🇧 EN</option>
                            </select>
                            
                            <span class="text-gray-300">${translations[currentLang].welcome}, ${storage.currentUser.firstName}!</span>
                            <button onclick="logout()" class="px-4 py-2 text-sm bg-red-500 rounded-lg hover:bg-red-600 transition">
                                ${translations[currentLang].logout}
                            </button>
                        </div>
                    </div>
                </div>
                </div>
                </div>
            `;
            showHomepage();
            */
        }

        // Logout
        async function logout() {
            const result = await SupabaseAuth.logout();
            
            if (result.success) {
                storage.currentUser = null;
                saveToStorage();
                location.reload();
            } else {
                showNotification(result.message || 'Çıkış yapılamadı', 'error');
            }
        }


        // Check authentication and redirect if needed
        function checkAuth() {
            if (!storage.currentUser) {
                console.error('No authenticated user found');
                console.log('Storage currentUser:', storage.currentUser);
                const t = translations[currentLang];
                showNotification(t.login_required || 'Please login to view this section', 'warning');
                openAuthModal('login');
                return false;
            }
            console.log('Auth check passed for user:', storage.currentUser);
            return true;
        }

        // Show Homepage
        async function showHomepage() {
            const contentDiv = document.getElementById('content');
            
            // Önce loading göster
            contentDiv.innerHTML = '<div class="text-center py-20"><i class="fas fa-spinner fa-spin text-4xl text-cyan-400"></i><p class="mt-4">Yükleniyor...</p></div>';
            
            try {
                cleanupPreviousViews();
                updateActiveTab(0);
            
            // If not logged in, show landing page
            if (!storage.currentUser) {
                contentDiv.innerHTML = `
                    <!-- Premium Animated Background -->
                    <div class="fixed inset-0 overflow-hidden pointer-events-none">
                        <div class="absolute inset-0 bg-gradient-to-br from-slate-900 via-purple-900/20 to-slate-900"></div>
                        <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl animate-pulse"></div>
                        <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-cyan-500/10 rounded-full blur-3xl animate-pulse" style="animation-delay: 2s;"></div>
                        <div class="absolute top-3/4 left-3/4 w-64 h-64 bg-pink-500/10 rounded-full blur-3xl animate-pulse" style="animation-delay: 4s;"></div>
                    </div>
                    
                    <!-- Hero Section -->
                    <section class="relative min-h-screen flex items-center justify-center px-4 sm:px-6 lg:px-8 overflow-hidden hero-section-mobile">
                        <!-- Premium Floating Elements -->
                        <div class="absolute top-20 right-10 opacity-10 hidden lg:block">
                            <i class="fas fa-dove text-9xl text-cyan-400 floating-animation"></i>
                        </div>
                        <div class="absolute bottom-20 left-10 opacity-10 hidden lg:block">
                            <i class="fas fa-feather-alt text-7xl text-purple-400 floating-animation" style="animation-delay: 3s;"></i>
                        </div>
                        
                        <div class="relative z-10 text-center max-w-7xl mx-auto">
                            <!-- Premium Badge Section -->
                            <div class="mb-6 flex justify-center gap-2">
                                <span class="px-3 py-1 text-xs rounded-full bg-gradient-to-r from-emerald-500/30 to-teal-500/30 border border-emerald-500/40 text-emerald-300">
                                    <i class="fas fa-sparkles mr-1"></i>Premium
                                </span>
                                <span class="px-3 py-1 text-xs rounded-full bg-gradient-to-r from-purple-500/30 to-pink-500/30 border border-purple-500/40 text-purple-300">
                                    <i class="fas fa-crown mr-1"></i>Lider
                                </span>
                            </div>
                            
                            <!-- Premium Title -->
                            <h1 class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold mb-6 leading-tight">
                                <span class="bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-600 bg-clip-text text-transparent lang-text" data-tr="hero_title1">
                                    Yeni Nesil
                                </span>
                                <br>
                                <span class="bg-gradient-to-r from-purple-400 via-pink-500 to-red-500 bg-clip-text text-transparent lang-text" data-tr="hero_title2">
                                    Güvercin Takip Sistemi
                                </span>
                            </h1>
                            
                            <!-- Premium Description -->
                            <p class="text-xl sm:text-2xl text-gray-300 mb-8 max-w-4xl mx-auto leading-relaxed lang-text" data-tr="hero_description">
                                Yapay zeka destekli performans analizi, akıllı eşleştirme önerileri ve 
                                profesyonel seviye raporlama ile güvercinlerinizi geleceğe taşıyın.
                            </p>
                            
                            <!-- Premium CTA Buttons -->
                            <div class="flex flex-col sm:flex-row gap-4 justify-center mb-12">
                                <button onclick="openAuthModal('register')" class="group relative px-8 py-4 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-2xl font-semibold text-lg text-white hover:from-cyan-400 hover:to-blue-500 transform hover:scale-105 transition-all duration-300 shadow-2xl hover:shadow-cyan-500/25">
                                    <div class="absolute inset-0 bg-gradient-to-r from-cyan-600 to-blue-700 rounded-2xl blur opacity-50 group-hover:opacity-75 transition-opacity duration-300"></div>
                                    <div class="relative flex items-center justify-center">
                                        <i class="fas fa-rocket mr-3"></i>
                                        <span class="lang-text" data-tr="btn_start">Ücretsiz Başla</span>
                                    </div>
                                </button>
                            </div>
                            
                            <!-- Premium Trust Indicators -->
                            <div class="max-w-2xl mx-auto mt-8">
                                <div class="glass p-6 rounded-2xl">
                                    <div class="flex flex-wrap justify-around gap-4 text-center">
                                        <div class="flex-1 min-w-[100px]">
                                            <i class="fas fa-shield-alt text-2xl text-green-400 mb-2"></i>
                                            <div class="text-lg font-bold">SSL Güvenlik</div>
                                        </div>
                                        <div class="flex-1 min-w-[100px]">
                                            <i class="fas fa-users text-2xl text-blue-400 mb-2"></i>
                                            <div class="text-lg font-bold">5000+ Kullanıcı</div>
                                        </div>
                                        <div class="flex-1 min-w-[100px]">
                                            <i class="fas fa-star text-2xl text-yellow-400 mb-2"></i>
                                            <div class="text-lg font-bold">4.9/5 Puan</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Premium Features Section -->
                    <section class="relative py-24 px-4 sm:px-6 lg:px-8">
                        <div class="absolute inset-0 bg-gradient-to-b from-transparent via-slate-900/50 to-transparent"></div>
                        <div class="relative max-w-7xl mx-auto">
                            <!-- Section Header -->
                            <div class="text-center mb-16">
                                <div class="inline-flex items-center px-4 py-2 rounded-full bg-gradient-to-r from-cyan-500/20 to-purple-500/20 border border-cyan-500/30 backdrop-blur-sm mb-6">
                                    <i class="fas fa-star text-cyan-400 mr-2"></i>
                                    <span class="text-cyan-300 text-sm font-medium">PROFESYONEL ÖZELLİKLER</span>
                                </div>
                                <h2 class="text-4xl sm:text-5xl lg:text-6xl font-bold mb-6">
                                    <span class="bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-600 bg-clip-text text-transparent lang-text" data-tr="features_title">
                                        Gelişmiş Özellikler
                                    </span>
                                </h2>
                                <p class="text-xl text-gray-300 max-w-3xl mx-auto">
                                    Güvercinlerinizi profesyonel seviyede yönetmek için ihtiyacınız olan tüm araçlar
                                </p>
                            </div>
                            
                            <!-- Feature Grid - 3 Main Features -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                                <!-- Feature 1: Soyağacı & Görsel Yönetim -->
                                <div class="group relative p-8 bg-gradient-to-br from-white/5 via-white/5 to-transparent backdrop-blur-sm border border-white/10 rounded-3xl hover:border-purple-500/30 transition-all duration-500 hover:scale-105">
                                    <div class="w-16 h-16 bg-gradient-to-r from-purple-400 to-pink-500 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform duration-300">
                                        <i class="fas fa-sitemap text-2xl text-white"></i>
                                    </div>
                                    <h3 class="text-2xl font-bold text-white mb-4 lang-text" data-tr="feature_combined_pedigree_title">Soyağacı & Görsel Yönetim</h3>
                                    <p class="text-gray-300 mb-4 leading-relaxed lang-text" data-tr="feature_combined_pedigree_desc">
                                        10 nesile kadar detaylı soyağacı takibi, görsel ağaç yapısı ve sınırsız fotoğraf galerisi ile güvercinlerinizin geçmişini ve gelişimini takip edin.
                                    </p>
                                    <ul class="space-y-2 mb-6">
                                        <li class="flex items-center text-sm text-gray-300">
                                            <i class="fas fa-check text-purple-400 mr-2"></i>
                                            <span class="lang-text" data-tr="feature_combined_pedigree_item1">Detaylı soyağacı görselleştirme</span>
                                        </li>
                                        <li class="flex items-center text-sm text-gray-300">
                                            <i class="fas fa-check text-purple-400 mr-2"></i>
                                            <span class="lang-text" data-tr="feature_combined_pedigree_item2">Sınırsız fotoğraf yükleme</span>
                                        </li>
                                        <li class="flex items-center text-sm text-gray-300">
                                            <i class="fas fa-check text-purple-400 mr-2"></i>
                                            <span class="lang-text" data-tr="feature_combined_pedigree_item3">Aile ağacı takibi</span>
                                        </li>
                                    </ul>
                                    <div class="flex items-center text-purple-400 font-medium cursor-pointer" onclick="openAuthModal('login')">
                                        <span class="lang-text" data-tr="more_info">Daha fazla bilgi</span>
                                        <i class="fas fa-arrow-right ml-2 group-hover:translate-x-2 transition-transform duration-300"></i>
                                    </div>
                                </div>
                                
                                <!-- Feature 2: Sağlık & Performans Analitik -->
                                <div class="group relative p-8 bg-gradient-to-br from-white/5 via-white/5 to-transparent backdrop-blur-sm border border-white/10 rounded-3xl hover:border-green-500/30 transition-all duration-500 hover:scale-105">
                                    <div class="w-16 h-16 bg-gradient-to-r from-green-400 to-teal-500 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform duration-300">
                                        <i class="fas fa-heartbeat text-2xl text-white"></i>
                                    </div>
                                    <h3 class="text-2xl font-bold text-white mb-4 lang-text" data-tr="feature_combined_health_title">Sağlık & Performans Analitik</h3>
                                    <p class="text-gray-300 mb-4 leading-relaxed lang-text" data-tr="feature_combined_health_desc">
                                        Aşı takvimi, veteriner kontrolleri ve tedavi geçmişi ile birlikte detaylı performans analizleri ve trend raporları.
                                    </p>
                                    <ul class="space-y-2 mb-6">
                                        <li class="flex items-center text-sm text-gray-300">
                                            <i class="fas fa-check text-green-400 mr-2"></i>
                                            <span class="lang-text" data-tr="feature_combined_health_item1">Kapsamlı sağlık takibi</span>
                                        </li>
                                        <li class="flex items-center text-sm text-gray-300">
                                            <i class="fas fa-check text-green-400 mr-2"></i>
                                            <span class="lang-text" data-tr="feature_combined_health_item2">Performans trend analizleri</span>
                                        </li>
                                        <li class="flex items-center text-sm text-gray-300">
                                            <i class="fas fa-check text-green-400 mr-2"></i>
                                            <span class="lang-text" data-tr="feature_combined_health_item3">Detaylı istatistik raporları</span>
                                        </li>
                                    </ul>
                                    <div class="flex items-center text-green-400 font-medium cursor-pointer" onclick="openAuthModal('login')">
                                        <span class="lang-text" data-tr="more_info">Daha fazla bilgi</span>
                                        <i class="fas fa-arrow-right ml-2 group-hover:translate-x-2 transition-transform duration-300"></i>
                                    </div>
                                </div>
                                
                                <!-- Feature 3: AI Destekli Akıllı Sistemler -->
                                <div class="group relative p-8 bg-gradient-to-br from-white/5 via-white/5 to-transparent backdrop-blur-sm border border-white/10 rounded-3xl hover:border-cyan-500/30 transition-all duration-500 hover:scale-105">
                                    <div class="absolute top-4 right-4">
                                        <span class="px-3 py-1 bg-gradient-to-r from-emerald-500 to-teal-500 text-white text-xs font-bold rounded-full lang-text" data-tr="feature_combined_ai_badge">AI POWERED</span>
                                    </div>
                                    <div class="w-16 h-16 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform duration-300">
                                        <i class="fas fa-brain text-2xl text-white"></i>
                                    </div>
                                    <h3 class="text-2xl font-bold text-white mb-4 lang-text" data-tr="feature_combined_ai_title">AI Destekli Akıllı Sistemler</h3>
                                    <p class="text-gray-300 mb-4 leading-relaxed lang-text" data-tr="feature_combined_ai_desc">
                                        Yapay zeka ile genetik uyumluluk analizi, optimal eşleştirme önerileri ve otomatik performans tahminleri.
                                    </p>
                                    <ul class="space-y-2 mb-6">
                                        <li class="flex items-center text-sm text-gray-300">
                                            <i class="fas fa-check text-cyan-400 mr-2"></i>
                                            <span class="lang-text" data-tr="feature_combined_ai_item1">Akıllı eşleştirme önerileri</span>
                                        </li>
                                        <li class="flex items-center text-sm text-gray-300">
                                            <i class="fas fa-check text-cyan-400 mr-2"></i>
                                            <span class="lang-text" data-tr="feature_combined_ai_item2">Genetik uyumluluk analizi</span>
                                        </li>
                                        <li class="flex items-center text-sm text-gray-300">
                                            <i class="fas fa-check text-cyan-400 mr-2"></i>
                                            <span class="lang-text" data-tr="feature_combined_ai_item3">Çoklu dil desteği</span>
                                        </li>
                                    </ul>
                                    <div class="flex items-center text-cyan-400 font-medium cursor-pointer" onclick="openAuthModal('login')">
                                        <span class="lang-text" data-tr="detailed_analyses_login">Detaylı analizler için giriş yapın</span>
                                        <i class="fas fa-arrow-right ml-2 group-hover:translate-x-2 transition-transform duration-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Premium Performance Showcase Section -->
                    <section class="relative py-24 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-slate-900/50 to-transparent">
                        <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_center,rgba(59,130,246,0.1),transparent_50%)]"></div>
                        <div class="relative max-w-7xl mx-auto">
                            <!-- Section Header -->
                            <div class="text-center mb-16">
                                <div class="inline-flex items-center px-6 py-3 rounded-full bg-gradient-to-r from-blue-500/20 to-purple-500/20 border border-blue-500/30 backdrop-blur-sm mb-8">
                                    <i class="fas fa-chart-line text-blue-400 mr-3"></i>
                                    <span class="text-blue-300 text-sm font-medium lang-text" data-tr="performance_real_time">GERÇEK ZAMANLI ANALİTİK</span>
                                </div>
                                <h2 class="text-4xl sm:text-5xl lg:text-6xl font-bold mb-6">
                                    <span class="bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 bg-clip-text text-transparent lang-text" data-tr="performance_showcase_title">
                                        Gelişmiş Performans Takibi
                                    </span>
                                </h2>
                                <p class="text-xl text-gray-300 max-w-3xl mx-auto lang-text" data-tr="performance_showcase_desc">
                                    Yapay zeka destekli analiz sistemi ile güvercinlerinizin potansiyelini keşfedin
                                </p>
                            </div>
                            
                            <!-- Performance Grid -->
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                <!-- Tumbler Performance -->
                                <div class="group relative p-8 bg-gradient-to-br from-pink-500/10 via-purple-500/5 to-transparent backdrop-blur-sm border border-pink-500/20 rounded-3xl hover:border-pink-400/40 transition-all duration-500 overflow-hidden">
                                    <div class="absolute inset-0 bg-gradient-to-br from-pink-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                                    <div class="absolute top-4 right-4">
                                        <span class="px-3 py-1 bg-gradient-to-r from-emerald-500 to-teal-500 text-white text-xs font-bold rounded-full lang-text" data-tr="performance_new_badge">YENİ</span>
                                    </div>
                                    <div class="relative">
                                        <div class="flex items-center mb-8">
                                            <div class="w-14 h-14 bg-gradient-to-r from-pink-500 to-purple-600 rounded-2xl flex items-center justify-center mr-4">
                                                <i class="fas fa-dove text-2xl text-white"></i>
                                            </div>
                                            <h3 class="text-2xl font-bold text-white lang-text" data-tr="feature_tumbler_title">Kelebek Güvercin Performansı</h3>
                                        </div>
                                        
                                        <div class="space-y-6">
                                            <div class="flex items-start space-x-4 p-4 bg-white/5 backdrop-blur-sm rounded-2xl border border-white/10">
                                                <div class="w-12 h-12 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-xl flex items-center justify-center flex-shrink-0">
                                                    <i class="fas fa-feather-alt text-white"></i>
                                                </div>
                                                <div>
                                                    <div class="font-semibold text-white text-lg lang-text" data-tr="performance_flight_style">Uçuş Stili</div>
                                                    <div class="text-sm text-gray-400 lang-text" data-tr="performance_flight_style_desc">Estetik uçuş paternleri ve stil analizi</div>
                                                </div>
                                            </div>
                                            
                                            <div class="flex items-start space-x-4 p-4 bg-white/5 backdrop-blur-sm rounded-2xl border border-white/10">
                                                <div class="w-12 h-12 bg-gradient-to-r from-purple-400 to-pink-500 rounded-xl flex items-center justify-center flex-shrink-0">
                                                    <i class="fas fa-clock text-white"></i>
                                                </div>
                                                <div>
                                                    <div class="font-semibold text-white text-lg lang-text" data-tr="performance_endurance">Dayanıklılık</div>
                                                    <div class="text-sm text-gray-400 lang-text" data-tr="performance_endurance_desc">Uzun süreli uçuş performansı ve kondisyon</div>
                                                </div>
                                            </div>
                                            
                                            <div class="flex items-start space-x-4 p-4 bg-white/5 backdrop-blur-sm rounded-2xl border border-white/10">
                                                <div class="w-12 h-12 bg-gradient-to-r from-green-400 to-teal-500 rounded-xl flex items-center justify-center flex-shrink-0">
                                                    <i class="fas fa-star text-white"></i>
                                                </div>
                                                <div>
                                                    <div class="font-semibold text-white text-lg lang-text" data-tr="performance_aesthetic_score">Estetik Puan</div>
                                                    <div class="text-sm text-gray-400 lang-text" data-tr="performance_aesthetic_score_desc">Güzellik ve form değerlendirmesi</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Racing Performance -->
                                <div class="group relative p-8 bg-gradient-to-br from-blue-500/10 via-cyan-500/5 to-transparent backdrop-blur-sm border border-blue-500/20 rounded-3xl hover:border-blue-400/40 transition-all duration-500 overflow-hidden">
                                    <div class="absolute inset-0 bg-gradient-to-br from-blue-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                                    <div class="relative">
                                        <div class="flex items-center mb-8">
                                            <div class="w-14 h-14 bg-gradient-to-r from-blue-500 to-cyan-600 rounded-2xl flex items-center justify-center mr-4">
                                                <i class="fas fa-flag-checkered text-2xl text-white"></i>
                                            </div>
                                            <h3 class="text-2xl font-bold text-white lang-text" data-tr="feature_racing_title">Posta Güvercini Yarış Performansı</h3>
                                        </div>
                                        
                                        <div class="space-y-6">
                                            <div class="flex items-start space-x-4 p-4 bg-white/5 backdrop-blur-sm rounded-2xl border border-white/10">
                                                <div class="w-12 h-12 bg-gradient-to-r from-red-400 to-orange-500 rounded-xl flex items-center justify-center flex-shrink-0">
                                                    <i class="fas fa-chart-line text-white"></i>
                                                </div>
                                                <div>
                                                    <div class="font-semibold text-white text-lg lang-text" data-tr="performance_detailed_analysis">Detaylı Yarış Analizleri</div>
                                                    <div class="text-sm text-gray-400 lang-text" data-tr="performance_detailed_analysis_desc">Hız trendleri, sıralama dağılımları ve performans metrikleri</div>
                                                </div>
                                            </div>
                                            
                                            <div class="flex items-start space-x-4 p-4 bg-white/5 backdrop-blur-sm rounded-2xl border border-white/10">
                                                <div class="w-12 h-12 bg-gradient-to-r from-orange-400 to-yellow-500 rounded-xl flex items-center justify-center flex-shrink-0">
                                                    <i class="fas fa-medal text-white"></i>
                                                </div>
                                                <div>
                                                    <div class="font-semibold text-white text-lg lang-text" data-tr="performance_success_stats">Başarı İstatistikleri</div>
                                                    <div class="text-sm text-gray-400 lang-text" data-tr="performance_success_stats_desc">Madalya dağılımı ve podyum performansları</div>
                                                </div>
                                            </div>
                                            
                                            <div class="flex items-start space-x-4 p-4 bg-white/5 backdrop-blur-sm rounded-2xl border border-white/10">
                                                <div class="w-12 h-12 bg-gradient-to-r from-yellow-400 to-amber-500 rounded-xl flex items-center justify-center flex-shrink-0">
                                                    <i class="fas fa-chart-bar text-white"></i>
                                                </div>
                                                <div>
                                                    <div class="font-semibold text-white text-lg lang-text" data-tr="performance_distance_correlation">Mesafe-Hız Korelasyonu</div>
                                                    <div class="text-sm text-gray-400 lang-text" data-tr="performance_distance_correlation_desc">Mesafeye göre optimal performans analizi</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Smart Breeding System -->
                                <div class="group relative p-8 bg-gradient-to-br from-purple-500/10 via-indigo-500/5 to-transparent backdrop-blur-sm border border-purple-500/20 rounded-3xl hover:border-purple-400/40 transition-all duration-500 overflow-hidden">
                                    <div class="absolute inset-0 bg-gradient-to-br from-purple-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                                    <div class="absolute top-4 right-4">
                                        <span class="px-3 py-1 bg-gradient-to-r from-orange-500 to-red-500 text-white text-xs font-bold rounded-full lang-text" data-tr="performance_popular_badge">POPÜLER</span>
                                    </div>
                                    <div class="relative">
                                        <div class="flex items-center mb-8">
                                            <div class="w-14 h-14 bg-gradient-to-r from-purple-500 to-indigo-600 rounded-2xl flex items-center justify-center mr-4">
                                                <i class="fas fa-dna text-2xl text-white"></i>
                                            </div>
                                            <h3 class="text-2xl font-bold text-white lang-text" data-tr="feature_breeding_title">Akıllı Eşleştirme</h3>
                                        </div>
                                        
                                        <div class="space-y-6">
                                            <div class="flex items-start space-x-4 p-4 bg-white/5 backdrop-blur-sm rounded-2xl border border-white/10">
                                                <div class="w-12 h-12 bg-gradient-to-r from-teal-400 to-cyan-500 rounded-xl flex items-center justify-center flex-shrink-0">
                                                    <i class="fas fa-microscope text-white"></i>
                                                </div>
                                                <div>
                                                    <div class="font-semibold text-white text-lg lang-text" data-tr="performance_genetic_map">Genetik Haritası</div>
                                                    <div class="text-sm text-gray-400 lang-text" data-tr="performance_genetic_map_desc">DNA analizi ve kalıtsal özellik takibi</div>
                                                </div>
                                            </div>
                                            
                                            <div class="flex items-start space-x-4 p-4 bg-white/5 backdrop-blur-sm rounded-2xl border border-white/10">
                                                <div class="w-12 h-12 bg-gradient-to-r from-pink-400 to-rose-500 rounded-xl flex items-center justify-center flex-shrink-0">
                                                    <i class="fas fa-heart text-white"></i>
                                                </div>
                                                <div>
                                                    <div class="font-semibold text-white text-lg lang-text" data-tr="performance_compatibility_score">Uyumluluk Skoru</div>
                                                    <div class="text-sm text-gray-400 lang-text" data-tr="performance_compatibility_score_desc">AI destekli optimal eşleştirme önerileri</div>
                                                </div>
                                            </div>
                                            
                                            <div class="flex items-start space-x-4 p-4 bg-white/5 backdrop-blur-sm rounded-2xl border border-white/10">
                                                <div class="w-12 h-12 bg-gradient-to-r from-indigo-400 to-purple-500 rounded-xl flex items-center justify-center flex-shrink-0">
                                                    <i class="fas fa-baby text-white"></i>
                                                </div>
                                                <div>
                                                    <div class="font-semibold text-white text-lg lang-text" data-tr="performance_next_generation">Sonraki Nesil</div>
                                                    <div class="text-sm text-gray-400 lang-text" data-tr="performance_next_generation_desc">Yavru potansiyeli ve özellik tahminleri</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- CTA for Performance Features -->
                            <div class="text-center mt-16">
                                <button onclick="openAuthModal('register')" class="group px-8 py-4 bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl font-semibold text-lg text-white hover:from-blue-400 hover:to-purple-500 transform hover:scale-105 transition-all duration-300 shadow-2xl hover:shadow-blue-500/25">
                                    <i class="fas fa-rocket mr-3"></i>
                                    <span>${translations[currentLang].try_performance_analysis || 'Try Performance Analysis'}</span>
                                    <i class="fas fa-arrow-right ml-3 group-hover:translate-x-2 transition-transform duration-300"></i>
                                </button>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Testimonials Section -->
                    <section class="py-12 px-6 bg-gradient-to-b from-transparent via-purple-900/10 to-transparent">
                        <div class="container mx-auto">
                            <h3 class="text-4xl font-bold text-center mb-8">
                                <span class="bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent lang-text" data-tr="testimonials_title">
                                    Kullanıcı Deneyimleri
                                </span>
                            </h3>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                                <div class="testimonial-card">
                                    <p class="text-gray-300 mb-6 pt-8 lang-text" data-tr="testimonial1_text">
                                        Bu sistem sayesinde güvercinlerimin performansını çok daha iyi takip edebiliyorum. Özellikle oyun dönüş kuşu performans takibi harika!
                                    </p>
                                    <div class="flex items-center gap-4">
                                        <div class="w-12 h-12 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-full flex items-center justify-center">
                                            <i class="fas fa-user text-white"></i>
                                        </div>
                                        <div>
                                            <div class="font-semibold lang-text" data-tr="testimonial1_author">Ahmet Yılmaz</div>
                                            <div class="text-sm text-gray-400 lang-text" data-tr="testimonial1_role">Profesyonel Güvercin Yetiştiricisi</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="testimonial-card">
                                    <p class="text-gray-300 mb-6 pt-8 lang-text" data-tr="testimonial2_text">
                                        10 yıldır güvercin yetiştiriyorum. Bu kadar detaylı ve kullanışlı bir sistem görmedim. Yarış sonuçlarım %40 iyileşti.
                                    </p>
                                    <div class="flex items-center gap-4">
                                        <div class="w-12 h-12 bg-gradient-to-r from-purple-400 to-pink-500 rounded-full flex items-center justify-center">
                                            <i class="fas fa-user text-white"></i>
                                        </div>
                                        <div>
                                            <div class="font-semibold lang-text" data-tr="testimonial2_author">Mehmet Demir</div>
                                            <div class="text-sm text-gray-400 lang-text" data-tr="testimonial2_role">Yarış Güvercini Uzmanı</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="testimonial-card">
                                    <p class="text-gray-300 mb-6 pt-8 lang-text" data-tr="testimonial3_text">
                                        Soyağacı takibi ve genetik analizler muhteşem. Hangi güvercinleri eşleştireceğime artık çok daha kolay karar verebiliyorum.
                                    </p>
                                    <div class="flex items-center gap-4">
                                        <div class="w-12 h-12 bg-gradient-to-r from-pink-400 to-red-500 rounded-full flex items-center justify-center">
                                            <i class="fas fa-user text-white"></i>
                                        </div>
                                        <div>
                                            <div class="font-semibold lang-text" data-tr="testimonial3_author">Fatma Kaya</div>
                                            <div class="text-sm text-gray-400 lang-text" data-tr="testimonial3_role">Güvercin Üreticisi</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Pricing Section -->
                    <section class="py-12 px-6">
                        <div class="container mx-auto">
                            <h3 class="text-4xl font-bold text-center mb-8">
                                <span class="bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent lang-text" data-tr="pricing_title">
                                    Size Uygun Planı Seçin
                                </span>
                            </h3>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                                <!-- Free Plan -->
                                <div class="pricing-card glass p-8 rounded-3xl border border-gray-600 hover:border-cyan-400 transition-all duration-300">
                                    <h4 class="text-2xl font-bold mb-4 lang-text" data-tr="plan_free">Ücretsiz</h4>
                                    <div class="mb-6">
                                        <span class="text-4xl font-bold lang-text" data-tr="plan_price_free">0₺</span>
                                        <span class="text-gray-400 lang-text" data-tr="plan_period">/ay</span>
                                    </div>
                                    
                                    <ul class="space-y-4 mb-8">
                                        <li class="flex items-start gap-3">
                                            <i class="fas fa-check text-green-400 mt-1"></i>
                                            <span class="text-gray-300 lang-text" data-tr="free_feature1">7 güvercin kaydı</span>
                                        </li>
                                        <li class="flex items-start gap-3">
                                            <i class="fas fa-check text-green-400 mt-1"></i>
                                            <span class="text-gray-300 lang-text" data-tr="free_feature2">Temel soyağacı takibi</span>
                                        </li>
                                        <li class="flex items-start gap-3">
                                            <i class="fas fa-check text-green-400 mt-1"></i>
                                            <span class="text-gray-300 lang-text" data-tr="free_feature3">Sağlık kayıtları</span>
                                        </li>
                                        <li class="flex items-start gap-3">
                                            <i class="fas fa-check text-green-400 mt-1"></i>
                                            <span class="text-gray-300 lang-text" data-tr="free_feature4">QR kod paylaşımı</span>
                                        </li>
                                    </ul>
                                    
                                    <button onclick="openAuthModal('register')" class="w-full py-3 px-6 bg-gray-600 hover:bg-gray-700 rounded-full transition">
                                        <span class="lang-text" data-tr="btn_choose_plan">Planı Seç</span>
                                    </button>
                                </div>
                                
                                <!-- Premium Plan -->
                                <div class="pricing-card glass p-8 rounded-3xl border-2 border-purple-500 relative overflow-hidden featured">
                                    <!-- Popular Badge -->
                                    <div class="absolute top-0 right-0 bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-2 rounded-bl-2xl">
                                        <span class="text-sm font-bold lang-text" data-tr="badge_popular">EN POPÜLER</span>
                                    </div>
                                    
                                    <h4 class="text-2xl font-bold mb-4 text-purple-400 lang-text" data-tr="plan_premium">Premium</h4>
                                    <div class="mb-6">
                                        <span class="text-4xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                                            <span data-price-tr="₺39.90" data-price-en="$9.99">₺39.90</span>
                                        </span>
                                        <span class="text-gray-400 lang-text" data-tr="plan_period">/ay</span>
                                    </div>
                                    
                                    <ul class="space-y-4 mb-8">
                                        <li class="flex items-start gap-3">
                                            <i class="fas fa-check text-purple-400 mt-1"></i>
                                            <span class="text-gray-300 lang-text" data-tr="premium_feature1">Sınırsız güvercin kaydı</span>
                                        </li>
                                        <li class="flex items-start gap-3">
                                            <i class="fas fa-check text-purple-400 mt-1"></i>
                                            <span class="text-gray-300 lang-text" data-tr="premium_feature2">Gelişmiş 10 nesil soyağacı takibi</span>
                                        </li>
                                        <li class="flex items-start gap-3">
                                            <i class="fas fa-check text-purple-400 mt-1"></i>
                                            <span class="text-gray-300 lang-text" data-tr="premium_feature3">Yapay zeka eşleştirme ve genetik renk analizi</span>
                                        </li>
                                        <li class="flex items-start gap-3">
                                            <i class="fas fa-check text-purple-400 mt-1"></i>
                                            <span class="text-gray-300 lang-text" data-tr="premium_feature4">Yarış ve performans takibi</span>
                                        </li>
                                        <li class="flex items-start gap-3">
                                            <i class="fas fa-check text-purple-400 mt-1"></i>
                                            <span class="text-gray-300 lang-text" data-tr="premium_feature5">Excel dışa aktarım</span>
                                        </li>
                                        <li class="flex items-start gap-3">
                                            <i class="fas fa-check text-purple-400 mt-1"></i>
                                            <span class="text-gray-300 lang-text" data-tr="premium_feature6">Topluluk erişimi</span>
                                        </li>
                                        <li class="flex items-start gap-3">
                                            <i class="fas fa-check text-purple-400 mt-1"></i>
                                            <span class="text-gray-300 lang-text" data-tr="premium_feature7">7/24 destek</span>
                                        </li>
                                    </ul>
                                    
                                    <button onclick="handlePremiumPurchaseLocal()" class="w-full py-3 px-6 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-full transition">
                                        <span class="lang-text" data-tr="btn_upgrade">Yükselt</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Additional Info -->
                            <div class="mt-16 text-center">
                                <p class="text-gray-400 mb-4">
                                    <span class="lang-text" data-tr="trial_info">Tüm planlar 7 günlük ücretsiz deneme süresi içerir</span>
                                </p>
                                <p class="text-sm text-gray-500">
                                    <span class="lang-text" data-tr="no_cc_required">Kredi kartı gerekmez • İstediğiniz zaman iptal edebilirsiniz</span>
                                </p>
                            </div>
                        </div>
                    </section>
                    
                    <!-- FAQ Section -->
                    <section class="py-12 px-6">
                        <div class="container mx-auto max-w-4xl">
                            <h3 class="text-4xl font-bold text-center mb-8">
                                <span class="bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent lang-text" data-tr="faq_title">
                                    Sıkça Sorulan Sorular
                                </span>
                            </h3>
                            
                            <div class="space-y-4">
                                <div class="faq-item">
                                    <div class="faq-question" onclick="toggleFAQ(this)">
                                        <span class="text-lg font-semibold lang-text" data-tr="faq_q1">Sistem nasıl çalışır?</span>
                                        <i class="fas fa-chevron-down faq-icon transition-transform"></i>
                                    </div>
                                    <div class="faq-answer">
                                        <p class="text-gray-400 lang-text" data-tr="faq_a1">
                                            Üye olduktan sonra güvercinlerinizi kaydedebilir, soyağaçlarını takip edebilir, performans kayıtları tutabilir ve detaylı raporlar alabilirsiniz.
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="faq-item">
                                    <div class="faq-question" onclick="toggleFAQ(this)">
                                        <span class="text-lg font-semibold lang-text" data-tr="faq_q2">Güvercin kaydı sınırı var mı?</span>
                                        <i class="fas fa-chevron-down faq-icon transition-transform"></i>
                                    </div>
                                    <div class="faq-answer">
                                        <p class="text-gray-400 lang-text" data-tr="faq_a2">
                                            Ücretsiz planda 5, Pro planda 50 güvercin kaydedebilirsiniz. Premium planda sınır yoktur.
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="faq-item">
                                    <div class="faq-question" onclick="toggleFAQ(this)">
                                        <span class="text-lg font-semibold lang-text" data-tr="faq_q3">Verilerin güvenliği nasıl sağlanıyor?</span>
                                        <i class="fas fa-chevron-down faq-icon transition-transform"></i>
                                    </div>
                                    <div class="faq-answer">
                                        <p class="text-gray-400 lang-text" data-tr="faq_a3">
                                            Tüm verileriniz şifreli olarak saklanır ve sadece sizin erişiminize açıktır. Verileriniz asla üçüncü taraflarla paylaşılmaz.
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="faq-item">
                                    <div class="faq-question" onclick="toggleFAQ(this)">
                                        <span class="text-lg font-semibold lang-text" data-tr="faq_q4">Mobil uygulama var mı?</span>
                                        <i class="fas fa-chevron-down faq-icon transition-transform"></i>
                                    </div>
                                    <div class="faq-answer">
                                        <p class="text-gray-400 lang-text" data-tr="faq_a4">
                                            Web uygulamamız mobil uyumludur. Native mobil uygulama üzerinde çalışıyoruz.
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="faq-item">
                                    <div class="faq-question" onclick="toggleFAQ(this)">
                                        <span class="text-lg font-semibold lang-text" data-tr="faq_q5">Ödeme yöntemleri nelerdir?</span>
                                        <i class="fas fa-chevron-down faq-icon transition-transform"></i>
                                    </div>
                                    <div class="faq-answer">
                                        <p class="text-gray-400 lang-text" data-tr="faq_a5">
                                            Kredi kartı, banka havalesi ve sanal pos ile ödeme yapabilirsiniz.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- CTA Section -->
                    <section class="py-12 px-6">
                        <div class="container mx-auto text-center">
                            <div class="glass p-12 rounded-3xl max-w-3xl mx-auto">
                                <h3 class="text-4xl font-bold mb-4">
                                    <span class="bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent lang-text" data-tr="cta_title">
                                        Hemen Başlayın
                                    </span>
                                </h3>
                                <p class="text-xl text-gray-300 mb-8 lang-text" data-tr="cta_subtitle">
                                    Güvercinlerinizin geleceği için bugün adım atın
                                </p>
                                <button onclick="openAuthModal('register')" class="cta-button">
                                    <i class="fas fa-rocket mr-2"></i>
                                    <span class="lang-text" data-tr="cta_button">Ücretsiz Deneyin</span>
                                </button>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Floating Feathers -->
                    <div class="feather" style="left: 10%; animation-delay: 0s;"><i class="fas fa-feather-alt text-4xl"></i></div>
                    <div class="feather" style="left: 30%; animation-delay: 3s;"><i class="fas fa-feather-alt text-3xl"></i></div>
                    <div class="feather" style="left: 50%; animation-delay: 6s;"><i class="fas fa-feather-alt text-5xl"></i></div>
                    <div class="feather" style="left: 70%; animation-delay: 9s;"><i class="fas fa-feather-alt text-3xl"></i></div>
                    <div class="feather" style="left: 90%; animation-delay: 12s;"><i class="fas fa-feather-alt text-4xl"></i></div>
            `;
                updateLanguage();
                return;
            }
            
            const t = translations[currentLang];
            
            try {
                // Supabase'den verileri çek
                const pigeonsResult = await SupabaseDB.getPigeons(storage.currentUser.id);
                const userPigeons = pigeonsResult.success ? pigeonsResult.data : [];
                
                const matingsResult = await SupabaseDB.getMatings(storage.currentUser.id);
                const userMatings = matingsResult.success ? matingsResult.data : [];
                
                
                // Health records - filter by user pigeons
                const userHealthRecords = [];
                if (userPigeons.length > 0) {
                    for (const pigeon of userPigeons) {
                        const healthResult = await SupabaseDB.getHealthRecords(pigeon.id);
                        if (healthResult.success && healthResult.data) {
                            userHealthRecords.push(...healthResult.data);
                        }
                    }
                }
                
                // Cache'leri güncelle - eski kodun çalışması için
                storage.updatePigeonsCache(userPigeons);
                storage.updateMatingsCache(userMatings);
                storage.updateHealthRecordsCache(userHealthRecords);
                
                // Calculate statistics
                const activePigeons = userPigeons.filter(p => p.status === 'active' || !p.status).length;
                const champions = userPigeons.filter(p => p.achievements && p.achievements.length > 0).length;
                const recentMatings = userMatings.filter(m => {
                    const matingDate = new Date(m.mating_date || m.date);
                    const monthAgo = new Date();
                    monthAgo.setMonth(monthAgo.getMonth() - 1);
                    return matingDate > monthAgo;
                }).length;
            
            // Simplified premium dashboard with focus on incubation tracking
            const contentDiv = document.getElementById('content');
            contentDiv.innerHTML = `
                <!-- Minimalist Hero Section -->
                <div class="premium-hero-section mb-8">
                    <div class="container mx-auto px-4">
                        <div class="glass p-6 md:p-8 rounded-3xl bg-gradient-to-br from-purple-900/10 via-transparent to-cyan-900/10 border border-white/5">
                            <div class="text-center">
                                <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold mb-2">
                                    ${getGreeting()}, <span class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400">${storage.currentUser.name}</span>!
                                </h1>
                                <p class="text-gray-400 text-sm md:text-base">${formatDate(new Date(), { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Decorative Background Elements -->
                <div class="fixed inset-0 overflow-hidden pointer-events-none">
                    <div class="absolute top-20 left-10 opacity-5">
                        <i class="fas fa-dove text-[200px] transform rotate-12"></i>
                    </div>
                    <div class="absolute bottom-20 right-10 opacity-5">
                        <i class="fas fa-feather-alt text-[150px] transform -rotate-12"></i>
                    </div>
                </div>

                <!-- Main Content - 3 Column Layout -->
                <div class="container mx-auto px-4">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8">
                        
                        <!-- Left Column - General Statistics -->
                        <div class="lg:col-span-1">
                            ${renderGeneralStatistics(userPigeons, userMatings)}
                        </div>
                        
                        <!-- Center Column - Incubation Tracking (Enlarged) -->
                        <div class="lg:col-span-1">
                            ${renderIncubationTrackingEnhanced(userMatings, userPigeons)}
                        </div>
                        
                        <!-- Right Column - Performance Analytics -->
                        <div class="lg:col-span-1">
                            ${await renderPerformanceAnalytics(userPigeons)}
                        </div>
                    </div>
                    
                    <!-- Pedigree Preview Section -->
                    ${renderPedigreePreview()}
                </div>
            `;
            
            // Animate counters
            setTimeout(() => {
                const counters = document.querySelectorAll('.counter, .stat-counter');
                counters.forEach(counter => {
                    const target = parseInt(counter.getAttribute('data-target'));
                    const increment = target / 100;
                    let count = 0;
                    
                    const updateCounter = () => {
                        if (count < target) {
                            count += increment;
                            counter.textContent = Math.ceil(count);
                            requestAnimationFrame(updateCounter);
                        } else {
                            counter.textContent = target;
                        }
                    };
                    
                    updateCounter();
                });
                
                // Initialize performance chart
                const ctx = document.getElementById('performanceChart');
                if (ctx) {
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['Oca', 'Şub', 'Mar', 'Nis', 'May', 'Haz'],
                            datasets: [{
                                label: 'Performans Skoru',
                                data: [65, 72, 78, 75, 82, 85],
                                borderColor: 'rgb(75, 192, 192)',
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(255,255,255,0.1)'
                                    }
                                },
                                x: {
                                    grid: {
                                        color: 'rgba(255,255,255,0.1)'
                                    }
                                }
                            }
                        }
                    });
                }
            }, 100);
            
            } catch (error) {
                // Hata durumunda mesaj göster
                console.error('showHomepage error:', error);
                document.getElementById('content').innerHTML = `
                    <div class="text-center py-20">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                        <p class="text-red-400">Error loading homepage.</p>
                        <p class="text-gray-400 mt-2">Hata: ${error.message}</p>
                        <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition">
                            Sayfayı Yenile
                        </button>
                    </div>
                `;
            }
            
        } catch (outerError) {
            // Catch for the outer try block
            console.error('showHomepage outer error:', outerError);
            const contentDiv = document.getElementById('content');
            if (contentDiv) {
                contentDiv.innerHTML = `
                    <div class="text-center py-20">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                        <p class="text-red-400">Critical error loading homepage.</p>
                        <p class="text-gray-400 mt-2">Hata: ${outerError.message}</p>
                        <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition">
                            Sayfayı Yenile
                        </button>
                    </div>
                `;
            }
        }
        }

        // Show Pricing Page
        function showPricing() {
            cleanupPreviousViews();
            updateActiveTab(-1); // No active tab for pricing
            const t = translations[currentLang];
            
            const currentPrice = currentLang === 'tr' ? '₺39.90' : '$9.99';
            
            // Local premium purchase handler
            window.handlePremiumPurchaseLocal = async function() {
                if (typeof handlePremiumPurchase === 'function') {
                    await handlePremiumPurchase();
                } else {
                    // Fallback - inline implementation
                    if (!checkAuth()) {
                        openAuthModal('login');
                        showNotification(
                            currentLang === 'tr' ? 
                                'Premium üyelik için giriş yapmanız gerekiyor' : 
                                'You need to login for premium membership',
                            'warning'
                        );
                        return;
                    }
                    showNotification(
                        currentLang === 'tr' ? 
                            'Premium sistem yükleniyor, lütfen tekrar deneyin.' : 
                            'Premium system is loading, please try again.',
                        'info'
                    );
                }
            };
            
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                    <!-- Pricing Header -->
                    <div class="text-center mb-12">
                        <h1 class="text-5xl font-bold mb-6">
                            <span class="bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent">
                                ${t.pricing_title}
                            </span>
                        </h1>
                        <p class="text-xl text-gray-300 max-w-3xl mx-auto">
                            ${currentLang === 'tr' ? 
                                'Güvercin koloninizi profesyonelce yönetmek için size en uygun planı seçin' : 
                                'Choose the best plan to professionally manage your pigeon colony'}
                        </p>
                    </div>
                    
                    <!-- Pricing Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                        <!-- Free Plan -->
                        <div class="pricing-card glass p-8 rounded-3xl border border-gray-600 hover:border-cyan-400 transition-all duration-300">
                            <h3 class="text-2xl font-bold mb-4">${t.plan_free}</h3>
                            <div class="mb-6">
                                <span class="text-4xl font-bold">${t.plan_price_free}</span>
                                <span class="text-gray-400">${t.plan_period}</span>
                            </div>
                            
                            <ul class="space-y-4 mb-8">
                                <li class="flex items-start gap-3">
                                    <i class="fas fa-check text-green-400 mt-1"></i>
                                    <span class="text-gray-300">${t.free_feature1}</span>
                                </li>
                                <li class="flex items-start gap-3">
                                    <i class="fas fa-check text-green-400 mt-1"></i>
                                    <span class="text-gray-300">${t.free_feature2}</span>
                                </li>
                                <li class="flex items-start gap-3">
                                    <i class="fas fa-check text-green-400 mt-1"></i>
                                    <span class="text-gray-300">${t.free_feature3}</span>
                                </li>
                                <li class="flex items-start gap-3">
                                    <i class="fas fa-check text-green-400 mt-1"></i>
                                    <span class="text-gray-300">${t.free_feature4}</span>
                                </li>
                            </ul>
                            
                            <button onclick="openAuthModal('register')" class="w-full py-3 px-6 bg-gray-600 hover:bg-gray-700 rounded-full transition">
                                ${t.btn_choose_plan || 'Planı Seç'}
                            </button>
                        </div>
                        
                        <!-- Premium Plan -->
                        <div class="pricing-card glass p-8 rounded-3xl border-2 border-purple-500 relative overflow-hidden featured">
                            <!-- Popular Badge -->
                            <div class="absolute top-0 right-0 bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-2 rounded-bl-2xl">
                                <span class="text-sm font-bold">
                                    ${currentLang === 'tr' ? 'EN POPÜLER' : 'MOST POPULAR'}
                                </span>
                            </div>
                            
                            <h3 class="text-2xl font-bold mb-4 text-purple-400">${t.plan_premium}</h3>
                            <div class="mb-6">
                                <span class="text-4xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                                    ${currentPrice}
                                </span>
                                <span class="text-gray-400">${t.plan_period}</span>
                            </div>
                            
                            <ul class="space-y-4 mb-8">
                                <li class="flex items-start gap-3">
                                    <i class="fas fa-check text-purple-400 mt-1"></i>
                                    <span class="text-gray-300">${t.premium_feature1}</span>
                                </li>
                                <li class="flex items-start gap-3">
                                    <i class="fas fa-check text-purple-400 mt-1"></i>
                                    <span class="text-gray-300">${t.premium_feature2}</span>
                                </li>
                                <li class="flex items-start gap-3">
                                    <i class="fas fa-check text-purple-400 mt-1"></i>
                                    <span class="text-gray-300">${t.premium_feature3}</span>
                                </li>
                                <li class="flex items-start gap-3">
                                    <i class="fas fa-check text-purple-400 mt-1"></i>
                                    <span class="text-gray-300">${t.premium_feature4}</span>
                                </li>
                                <li class="flex items-start gap-3">
                                    <i class="fas fa-check text-purple-400 mt-1"></i>
                                    <span class="text-gray-300">${t.premium_feature5}</span>
                                </li>
                                <li class="flex items-start gap-3">
                                    <i class="fas fa-check text-purple-400 mt-1"></i>
                                    <span class="text-gray-300">${t.premium_feature6}</span>
                                </li>
                                <li class="flex items-start gap-3">
                                    <i class="fas fa-check text-purple-400 mt-1"></i>
                                    <span class="text-gray-300">${t.premium_feature7}</span>
                                </li>
                            </ul>
                            
                            <button onclick="handlePremiumPurchaseLocal()" class="w-full py-3 px-6 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-full transition">
                                ${t.btn_upgrade || 'Yükselt'}
                            </button>
                        </div>
                    </div>
                    
                    <!-- Additional Info -->
                    <div class="mt-16 text-center">
                        <p class="text-gray-400 mb-4">
                            ${currentLang === 'tr' ? 
                                'Tüm planlar 7 günlük ücretsiz deneme süresi içerir' : 
                                'All plans include a 7-day free trial'}
                        </p>
                        <p class="text-sm text-gray-500">
                            ${currentLang === 'tr' ? 
                                'Kredi kartı gerekmez • İstediğiniz zaman iptal edebilirsiniz' : 
                                'No credit card required • Cancel anytime'}
                        </p>
                    </div>
                </div>
            `;
        }

        // Show Pigeons with filters - SUPABASE VERSION
        async function showPigeons(filters = {}) {
            if (!checkAuth()) return;
            cleanupPreviousViews();
            updateActiveTab(1);
            
            // Loading göster
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                    <div class="glass p-8 rounded-3xl text-center">
                        <i class="fas fa-spinner fa-spin text-4xl text-cyan-400 mb-4"></i>
                        <p class="text-xl">Güvercinler yükleniyor...</p>
                    </div>
                </div>
            `;
            
            try {
                // Supabase'den güvercinleri getir
                const result = await SupabaseDB.getPigeons(storage.currentUser.id);
                
                if (!result.success) {
                    throw new Error(result.error);
                }
                
                let userPigeons = result.data || [];
                
                // Apply filters
                if (filters.breed) {
                    userPigeons = userPigeons.filter(p => p.breed === filters.breed);
                }
                if (filters.gender) {
                    userPigeons = userPigeons.filter(p => p.gender === filters.gender);
                }
                if (filters.search) {
                    const searchTerm = filters.search.toLowerCase();
                    userPigeons = userPigeons.filter(p => 
                        p.name.toLowerCase().includes(searchTerm) || 
                        p.band_number.toLowerCase().includes(searchTerm)
                    );
                }
                
                const t = translations[currentLang];
                
                // Get unique values for filters
                const allPigeons = result.data || [];
                const breeds = [...new Set(allPigeons.map(p => p.breed).filter(b => b))];
            
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                <div class="glass p-8 rounded-3xl">`
                +
                `
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold">${t.my_pigeons}</h2>
                    <button onclick="showAddPigeon()" class="btn-primary">
                        <i class="fas fa-plus mr-2"></i> ${t.add_pigeon}
                    </button>
                </div>
                
                <!-- Filters -->
                <div class="glass p-4 rounded-xl mb-6">
                    <div class="flex flex-wrap gap-4 items-center">
                        <input 
                            type="text" 
                            placeholder="${t.search}..." 
                            onchange="showPigeons({...${JSON.stringify(filters)}, search: this.value})"
                            value="${filters.search || ''}"
                            class="px-4 py-2 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none"
                        >
                        
                        <select 
                            onchange="showPigeons({...${JSON.stringify(filters)}, breed: this.value})"
                            class="px-4 py-2 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none"
                        >
                            <option value="">${t.filter_by_breed}</option>
                            ${breeds.map(b => `
                                <option value="${b}" ${filters.breed === b ? 'selected' : ''}>${t[b] || b}</option>
                            `).join('')}
                        </select>
                        
                        <select 
                            onchange="showPigeons({...${JSON.stringify(filters)}, gender: this.value})"
                            class="px-4 py-2 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none"
                        >
                            <option value="">${t.filter_by_gender}</option>
                            <option value="male" ${filters.gender === 'male' ? 'selected' : ''}>${t.male}</option>
                            <option value="female" ${filters.gender === 'female' ? 'selected' : ''}>${t.female}</option>
                        </select>
                        
                        ${Object.keys(filters).length > 0 ? `
                            <button onclick="showPigeons()" class="px-4 py-2 bg-red-500 rounded-lg hover:bg-red-600 transition">
                                <i class="fas fa-times mr-2"></i> ${t.clear_filters}
                            </button>
                        ` : ''}
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    ${userPigeons.map(pigeon => `
                        <div class="glass p-6 rounded-2xl pigeon-card">
                            ${pigeon.image_url ? `
                                <img src="${pigeon.image_url}" alt="${pigeon.name}" class="w-full h-48 object-cover rounded-xl mb-4">
                            ` : `
                                <div class="bg-gradient-to-r from-cyan-400 to-purple-400 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-dove text-3xl"></i>
                                </div>
                            `}
                            <h3 class="text-xl font-bold text-center mb-2">${pigeon.name}</h3>
                            <p class="text-center text-gray-400 mb-4">${pigeon.band_number}</p>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">${t.breed}:</span>
                                    <span>${pigeon.breed}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">${t.color || 'Renk'}:</span>
                                    <span class="flex items-center gap-2">
                                        ${pigeon.color ? `
                                            <span class="w-4 h-4 rounded-full border border-gray-400" 
                                                  style="background-color: ${window.ColorPatternSystem?.turkishPigeonColors[pigeon.color]?.hex || '#808080'}"></span>
                                            ${window.ColorPatternSystem?.getColorDisplayName(pigeon.color) || pigeon.color}
                                        ` : '-'}
                                    </span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">${t.gender}:</span>
                                    <span>${pigeon.gender === 'male' ? t.male : t.female}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">${t.birth}:</span>
                                    <span>${formatDate(pigeon.birth_date)}</span>
                                </div>
                            </div>
                            <div class="flex gap-2 mt-4">
                                <button type="button" data-action="showDetail" data-pigeon-id="${pigeon.id}" onclick="showPigeonDetail('${pigeon.id}')" class="flex-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg hover:bg-white/20 transition text-sm">
                                    <i class="fas fa-eye"></i> ${t.detail}
                                </button>
                                <button type="button" data-action="showPedigree" data-pigeon-id="${pigeon.id}" onclick="showPedigree('${pigeon.id}')" class="flex-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg hover:bg-white/20 transition text-sm">
                                    <i class="fas fa-sitemap"></i> ${t.pedigree}
                                </button>
                                <button type="button" data-action="deletePigeon" data-pigeon-id="${pigeon.id}" onclick="deletePigeon('${pigeon.id}')" class="px-3 py-2 bg-red-500/20 border border-red-500/40 rounded-lg hover:bg-red-500/30 transition text-sm">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `).join('') || `<p class="text-gray-400 col-span-3 text-center">${t.no_pigeons}</p>`}
                </div>
                </div>
                </div>
            `;
            
            } catch (error) {
                console.error('Error loading pigeons:', error);
                document.getElementById('content').innerHTML = `
                    <div class="container mx-auto">
                        <div class="glass p-8 rounded-3xl text-center">
                            <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                            <p class="text-xl text-red-400">Güvercinler yüklenemedi</p>
                            <p class="text-gray-400 mt-2">${error.message || 'An error occurred'}</p>
                            <button onclick="showPigeons()" class="btn-primary mt-4">
                                <i class="fas fa-redo mr-2"></i> Tekrar Dene
                            </button>
                        </div>
                    </div>
                `;
            }
        }
        
        // Helper functions for premium dashboard
        function getGreeting() {
            const hour = new Date().getHours();
            const t = translations[currentLang];
            if (hour < 12) return t.good_morning || 'Günaydın';
            if (hour < 18) return t.good_afternoon || 'İyi günler';
            return t.good_evening || 'İyi akşamlar';
        }
        
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - new Date(date)) / 1000);
            const t = translations[currentLang];
            
            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + ' ' + (t.years_ago || 'yıl önce');
            
            interval = seconds / 2592000;
            if (interval > 1) return Math.floor(interval) + ' ' + (t.months_ago || 'ay önce');
            
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + ' ' + (t.days_ago || 'gün önce');
            
            interval = seconds / 3600;
            if (interval > 1) return Math.floor(interval) + ' ' + (t.hours_ago || 'saat önce');
            
            interval = seconds / 60;
            if (interval > 1) return Math.floor(interval) + ' ' + (t.minutes_ago || 'dakika önce');
            
            return Math.floor(seconds) + ' ' + (t.seconds_ago || 'saniye önce');
        }
        
        function getActivityIcon(type) {
            const icons = {
                'pigeon_added': 'fa-dove text-cyan-400',
                'mating_added': 'fa-heart text-pink-400',
                'race_completed': 'fa-flag-checkered text-green-400',
                'health_record': 'fa-notes-medical text-yellow-400',
                'performance_update': 'fa-chart-line text-purple-400'
            };
            return icons[type] || 'fa-circle text-gray-400';
        }
        
        function renderQuickActions() {
            const t = translations[currentLang];
            return `
                <div class="quick-actions-grid mb-8">
                    <div onclick="showAddPigeon()" class="quick-action-card group">
                        <i class="fas fa-plus-circle quick-action-icon"></i>
                        <h3 class="font-semibold mt-2">${t.add_pigeon || 'Güvercin Ekle'}</h3>
                        <p class="text-xs text-gray-400 mt-1">${t.add_new_pigeon_desc || 'Yeni güvercin kaydı'}</p>
                    </div>
                    
                    <div onclick="showMatings()" class="quick-action-card group">
                        <i class="fas fa-heart quick-action-icon"></i>
                        <h3 class="font-semibold mt-2">${t.nav_matings || 'Eşleştirmeler'}</h3>
                        <p class="text-xs text-gray-400 mt-1">${t.manage_matings_desc || 'Eşleştirme yönetimi'}</p>
                    </div>
                    
                    
                    <div onclick="showHealthRecords()" class="quick-action-card group">
                        <i class="fas fa-stethoscope quick-action-icon"></i>
                        <h3 class="font-semibold mt-2">${t.nav_health || 'Sağlık'}</h3>
                        <p class="text-xs text-gray-400 mt-1">${t.health_records_desc || 'Sağlık takibi'}</p>
                    </div>
                    
                    <div onclick="showPerformanceRecords()" class="quick-action-card group">
                        <i class="fas fa-medal quick-action-icon"></i>
                        <h3 class="font-semibold mt-2">${t.nav_performance || 'Performans'}</h3>
                        <p class="text-xs text-gray-400 mt-1">${t.performance_tracking_desc || 'Başarı takibi'}</p>
                    </div>
                </div>
            `;
        }
        
        function renderActivityTimeline(userPigeons, userMatings) {
            const t = translations[currentLang];
            const activities = [];
            
            // Collect recent activities
            userPigeons.slice(-3).forEach(p => {
                activities.push({
                    type: 'pigeon_added',
                    title: `${p.name} ${t.added || 'added'}`,
                    date: p.createdAt || new Date().toISOString(),
                    data: p
                });
            });
            
            userMatings.slice(-2).forEach(m => {
                activities.push({
                    type: 'mating_added',
                    title: t.new_mating_recorded || 'Yeni eşleştirme kaydedildi',
                    date: m.date,
                    data: m
                });
            });
            
            userRaces.slice(-2).forEach(r => {
                if (r.status === 'completed') {
                    activities.push({
                        type: 'race_completed',
                        title: `${r.name} ${t.completed || 'tamamlandı'}`,
                        date: r.endDate || r.date,
                        data: r
                    });
                }
            });
            
            // Sort by date
            activities.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            return `
                <div class="glass p-6 rounded-2xl mb-8">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-history mr-2 text-cyan-400"></i>
                        ${t.recent_activities || 'Son Aktiviteler'}
                    </h3>
                    <div class="activity-timeline">
                        ${activities.slice(0, 5).map((activity, index) => `
                            <div class="activity-item" style="animation-delay: ${index * 0.1}s">
                                <div class="activity-dot"></div>
                                <div class="activity-content">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-start gap-3">
                                            <div class="activity-icon">
                                                <i class="fas ${getActivityIcon(activity.type)}"></i>
                                            </div>
                                            <div>
                                                <p class="font-semibold">${activity.title}</p>
                                                <p class="text-sm text-gray-400 mt-1">${getTimeAgo(activity.date)}</p>
                                            </div>
                                        </div>
                                        <span class="text-xs text-gray-500">
                                            ${formatDate(activity.date)}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        `).join('') || `
                            <div class="text-center py-8">
                                <i class="fas fa-inbox text-4xl text-gray-600 mb-3"></i>
                                <p class="text-gray-400">${t.no_recent_activities || 'Henüz aktivite yok'}</p>
                            </div>
                        `}
                    </div>
                    ${activities.length > 5 ? `
                        <button onclick="showActivityHistory()" class="w-full mt-4 py-3 bg-gradient-to-r from-cyan-500/10 to-purple-500/10 rounded-lg border border-cyan-500/20 hover:border-cyan-500/40 transition-all group">
                            <span class="text-cyan-400 group-hover:text-cyan-300">
                                ${t.view_all || 'Tümünü Gör'} 
                                <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                            </span>
                        </button>
                    ` : ''}
                </div>
            `;
        }
        
        function renderFeaturedPigeons(userPigeons) {
            const t = translations[currentLang];
            const featured = userPigeons
                .filter(p => p.achievements && p.achievements.length > 0)
                .slice(0, 3);
                
            if (featured.length === 0) {
                featured.push(...userPigeons.slice(0, 3));
            }
            
            return `
                <div class="glass p-6 rounded-2xl mb-8">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold flex items-center">
                            <i class="fas fa-star mr-2 text-yellow-400"></i>
                            ${t.featured_pigeons || 'Öne Çıkan Güvercinler'}
                        </h3>
                        <button onclick="showPigeons()" class="text-sm text-cyan-400 hover:text-cyan-300 transition">
                            ${t.view_all || 'Tümünü Gör'} →
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        ${featured.map((pigeon, index) => `
                            <div class="featured-pigeon-card" onclick="showPigeonDetail('${pigeon.id}')" style="animation-delay: ${index * 0.1}s">
                                <div class="featured-pigeon-avatar">
                                    ${pigeon.image ? 
                                        `<img src="${pigeon.image}" alt="${pigeon.name}">` :
                                        `<i class="fas fa-dove"></i>`
                                    }
                                    ${pigeon.achievements && pigeon.achievements.length > 0 ? `
                                        <div class="featured-badge">
                                            <i class="fas fa-trophy text-xs"></i>
                                        </div>
                                    ` : ''}
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-lg">${pigeon.name}</h4>
                                    <p class="text-sm text-gray-400">${pigeon.bandNumber}</p>
                                    <div class="flex items-center gap-3 mt-2">
                                        <span class="text-xs px-2 py-1 rounded-full ${pigeon.gender === 'male' ? 'bg-blue-500/20 text-blue-400' : 'bg-pink-500/20 text-pink-400'}">
                                            <i class="fas fa-${pigeon.gender === 'male' ? 'mars' : 'venus'} mr-1"></i>
                                            ${pigeon.gender === 'male' ? t.male : t.female}
                                        </span>
                                        <span class="text-xs text-gray-500">
                                            ${pigeon.age || 0} ${t.years_old || 'yaş'}
                                        </span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-xs text-gray-500 mb-1">${t.performance || 'Performans'}</div>
                                    <div class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400">
                                        ${pigeon.raceCount || 0}
                                    </div>
                                    <div class="text-xs text-gray-400">${t.races || 'Yarış'}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function renderIncubationTracking(userMatings) {
            const t = translations[currentLang];
            const today = new Date();
            const upcomingHatches = [];
            
            // Kuluçkadaki yumurtaları bul (4 gün içinde çıkacaklar)
            userMatings.forEach((mating, index) => {
                // expected_hatch_date varsa ve henüz çıkmadıysa
                if (mating.expected_hatch_date && !mating.hatched) {
                    const hatchDate = new Date(mating.expected_hatch_date);
                    const daysUntil = Math.ceil((hatchDate - today) / (1000 * 60 * 60 * 24));
                    
                    // Sadece 0-4 gün arasındakileri göster
                    if (daysUntil >= 0 && daysUntil <= 4) {
                        const pigeonsList = userPigeons || storage.pigeons;
                        const malePigeon = pigeonsList.find(p => p.id === (mating.male_id || mating.maleId)) || mating.male;
                        const femalePigeon = pigeonsList.find(p => p.id === (mating.female_id || mating.femaleId)) || mating.female;
                        
                        upcomingHatches.push({
                            eggNumber: 1, // Varsayılan olarak 1 yumurta
                            layDate: mating.egg_laying_date || mating.mating_date,
                            expectedHatchDate: mating.expected_hatch_date,
                            daysUntil: daysUntil,
                            parents: {
                                male: malePigeon ? (malePigeon.name || malePigeon.band_number) : 'Bilinmiyor',
                                female: femalePigeon ? (femalePigeon.name || femalePigeon.band_number) : 'Bilinmiyor'
                            },
                            matingId: mating.id
                        });
                    }
                }
            });
            
            // Tarihe göre sırala (yakın olanlar önce)
            upcomingHatches.sort((a, b) => a.daysUntil - b.daysUntil);
            
            return `
                <div class="glass p-6 rounded-2xl border-2 border-orange-500/30">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-egg mr-2 text-orange-400 animate-pulse"></i>
                        ${t.incubation_tracking || 'Kuluçka Takibi'}
                    </h3>
                    <div class="space-y-3">
                        ${upcomingHatches.length > 0 ? upcomingHatches.map(hatch => {
                            const urgencyColor = hatch.daysUntil <= 1 ? 'red' : hatch.daysUntil <= 2 ? 'orange' : 'yellow';
                            const urgencyBg = hatch.daysUntil <= 1 ? 'bg-red-500/20' : hatch.daysUntil <= 2 ? 'bg-orange-500/20' : 'bg-yellow-500/20';
                            const urgencyBorder = hatch.daysUntil <= 1 ? 'border-red-500/50' : hatch.daysUntil <= 2 ? 'border-orange-500/50' : 'border-yellow-500/50';
                            
                            return `
                                <div class="${urgencyBg} border ${urgencyBorder} rounded-lg p-4 hover:scale-[1.02] transition-all cursor-pointer" onclick="showIncubationDetail('${hatch.matingId}')">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <div class="flex items-center gap-2 mb-2">
                                                <div class="w-8 h-8 rounded-full bg-${urgencyColor}-500/30 flex items-center justify-center">
                                                    <span class="text-xs font-bold text-${urgencyColor}-400">${hatch.eggNumber}</span>
                                                </div>
                                                <p class="font-semibold text-sm">
                                                    ${hatch.parents.male} x ${hatch.parents.female}
                                                </p>
                                            </div>
                                            <div class="flex items-center gap-4 text-xs text-gray-400">
                                                <span>
                                                    <i class="fas fa-calendar-plus mr-1"></i>
                                                    ${formatDate(hatch.layDate)}
                                                </span>
                                                <span>
                                                    <i class="fas fa-hourglass-half mr-1"></i>
                                                    18 gün
                                                </span>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-2xl font-bold text-${urgencyColor}-400">
                                                ${hatch.daysUntil}
                                            </div>
                                            <div class="text-xs text-gray-400">
                                                ${hatch.daysUntil === 0 ? 'Bugün!' : hatch.daysUntil === 1 ? 'gün kaldı' : 'gün kaldı'}
                                            </div>
                                        </div>
                                    </div>
                                    ${hatch.daysUntil <= 1 ? `
                                        <div class="mt-3 pt-3 border-t border-${urgencyColor}-500/30">
                                            <p class="text-xs text-${urgencyColor}-400 flex items-center">
                                                <i class="fas fa-exclamation-triangle mr-1 animate-pulse"></i>
                                                ${hatch.daysUntil === 0 ? 'Çıkım için hazır olun!' : 'Yarın çıkması bekleniyor!'}
                                            </p>
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        }).join('') : `
                            <div class="text-center py-8">
                                <i class="fas fa-egg text-4xl text-gray-600 mb-3"></i>
                                <p class="text-gray-400">${t.no_upcoming_hatches || 'Yakında çıkacak yavru yok'}</p>
                                <p class="text-sm text-gray-500 mt-2">${t.incubation_info || 'Kuluçkadaki yumurtalar 4 gün kala burada görünür'}</p>
                            </div>
                        `}
                    </div>
                    ${upcomingHatches.length > 0 ? `
                        <button onclick="showIncubationRecords()" class="w-full mt-4 py-2 text-orange-400 hover:text-orange-300 text-sm transition">
                            ${t.view_all_incubations || 'Tüm Kuluçkaları Gör'} →
                        </button>
                    ` : ''}
                </div>
            `;
        }
        
        function renderUpcomingEvents(userMatings) {
            const t = translations[currentLang];
            const events = [];
            const today = new Date();
            
            // Add upcoming races
            userRaces.filter(r => r.status === 'planned' || r.status === 'ongoing').forEach(r => {
                events.push({
                    type: 'race',
                    title: r.name,
                    date: r.date,
                    icon: 'fa-flag-checkered',
                    color: 'blue'
                });
            });
            
            // Sort by date
            events.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            return `
                <div class="glass p-6 rounded-2xl">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-calendar-alt mr-2 text-purple-400"></i>
                        ${t.upcoming_events || 'Yaklaşan Etkinlikler'}
                    </h3>
                    <div class="space-y-3">
                        ${events.slice(0, 5).map(event => {
                            const eventDate = new Date(event.date);
                            const daysUntil = Math.ceil((eventDate - today) / (1000 * 60 * 60 * 24));
                            return `
                                <div class="flex items-center justify-between p-3 rounded-lg bg-white/5 hover:bg-white/10 transition">
                                    <div class="flex items-center space-x-3">
                                        <i class="fas ${event.icon} text-${event.color}-400"></i>
                                        <div>
                                            <p class="font-medium">${event.title}</p>
                                            <p class="text-sm text-gray-400">${formatDate(eventDate)}</p>
                                        </div>
                                    </div>
                                    <span class="text-sm font-medium text-${event.color}-400">
                                        ${daysUntil} ${t.days || 'gün'}
                                    </span>
                                </div>
                            `;
                        }).join('') || `
                            <p class="text-gray-400 text-center py-8">${t.no_upcoming_events || 'Yaklaşan etkinlik yok'}</p>
                        `}
                    </div>
                </div>
            `;
        }
        
        // General Statistics for Dashboard
        function renderGeneralStatistics(userPigeons, userMatings) {
            const t = translations[currentLang];
            
            // Calculate statistics
            const totalPigeons = userPigeons.length;
            const activePigeons = userPigeons.filter(p => p.status === 'active').length;
            const malePigeons = userPigeons.filter(p => p.gender === 'male').length;
            const femalePigeons = userPigeons.filter(p => p.gender === 'female').length;
            
            // Last 30 days activity
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            const recentPigeons = userPigeons.filter(p => new Date(p.createdAt || '2024-01-01') > thirtyDaysAgo).length;
            const recentMatings = userMatings.filter(m => new Date(m.date) > thirtyDaysAgo).length;
            const recentRaces = 0; // Race feature removed
            
            return `
                <div class="glass p-6 rounded-2xl border border-cyan-500/20">
                    <h3 class="text-xl font-bold mb-6 flex items-center">
                        <i class="fas fa-chart-bar mr-2 text-cyan-400"></i>
                        ${t.general_statistics || 'Genel İstatistikler'}
                    </h3>
                    
                    <!-- Main Stats Grid -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <!-- Total Pigeons -->
                        <div class="stat-mini-card bg-gradient-to-br from-blue-500/20 to-cyan-500/20 p-4 rounded-xl">
                            <div class="flex items-center justify-between mb-2">
                                <i class="fas fa-dove text-2xl text-cyan-400"></i>
                                <span class="text-xs text-green-400">+${recentPigeons}</span>
                            </div>
                            <div class="text-2xl font-bold stat-counter" data-target="${totalPigeons}">0</div>
                            <div class="text-xs text-gray-400 mt-1">${t.total_pigeons || 'Total Pigeons'}</div>
                        </div>
                        
                        <!-- Active Pigeons -->
                        <div class="stat-mini-card bg-gradient-to-br from-green-500/20 to-emerald-500/20 p-4 rounded-xl">
                            <div class="flex items-center justify-between mb-2">
                                <i class="fas fa-check-circle text-2xl text-green-400"></i>
                                <span class="text-xs text-gray-400">${((activePigeons/totalPigeons)*100 || 0).toFixed(0)}%</span>
                            </div>
                            <div class="text-2xl font-bold stat-counter" data-target="${activePigeons}">0</div>
                            <div class="text-xs text-gray-400 mt-1">Aktif</div>
                        </div>
                        
                        <!-- Males -->
                        <div class="stat-mini-card bg-gradient-to-br from-blue-500/20 to-indigo-500/20 p-4 rounded-xl">
                            <div class="flex items-center justify-between mb-2">
                                <i class="fas fa-mars text-2xl text-blue-400"></i>
                                <span class="text-xs text-gray-400">${((malePigeons/totalPigeons)*100 || 0).toFixed(0)}%</span>
                            </div>
                            <div class="text-2xl font-bold stat-counter" data-target="${malePigeons}">0</div>
                            <div class="text-xs text-gray-400 mt-1">${t.male || 'Male'}</div>
                        </div>
                        
                        <!-- Females -->
                        <div class="stat-mini-card bg-gradient-to-br from-pink-500/20 to-rose-500/20 p-4 rounded-xl">
                            <div class="flex items-center justify-between mb-2">
                                <i class="fas fa-venus text-2xl text-pink-400"></i>
                                <span class="text-xs text-gray-400">${((femalePigeons/totalPigeons)*100 || 0).toFixed(0)}%</span>
                            </div>
                            <div class="text-2xl font-bold stat-counter" data-target="${femalePigeons}">0</div>
                            <div class="text-xs text-gray-400 mt-1">${t.female || 'Female'}</div>
                        </div>
                    </div>
                    
                    <!-- Activity Chart -->
                    <div class="bg-black/20 rounded-xl p-4">
                        <h4 class="text-sm font-semibold mb-3 text-gray-300">${t.last_30_days_activity || 'Last 30 Days Activity'}</h4>
                        <div class="grid grid-cols-3 gap-3 text-center">
                            <div>
                                <div class="text-lg font-bold text-cyan-400">${recentPigeons}</div>
                                <div class="text-xs text-gray-400">${t.new_pigeon || 'New Pigeon'}</div>
                            </div>
                            <div>
                                <div class="text-lg font-bold text-pink-400">${recentMatings}</div>
                                <div class="text-xs text-gray-400">Eşleştirme</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mini Progress Bars -->
                    <div class="mt-4 space-y-2">
                        <div class="flex items-center gap-2">
                            <span class="text-xs text-gray-400 w-16">${t.occupancy || 'Occupancy'}</span>
                            <div class="flex-1 h-2 bg-gray-800 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-cyan-400 to-blue-500 transition-all duration-1000" style="width: ${Math.min(totalPigeons * 2, 100)}%"></div>
                            </div>
                            <span class="text-xs text-gray-400">${Math.min(totalPigeons * 2, 100)}%</span>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Pedigree Preview for Dashboard
        function renderPedigreePreview() {
            const t = translations[currentLang];
            
            return `
                <div class="mt-12">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl md:text-4xl font-bold mb-3">
                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400">
                                <i class="fas fa-dna mr-2"></i>
                                Şampiyonların Genetik Mirası
                            </span>
                        </h2>
                        <p class="text-gray-400 max-w-2xl mx-auto">
                            Premium soyağacı sistemiyle güvercinlerinizin 4 nesil geriye uzanan gen havuzunu keşfedin
                        </p>
                    </div>
                    
                    <div class="glass p-6 md:p-8 rounded-3xl border border-purple-500/20 overflow-hidden">
                        <!-- Pedigree Preview Container -->
                        <div class="pedigree-preview-container">
                            <div class="flex items-center justify-center gap-4 md:gap-8 overflow-x-auto pb-4">
                                <!-- Center - Main Pigeon -->
                                <div class="flex items-center">
                                    <div class="pedigree-preview-card main">
                                        <div class="pedigree-preview-header">
                                            <i class="fas fa-crown text-yellow-400 mb-2"></i>
                                            <h4 class="font-bold text-lg">Ana Güvercin</h4>
                                        </div>
                                        <div class="pedigree-preview-body">
                                            <div class="w-20 h-20 mx-auto mb-3 rounded-full bg-gradient-to-br from-cyan-400 to-purple-400 flex items-center justify-center">
                                                <i class="fas fa-dove text-3xl text-white"></i>
                                            </div>
                                            <p class="text-sm text-gray-400">TR-2024-1234</p>
                                            <div class="mt-2 flex justify-center gap-2">
                                                <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded-full">
                                                    <i class="fas fa-mars"></i> Erkek
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Connection Lines -->
                                <div class="hidden md:block">
                                    <div class="pedigree-connection-line"></div>
                                </div>
                                
                                <!-- Parents -->
                                <div class="flex flex-col gap-4">
                                    <div class="pedigree-preview-card parent">
                                        <h5 class="font-semibold mb-2">Baba</h5>
                                        <div class="w-16 h-16 mx-auto mb-2 rounded-full bg-blue-500/20 flex items-center justify-center">
                                            <i class="fas fa-dove text-2xl text-blue-400"></i>
                                        </div>
                                        <p class="text-xs text-gray-400">TR-2022-5678</p>
                                    </div>
                                    <div class="pedigree-preview-card parent">
                                        <h5 class="font-semibold mb-2">Anne</h5>
                                        <div class="w-16 h-16 mx-auto mb-2 rounded-full bg-pink-500/20 flex items-center justify-center">
                                            <i class="fas fa-dove text-2xl text-pink-400"></i>
                                        </div>
                                        <p class="text-xs text-gray-400">TR-2022-9012</p>
                                    </div>
                                </div>
                                
                                <!-- Connection Lines -->
                                <div class="hidden lg:block">
                                    <div class="pedigree-connection-line"></div>
                                </div>
                                
                                <!-- Grandparents -->
                                <div class="hidden lg:grid grid-cols-2 gap-3">
                                    <div class="pedigree-preview-card mini">
                                        <div class="w-10 h-10 mx-auto rounded-full bg-blue-500/10 flex items-center justify-center">
                                            <i class="fas fa-dove text-sm text-blue-300"></i>
                                        </div>
                                        <p class="text-xs mt-1">Dede</p>
                                    </div>
                                    <div class="pedigree-preview-card mini">
                                        <div class="w-10 h-10 mx-auto rounded-full bg-pink-500/10 flex items-center justify-center">
                                            <i class="fas fa-dove text-sm text-pink-300"></i>
                                        </div>
                                        <p class="text-xs mt-1">B.Anne</p>
                                    </div>
                                    <div class="pedigree-preview-card mini">
                                        <div class="w-10 h-10 mx-auto rounded-full bg-blue-500/10 flex items-center justify-center">
                                            <i class="fas fa-dove text-sm text-blue-300"></i>
                                        </div>
                                        <p class="text-xs mt-1">Dede</p>
                                    </div>
                                    <div class="pedigree-preview-card mini">
                                        <div class="w-10 h-10 mx-auto rounded-full bg-pink-500/10 flex items-center justify-center">
                                            <i class="fas fa-dove text-sm text-pink-300"></i>
                                        </div>
                                        <p class="text-xs mt-1">B.Anne</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- CTA Button -->
                        <div class="text-center mt-8">
                            <button onclick="showPigeons()" class="btn-primary">
                                <i class="fas fa-sitemap mr-2"></i>
                                Tüm Soyağaçlarını Görüntüle
                            </button>
                            <p class="text-xs text-gray-500 mt-2">4 nesil geriye kadar detaylı soyağacı analizi</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Enhanced Incubation Tracking
        function renderIncubationTrackingEnhanced(userMatings, userPigeons = null) {
            const t = translations[currentLang];
            const today = new Date();
            const upcomingHatches = [];
            
            // Kuluçkadaki yumurtaları bul (4 gün içinde çıkacaklar)
            userMatings.forEach((mating, index) => {
                // expected_hatch_date varsa ve henüz çıkmadıysa
                if (mating.expected_hatch_date && !mating.hatched) {
                    const hatchDate = new Date(mating.expected_hatch_date);
                    const daysUntil = Math.ceil((hatchDate - today) / (1000 * 60 * 60 * 24));
                    
                    // Sadece 0-4 gün arasındakileri göster
                    if (daysUntil >= 0 && daysUntil <= 4) {
                        const pigeonsList = userPigeons || storage.pigeons;
                        const malePigeon = pigeonsList.find(p => p.id === (mating.male_id || mating.maleId)) || mating.male;
                        const femalePigeon = pigeonsList.find(p => p.id === (mating.female_id || mating.femaleId)) || mating.female;
                        
                        upcomingHatches.push({
                            eggNumber: 1, // Varsayılan olarak 1 yumurta
                            layDate: mating.egg_laying_date || mating.mating_date,
                            expectedHatchDate: mating.expected_hatch_date,
                            daysUntil: daysUntil,
                            parents: {
                                male: malePigeon ? (malePigeon.name || malePigeon.band_number) : 'Bilinmiyor',
                                female: femalePigeon ? (femalePigeon.name || femalePigeon.band_number) : 'Bilinmiyor'
                            },
                            matingId: mating.id
                        });
                    }
                }
            });
            
            // Tarihe göre sırala (yakın olanlar önce)
            upcomingHatches.sort((a, b) => a.daysUntil - b.daysUntil);
            
            return `
                <div class="glass p-6 rounded-2xl border-2 border-orange-500/30 shadow-2xl">
                    <h3 class="text-2xl font-bold mb-6 flex items-center justify-center">
                        <i class="fas fa-egg mr-3 text-orange-400 text-3xl animate-pulse"></i>
                        ${t.incubation_tracking || 'Kuluçka Takibi'}
                    </h3>
                    <div class="space-y-4">
                        ${upcomingHatches.length > 0 ? upcomingHatches.map(hatch => {
                            const urgencyColor = hatch.daysUntil <= 1 ? 'red' : hatch.daysUntil <= 2 ? 'orange' : 'yellow';
                            const urgencyBg = hatch.daysUntil <= 1 ? 'bg-red-500/20' : hatch.daysUntil <= 2 ? 'bg-orange-500/20' : 'bg-yellow-500/20';
                            const urgencyBorder = hatch.daysUntil <= 1 ? 'border-red-500/50' : hatch.daysUntil <= 2 ? 'border-orange-500/50' : 'border-yellow-500/50';
                            
                            return `
                                <div class="${urgencyBg} border-2 ${urgencyBorder} rounded-2xl p-5 hover:scale-[1.02] transition-all cursor-pointer shadow-xl" onclick="showIncubationDetail('${hatch.matingId}')">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <div class="flex items-center gap-3 mb-3">
                                                <div class="w-12 h-12 rounded-full bg-${urgencyColor}-500/30 flex items-center justify-center animate-pulse">
                                                    <span class="text-lg font-bold text-${urgencyColor}-400">${hatch.eggNumber}</span>
                                                </div>
                                                <div>
                                                    <p class="font-bold text-lg">
                                                        ${hatch.parents.male} x ${hatch.parents.female}
                                                    </p>
                                                    <p class="text-xs text-gray-400">Yumurta No: ${hatch.eggNumber}</p>
                                                </div>
                                            </div>
                                            <div class="grid grid-cols-2 gap-3 text-sm">
                                                <div class="bg-black/20 rounded-lg p-2">
                                                    <i class="fas fa-calendar-plus mr-1 text-${urgencyColor}-400"></i>
                                                    <span class="text-gray-300">Yumurtlama: ${formatDate(hatch.layDate)}</span>
                                                </div>
                                                <div class="bg-black/20 rounded-lg p-2">
                                                    <i class="fas fa-hourglass-half mr-1 text-${urgencyColor}-400"></i>
                                                    <span class="text-gray-300">Süre: 18 gün</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-center ml-4">
                                            <div class="text-4xl font-bold text-${urgencyColor}-400 mb-1">
                                                ${hatch.daysUntil}
                                            </div>
                                            <div class="text-sm font-medium text-gray-300">
                                                ${hatch.daysUntil === 0 ? 'BUGÜN!' : hatch.daysUntil === 1 ? 'GÜN' : 'GÜN'}
                                            </div>
                                            <div class="text-xs text-gray-400">
                                                ${hatch.daysUntil === 0 ? 'Çıkım günü' : 'kaldı'}
                                            </div>
                                        </div>
                                    </div>
                                    ${hatch.daysUntil <= 1 ? `
                                        <div class="mt-4 pt-4 border-t border-${urgencyColor}-500/30">
                                            <p class="text-sm text-${urgencyColor}-400 flex items-center justify-center font-medium">
                                                <i class="fas fa-exclamation-triangle mr-2 text-lg animate-pulse"></i>
                                                ${hatch.daysUntil === 0 ? 'Çıkım için hazır olun!' : 'Yarın çıkması bekleniyor!'}
                                            </p>
                                        </div>
                                    ` : ''}
                                    <div class="mt-3 flex justify-between items-center">
                                        <div class="flex -space-x-2">
                                            <div class="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center border-2 border-gray-900">
                                                <i class="fas fa-mars text-xs text-white"></i>
                                            </div>
                                            <div class="w-8 h-8 rounded-full bg-gradient-to-br from-pink-400 to-red-500 flex items-center justify-center border-2 border-gray-900">
                                                <i class="fas fa-venus text-xs text-white"></i>
                                            </div>
                                        </div>
                                        <div class="text-xs text-gray-400">
                                            <i class="fas fa-egg mr-1"></i>
                                            18 günlük kuluçka
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('') : `
                            <div class="text-center py-12">
                                <div class="relative inline-block">
                                    <i class="fas fa-egg text-8xl text-gray-600 opacity-20"></i>
                                    <i class="fas fa-question absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-4xl text-gray-500"></i>
                                </div>
                                <p class="text-gray-400 text-lg mt-4 font-medium">${t.no_upcoming_hatches || 'Yakında çıkacak yavru yok'}</p>
                                <p class="text-sm text-gray-500 mt-2">${t.incubation_info || 'Kuluçkadaki yumurtalar 4 gün kala burada görünür'}</p>
                            </div>
                        `}
                    </div>
                    ${upcomingHatches.length > 0 ? `
                        <button onclick="showIncubationRecords()" class="w-full mt-6 py-3 bg-gradient-to-r from-orange-500/20 to-red-500/20 rounded-xl border border-orange-500/30 text-orange-400 hover:from-orange-500/30 hover:to-red-500/30 transition font-medium">
                            ${t.view_all_incubations || 'Tüm Kuluçkaları Gör'} <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    ` : ''}
                </div>
            `;
        }
        
        // Performance Analytics Summary for Dashboard - Supabase Version with Performance Records
        async function renderPerformanceAnalytics(userPigeons) {
            const t = translations[currentLang];
            
            try {
                // Tüm performans kayıtlarını getir
                let allPerformanceRecords = [];
                for (const pigeon of userPigeons) {
                    const performanceResult = await SupabaseDB.getPerformanceRecords(pigeon.id);
                    if (performanceResult.success && performanceResult.data) {
                        allPerformanceRecords = allPerformanceRecords.concat(performanceResult.data);
                    }
                }
                
                // Son 30 günün kayıtları
                const last30Days = new Date();
                last30Days.setDate(last30Days.getDate() - 30);
                const recentRecords = allPerformanceRecords.filter(r => new Date(r.date) > last30Days);
                const totalRecords = allPerformanceRecords.length;
                
                // Güvercin bazında performans hesapla
                const pigeonPerformance = {};
                allPerformanceRecords.forEach(record => {
                    const pigeonId = record.pigeon_id;
                    if (!pigeonPerformance[pigeonId]) {
                        pigeonPerformance[pigeonId] = {
                            records: [],
                            totalScore: 0,
                            count: 0,
                            types: {}
                        };
                    }
                    pigeonPerformance[pigeonId].records.push(record);
                    pigeonPerformance[pigeonId].totalScore += (record.overall_score || 0);
                    pigeonPerformance[pigeonId].count++;
                    
                    // Performans türlerini say
                    if (!pigeonPerformance[pigeonId].types[record.performance_type]) {
                        pigeonPerformance[pigeonId].types[record.performance_type] = 0;
                    }
                    pigeonPerformance[pigeonId].types[record.performance_type]++;
                });
                
                // En iyi 3 performansı bul
                const topPerformers = Object.entries(pigeonPerformance)
                    .map(([pigeonId, stats]) => {
                        const pigeon = userPigeons.find(p => p.id === pigeonId);
                        if (!pigeon) return null;
                        const avgScore = stats.totalScore / stats.count;
                        return {
                            pigeon,
                            avgScore,
                            totalRecords: stats.count,
                            mainType: Object.entries(stats.types).sort((a, b) => b[1] - a[1])[0]?.[0] || 'unknown'
                        };
                    })
                    .filter(p => p !== null)
                    .sort((a, b) => b.avgScore - a.avgScore)
                    .slice(0, 3);
                
                // Genel istatistikler
                const avgOverallScore = totalRecords > 0 ? 
                    (allPerformanceRecords.reduce((sum, r) => sum + (r.overall_score || 0), 0) / totalRecords).toFixed(1) : '0';
                const bestScore = totalRecords > 0 ? 
                    Math.max(...allPerformanceRecords.map(r => r.overall_score || 0)).toFixed(1) : '0';
                
                return `
                    <div class="glass p-6 rounded-2xl border border-purple-500/20">
                        <h3 class="text-xl font-bold mb-6 flex items-center justify-between">
                            <span>
                                <i class="fas fa-chart-line mr-2 text-purple-400"></i>
                                ${t.performance_analytics || 'Performans Analizi'}
                            </span>
                            <button onclick="showPerformanceRecords()" class="text-sm text-purple-400 hover:text-purple-300 transition">
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </h3>
                        
                        <!-- Trend Analizi -->
                        <div class="mb-6">
                            <h4 class="text-sm font-semibold mb-3 text-gray-300 flex items-center">
                                <i class="fas fa-trending-up mr-2 text-green-400"></i>
                                ${t.trend_analysis || 'Trend Analizi'}
                            </h4>
                            <div class="bg-black/20 rounded-xl p-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-xs text-gray-400">${t.last_30_days || 'Son 30 Gün'}</span>
                                    <span class="text-sm font-bold ${recentRecords.length > 0 ? 'text-green-400' : 'text-gray-400'}">
                                        ${recentRecords.length} ${t.new_records || 'yeni kayıt'}
                                    </span>
                                </div>
                                <div class="h-2 bg-gray-800 rounded-full overflow-hidden">
                                    <div class="h-full bg-gradient-to-r from-purple-400 to-purple-600 transition-all duration-1000" 
                                         style="width: ${Math.min((recentRecords.length / Math.max(totalRecords, 1)) * 100, 100)}%"></div>
                                </div>
                                <div class="flex justify-between mt-2 text-xs text-gray-500">
                                    <span>${recentRecords.length} ${t.performance || 'performans'}</span>
                                    <span>${t.total || 'Toplam'}: ${totalRecords}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- En İyi Performanslar -->
                        <div class="mb-6">
                            <h4 class="text-sm font-semibold mb-3 text-gray-300 flex items-center">
                                <i class="fas fa-trophy mr-2 text-yellow-400"></i>
                                ${t.best_performances || 'En İyi Performanslar'}
                            </h4>
                            <div class="space-y-2">
                                ${topPerformers.length > 0 ? topPerformers.map((performer, index) => {
                                    const typeLabels = {
                                        'tumbling': t.tumbling_performance || 'Taklacı',
                                        'postal': t.postal_performance || 'Posta',
                                        'butterfly': t.butterfly_performance || 'Kelebek',
                                        'racing': t.racing_performance || 'Yarış'
                                    };
                                    return `
                                        <div class="flex items-center gap-3 p-3 bg-black/20 rounded-lg hover:bg-black/30 transition cursor-pointer" 
                                             onclick="showPigeonDetail('${performer.pigeon.id}')">
                                            <div class="w-8 h-8 rounded-full bg-gradient-to-br ${index === 0 ? 'from-yellow-400 to-yellow-600' : index === 1 ? 'from-gray-300 to-gray-500' : 'from-orange-400 to-orange-600'} 
                                                 flex items-center justify-center text-xs font-bold text-white">
                                                ${index + 1}
                                            </div>
                                            <div class="flex-1">
                                                <p class="font-semibold text-sm">${performer.pigeon.name}</p>
                                                <p class="text-xs text-gray-400">${typeLabels[performer.mainType] || performer.mainType}</p>
                                            </div>
                                            <div class="text-right">
                                                <p class="text-sm font-bold text-green-400">${performer.avgScore.toFixed(1)}</p>
                                                <p class="text-xs text-gray-400">${t.avg_score || 'ort. puan'}</p>
                                            </div>
                                        </div>
                                    `;
                                }).join('') : `
                                    <p class="text-center text-gray-400 py-4 text-sm">${t.no_performance || 'Henüz performans kaydı yok'}</p>
                                `}
                            </div>
                        </div>
                        
                        <!-- İstatistik Özeti -->
                        <div class="mb-6">
                            <h4 class="text-sm font-semibold mb-3 text-gray-300 flex items-center">
                                <i class="fas fa-calculator mr-2 text-cyan-400"></i>
                                ${t.statistics || 'İstatistikler'}
                            </h4>
                            <div class="grid grid-cols-2 gap-3">
                                <div class="bg-black/20 rounded-lg p-3 text-center">
                                    <p class="text-2xl font-bold text-cyan-400">${avgOverallScore}</p>
                                    <p class="text-xs text-gray-400">${t.avg_score || 'Ort. Puan'}</p>
                                </div>
                                <div class="bg-black/20 rounded-lg p-3 text-center">
                                    <p class="text-2xl font-bold text-green-400">${bestScore}</p>
                                    <p class="text-xs text-gray-400">${t.best_score || 'En Yüksek'}</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Hızlı İşlemler -->
                        <div class="flex gap-3">
                            <button onclick="showAddPerformance()" 
                                    class="flex-1 py-2 bg-purple-500/20 hover:bg-purple-500/30 rounded-lg transition text-sm font-medium">
                                <i class="fas fa-plus mr-2"></i> ${t.add || 'Ekle'}
                            </button>
                            <button onclick="showPerformanceRecords()" 
                                    class="flex-1 py-2 bg-green-500/20 hover:bg-green-500/30 rounded-lg transition text-sm font-medium">
                                <i class="fas fa-list mr-2"></i> ${t.view_all || 'Tümünü Gör'}
                            </button>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Performance analytics error:', error);
                return `
                    <div class="glass p-6 rounded-2xl border border-purple-500/20">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-chart-line mr-2 text-purple-400"></i>
                            ${t.performance_analytics || 'Performans Analizi'}
                        </h3>
                        <p class="text-center text-gray-400">${t.error_loading || 'Error loading'}</p>
                    </div>
                `;
            }
        }

        // Show Add Pigeon Form with image upload - SUPABASE VERSION
        async function showAddPigeon() {
            if (!checkAuth()) return;
            
            // Premium ve güvercin limiti kontrolü
            const user = await SupabaseAuth.getCurrentUser();
            const isPremium = await checkPremiumStatus(user.id);
            
            // Mevcut güvercin sayısını kontrol et
            const { count, error: countError } = await supabaseClient
                .from('pigeons')
                .select('*', { count: 'exact', head: true })
                .eq('user_id', user.id);
            
            const limit = isPremium ? Infinity : 7;
            
            if (count >= limit) {
                showNotification(
                    currentLang === 'tr' ? 
                        `Güvercin limitine ulaştınız (${count}/${limit}). Premium'a yükseltin!` : 
                        `You reached the pigeon limit (${count}/${limit}). Upgrade to Premium!`,
                    'warning'
                );
                // Fiyatlandırma sayfasına yönlendir
                showPricing();
                return;
            }
            
            cleanupPreviousViews();
            const t = translations[currentLang];
            
            // Loading göster
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                    <div class="glass p-8 rounded-3xl text-center">
                        <i class="fas fa-spinner fa-spin text-4xl text-cyan-400 mb-4"></i>
                        <p class="text-xl">Form hazırlanıyor...</p>
                    </div>
                </div>
            `;
            
            try {
                // Kullanıcının güvercinlerini getir
                const pigeonsResult = await SupabaseDB.getPigeons(storage.currentUser.id);
                if (!pigeonsResult.success) {
                    throw new Error('Güvercinler yüklenemedi');
                }
                
                const userPigeons = pigeonsResult.data || [];
                const males = userPigeons.filter(p => p.gender === 'male');
                const females = userPigeons.filter(p => p.gender === 'female');
                
                document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                <div class="glass p-8 rounded-3xl">`
                +
                `
                <h2 class="text-3xl font-bold mb-8">${t.add_new_pigeon}</h2>
                
                <form onsubmit="handleAddPigeon(event)" class="max-w-2xl mx-auto">
                    <!-- Image Upload -->
                    <div class="mb-6">
                        <label class="block text-gray-300 mb-2">${t.upload_photo}</label>
                        <div class="image-upload-area" onclick="document.getElementById('pigeonImage').click()">
                            <input type="file" id="pigeonImage" accept="image/*" onchange="previewImage(event)" style="display: none;">
                            <div id="imagePreview">
                                <i class="fas fa-camera text-4xl text-gray-400 mb-2"></i>
                                <p class="text-gray-400">${t.drag_drop}</p>
                                <p class="text-sm text-gray-500">${t.max_size}</p>
                                <p class="text-sm text-gray-500">${t.supported_formats}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-300 mb-2">${t.name}*</label>
                            <input type="text" id="pigeonName" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                        </div>
                        <div>
                            <label class="block text-gray-300 mb-2">${t.band_number}*</label>
                            <input type="text" id="bandNumber" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-300 mb-2">${t.gender}*</label>
                            <select id="gender" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                                <option value="">${t.select}</option>
                                <option value="male">${t.male}</option>
                                <option value="female">${t.female}</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-300 mb-2">${t.breed}*</label>
                            <select id="breed" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required onchange="handleBreedChange(this.value)">
                                <option value="">${t.select}</option>
                                <option value="taklaci">Taklacı (Oyun Kuşu)</option>
                                <option value="adana">Adana Güvercini</option>
                                <option value="bursa_oynari">Bursa Oynarı</option>
                                <option value="dolapci">Dolapçı Güvercini</option>
                                <option value="hunkari">Hünkari</option>
                                <option value="sebap">Şebap Güvercini</option>
                                <option value="van">Van Güvercini</option>
                                <option value="posta">Posta Güvercini</option>
                                <option value="kelebek">Kelebek Güvercini</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-300 mb-2">${t.color || 'Renk'}*</label>
                            <select id="color" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required onchange="handleColorChange(this.value)">
                                <option value="">${t.select}</option>
                                <option value="arap">Arap (Düz Siyah)</option>
                                <option value="mavi-seritli">Mavi Şeritli</option>
                                <option value="mavi-cakmakli">Mavi Çakmaklı</option>
                                <option value="gok">Gök</option>
                                <option value="sabuni">Sabuni</option>
                                <option value="karakomple">Karakomple</option>
                                <option value="karabozali">Karabozalı</option>
                                <option value="miski">Miski (Boz)</option>
                                <option value="baska">Baska</option>
                                <option value="sekeri">Şekeri</option>
                                <option value="kurenk">Kürenk</option>
                                <option value="sari-komple">Sarı Komple</option>
                                <option value="kirmizi-komple">Kırmızı Komple</option>
                                <option value="duz-siyah">Düz Siyah</option>
                                <option value="duz-mavi">Düz Mavi</option>
                                <option value="duz-kirmizi">Düz Kırmızı</option>
                                <option value="beyaz">Beyaz</option>
                            </select>
                            <div id="colorRecommendation" class="mt-1 text-xs text-cyan-400" style="display:none;"></div>
                        </div>
                        <div>
                            <div id="colorPreview" class="w-full h-24 rounded-lg border border-gray-600 flex items-center justify-center bg-black/30">
                                <i class="fas fa-dove text-4xl text-gray-500"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Beyaz renk seçildiğinde gösterilecek -->
                    <div id="whiteColorDetails" style="display:none;" class="mb-4 p-4 bg-black/30 rounded-lg border border-gray-600">
                        <h4 class="text-sm font-semibold mb-2 text-yellow-400">
                            <i class="fas fa-info-circle mr-1"></i> Beyaz Renk Detayları
                        </h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-300 mb-2">Beyaz Tipi*</label>
                                <select id="whiteType" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" onchange="handleWhiteTypeChange(this.value)">
                                    <option value="">${t.select}</option>
                                    <option value="pure">Saf Beyaz (Albino)</option>
                                    <option value="pied">Alaca (Pied) - Gizli renk taşır</option>
                                </select>
                            </div>
                            <div id="hiddenColorDiv" style="display:none;">
                                <label class="block text-gray-300 mb-2">Taşıdığı Gizli Renk</label>
                                <select id="hiddenColor" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                    <option value="">${t.select}</option>
                                    <option value="arap">Siyah (Arap) geni taşıyor</option>
                                    <option value="ash-red">Kırmızı (Ash-Red) geni taşıyor</option>
                                    <option value="blue">Mavi geni taşıyor</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-300 mb-2">${t.birth_date}*</label>
                        <input type="date" id="birthDate" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none date-input" required>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-300 mb-2">${t.father}</label>
                            <select id="fatherId" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                <option value="">${t.select}</option>
                                ${males.map(p => `<option value="${p.id}">${p.name} - ${p.band_number}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-300 mb-2">${t.mother}</label>
                            <select id="motherId" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                <option value="">${t.select}</option>
                                ${females.map(p => `<option value="${p.id}">${p.name} - ${p.band_number}</option>`).join('')}
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-300 mb-2">${t.description}</label>
                        <textarea id="description" rows="3" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none"></textarea>
                    </div>
                    
                    <div class="flex gap-4">
                        <button type="submit" class="btn-primary flex-1">
                            <i class="fas fa-save mr-2"></i> ${t.save}
                        </button>
                        <button type="button" onclick="showPigeons()" class="flex-1 px-6 py-3 bg-gray-600 rounded-full hover:bg-gray-700 transition">
                            ${t.cancel}
                        </button>
                    </div>
                </form>
                </div>
                </div>
            `;
            } catch (error) {
                console.error('Show add pigeon error:', error);
                showNotification(error.message || 'Form yüklenemedi', 'error');
                showPigeons();
            }
        }
        
        // Handle breed change to show recommended colors
        function handleBreedChange(breed) {
            if (!breed || !window.ColorPatternSystem) return;
            
            const recommendations = ColorPatternSystem.getBreedRecommendations(breed);
            const colorSelect = document.getElementById('color');
            const recommendationDiv = document.getElementById('colorRecommendation');
            
            if (recommendations.length > 0) {
                const topColor = recommendations[0];
                recommendationDiv.textContent = `Önerilen: ${ColorPatternSystem.getColorDisplayName(topColor.color)} (%${Math.round(topColor.frequency * 100)})`;
                recommendationDiv.style.display = 'block';
            } else {
                recommendationDiv.style.display = 'none';
            }
        }
        
        // Handle color change to show preview
        function handleColorChange(color) {
            if (!color || !window.ColorPatternSystem) return;
            
            const colorData = ColorPatternSystem.turkishPigeonColors[color];
            const previewDiv = document.getElementById('colorPreview');
            const whiteDetailsDiv = document.getElementById('whiteColorDetails');
            
            if (colorData) {
                // Update preview
                if (colorData.secondary_hex) {
                    // Pied colors
                    previewDiv.innerHTML = `
                        <div class="relative w-20 h-20">
                            <i class="fas fa-dove text-5xl absolute inset-0" style="color: ${colorData.hex};"></i>
                            <i class="fas fa-dove text-5xl absolute inset-0 opacity-50" style="color: ${colorData.secondary_hex};"></i>
                        </div>
                    `;
                } else {
                    // Solid colors
                    previewDiv.innerHTML = `<i class="fas fa-dove text-5xl" style="color: ${colorData.hex};"></i>`;
                }
                
                // Show white details if white is selected
                if (color === 'beyaz') {
                    whiteDetailsDiv.style.display = 'block';
                } else {
                    whiteDetailsDiv.style.display = 'none';
                    document.getElementById('whiteType').value = '';
                    document.getElementById('hiddenColor').value = '';
                    document.getElementById('hiddenColorDiv').style.display = 'none';
                }
            }
        }
        
        // Handle white type change
        function handleWhiteTypeChange(whiteType) {
            const hiddenColorDiv = document.getElementById('hiddenColorDiv');
            if (whiteType === 'pied') {
                hiddenColorDiv.style.display = 'block';
            } else {
                hiddenColorDiv.style.display = 'none';
                document.getElementById('hiddenColor').value = '';
            }
        }
        
        // Handle add pigeon form submission
        async function handleAddPigeon(event) {
            event.preventDefault();
            
            const t = translations[currentLang];
            const submitButton = event.target.querySelector('button[type="submit"]');
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> ' + t.saving;
            
            try {
                // Get color details
                const color = document.getElementById('color').value;
                let colorDetails = null;
                
                if (color === 'beyaz') {
                    const whiteType = document.getElementById('whiteType').value;
                    const hiddenColor = document.getElementById('hiddenColor').value;
                    colorDetails = {
                        type: whiteType,
                        hiddenColor: whiteType === 'pied' ? hiddenColor : null
                    };
                }
                
                const pigeonData = {
                    name: document.getElementById('pigeonName').value,
                    bandNumber: document.getElementById('bandNumber').value,
                    gender: document.getElementById('gender').value,
                    breed: document.getElementById('breed').value,
                    color: color,
                    colorDetails: colorDetails,
                    birthDate: document.getElementById('birthDate').value,
                    fatherId: document.getElementById('fatherId').value || null,
                    motherId: document.getElementById('motherId').value || null,
                    description: document.getElementById('description').value
                };
                
                // Handle image upload if present
                const imageFile = document.getElementById('pigeonImage').files[0];
                if (imageFile) {
                    const uploadResult = await SupabaseStorage.uploadPigeonImage(imageFile);
                    if (uploadResult.success) {
                        pigeonData.imageUrl = uploadResult.url;
                    }
                }
                
                // Add pigeon to database
                const result = await SupabaseDB.addPigeon(pigeonData);
                
                if (result.success) {
                    showNotification(t.pigeon_added_success || 'Güvercin başarıyla eklendi!', 'success');
                    showPigeons();
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('Add pigeon error:', error);
                showNotification(error.message || t.error_occurred, 'error');
            } finally {
                submitButton.disabled = false;
                submitButton.innerHTML = '<i class="fas fa-save mr-2"></i> ' + t.save;
            }
        }

        // Show Edit Pigeon Form - OLD LOCALSTORAGE VERSION (Commented out)
        /*
        function showEditPigeon(pigeonId) {
            const pigeon = storage.pigeons.find(p => p.id === pigeonId && p.userId === storage.currentUser.id);
            if (!pigeon) {
                showNotification('Pigeon not found!', 'error');
                return;
            }

            const userPigeons = storage.pigeons.filter(p => p.userId === storage.currentUser.id);
            const males = userPigeons.filter(p => p.gender === 'male' && p.id !== pigeonId);
            const females = userPigeons.filter(p => p.gender === 'female' && p.id !== pigeonId);
            const t = translations[currentLang];
            
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                <div class="glass p-8 rounded-3xl">`
                +
                `
                <h2 class="text-3xl font-bold mb-8">${t.edit || 'Edit'} ${pigeon.name}</h2>
                
                <form onsubmit="handleEditPigeon(event, '${pigeonId}')" class="max-w-2xl mx-auto">
                    <!-- Image Upload -->
                    <div class="mb-6">
                        <label class="block text-gray-300 mb-2">${t.upload_photo}</label>
                        <div class="image-upload-area" onclick="document.getElementById('pigeonImageEdit').click()">
                            <input type="file" id="pigeonImageEdit" accept="image/*" onchange="previewImageEdit(event)" style="display: none;">
                            <div id="imagePreviewEdit">
                                ${pigeon.image ? 
                                    `<img src="${pigeon.image}" class="image-preview">` :
                                    `<i class="fas fa-camera text-4xl text-gray-400 mb-2"></i>
                                    <p class="text-gray-400">${t.drag_drop}</p>
                                    <p class="text-sm text-gray-500">${t.max_size}</p>
                                    <p class="text-sm text-gray-500">${t.supported_formats}</p>`
                                }
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-300 mb-2">${t.name}*</label>
                            <input type="text" id="pigeonNameEdit" value="${pigeon.name}" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                        </div>
                        <div>
                            <label class="block text-gray-300 mb-2">${t.band_number}*</label>
                            <input type="text" id="bandNumberEdit" value="${pigeon.bandNumber}" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-300 mb-2">${t.gender}*</label>
                            <select id="genderEdit" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                                <option value="">${t.select}</option>
                                <option value="male" ${pigeon.gender === 'male' ? 'selected' : ''}>${t.male}</option>
                                <option value="female" ${pigeon.gender === 'female' ? 'selected' : ''}>${t.female}</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-300 mb-2">${t.breed}*</label>
                            <select id="breedEdit" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                                <option value="">${t.select}</option>
                                <option value="taklaci" ${pigeon.breed === 'taklaci' ? 'selected' : ''}>Taklacı (Oyun Kuşu)</option>
                                <option value="adana" ${pigeon.breed === 'adana' ? 'selected' : ''}>Adana Güvercini</option>
                                <option value="bursa_oynari" ${pigeon.breed === 'bursa_oynari' ? 'selected' : ''}>Bursa Oynarı</option>
                                <option value="dolapci" ${pigeon.breed === 'dolapci' ? 'selected' : ''}>Dolapçı Güvercini</option>
                                <option value="hunkari" ${pigeon.breed === 'hunkari' ? 'selected' : ''}>Hünkari</option>
                                <option value="sebap" ${pigeon.breed === 'sebap' ? 'selected' : ''}>Şebap Güvercini</option>
                                <option value="van" ${pigeon.breed === 'van' ? 'selected' : ''}>Van Güvercini</option>
                                <option value="posta" ${pigeon.breed === 'posta' ? 'selected' : ''}>Posta Güvercini</option>
                                <option value="kelebek" ${pigeon.breed === 'kelebek' ? 'selected' : ''}>Kelebek Güvercini</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-300 mb-2">${t.birth_date}*</label>
                        <input type="date" id="birthDateEdit" value="${pigeon.birthDate}" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none date-input" required>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-300 mb-2">${t.father}</label>
                            <select id="fatherIdEdit" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                <option value="">${t.select}</option>
                                ${males.map(p => `<option value="${p.id}" ${pigeon.fatherId === p.id ? 'selected' : ''}>${p.name} - ${p.bandNumber}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-300 mb-2">${t.mother}</label>
                            <select id="motherIdEdit" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                <option value="">${t.select}</option>
                                ${females.map(p => `<option value="${p.id}" ${pigeon.motherId === p.id ? 'selected' : ''}>${p.name} - ${p.bandNumber}</option>`).join('')}
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-300 mb-2">${t.description}</label>
                        <textarea id="descriptionEdit" rows="3" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">${pigeon.description || ''}</textarea>
                    </div>
                    
                    <div class="flex gap-4">
                        <button type="submit" class="btn-primary flex-1">
                            <i class="fas fa-save mr-2"></i> ${t.save}
                        </button>
                        <button type="button" onclick="showPigeons()" class="flex-1 px-6 py-3 bg-gray-600 rounded-full hover:bg-gray-700 transition">
                            ${t.cancel}
                        </button>
                    </div>
                </form>
                </div>
                </div>
            `;
        }

        // Preview image for edit form
        function previewImageEdit(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreviewEdit').innerHTML = `
                        <img src="${e.target.result}" class="image-preview">
                    `;
                };
                reader.readAsDataURL(file);
            }
        }

        // Handle Edit Pigeon form submission
        function handleEditPigeon(event, pigeonId) {
            event.preventDefault();
            
            const imageInput = document.getElementById('pigeonImageEdit');
            let existingPigeon = storage.pigeons.find(p => p.id === pigeonId && p.userId === storage.currentUser.id);
            
            if (!existingPigeon) {
                showNotification('Pigeon not found!', 'error');
                return;
            }

            if (imageInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    updatePigeon(pigeonId, e.target.result);
                };
                reader.readAsDataURL(imageInput.files[0]);
            } else {
                updatePigeon(pigeonId, existingPigeon.image);
            }
            
            function updatePigeon(id, image) {
                const pigeonIndex = storage.pigeons.findIndex(p => p.id === id && p.userId === storage.currentUser.id);
                
                if (pigeonIndex === -1) {
                    showNotification('Pigeon not found!', 'error');
                    return;
                }

                storage.pigeons[pigeonIndex] = {
                    ...storage.pigeons[pigeonIndex],
                    name: document.getElementById('pigeonNameEdit').value,
                    bandNumber: document.getElementById('bandNumberEdit').value,
                    gender: document.getElementById('genderEdit').value,
                    breed: document.getElementById('breedEdit').value,
                    birthDate: document.getElementById('birthDateEdit').value,
                    fatherId: document.getElementById('fatherIdEdit').value || null,
                    motherId: document.getElementById('motherIdEdit').value || null,
                    description: document.getElementById('descriptionEdit').value,
                    image: image,
                    updatedAt: new Date().toISOString()
                };
                
                saveToStorage();
                showNotification(translations[currentLang].success + '!', 'success');
                showPigeons();
            }
        }

        // Preview image
        function previewImage(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').innerHTML = `
                        <img src="${e.target.result}" class="image-preview">
                        </div>
                </div>
            `;
                };
                reader.readAsDataURL(file);
            }
        }
        */

        // Preview image for add pigeon form
        function previewImage(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Önizleme alanını güncelle
                    document.getElementById('imagePreview').innerHTML = `
                        <div class="relative">
                            <img src="${e.target.result}" class="image-preview animate-fadeIn">
                            <div class="absolute top-2 right-2 bg-green-500 text-white px-3 py-1 rounded-full text-sm animate-slideIn">
                                <i class="fas fa-check mr-1"></i> ${t.image_added || 'Image added'}
                            </div>
                        </div>
                    `;
                    
                    // Başarı bildirimi göster
                    showNotification(t.image_added_success || 'Image added successfully', 'success');
                };
                reader.readAsDataURL(file);
            } else if (file) {
                // Geçersiz dosya tipi
                showNotification(t.select_valid_image || 'Please select a valid image file', 'error');
            }
        }

        // Handle breed change to show breed-specific color recommendations
        
        // Handle color/pattern change for preview
        
        // Get breed display name
        function getBreedName(breed) {
            const breedNames = {
                'taklaci': 'Taklacı',
                'adana': 'Adana Güvercini',
                'bursa_oynari': 'Bursa Oynarı',
                'dolapci': 'Dolapçı',
                'hunkari': 'Hünkari',
                'sebap': 'Şebap',
                'van': 'Van Güvercini',
                'posta': 'Posta Güvercini',
                'kelebek': 'Kelebek'
            };
            return breedNames[breed] || breed;
        }
        
        // Handle breed change for edit form
        
        // Handle color/pattern change for edit form


        function closePigeonModal() {
            document.getElementById('pigeonModal').style.display = 'none';
        }


        // Render modern pedigree tree
        function renderModernPedigree(node, t) {
            const generations = [];
            
            // Organize nodes by generation
            function collectGenerations(n, genIndex = 0) {
                if (!n || genIndex >= 4) return;
                
                if (!generations[genIndex]) generations[genIndex] = [];
                generations[genIndex].push(n);
                
                if (n.father) collectGenerations(n.father, genIndex + 1);
                if (n.mother) collectGenerations(n.mother, genIndex + 1);
            }
            
            collectGenerations(node);
            
            // Build HTML structure
            let html = '<div class="pedigree-tree">';
            
            generations.forEach((gen, genIndex) => {
                html += `<div class="generation" data-generation="${genIndex}">`;
                
                gen.forEach((pigeon, index) => {
                    html += renderPigeonNode(pigeon, t, genIndex, index);
                });
                
                html += '</div>';
            });
            
            html += '</div>';
            return html;
        }
        
        // Calculate familial role based on generation and position
        function getFamilialRole(generation, index) {
            if (generation === 0) return null; // Root pigeon, no label
            
            const isMale = index % 2 === 0;
            
            if (generation === 1) {
                return isMale ? 'Baba' : 'Anne';
            } else if (generation === 2) {
                // Determine if paternal or maternal side
                const isPaternal = index < 2;
                if (isMale) {
                    return isPaternal ? 'Dede' : 'Dede';
                } else {
                    return isPaternal ? 'Babaanne' : 'Anneanne';
                }
            } else if (generation === 3) {
                // Great-grandparents
                if (isMale) {
                    return 'Büyük Dede';
                } else {
                    return 'Büyük Anne';
                }
            } else {
                // For deeper generations, add more "Büyük"
                const prefix = 'Büyük '.repeat(generation - 2);
                return isMale ? prefix + 'Dede' : prefix + 'Anne';
            }
        }
        
        // Render individual pigeon node
        function renderPigeonNode(pigeon, t, genIndex, nodeIndex) {
            if (pigeon.empty) {
                return `
                    <div class="pigeon-node empty ${pigeon.gender}" data-gen="${genIndex}" data-index="${nodeIndex}">
                        <div class="pigeon-header">
                            <div class="pigeon-icon bg-gray-700">
                                <i class="fas fa-question text-gray-500"></i>
                            </div>
                            <div class="pigeon-info">
                                <div class="pigeon-name">${t.unknown || 'Bilinmiyor'}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            const genderClass = pigeon.gender || 'unknown';
            const iconColor = pigeon.gender === 'male' ? 'bg-blue-500' : 
                             pigeon.gender === 'female' ? 'bg-pink-500' : 'bg-gray-500';
            const role = getFamilialRole(genIndex, nodeIndex);
            
            return `
                <div class="pigeon-node ${genderClass}" 
                     data-pigeon-id="${pigeon.id}" 
                     data-gen="${genIndex}" 
                     data-index="${nodeIndex}"
                     onclick="showPedigree('${pigeon.id}')">
                    <div class="pigeon-tooltip">
                        <div class="text-sm font-semibold text-gray-200 mb-2">${t.quick_info || 'Hızlı Bilgi'}</div>
                        ${pigeon.strain ? `<div class="text-xs text-gray-400"><span class="text-gray-500">${t.strain || 'Irk'}:</span> ${pigeon.strain}</div>` : ''}
                        ${pigeon.owner ? `<div class="text-xs text-gray-400"><span class="text-gray-500">${t.owner || 'Sahip'}:</span> ${pigeon.owner}</div>` : ''}
                        ${pigeon.notes ? `<div class="text-xs text-gray-400 mt-2"><span class="text-gray-500">${t.notes || 'Notlar'}:</span> ${pigeon.notes}</div>` : ''}
                    </div>
                    <div class="pigeon-header">
                        ${pigeon.image ? `
                            <img src="${pigeon.image}" alt="${pigeon.name}" class="pigeon-image">
                        ` : `
                            <div class="pigeon-icon ${iconColor}">
                                <i class="fas fa-dove"></i>
                            </div>
                        `}
                        <div class="pigeon-info">
                            ${role ? `<div class="pigeon-role">${role}</div>` : ''}
                            <div class="pigeon-name">${pigeon.name}</div>
                            ${pigeon.altName ? `<div class="pigeon-alt-name">${pigeon.altName}</div>` : ''}
                        </div>
                    </div>
                    <div class="pigeon-details">
                        <div class="pigeon-detail-item">
                            <span>${t.band || 'Künye'}:</span>
                            <span>${pigeon.bandNumber}</span>
                        </div>
                        ${pigeon.birthDate ? `
                            <div class="pigeon-detail-item">
                                <span>${t.birth || 'Doğum'}:</span>
                                <span>${new Date(pigeon.birthDate).getFullYear()}</span>
                            </div>
                        ` : ''}
                        ${pigeon.deathDate ? `
                            <div class="pigeon-detail-item">
                                <span>${t.death || 'Ölüm'}:</span>
                                <span>${new Date(pigeon.deathDate).getFullYear()}</span>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }
        
        // Draw connection lines between nodes
        function drawConnectionLines() {
            const container = document.querySelector('.pedigree-tree');
            if (!container) return;
            
            // Clear existing lines and SVG
            container.querySelectorAll('.connection-line, .vertical-line, .connection-joint, .connection-svg').forEach(element => element.remove());
            
            // Create or get SVG element
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.classList.add('connection-svg');
            
            // Set SVG dimensions to match container's scroll dimensions
            svg.setAttribute('width', container.scrollWidth);
            svg.setAttribute('height', container.scrollHeight);
            svg.style.position = 'absolute';
            svg.style.top = '0';
            svg.style.left = '0';
            
            // Create gradient definition
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
            gradient.setAttribute('id', 'lineGradient');
            gradient.setAttribute('x1', '0%');
            gradient.setAttribute('y1', '0%');
            gradient.setAttribute('x2', '100%');
            gradient.setAttribute('y2', '0%');
            
            const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
            stop1.setAttribute('offset', '0%');
            stop1.setAttribute('stop-color', isMobile ? 'rgba(99, 102, 241, 0.7)' : 'rgba(99, 102, 241, 0.5)');
            
            const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
            stop2.setAttribute('offset', '100%');
            stop2.setAttribute('stop-color', isMobile ? 'rgba(168, 85, 247, 0.7)' : 'rgba(168, 85, 247, 0.5)');
            
            gradient.appendChild(stop1);
            gradient.appendChild(stop2);
            defs.appendChild(gradient);
            svg.appendChild(defs);
            
            // Append SVG to container first
            container.appendChild(svg);
            
            const generations = container.querySelectorAll('.generation');
            const isMobile = window.innerWidth <= 768;
            
            generations.forEach((gen, genIndex) => {
                if (genIndex >= generations.length - 1) return;
                
                const nodes = gen.querySelectorAll('.pigeon-node');
                const nextGen = generations[genIndex + 1];
                const nextNodes = nextGen.querySelectorAll('.pigeon-node');
                
                nodes.forEach((node, nodeIndex) => {
                    const childIndex = nodeIndex * 2;
                    if (childIndex >= nextNodes.length) return;
                    
                    // Use offsetLeft/offsetTop for more reliable positioning
                    const nodeX = node.offsetLeft + node.offsetWidth;
                    const nodeY = node.offsetTop + node.offsetHeight / 2;
                    
                    // Connect to father (top child)
                    const father = nextNodes[childIndex];
                    if (father) {
                        const fatherX = father.offsetLeft;
                        const fatherY = father.offsetTop + father.offsetHeight / 2;
                        drawSVGLine(svg, nodeX, nodeY, fatherX, fatherY, isMobile);
                    }
                    
                    // Connect to mother (bottom child)
                    const mother = nextNodes[childIndex + 1];
                    if (mother) {
                        const motherX = mother.offsetLeft;
                        const motherY = mother.offsetTop + mother.offsetHeight / 2;
                        drawSVGLine(svg, nodeX, nodeY, motherX, motherY, isMobile);
                    }
                });
            });
        }
        
        // Draw SVG connection line with 90-degree elbow paths
        function drawSVGLine(svg, x1, y1, x2, y2, isMobile = false) {
            // Calculate midpoint for the elbow
            const midX = x1 + (x2 - x1) / 2;
            
            // Create path element
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            
            // Create path data with 90-degree angles
            const pathData = `M ${x1} ${y1} L ${midX} ${y1} L ${midX} ${y2} L ${x2} ${y2}`;
            path.setAttribute('d', pathData);
            path.setAttribute('stroke', 'url(#lineGradient)');
            path.setAttribute('stroke-width', isMobile ? '3' : '2');
            path.setAttribute('fill', 'none');
            
            // Add animation delay based on position
            const delay = (x1 / 100) * 0.1;
            path.style.animationDelay = `${delay}s`;
            
            // Add path to SVG
            svg.appendChild(path);
            
            // Create connection joints (circles at corners)
            const joint1 = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            joint1.setAttribute('cx', midX);
            joint1.setAttribute('cy', y1);
            joint1.setAttribute('r', isMobile ? '5' : '4');
            joint1.setAttribute('fill', '#6366f1');
            joint1.style.animationDelay = `${delay + 0.1}s`;
            
            const joint2 = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            joint2.setAttribute('cx', midX);
            joint2.setAttribute('cy', y2);
            joint2.setAttribute('r', isMobile ? '5' : '4');
            joint2.setAttribute('fill', '#8b5cf6');
            joint2.style.animationDelay = `${delay + 0.2}s`;
            
            // Add joints to SVG
            svg.appendChild(joint1);
            svg.appendChild(joint2);
        }
        
        // OLD: Draw a single connection line with 90-degree elbow paths (keeping for backwards compatibility)
        function drawLine(x1, y1, x2, y2, container, isMobile = false) {
            // Calculate midpoint for the elbow
            const midX = x1 + (x2 - x1) / 2;
            
            // Line thickness based on viewport
            const lineThickness = isMobile ? '3px' : '2px';
            
            // Create horizontal line from parent node
            const hLine1 = document.createElement('div');
            hLine1.className = 'connection-line';
            hLine1.style.width = `${Math.max(midX - x1, 0)}px`;
            hLine1.style.height = lineThickness;
            hLine1.style.left = `${x1}px`;
            hLine1.style.top = `${y1 - (isMobile ? 1.5 : 1)}px`;
            
            // Create vertical line
            const vLine = document.createElement('div');
            vLine.className = 'connection-line';
            vLine.style.width = lineThickness;
            vLine.style.height = `${Math.max(Math.abs(y2 - y1), 0)}px`;
            vLine.style.left = `${midX - (isMobile ? 1.5 : 1)}px`;
            vLine.style.top = `${Math.min(y1, y2)}px`;
            
            // Create horizontal line to child node
            const hLine2 = document.createElement('div');
            hLine2.className = 'connection-line';
            hLine2.style.width = `${Math.max(x2 - midX, 0)}px`;
            hLine2.style.height = lineThickness;
            hLine2.style.left = `${midX}px`;
            hLine2.style.top = `${y2 - (isMobile ? 1.5 : 1)}px`;
            
            // Add stagger animation based on position
            const delay = (x1 / 100) * 0.1;
            [hLine1, vLine, hLine2].forEach((line, index) => {
                line.style.animationDelay = `${delay + index * 0.05}s`;
            });
            
            // Create connection joints at elbow corners
            const joint1 = document.createElement('div');
            joint1.className = 'connection-joint';
            joint1.style.left = `${midX}px`;
            joint1.style.top = `${y1}px`;
            
            const joint2 = document.createElement('div');
            joint2.className = 'connection-joint';
            joint2.style.left = `${midX}px`;
            joint2.style.top = `${y2}px`;
            
            // Append all line segments and joints
            container.appendChild(hLine1);
            container.appendChild(vLine);
            container.appendChild(hLine2);
            container.appendChild(joint1);
            container.appendChild(joint2);
        }
        
        // Print pedigree
        function printPedigree() {
            window.print();
        }
        
        // Clean up any existing pedigree views or modals
        function cleanupPreviousViews() {
            // Clean pedigree views and all related elements
            const pedigreeContainers = document.querySelectorAll('.pedigree-container, .pedigree-wrapper');
            pedigreeContainers.forEach(container => {
                container.style.transition = 'opacity 0.3s ease';
                container.style.opacity = '0';
                setTimeout(() => container.remove(), 300);
            });
            
            // Clean any connection lines, joints and SVG elements
            const connectionElements = document.querySelectorAll('.connection-line, .vertical-line, .connection-joint, .connection-svg');
            connectionElements.forEach(element => element.remove());
            
            // Clean pedigree specific nodes and elements
            const pedigreeNodes = document.querySelectorAll('.pedigree-node, .pigeon-node, .empty-node');
            pedigreeNodes.forEach(node => node.remove());
            
            // Close any open modals
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (modal.style.display !== 'none') {
                    modal.style.display = 'none';
                }
            });
            
            // Specifically close all known modals
            const specificModals = ['pigeonModal', 'authModal', 'qrModal'];
            specificModals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'none';
                    modal.classList.remove('active', 'show', 'open');
                }
            });
            
            // Clean modal backdrops and overlays
            const backdrops = document.querySelectorAll('.modal-backdrop, .overlay, .modal-overlay');
            backdrops.forEach(backdrop => backdrop.remove());
            
            // Clear any timeout/interval related to pedigree
            if (window.pedigreeTimeout) {
                clearTimeout(window.pedigreeTimeout);
                window.pedigreeTimeout = null;
            }
        }

        // Show Edit Pigeon Form
        async function showEditPigeon(pigeonId) {
            // Clean up any existing views first
            cleanupPreviousViews();
            
            // Loading göster
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                    <div class="glass p-8 rounded-3xl text-center">
                        <i class="fas fa-spinner fa-spin text-4xl text-cyan-400 mb-4"></i>
                        <p class="text-xl">Güvercin bilgileri yükleniyor...</p>
                    </div>
                </div>
            `;
            
            try {
                // Güvercin bilgilerini al
                const pigeonResult = await SupabaseDB.getPigeon(pigeonId);
                if (!pigeonResult.success || !pigeonResult.data) {
                    throw new Error('Güvercin bulunamadı');
                }
                
                const pigeon = pigeonResult.data;
                
                // Tüm güvercinleri al (anne-baba seçimi için)
                const allPigeonsResult = await SupabaseDB.getPigeons(storage.currentUser.id);
                if (!allPigeonsResult.success) {
                    throw new Error('Güvercin listesi yüklenemedi');
                }
                
                const userPigeons = (allPigeonsResult.data || []).filter(p => p.id !== pigeonId);
                const males = userPigeons.filter(p => p.gender === 'male');
                const females = userPigeons.filter(p => p.gender === 'female');
                const t = translations[currentLang];
            
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                <div class="glass p-8 rounded-3xl">
                <h2 class="text-3xl font-bold mb-8">${t.edit || 'Düzenle'} - ${pigeon.name}</h2>
                
                <form onsubmit="handleEditPigeon(event, '${pigeonId}')" class="max-w-2xl mx-auto">
                    <div class="mb-6">
                        <label class="block text-gray-300 mb-2">${t.pigeon_image || 'Güvercin Fotoğrafı'}</label>
                        <input type="file" id="pigeonImageEdit" accept="image/*" onchange="previewImageEdit(event)" 
                               class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                        <div id="imagePreviewEdit" class="mt-4">
                            ${pigeon.image_url ? `<img src="${pigeon.image_url}" class="image-preview">` : ''}
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-300 mb-2">${t.name}*</label>
                            <input type="text" id="pigeonNameEdit" value="${pigeon.name}" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                        </div>
                        <div>
                            <label class="block text-gray-300 mb-2">${t.band_number}*</label>
                            <input type="text" id="bandNumberEdit" value="${pigeon.band_number}" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-300 mb-2">${t.gender}*</label>
                            <select id="genderEdit" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                                <option value="">${t.select}</option>
                                <option value="male" ${pigeon.gender === 'male' ? 'selected' : ''}>${t.male}</option>
                                <option value="female" ${pigeon.gender === 'female' ? 'selected' : ''}>${t.female}</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-300 mb-2">${t.breed}*</label>
                            <select id="breedEdit" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                                <option value="">${t.select}</option>
                                <option value="taklaci" ${pigeon.breed === 'taklaci' ? 'selected' : ''}>Taklacı (Oyun Kuşu)</option>
                                <option value="adana" ${pigeon.breed === 'adana' ? 'selected' : ''}>Adana Güvercini</option>
                                <option value="bursa_oynari" ${pigeon.breed === 'bursa_oynari' ? 'selected' : ''}>Bursa Oynarı</option>
                                <option value="dolapci" ${pigeon.breed === 'dolapci' ? 'selected' : ''}>Dolapçı Güvercini</option>
                                <option value="hunkari" ${pigeon.breed === 'hunkari' ? 'selected' : ''}>Hünkari</option>
                                <option value="sebap" ${pigeon.breed === 'sebap' ? 'selected' : ''}>Şebap Güvercini</option>
                                <option value="van" ${pigeon.breed === 'van' ? 'selected' : ''}>Van Güvercini</option>
                                <option value="posta" ${pigeon.breed === 'posta' ? 'selected' : ''}>Posta Güvercini</option>
                                <option value="kelebek" ${pigeon.breed === 'kelebek' ? 'selected' : ''}>Kelebek Güvercini</option>
                            </select>
                        </div>
                    </div>
                    
                    
                    <div class="mb-4">
                        <label class="block text-gray-300 mb-2">${t.birth_date}*</label>
                        <input type="date" id="birthDateEdit" value="${pigeon.birth_date}" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-300 mb-2">${t.father}</label>
                            <select id="fatherIdEdit" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                <option value="">${t.select}</option>
                                ${males.map(p => `<option value="${p.id}" ${pigeon.father_id === p.id ? 'selected' : ''}>${p.name} - ${p.band_number}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-300 mb-2">${t.mother}</label>
                            <select id="motherIdEdit" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                <option value="">${t.select}</option>
                                ${females.map(p => `<option value="${p.id}" ${pigeon.mother_id === p.id ? 'selected' : ''}>${p.name} - ${p.band_number}</option>`).join('')}
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-300 mb-2">${t.description}</label>
                        <textarea id="descriptionEdit" rows="3" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">${pigeon.description || ''}</textarea>
                    </div>
                    
                    <div class="flex gap-4">
                        <button type="submit" class="btn-primary flex-1">
                            <i class="fas fa-save mr-2"></i> ${t.save}
                        </button>
                        <button type="button" onclick="showPigeons()" class="flex-1 px-6 py-3 bg-gray-600 rounded-full hover:bg-gray-700 transition">
                            ${t.cancel}
                        </button>
                    </div>
                </form>
                </div>
                </div>
            `;
            } catch (error) {
                console.error('Güvercin düzenleme hatası:', error);
                
                // Kullanıcıya anlamlı hata mesajı göster
                document.getElementById('content').innerHTML = `
                    <div class="container mx-auto">
                        <div class="glass p-8 rounded-3xl text-center">
                            <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                            <h2 class="text-2xl font-bold mb-4 text-red-400">Hata Oluştu</h2>
                            <p class="text-xl mb-4">${error.message || 'Güvercin bilgileri yüklenirken bir hata oluştu.'}</p>
                            <button onclick="showPigeons()" class="px-6 py-3 bg-gray-600 rounded-full hover:bg-gray-700 transition">
                                <i class="fas fa-arrow-left mr-2"></i> Geri Dön
                            </button>
                        </div>
                    </div>
                `;
                
                // Hata bildirimini göster
                showNotification(error.message || 'Güvercin bilgileri yüklenemedi', 'error');
            }
        }

        // Preview image for edit form
        function previewImageEdit(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreviewEdit').innerHTML = `
                        <img src="${e.target.result}" class="image-preview">
                    `;
                };
                reader.readAsDataURL(file);
            }
        }

        // Handle Edit Pigeon - SUPABASE VERSION
        async function handleEditPigeon(event, pigeonId) {
            event.preventDefault();
            
            // Loading göster
            showNotification('Güvercin güncelleniyor...', 'info');
            
            try {
                // Form verilerini topla
                const updateData = {
                    name: document.getElementById('pigeonNameEdit').value,
                    bandNumber: document.getElementById('bandNumberEdit').value,
                    gender: document.getElementById('genderEdit').value,
                    breed: document.getElementById('breedEdit').value,
                    birthDate: document.getElementById('birthDateEdit').value,
                    fatherId: document.getElementById('fatherIdEdit').value || null,
                    motherId: document.getElementById('motherIdEdit').value || null,
                    description: document.getElementById('descriptionEdit').value
                };
                
                // Yeni resim varsa önce yükle
                const imageInput = document.getElementById('pigeonImageEdit');
                if (imageInput.files[0]) {
                    const uploadResult = await SupabaseStorage.uploadPigeonImage(
                        imageInput.files[0], 
                        pigeonId
                    );
                    
                    if (uploadResult.success) {
                        updateData.image_url = uploadResult.url;
                    } else {
                        console.error('Resim yükleme hatası:', uploadResult.error);
                        // Resim yüklenemese bile güncellemeye devam et
                    }
                }
                
                // Supabase'de güncelle
                const result = await SupabaseDB.updatePigeon(pigeonId, updateData);
                
                if (!result.success) {
                    throw new Error(result.error);
                }
                
                showNotification(translations[currentLang].success + '!', 'success');
                showPigeonDetail(pigeonId);
                
            } catch (error) {
                console.error('Güvercin güncelleme hatası:', error);
                showNotification(error.message || 'Güvercin güncellenemedi', 'error');
            }
        }

        // Delete pigeon - SUPABASE VERSION
        async function deletePigeon(pigeonId) {
            try {
                // Önce güvercin bilgisini al
                const pigeonResult = await SupabaseDB.getPigeon(pigeonId);
                if (!pigeonResult.success || !pigeonResult.data) {
                    showNotification('Güvercin bulunamadı', 'error');
                    return;
                }
                
                const pigeon = pigeonResult.data;
                
                if (confirm(`${pigeon.name} adlı güvercini silmek istediğinizden emin misiniz? Bu işlem geri alınamaz!`)) {
                    // Loading göster
                    showNotification('Güvercin siliniyor...', 'info');
                    
                    // Supabase'den sil
                    const deleteResult = await SupabaseDB.deletePigeon(pigeonId);
                    
                    if (!deleteResult.success) {
                        throw new Error(deleteResult.error);
                    }
                    
                    // Resim varsa sil
                    if (pigeon.image_url) {
                        // URL'den path'i çıkar
                        const urlParts = pigeon.image_url.split('/');
                        const fileName = urlParts[urlParts.length - 1];
                        const path = `${storage.currentUser.id}/${fileName}`;
                        
                        await SupabaseStorage.deletePigeonImage(path);
                    }
                    
                    // Show success message
                    showNotification('Güvercin başarıyla silindi', 'success');
                    
                    // Ensure we stay on the My Pigeons tab
                    setTimeout(() => {
                        // Refresh the list and ensure tab is active
                        showPigeons();
                        updateActiveTab(1);
                    }, 100);
                }
            } catch (error) {
                console.error('Güvercin silme hatası:', error);
                showNotification(error.message || 'Güvercin silinemedi', 'error');
            }
        }

        // Show Pigeon Detail - SUPABASE VERSION
        async function showPigeonDetail(pigeonId) {
            if (!checkAuth()) return;
            cleanupPreviousViews();
            const t = translations[currentLang];
            
            // Loading göster
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                    <div class="glass p-8 rounded-3xl text-center">
                        <i class="fas fa-spinner fa-spin text-4xl text-cyan-400 mb-4"></i>
                        <p class="text-xl">Güvercin detayları yükleniyor...</p>
                    </div>
                </div>
            `;
            
            try {
                // Güvercin bilgilerini getir
                const pigeonResult = await SupabaseDB.getPigeon(pigeonId);
                if (!pigeonResult.success || !pigeonResult.data) {
                    throw new Error('Güvercin bulunamadı');
                }
                
                const pigeon = pigeonResult.data;
                
                // Sağlık kayıtlarını getir
                const healthRecords = await SupabaseDB.getHealthRecords(pigeonId);
                const healthData = healthRecords.success ? healthRecords.data : [];
                
                // Performans kayıtlarını getir (şimdilik localStorage'dan)
                const performanceRecords = storage.performanceRecords.filter(r => r.pigeonId === pigeonId);
                
                document.getElementById('content').innerHTML = `
                    <div class="container mx-auto">
                    <div class="glass p-8 rounded-3xl">
                    <div class="flex justify-between items-center mb-8">
                        <h2 class="text-3xl font-bold">${pigeon.name}</h2>
                        <button onclick="showPigeons()" class="px-6 py-3 bg-gray-600 rounded-full hover:bg-gray-700 transition">
                            <i class="fas fa-arrow-left mr-2"></i> Geri
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Sol taraf - Temel bilgiler -->
                        <div>
                            ${pigeon.image_url ? `
                                <img src="${pigeon.image_url}" alt="${pigeon.name}" class="w-full h-64 object-cover rounded-xl mb-6">
                            ` : `
                                <div class="bg-gradient-to-r from-cyan-400 to-purple-400 w-32 h-32 rounded-full flex items-center justify-center mx-auto mb-6">
                                    <i class="fas fa-dove text-5xl"></i>
                                </div>
                            `}
                            
                            <div class="space-y-4">
                                <div class="glass p-4 rounded-lg">
                                    <h4 class="font-bold mb-2">Temel Bilgiler</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span class="text-gray-400">Künye No:</span>
                                            <span>${pigeon.band_number}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-400">Cinsiyet:</span>
                                            <span>${pigeon.gender === 'male' ? 'Erkek' : 'Dişi'}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-400">Irk:</span>
                                            <span>${pigeon.breed}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-400">Doğum Tarihi:</span>
                                            <span>${formatDate(pigeon.birth_date)}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                ${pigeon.father || pigeon.mother ? `
                                    <div class="glass p-4 rounded-lg">
                                        <h4 class="font-bold mb-2">Anne-Baba</h4>
                                        <div class="space-y-2 text-sm">
                                            ${pigeon.father ? `
                                                <div class="flex justify-between">
                                                    <span class="text-gray-400">Baba:</span>
                                                    <span>${pigeon.father.name} - ${pigeon.father.band_number}</span>
                                                </div>
                                            ` : ''}
                                            ${pigeon.mother ? `
                                                <div class="flex justify-between">
                                                    <span class="text-gray-400">Anne:</span>
                                                    <span>${pigeon.mother.name} - ${pigeon.mother.band_number}</span>
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- Sağ taraf - Kayıtlar -->
                        <div>
                            <!-- Sağlık Kayıtları -->
                            <div class="glass p-4 rounded-lg mb-4">
                                <h4 class="font-bold mb-3">Sağlık Kayıtları</h4>
                                ${healthData.length > 0 ? `
                                    <div class="space-y-2">
                                        ${healthData.slice(0, 5).map(record => `
                                            <div class="bg-black/30 p-3 rounded-lg">
                                                <div class="flex justify-between items-start">
                                                    <div>
                                                        <p class="font-semibold">${t[record.type] || record.type}</p>
                                                        <p class="text-sm text-gray-400">${formatDate(record.date)}</p>
                                                    </div>
                                                    ${record.veterinarian ? `<span class="text-xs text-gray-400">${record.veterinarian}</span>` : ''}
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : '<p class="text-gray-400 text-sm">Henüz sağlık kaydı yok</p>'}
                            </div>
                            
                            <!-- Performans Kayıtları -->
                            <div class="glass p-4 rounded-lg">
                                <h4 class="font-bold mb-3">Performans Kayıtları</h4>
                                ${performanceRecords.length > 0 ? `
                                    <div class="space-y-2">
                                        ${performanceRecords.slice(0, 5).map(record => `
                                            <div class="bg-black/30 p-3 rounded-lg">
                                                <div class="flex justify-between items-start">
                                                    <div>
                                                        <p class="font-semibold">${record.performanceType}</p>
                                                        <p class="text-sm text-gray-400">${formatDate(record.date)}</p>
                                                    </div>
                                                    <span class="text-cyan-400">${record.overallScore || 0} puan</span>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : '<p class="text-gray-400 text-sm">Henüz performans kaydı yok</p>'}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Alt butonlar -->
                    <div class="flex gap-4 mt-8">
                        <button onclick="showEditPigeon('${pigeon.id}')" class="btn-primary">
                            <i class="fas fa-edit mr-2"></i> Düzenle
                        </button>
                        <button onclick="showPedigree('${pigeon.id}')" class="px-6 py-3 bg-purple-500 rounded-full hover:bg-purple-600 transition">
                            <i class="fas fa-sitemap mr-2"></i> Soyağacı
                        </button>
                        <button onclick="generateQRCode('${pigeon.id}')" class="px-6 py-3 bg-blue-500 rounded-full hover:bg-blue-600 transition">
                            <i class="fas fa-qrcode mr-2"></i> QR Kod
                        </button>
                    </div>
                    </div>
                    </div>
                `;
            } catch (error) {
                console.error('Pigeon detail error:', error);
                showNotification(error.message || 'Güvercin detayları yüklenemedi', 'error');
                showPigeons();
            }
        }

        // Show Pedigree - SUPABASE VERSION WITH SVG VISUALIZATION
        async function showPedigree(pigeonId, maxGenerations = 4) {
            if (!checkAuth()) return;
            cleanupPreviousViews();
            const t = translations[currentLang];
            
            // Close all modals first
            const modals = ['pigeonModal', 'authModal', 'qrModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'none';
                }
            });
            
            // Loading göster
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                    <div class="glass p-8 rounded-3xl text-center">
                        <i class="fas fa-spinner fa-spin text-4xl text-cyan-400 mb-4"></i>
                        <p class="text-xl">Soyağacı yükleniyor...</p>
                    </div>
                </div>
            `;
            
            try {
                // Ana güvercini getir
                const pigeonResult = await SupabaseDB.getPigeon(pigeonId);
                if (!pigeonResult.success || !pigeonResult.data) {
                    throw new Error('Güvercin bulunamadı');
                }
                
                const pigeon = pigeonResult.data;
                
                // Soyağacı verilerini topla
                async function buildPedigreeTree(pigeonId, generation = 0) {
                    if (generation >= maxGenerations || !pigeonId) return null;
                    
                    const result = await SupabaseDB.getPigeon(pigeonId);
                    if (!result.success || !result.data) return null;
                    
                    const p = result.data;
                    
                    const node = {
                        id: p.id,
                        name: p.name,
                        altName: p.alt_name || '',
                        bandNumber: p.band_number,
                        gender: p.gender || 'unknown',
                        birthDate: p.birth_date,
                        deathDate: p.death_date || null,
                        image: p.image_url || null,
                        color: p.color,
                        breed: p.breed,
                        strain: p.strain,
                        owner: p.owner,
                        notes: p.notes,
                        generation: generation
                    };
                    
                    // Always create parent slots for consistent tree structure
                    if (generation < maxGenerations - 1) {
                        node.father = p.father_id ? await buildPedigreeTree(p.father_id, generation + 1) : 
                            { empty: true, gender: 'male', generation: generation + 1 };
                        node.mother = p.mother_id ? await buildPedigreeTree(p.mother_id, generation + 1) : 
                            { empty: true, gender: 'female', generation: generation + 1 };
                    }
                    
                    return node;
                }
                
                const pedigreeData = await buildPedigreeTree(pigeonId);
                
                // Create pedigree HTML with modern SVG rendering
                document.getElementById('content').innerHTML = `
                    <div class="container mx-auto">
                        <div class="glass p-8 rounded-3xl">
                            <div class="flex justify-between items-center mb-8">
                                <h2 class="text-3xl font-bold">${pigeon.name} - ${t.pedigree || 'Soyağacı'}</h2>
                                <div class="flex gap-2">
                                    <button onclick="showPedigree('${pigeonId}', 3)" class="px-4 py-2 ${maxGenerations === 3 ? 'bg-purple-500' : 'bg-gray-600'} rounded-lg hover:opacity-80 transition">
                                        3 ${t.generation || 'Nesil'}
                                    </button>
                                    <button onclick="showPedigree('${pigeonId}', 4)" class="px-4 py-2 ${maxGenerations === 4 ? 'bg-purple-500' : 'bg-gray-600'} rounded-lg hover:opacity-80 transition">
                                        4 ${t.generation || 'Nesil'}
                                    </button>
                                    <button onclick="showPedigree('${pigeonId}', 5)" class="px-4 py-2 ${maxGenerations === 5 ? 'bg-purple-500' : 'bg-gray-600'} rounded-lg hover:opacity-80 transition">
                                        5 ${t.generation || 'Nesil'}
                                    </button>
                                </div>
                            </div>
                            
                            <div class="pedigree-container bg-black/20 rounded-2xl">
                                <div class="pedigree-wrapper">
                                    ${renderModernPedigree(pedigreeData, t)}
                                </div>
                            </div>
                            
                            <div class="mt-8 flex gap-4 flex-wrap">
                                <button onclick="showPigeons()" class="px-6 py-3 bg-gray-600 rounded-full hover:bg-gray-700 transition">
                                    <i class="fas fa-arrow-left mr-2"></i> ${t.back || 'Geri Dön'}
                                </button>
                                <button onclick="exportSVGPedigreePDF('${pigeonId}')" class="btn-primary">
                                    <i class="fas fa-file-pdf mr-2"></i> ${t.download_pdf || 'PDF İndir'}
                                </button>
                                <button onclick="printPedigree()" class="px-6 py-3 bg-green-500 rounded-full hover:bg-green-600 transition">
                                    <i class="fas fa-print mr-2"></i> ${t.print || 'Yazdır'}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add connection lines after rendering
                if (window.pedigreeTimeout) clearTimeout(window.pedigreeTimeout);
                window.pedigreeTimeout = setTimeout(() => drawConnectionLines(), 100);
                
                // Add resize event handler with debouncing (only once)
                if (!window.pedigreeResizeHandler) {
                    window.pedigreeResizeHandler = true;
                    let resizeTimeout;
                    window.addEventListener('resize', () => {
                        clearTimeout(resizeTimeout);
                        resizeTimeout = setTimeout(() => {
                            drawConnectionLines();
                        }, 150); // Faster response for mobile
                    });
                    
                    // Handle orientation changes for mobile devices
                    window.addEventListener('orientationchange', () => {
                        // Clear lines immediately for visual feedback
                        const container = document.querySelector('.pedigree-tree');
                        if (container) {
                            container.querySelectorAll('.connection-line, .vertical-line, .connection-joint, .connection-svg').forEach(element => element.remove());
                        }
                        setTimeout(() => {
                            drawConnectionLines();
                        }, 200);
                    });
                }
                
                // Redraw lines when container is scrolled (for mobile)
                const pedigreeContainer = document.querySelector('.pedigree-tree');
                if (pedigreeContainer) {
                    let scrollTimeout;
                    pedigreeContainer.addEventListener('scroll', () => {
                        clearTimeout(scrollTimeout);
                        scrollTimeout = setTimeout(() => {
                            drawConnectionLines();
                        }, 100);
                    });
                }
                
                // Use IntersectionObserver for performance optimization
                const observer = new IntersectionObserver((entries) => {
                    if (entries.some(entry => entry.isIntersecting)) {
                        drawConnectionLines();
                    }
                });
                
                // Observe the pedigree container
                if (pedigreeContainer) {
                    observer.observe(pedigreeContainer);
                }
                
            } catch (error) {
                console.error('Pedigree error:', error);
                showNotification(error.message || 'Soyağacı yüklenemedi', 'error');
                showPigeons();
            }
        }

        // Print Pedigree
        function printPedigree() {
            window.print();
        }

        // Export Pedigree as PDF
        async function exportPedigreePDF(pigeonId) {
            try {
                showNotification('PDF oluşturuluyor...', 'info');
                
                // Get the pedigree container
                const pedigreeContainer = document.querySelector('.pedigree-container');
                if (!pedigreeContainer) {
                    throw new Error('Soyağacı bulunamadı');
                }
                
                // Use html2canvas to convert to image
                const canvas = await html2canvas(pedigreeContainer, {
                    backgroundColor: '#0f0f0f',
                    scale: 2
                });
                
                // Convert to PDF using jsPDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'landscape',
                    unit: 'mm',
                    format: 'a4'
                });
                
                const imgWidth = 297; // A4 width in landscape
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                pdf.addImage(
                    canvas.toDataURL('image/png'),
                    'PNG',
                    0,
                    0,
                    imgWidth,
                    imgHeight
                );
                
                // Get pigeon name for filename
                const pigeonResult = await SupabaseDB.getPigeon(pigeonId);
                const filename = pigeonResult.success ? 
                    `soyagaci_${pigeonResult.data.name}_${new Date().toISOString().split('T')[0]}.pdf` :
                    `soyagaci_${new Date().toISOString().split('T')[0]}.pdf`;
                
                pdf.save(filename);
                showNotification('PDF başarıyla oluşturuldu!', 'success');
            } catch (error) {
                console.error('PDF export error:', error);
                showNotification('PDF oluşturulurken hata oluştu', 'error');
            }
        }

        // Show Matings
        // Show Matings - SUPABASE VERSION
        async function showMatings() {
            if (!checkAuth()) return;
            cleanupPreviousViews();
            updateActiveTab(2);
            
            // Loading göster
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                    <div class="glass p-8 rounded-3xl text-center">
                        <i class="fas fa-spinner fa-spin text-4xl text-cyan-400 mb-4"></i>
                        <p class="text-xl">Eşleştirmeler yükleniyor...</p>
                    </div>
                </div>
            `;
            
            try {
                // Eşleştirmeleri getir
                const matingsResult = await SupabaseDB.getMatings(storage.currentUser.id);
                if (!matingsResult.success) {
                    throw new Error(matingsResult.error);
                }
                
                const userMatings = matingsResult.data || [];
                
                // Güvercinleri getir (erkek/dişi bilgileri için)
                const pigeonsResult = await SupabaseDB.getPigeons(storage.currentUser.id);
                if (!pigeonsResult.success) {
                    throw new Error(pigeonsResult.error);
                }
                
                const userPigeons = pigeonsResult.data || [];
                const t = translations[currentLang];
                
                document.getElementById('content').innerHTML = `
                    <div class="container mx-auto">
                    <div class="glass p-8 rounded-3xl">`
                    +
                    `
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold">${t.nav_matings}</h2>
                    <button onclick="showAddMating()" class="btn-primary">
                        <i class="fas fa-plus mr-2"></i> ${t.new_mating}
                    </button>
                </div>
                
                <div class="space-y-6">
                    ${userMatings.map(mating => {
                        const male = mating.male || { name: t.unknown, band_number: '', image_url: null };
                        const female = mating.female || { name: t.unknown, band_number: '', image_url: null };
                        const eggLayingDate = mating.egg_laying_date || calculateEggLayingDate(mating.mating_date);
                        const expectedHatchDate = mating.expected_hatch_date || calculateHatchDate(eggLayingDate);
                        const isHatched = mating.hatched || false;
                        
                        return `
                            <div class="glass p-6 rounded-2xl card-3d">
                                <!-- Güvercin Çifti -->
                                <div class="flex items-center justify-between mb-6">
                                    <div class="flex items-center gap-4">
                                        ${male.image_url ? `
                                            <img src="${male.image_url}" alt="${male.name}" class="w-16 h-16 rounded-full object-cover">
                                        ` : `
                                            <div class="bg-gradient-to-r from-blue-400 to-cyan-400 w-16 h-16 rounded-full flex items-center justify-center">
                                                <i class="fas fa-mars text-xl"></i>
                                            </div>
                                        `}
                                        <div>
                                            <h4 class="font-bold text-lg">${male.name}</h4>
                                            <p class="text-sm text-gray-400">${male.band_number || ''}</p>
                                        </div>
                                    </div>
                                    <div class="flex flex-col items-center">
                                        <i class="fas fa-heart text-red-400 text-3xl mb-2"></i>
                                        ${isHatched ? `
                                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded-full text-xs">✓ ${t.hatched}</span>
                                        ` : ''}
                                    </div>
                                    <div class="flex items-center gap-4">
                                        <div class="text-right">
                                            <h4 class="font-bold text-lg">${female.name}</h4>
                                            <p class="text-sm text-gray-400">${female.band_number || ''}</p>
                                        </div>
                                        ${female.image_url ? `
                                            <img src="${female.image_url}" alt="${female.name}" class="w-16 h-16 rounded-full object-cover">
                                        ` : `
                                            <div class="bg-gradient-to-r from-pink-400 to-purple-400 w-16 h-16 rounded-full flex items-center justify-center">
                                                <i class="fas fa-venus text-xl"></i>
                                            </div>
                                        `}
                                    </div>
                                </div>
                                
                                <!-- Tarih Bilgileri -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                    <div class="text-center p-3 bg-black/20 rounded-lg">
                                        <div class="text-xs text-gray-400 mb-1">${t.mating_date}</div>
                                        <div class="font-semibold">${new Date(mating.mating_date).toLocaleDateString('tr-TR')}</div>
                                    </div>
                                    <div class="text-center p-3 bg-black/20 rounded-lg">
                                        <div class="text-xs text-gray-400 mb-1">${t.egg_laying_date}</div>
                                        <div class="font-semibold">${new Date(eggLayingDate).toLocaleDateString('tr-TR')}</div>
                                    </div>
                                    <div class="text-center p-3 bg-black/20 rounded-lg">
                                        <div class="text-xs text-gray-400 mb-1">${t.expected_hatch}</div>
                                        <div class="font-semibold">${new Date(expectedHatchDate).toLocaleDateString('tr-TR')}</div>
                                    </div>
                                </div>
                                
                                <!-- Notlar -->
                                ${mating.notes ? `
                                    <div class="mb-4 p-3 bg-black/30 rounded-lg">
                                        <div class="text-xs text-gray-400 mb-1">Notlar:</div>
                                        <p class="text-gray-300">${mating.notes}</p>
                                    </div>
                                ` : ''}
                                
                                <!-- Aksiyon Butonları -->
                                <div class="flex gap-2 justify-end">
                                    <button onclick="editMating('${mating.id}')" class="px-4 py-2 bg-blue-500/20 text-blue-400 rounded-lg hover:bg-blue-500/30 transition text-sm">
                                        <i class="fas fa-edit mr-1"></i> Düzenle
                                    </button>
                                    <button onclick="deleteMating('${mating.id}')" class="px-4 py-2 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 transition text-sm">
                                        <i class="fas fa-trash mr-1"></i> Sil
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('') || `<div class="text-center py-12"><p class="text-gray-400 text-lg">${t.no_matings}</p></div>`}
                </div>
                </div>
                </div>
            `;
            } catch (error) {
                console.error('Eşleştirmeler yükleneme hatası:', error);
                showNotification(error.message || 'Eşleştirmeler yüklenemedi', 'error');
                document.getElementById('content').innerHTML = `
                    <div class="container mx-auto">
                        <div class="glass p-8 rounded-3xl text-center">
                            <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                            <p class="text-xl">Eşleştirmeler yüklenemedi</p>
                            <p class="text-gray-400 mt-2">${error.message}</p>
                        </div>
                    </div>
                `;
            }
        }

        // Generate QR Code
        function generateQRCode(pigeonId) {
            const pigeon = storage.pigeons.find(p => p.id === pigeonId);
            if (!pigeon) return;
            
            const qrData = {
                name: pigeon.name,
                bandNumber: pigeon.bandNumber,
                breed: pigeon.breed,
                gender: pigeon.gender,
                color: pigeon.color,
                birthDate: pigeon.birthDate,
                owner: storage.currentUser.firstName + ' ' + storage.currentUser.lastName
            };
            
            document.getElementById('qrcode').innerHTML = '';
            new QRCode(document.getElementById('qrcode'), {
                text: JSON.stringify(qrData),
                width: 256,
                height: 256,
                colorDark: '#000000',
                colorLight: '#ffffff',
                correctLevel: QRCode.CorrectLevel.H
            });
            
            document.getElementById('qrModal').style.display = 'block';
        }

        function closeQRModal() {
            document.getElementById('qrModal').style.display = 'none';
        }

        function downloadQRCode() {
            const canvas = document.querySelector('#qrcode canvas');
            const link = document.createElement('a');
            link.download = 'qrcode.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        // Export to PDF
        function exportPigeonPDF(pigeonId) {
            const pigeon = storage.pigeons.find(p => p.id === pigeonId);
            if (!pigeon) return;
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            let y = 20;
            
            // Title - Canvas yöntemi ile
            const titleImg = createTextImage(pigeon.name, {
                fontSize: 20,
                fontFamily: 'Arial'
            });
            doc.addImage(titleImg, 'PNG', 20, y, 170, 10);
            y += 20;
            
            // Basic info - Her satır için ayrı görüntü
            const infoLines = [
                `Künye No: ${pigeon.bandNumber}`,
                `Cinsiyet: ${pigeon.gender === 'male' ? 'Erkek' : 'Dişi'}`,
                `Irk: ${pigeon.breed}`,
                `Renk: ${pigeon.color}`,
                `Doğum Tarihi: ${formatDate(pigeon.birthDate)}`
            ];
            
            infoLines.forEach(line => {
                const lineImg = createTextImage(line, {
                    fontSize: 12,
                    fontFamily: 'Arial'
                });
                doc.addImage(lineImg, 'PNG', 20, y, 120, 6);
                y += 10;
            });
            
            // Parents info
            if (pigeon.fatherId || pigeon.motherId) {
                y += 10;
                
                // Ebeveyn Bilgileri başlığı
                const parentTitleImg = createTextImage('Ebeveyn Bilgileri', {
                    fontSize: 16,
                    fontFamily: 'Arial'
                });
                doc.addImage(parentTitleImg, 'PNG', 20, y, 80, 8);
                y += 10;
                
                if (pigeon.fatherId) {
                    const father = storage.pigeons.find(p => p.id === pigeon.fatherId);
                    if (father) {
                        const fatherImg = createTextImage(`Baba: ${father.name} (${father.bandNumber})`, {
                            fontSize: 12,
                            fontFamily: 'Arial'
                        });
                        doc.addImage(fatherImg, 'PNG', 20, y, 120, 6);
                        y += 10;
                    }
                }
                
                if (pigeon.motherId) {
                    const mother = storage.pigeons.find(p => p.id === pigeon.motherId);
                    if (mother) {
                        const motherImg = createTextImage(`Anne: ${mother.name} (${mother.bandNumber})`, {
                            fontSize: 12,
                            fontFamily: 'Arial'
                        });
                        doc.addImage(motherImg, 'PNG', 20, y, 120, 6);
                    }
                }
            }
            
            // Save PDF
            doc.save(`${pigeon.name}_${pigeon.bandNumber}.pdf`);
            showNotification('PDF başarıyla indirildi!', 'success');
        }

        function exportPedigreePDF(pigeonId) {
            const pigeon = storage.pigeons.find(p => p.id === pigeonId);
            if (!pigeon) return;
            
            // Show loading notification
            showNotification('PDF hazırlanıyor, lütfen bekleyin...', 'info');
            
            // Find the pedigree tree element
            const pedigreeElement = document.querySelector('.pedigree-tree');
            if (!pedigreeElement) {
                showNotification('Soyağacı bulunamadı!', 'error');
                return;
            }
            
            // Configure dom-to-image options for print-friendly PDF
            const scale = 2; // High resolution
            
            // Clone the element to apply print styles without affecting the display
            const clonedElement = pedigreeElement.cloneNode(true);
            clonedElement.style.position = 'absolute';
            clonedElement.style.left = '-9999px';
            clonedElement.style.top = '0';
            clonedElement.style.width = pedigreeElement.scrollWidth + 'px';
            clonedElement.style.height = pedigreeElement.scrollHeight + 'px';
            document.body.appendChild(clonedElement);
            
            // Apply inline styles from computed styles and make print-friendly
            const applyInlineStyles = (element) => {
                const computedStyle = window.getComputedStyle(element);
                const importantStyles = [
                    'width', 'height', 'padding', 'margin', 'border', 'borderRadius',
                    'fontSize', 'fontWeight', 'fontFamily', 'lineHeight', 'textAlign',
                    'display', 'position', 'top', 'left', 'right', 'bottom',
                    'flexDirection', 'justifyContent', 'alignItems', 'gap',
                    'gridTemplateColumns', 'gridGap'
                ];
                
                // Apply computed styles as inline styles
                importantStyles.forEach(prop => {
                    if (computedStyle[prop]) {
                        element.style[prop] = computedStyle[prop];
                    }
                });
                
                // Override with print-friendly colors
                element.style.color = '#000000';
                element.style.backgroundColor = 'transparent';
                element.style.backgroundImage = 'none';
                element.style.backdropFilter = 'none';
                element.style.filter = 'none';
                element.style.opacity = '1';
                element.style.animation = 'none';
                element.style.transition = 'none';
                element.style.transform = 'none';
                element.style.boxShadow = 'none';
                
                // Recursively apply to all children
                Array.from(element.children).forEach(child => {
                    applyInlineStyles(child);
                });
            };
            
            // Apply print-friendly styles to specific elements
            const applyPrintStyles = (element) => {
                // First apply inline styles to all elements
                applyInlineStyles(element);
                
                // Main container - solid white background
                element.style.background = 'white';
                element.style.backgroundColor = 'white';
                element.style.minHeight = pedigreeElement.scrollHeight + 'px';
                
                // Remove all glass effects
                element.querySelectorAll('.glass').forEach(el => {
                    el.style.background = 'white';
                    el.style.backgroundColor = 'white';
                    el.style.backdropFilter = 'none';
                    el.style.border = '1px solid #e5e7eb';
                });
                
                // Generation containers
                element.querySelectorAll('.generation').forEach(gen => {
                    gen.style.backgroundColor = 'white';
                    gen.style.background = 'white';
                });
                
                // Pigeon nodes - ensure they have solid backgrounds
                element.querySelectorAll('.pigeon-node').forEach(node => {
                    // Apply computed styles first
                    const nodeComputed = window.getComputedStyle(node);
                    node.style.width = nodeComputed.width;
                    node.style.height = nodeComputed.height;
                    node.style.padding = nodeComputed.padding;
                    node.style.borderRadius = nodeComputed.borderRadius;
                    
                    // Then apply print styles
                    node.style.backgroundColor = '#f9fafb';
                    node.style.border = '2px solid #6b7280';
                    node.style.boxShadow = 'none';
                    
                    // Male nodes
                    if (node.classList.contains('male')) {
                        node.style.backgroundColor = '#dbeafe';
                        node.style.borderColor = '#3b82f6';
                    }
                    // Female nodes
                    if (node.classList.contains('female')) {
                        node.style.backgroundColor = '#fce7f3';
                        node.style.borderColor = '#ec4899';
                    }
                });
                
                // All text elements - ensure black color
                element.querySelectorAll('*').forEach(el => {
                    if (el.textContent && el.children.length === 0) {
                        el.style.color = '#000000';
                    }
                });
                
                // Specific text elements - DARK colors for PDF contrast
                element.querySelectorAll('.pigeon-name').forEach(el => {
                    el.style.color = '#000000'; // Pure black for maximum contrast
                    el.style.fontWeight = 'bold';
                });
                
                element.querySelectorAll('.pigeon-role').forEach(el => {
                    el.style.color = '#1f2937'; // Very dark gray for band number
                    el.style.fontWeight = '600'; // Semi-bold for better visibility
                });
                
                element.querySelectorAll('.pigeon-alt-name').forEach(el => {
                    el.style.color = '#1f2937'; // Very dark gray
                });
                
                element.querySelectorAll('.pigeon-detail-item').forEach(el => {
                    el.style.color = '#111827'; // Dark gray for details
                    el.style.backgroundColor = '#f3f4f6';
                    el.style.padding = '4px 8px';
                    el.style.borderRadius = '4px';
                    el.style.fontWeight = '500'; // Medium weight for better readability
                });
                
                element.querySelectorAll('.pigeon-detail-item span').forEach(el => {
                    el.style.color = '#111827'; // Dark gray for span text
                });
                
                // Connection lines - ensure visible
                element.querySelectorAll('.connection-line').forEach(el => {
                    el.style.backgroundColor = '#6b7280';
                    el.style.boxShadow = 'none';
                    el.style.animation = 'none';
                });
                
                // Connection joints
                element.querySelectorAll('.connection-joint').forEach(el => {
                    el.style.backgroundColor = '#6b7280';
                    el.style.boxShadow = 'none';
                });
                
                // Icons
                element.querySelectorAll('.pigeon-icon').forEach(el => {
                    el.style.color = '#374151';
                    el.style.backgroundColor = '#e5e7eb';
                    el.style.padding = '8px';
                    el.style.borderRadius = '50%';
                });
                
                // Remove any remaining animations or transitions
                element.querySelectorAll('*').forEach(el => {
                    el.style.animation = 'none';
                    el.style.transition = 'none';
                });
            };
            
            // Apply styles after a small delay to ensure DOM is ready
            setTimeout(() => {
                applyPrintStyles(clonedElement);
                
                // Another small delay to ensure styles are applied
                setTimeout(() => {
                    const options = {
                        quality: 1.0,
                        bgcolor: '#ffffff',
                        width: clonedElement.scrollWidth * scale,
                        height: clonedElement.scrollHeight * scale,
                        style: {
                            transform: `scale(${scale})`,
                            transformOrigin: 'top left',
                            width: clonedElement.scrollWidth + 'px',
                            height: clonedElement.scrollHeight + 'px'
                        },
                        filter: (node) => {
                            // Include all nodes except tooltips
                            return !node.classList || !node.classList.contains('pigeon-tooltip');
                        }
                    };
                    
                    // Capture the cloned pedigree tree as PNG
                    domtoimage.toPng(clonedElement, options).then(dataUrl => {
                        // Remove the clone
                        document.body.removeChild(clonedElement);
                        
                        // Create an image to get dimensions
                        const img = new Image();
                        img.onload = function() {
                            const { jsPDF } = window.jspdf;
                            
                            // Calculate PDF dimensions based on image aspect ratio
                            const imgWidth = img.width;
                            const imgHeight = img.height;
                            const aspectRatio = imgWidth / imgHeight;
                            
                            // Use landscape orientation for wide pedigrees
                            const isWide = aspectRatio > 1.3;
                            const orientation = isWide ? 'landscape' : 'portrait';
                            
                            // Create PDF with appropriate orientation
                            const doc = new jsPDF({
                                orientation: orientation,
                                unit: 'mm',
                                format: 'a4'
                            });
                            
                            
                            // Get PDF page dimensions
                            const pageWidth = doc.internal.pageSize.getWidth();
                            const pageHeight = doc.internal.pageSize.getHeight();
                            
                            // Calculate image dimensions to fit the page with margins
                            const margin = 10;
                            const maxWidth = pageWidth - (margin * 2);
                            const maxHeight = pageHeight - (margin * 2);
                            
                            let pdfWidth = maxWidth;
                            let pdfHeight = pdfWidth / aspectRatio;
                            
                            // Adjust if height exceeds page
                            if (pdfHeight > maxHeight) {
                                pdfHeight = maxHeight;
                                pdfWidth = pdfHeight * aspectRatio;
                            }
                            
                            // Center the image on the page
                            const xOffset = (pageWidth - pdfWidth) / 2;
                            const yOffset = (pageHeight - pdfHeight) / 2;
                            
                            // Add image to PDF
                            doc.addImage(dataUrl, 'PNG', xOffset, yOffset, pdfWidth, pdfHeight);
                            
                            // Add title at the top
                            doc.setFontSize(16);
                            doc.setTextColor(60, 60, 60);
                            doc.text(`${pigeon.name} - Soyağacı`, pageWidth / 2, margin / 2, { align: 'center' });
                            
                            // Save the PDF
                            doc.save(`${pigeon.name}_soyagaci.pdf`);
                            showNotification('Soyağacı PDF\'i başarıyla indirildi!', 'success');
                        };
                        img.src = dataUrl;
                    }).catch(error => {
                        // Remove the clone on error too
                        if (document.body.contains(clonedElement)) {
                            document.body.removeChild(clonedElement);
                        }
                        console.error('PDF export error:', error);
                        showNotification('PDF oluşturulurken hata oluştu!', 'error');
                    });
                }, 100); // Small delay to ensure styles are applied
            }, 50); // Initial delay to ensure DOM is ready
        }

        // Enhanced SVG-based PDF export with color transformation
        async function exportSVGPedigreePDF(pigeonId) {
            try {
                // Fetch pigeon data from Supabase
                const pigeonResult = await SupabaseDB.getPigeon(pigeonId);
                if (!pigeonResult.success || !pigeonResult.data) {
                    showNotification('Güvercin bulunamadı!', 'error');
                    return;
                }
                
                const pigeon = pigeonResult.data;
                
                // Show loading notification
                showNotification('PDF hazırlanıyor (Gelişmiş mod)...', 'info');
                
                // Find the pedigree tree element
                const pedigreeElement = document.querySelector('.pedigree-tree');
                if (!pedigreeElement) {
                    showNotification('Soyağacı bulunamadı!', 'error');
                    return;
                }
                
                // Try simple approach first
                try {
                    simplePDFExport(pedigreeElement, pigeon);
                } catch (error) {
                    console.error('Simple PDF export failed, trying advanced method:', error);
                    try {
                        // Create printable version with color transformation
                        createPrintableSVG(pedigreeElement, pigeon);
                    } catch (error2) {
                        console.error('PDF export error:', error2);
                        showNotification('PDF oluşturulurken hata oluştu!', 'error');
                        debugPDFExport(error2);
                    }
                }
            } catch (error) {
                console.error('Error fetching pigeon data:', error);
                showNotification('Güvercin bilgileri alınamadı!', 'error');
            }
        }
        
        // Simple PDF export approach
        function simplePDFExport(element, pigeon) {
            console.log('Trying simple PDF export...');
            
            // Clone and prepare element
            const clonedElement = element.cloneNode(true);
            clonedElement.style.position = 'fixed';
            clonedElement.style.left = '0';
            clonedElement.style.top = '0';
            clonedElement.style.width = element.scrollWidth + 'px';
            clonedElement.style.height = element.scrollHeight + 'px';
            clonedElement.style.zIndex = '-9999';
            clonedElement.style.backgroundColor = '#ffffff';
            
            // Simple color fixes
            clonedElement.style.color = '#000000';
            clonedElement.querySelectorAll('*').forEach(el => {
                const style = window.getComputedStyle(el);
                
                // Fix text colors
                if (style.color) {
                    const rgb = style.color.match(/\d+/g);
                    if (rgb && (parseInt(rgb[0]) > 200 || parseInt(rgb[1]) > 200 || parseInt(rgb[2]) > 200)) {
                        el.style.color = '#000000';
                    }
                }
                
                // Fix backgrounds
                if (el.classList.contains('glass') || style.backdropFilter !== 'none') {
                    el.style.backgroundColor = '#ffffff';
                    el.style.backdropFilter = 'none';
                }
                
                // Remove animations and shadows
                el.style.animation = 'none';
                el.style.transition = 'none';
                el.style.boxShadow = 'none';
                el.style.textShadow = 'none';
            });
            
            // Special handling for pigeon nodes
            clonedElement.querySelectorAll('.pigeon-node').forEach(node => {
                node.style.backgroundColor = node.classList.contains('male') ? '#e3f2fd' : '#fce4ec';
                node.style.borderColor = node.classList.contains('male') ? '#2196f3' : '#e91e63';
                node.style.color = '#000000';
            });
            
            // Ensure dark text for pigeon details
            clonedElement.querySelectorAll('.pigeon-name').forEach(el => {
                el.style.color = '#000000'; // Pure black
                el.style.fontWeight = 'bold';
            });
            
            clonedElement.querySelectorAll('.pigeon-role').forEach(el => {
                el.style.color = '#1f2937'; // Very dark gray for band number
                el.style.fontWeight = '600';
            });
            
            clonedElement.querySelectorAll('.pigeon-alt-name').forEach(el => {
                el.style.color = '#1f2937';
            });
            
            clonedElement.querySelectorAll('.pigeon-detail-item').forEach(el => {
                el.style.color = '#111827';
                el.style.fontWeight = '500';
            });
            
            clonedElement.querySelectorAll('.pigeon-detail-item span').forEach(el => {
                el.style.color = '#111827';
            });
            
            // Ensure date/birth date text is dark
            clonedElement.querySelectorAll('.date, .birth-date, time').forEach(el => {
                el.style.color = '#000000';
                el.style.fontWeight = '500';
            });
            
            document.body.appendChild(clonedElement);
            
            // Use html2canvas if available
            if (window.html2canvas) {
                html2canvas(clonedElement, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#ffffff',
                    logging: false
                }).then(canvas => {
                    document.body.removeChild(clonedElement);
                    createPDFFromCanvas(canvas, pigeon, 150);
                }).catch(error => {
                    document.body.removeChild(clonedElement);
                    throw error;
                });
            } else if (window.domtoimage) {
                // Use dom-to-image
                domtoimage.toPng(clonedElement, {
                    bgcolor: '#ffffff',
                    width: clonedElement.scrollWidth * 2,
                    height: clonedElement.scrollHeight * 2,
                    style: {
                        transform: 'scale(2)',
                        transformOrigin: 'top left'
                    }
                }).then(dataUrl => {
                    document.body.removeChild(clonedElement);
                    
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');
                        ctx.fillStyle = '#ffffff';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                        ctx.drawImage(img, 0, 0);
                        createPDFFromCanvas(canvas, pigeon, 150);
                    };
                    img.src = dataUrl;
                }).catch(error => {
                    document.body.removeChild(clonedElement);
                    throw error;
                });
            } else {
                document.body.removeChild(clonedElement);
                throw new Error('No canvas library available');
            }
        }
        
        // Create printable SVG with color transformation
        function createPrintableSVG(originalElement, pigeon) {
            console.log('Starting PDF creation process...');
            
            const scale = 2; // Reduced for better compatibility
            const dpi = 150; // Reduced for better performance
            
            // Deep clone the element
            const clonedElement = originalElement.cloneNode(true);
            clonedElement.style.position = 'absolute';
            clonedElement.style.left = '-9999px';
            clonedElement.style.top = '0';
            clonedElement.style.width = originalElement.scrollWidth + 'px';
            clonedElement.style.height = originalElement.scrollHeight + 'px';
            
            console.log('Element cloned, dimensions:', originalElement.scrollWidth, 'x', originalElement.scrollHeight);
            
            // Add to body temporarily
            document.body.appendChild(clonedElement);
            
            try {
                // Apply color transformation
                console.log('Applying color transformation...');
                transformColorsForPrint(clonedElement);
                
                // Small delay to ensure styles are applied
                setTimeout(() => {
                    console.log('Converting to canvas...');
                    
                    // Convert to canvas with high quality
                    domToCanvasWithOptions(clonedElement, {
                        scale: scale,
                        useCORS: true,
                        allowTaint: true, // Changed to true for better compatibility
                        backgroundColor: '#ffffff',
                        logging: true, // Enable logging for debugging
                        width: originalElement.scrollWidth * scale,
                        height: originalElement.scrollHeight * scale
                    }).then(canvas => {
                        console.log('Canvas created successfully:', canvas.width, 'x', canvas.height);
                        
                        // Remove the clone
                        if (document.body.contains(clonedElement)) {
                            document.body.removeChild(clonedElement);
                        }
                        
                        // Create PDF from canvas
                        createPDFFromCanvas(canvas, pigeon, dpi);
                    }).catch(error => {
                        console.error('Canvas creation failed:', error);
                        
                        // Clean up on error
                        if (document.body.contains(clonedElement)) {
                            document.body.removeChild(clonedElement);
                        }
                        
                        // Show more specific error message
                        if (error.message.includes('tainted')) {
                            showNotification('Güvenlik hatası: Canvas erişim sorunu. Lütfen sayfayı yenileyin.', 'error');
                        } else {
                            showNotification('PDF oluşturulamadı: ' + error.message, 'error');
                        }
                        
                        debugPDFExport(error);
                    });
                }, 100); // Small delay for style application
                
            } catch (error) {
                console.error('Color transformation failed:', error);
                
                // Clean up
                if (document.body.contains(clonedElement)) {
                    document.body.removeChild(clonedElement);
                }
                
                throw error;
            }
        }
        
        // Transform colors for print (light to dark conversion)
        function transformColorsForPrint(element) {
            // Color transformation algorithm
            const getLuminance = (r, g, b) => {
                // Relative luminance formula
                return 0.299 * r + 0.587 * g + 0.114 * b;
            };
            
            const parseColor = (color) => {
                // Handle different color formats
                if (!color || color === 'transparent' || color === 'none') {
                    return null;
                }
                
                // RGB/RGBA
                const rgbMatch = color.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*[\d.]+)?\)/);
                if (rgbMatch) {
                    return {
                        r: parseInt(rgbMatch[1]),
                        g: parseInt(rgbMatch[2]),
                        b: parseInt(rgbMatch[3])
                    };
                }
                
                // Hex
                const hexMatch = color.match(/^#([0-9a-f]{6}|[0-9a-f]{3})$/i);
                if (hexMatch) {
                    let hex = hexMatch[1];
                    if (hex.length === 3) {
                        hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];
                    }
                    return {
                        r: parseInt(hex.substr(0, 2), 16),
                        g: parseInt(hex.substr(2, 2), 16),
                        b: parseInt(hex.substr(4, 2), 16)
                    };
                }
                
                return null;
            };
            
            const invertColorIfLight = (color) => {
                const parsed = parseColor(color);
                if (!parsed) return color;
                
                const luminance = getLuminance(parsed.r, parsed.g, parsed.b);
                
                // If color is light (luminance > 100), make it dark - lowered threshold for better contrast
                if (luminance > 100) {
                    // Make very dark for maximum contrast on white background
                    const darkness = Math.max(0, 50 - (luminance / 5)); // Very dark color
                    return `rgb(${darkness}, ${darkness}, ${darkness})`;
                }
                
                return color;
            };
            
            // Process all elements recursively
            const processElement = (el) => {
                const computedStyle = window.getComputedStyle(el);
                
                // Set white background on main container
                if (el === element) {
                    el.style.backgroundColor = '#ffffff';
                    el.style.background = '#ffffff';
                }
                
                // Transform text color
                const color = computedStyle.color;
                if (color) {
                    const newColor = invertColorIfLight(color);
                    if (newColor !== color) {
                        el.style.color = newColor;
                    }
                }
                
                // Transform background color (except main container)
                if (el !== element) {
                    const bgColor = computedStyle.backgroundColor;
                    if (bgColor && bgColor !== 'transparent' && bgColor !== 'rgba(0, 0, 0, 0)') {
                        const parsed = parseColor(bgColor);
                        if (parsed) {
                            const luminance = getLuminance(parsed.r, parsed.g, parsed.b);
                            // If background is very dark, lighten it
                            if (luminance < 50) {
                                el.style.backgroundColor = '#f5f5f5';
                            }
                        }
                    }
                }
                
                // Transform border color
                const borderColor = computedStyle.borderColor;
                if (borderColor && borderColor !== 'transparent') {
                    el.style.borderColor = invertColorIfLight(borderColor);
                }
                
                // Remove shadows and effects
                el.style.boxShadow = 'none';
                el.style.textShadow = 'none';
                el.style.filter = 'none';
                el.style.backdropFilter = 'none';
                el.style.opacity = '1';
                
                // Handle SVG elements
                if (el.tagName && el.tagName.toLowerCase() === 'svg') {
                    el.style.backgroundColor = 'transparent';
                }
                
                // Special handling for SVG child elements
                if (el.getAttribute) {
                    const fill = el.getAttribute('fill');
                    if (fill) {
                        el.setAttribute('fill', invertColorIfLight(fill));
                    }
                    
                    const stroke = el.getAttribute('stroke');
                    if (stroke) {
                        el.setAttribute('stroke', invertColorIfLight(stroke));
                    }
                }
                
                // Process all children
                Array.from(el.children).forEach(child => processElement(child));
            };
            
            // Start processing
            processElement(element);
            
            // Additional specific transformations
            element.querySelectorAll('.glass').forEach(el => {
                el.style.backgroundColor = '#ffffff';
                el.style.border = '1px solid #cccccc';
            });
            
            element.querySelectorAll('.pigeon-node').forEach(node => {
                // Ensure readable contrast
                node.style.backgroundColor = node.classList.contains('male') ? '#e3f2fd' : '#fce4ec';
                node.style.borderColor = node.classList.contains('male') ? '#1976d2' : '#c2185b';
                node.style.color = '#000000';
            });
            
            element.querySelectorAll('.connection-line').forEach(line => {
                line.style.backgroundColor = '#666666';
            });
            
            // Ensure all date/time text is dark
            element.querySelectorAll('.date, .birth-date, time').forEach(el => {
                el.style.color = '#000000';
                el.style.fontWeight = '500';
            });
        }
        
        // Enhanced dom-to-canvas conversion with options
        function domToCanvasWithOptions(element, options) {
            return new Promise((resolve, reject) => {
                // If dom-to-image is available, use it
                if (window.domtoimage) {
                    // Use toPng then convert to canvas
                    domtoimage.toPng(element, options)
                        .then(dataUrl => {
                            const img = new Image();
                            img.onload = function() {
                                const canvas = document.createElement('canvas');
                                const ctx = canvas.getContext('2d');
                                
                                canvas.width = img.width;
                                canvas.height = img.height;
                                
                                // White background
                                ctx.fillStyle = '#ffffff';
                                ctx.fillRect(0, 0, canvas.width, canvas.height);
                                
                                // Draw image
                                ctx.drawImage(img, 0, 0);
                                resolve(canvas);
                            };
                            img.onerror = function() {
                                reject(new Error('Failed to load generated image'));
                            };
                            img.src = dataUrl;
                        })
                        .catch(error => {
                            console.error('dom-to-image error:', error);
                            // Fallback to manual method
                            manualCanvasCreation(element, options, resolve, reject);
                        });
                } else {
                    // Fallback to manual canvas creation
                    manualCanvasCreation(element, options, resolve, reject);
                }
            });
        }
        
        // Manual canvas creation fallback
        function manualCanvasCreation(element, options, resolve, reject) {
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const scale = options.scale || 2;
                
                canvas.width = element.scrollWidth * scale;
                canvas.height = element.scrollHeight * scale;
                
                // White background
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Get computed styles
                const computedStyles = [];
                const allElements = element.querySelectorAll('*');
                allElements.forEach(el => {
                    computedStyles.push({
                        element: el,
                        styles: window.getComputedStyle(el).cssText
                    });
                });
                
                // Create SVG with inline styles
                const svgNS = "http://www.w3.org/2000/svg";
                const svg = document.createElementNS(svgNS, "svg");
                svg.setAttribute("width", element.scrollWidth);
                svg.setAttribute("height", element.scrollHeight);
                svg.setAttribute("xmlns", svgNS);
                
                // Foreign object to embed HTML
                const foreignObject = document.createElementNS(svgNS, "foreignObject");
                foreignObject.setAttribute("width", "100%");
                foreignObject.setAttribute("height", "100%");
                
                // Clone and apply inline styles
                const clonedElement = element.cloneNode(true);
                const clonedElements = clonedElement.querySelectorAll('*');
                clonedElements.forEach((el, index) => {
                    if (computedStyles[index]) {
                        el.setAttribute('style', computedStyles[index].styles);
                    }
                });
                
                // Wrap in div with namespace
                const wrapper = document.createElement('div');
                wrapper.setAttribute('xmlns', 'http://www.w3.org/1999/xhtml');
                wrapper.appendChild(clonedElement);
                
                foreignObject.appendChild(wrapper);
                svg.appendChild(foreignObject);
                
                // Serialize to string
                const serializer = new XMLSerializer();
                const svgString = serializer.serializeToString(svg);
                
                // Create blob and load as image
                const blob = new Blob([svgString], { type: 'image/svg+xml;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const img = new Image();
                
                img.onload = function() {
                    ctx.scale(scale, scale);
                    ctx.drawImage(img, 0, 0, element.scrollWidth, element.scrollHeight);
                    URL.revokeObjectURL(url);
                    resolve(canvas);
                };
                
                img.onerror = function() {
                    URL.revokeObjectURL(url);
                    reject(new Error('Failed to load SVG image in manual method'));
                };
                
                img.src = url;
                
            } catch (error) {
                reject(error);
            }
        }
        
        // Create PDF from canvas with high quality
        function createPDFFromCanvas(canvas, pigeon, dpi = 300) {
            const { jsPDF } = window.jspdf;
            
            // Calculate dimensions
            const imgWidth = canvas.width;
            const imgHeight = canvas.height;
            const aspectRatio = imgWidth / imgHeight;
            
            // Determine orientation
            const isWide = aspectRatio > 1.3;
            const orientation = isWide ? 'landscape' : 'portrait';
            
            // Create PDF
            const doc = new jsPDF({
                orientation: orientation,
                unit: 'mm',
                format: 'a4',
                compress: true
            });
            
            
            // Get page dimensions
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            
            // Calculate image dimensions to fit page with margins
            const margin = 10;
            const maxWidth = pageWidth - (margin * 2);
            const maxHeight = pageHeight - (margin * 2);
            
            let pdfWidth = maxWidth;
            let pdfHeight = pdfWidth / aspectRatio;
            
            if (pdfHeight > maxHeight) {
                pdfHeight = maxHeight;
                pdfWidth = pdfHeight * aspectRatio;
            }
            
            // Center the image
            const xOffset = (pageWidth - pdfWidth) / 2;
            const yOffset = (pageHeight - pdfHeight) / 2;
            
            // Convert canvas to high quality image
            const imgData = canvas.toDataURL('image/png', 1.0);
            
            // Add image to PDF with high quality
            doc.addImage(imgData, 'PNG', xOffset, yOffset, pdfWidth, pdfHeight, undefined, 'FAST');
            
            // Add title with proper Turkish character support
            doc.setFont("helvetica", "bold");
            doc.setFontSize(18);
            doc.setTextColor(51, 51, 51);
            
            // Convert Turkish characters to Latin equivalents for PDF compatibility
            const turkishToLatin = (text) => {
                const charMap = {
                    'ç': 'c', 'Ç': 'C',
                    'ğ': 'g', 'Ğ': 'G',
                    'ı': 'i', 'İ': 'I',
                    'ö': 'o', 'Ö': 'O',
                    'ş': 's', 'Ş': 'S',
                    'ü': 'u', 'Ü': 'U'
                };
                return text.replace(/[çÇğĞıİöÖşŞüÜ]/g, match => charMap[match] || match);
            };
            
            // Format the title as "X Pedigree"
            const titleText = `${turkishToLatin(pigeon.name)} Pedigree`;
            
            // Ensure proper encoding
            doc.text(titleText, pageWidth / 2, margin + 5, { 
                align: 'center',
                maxWidth: pageWidth - (margin * 2)
            });
            
            // Add metadata
            doc.setProperties({
                title: `${pigeon.name} Güvercininin Soy Ağacı`,
                subject: 'Güvercin Soy Ağacı',
                author: 'Güvercin Takip Sistemi',
                keywords: 'güvercin, soy ağacı, pedigree, şecere',
                creator: 'Güvercin Takip Sistemi'
            });
            
            // Save PDF
            doc.save(`${pigeon.name}_soyagaci_HD.pdf`);
            showNotification('Yüksek kaliteli PDF başarıyla oluşturuldu!', 'success');
        }
        
        // Debug helper for PDF export issues
        function debugPDFExport(error) {
            console.group('PDF Export Debug Info');
            console.error('Error:', error);
            
            // Check dependencies
            console.log('Dependencies check:');
            console.log('- jsPDF:', typeof window.jspdf !== 'undefined');
            console.log('- dom-to-image:', typeof window.domtoimage !== 'undefined');
            console.log('- html2canvas:', typeof window.html2canvas !== 'undefined');
            
            // Check DOM elements
            const pedigreeElement = document.querySelector('.pedigree-tree');
            console.log('Pedigree element found:', !!pedigreeElement);
            if (pedigreeElement) {
                console.log('- Width:', pedigreeElement.scrollWidth);
                console.log('- Height:', pedigreeElement.scrollHeight);
                console.log('- Children:', pedigreeElement.children.length);
            }
            
            // Browser info
            console.log('Browser info:');
            console.log('- User Agent:', navigator.userAgent);
            console.log('- Canvas support:', !!document.createElement('canvas').getContext);
            
            console.groupEnd();
            
            // Provide user-friendly error messages
            let userMessage = 'PDF oluşturulamadı. ';
            if (!window.jspdf) {
                userMessage += 'jsPDF kütüphanesi yüklenmemiş.';
            } else if (!pedigreeElement) {
                userMessage += 'Soyağacı elementi bulunamadı.';
            } else {
                userMessage += 'Teknik bir hata oluştu. Konsolu kontrol edin.';
            }
            
            showNotification(userMessage, 'error');
        }


        // Update active tab
        function updateActiveTab(index) {
            const tabs = document.querySelectorAll('.tab-btn');
            tabs.forEach((tab, i) => {
                if (i === index) {
                    tab.classList.add('tab-active');
                } else {
                    tab.classList.remove('tab-active');
                }
            });
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-20 right-4 px-6 py-3 rounded-lg text-white z-50 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                'bg-blue-500'
            }`;
            notification.innerHTML = `
                <div class="flex items-center gap-2">
                    <i class="fas ${
                        type === 'success' ? 'fa-check-circle' : 
                        type === 'error' ? 'fa-exclamation-circle' : 
                        'fa-info-circle'
                    }"></i>
                    <span>${message}</span>
                </div>
                </div>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Export to Excel (mock)
        function exportToExcel() {
            showNotification('Excel dosyası hazırlanıyor...', 'info');
            // In a real app, this would create and download an Excel file
        }

        // Print report
        function printReport() {
            window.print();
        }


        // Initialize on load
        window.onload = async function() {
            try {
                initTheme();
                updateLanguage();
                document.getElementById('langSelector').value = currentLang;
                
                // Check Supabase session
                try {
                    const session = await supabaseClient.checkSession();
                    if (session && session.user) {
                        // Session var, kullanıcı bilgilerini al
                        const user = await SupabaseAuth.getCurrentUser();
                        if (user) {
                            storage.currentUser = user;
                            console.log('[Supabase] User session restored:', user.email);
                        }
                    }
                } catch (error) {
                    console.error('[Supabase] Session check error:', error);
                }
                
                // Update navigation based on login state
                updateNavigation();
                
                // Always show homepage (it will handle logged in/out state)
                showHomepage();
            } catch (error) {
                console.error('Initialization error:', error);
                // Fallback content göster
                document.getElementById('content').innerHTML = `
                    <div class="text-center py-20">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                        <p class="text-red-400">Sayfa yüklenirken hata oluştu. Lütfen sayfayı yenileyin.</p>
                        <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition">
                            Sayfayı Yenile
                        </button>
                    </div>
                `;
            }
            
            // Initialize scroll reveal animations
            initScrollReveal();
            
            // Event delegation for pigeon detail and pedigree buttons
            document.addEventListener('click', function(e) {
                // Check if clicked element or its parent is a button with data attributes
                const button = e.target.closest('[data-action]');
                if (button) {
                    const action = button.getAttribute('data-action');
                    const pigeonId = button.getAttribute('data-pigeon-id');
                    
                    if (action === 'showDetail' && pigeonId) {
                        e.preventDefault();
                        showPigeonDetail(pigeonId);
                    } else if (action === 'showPedigree' && pigeonId) {
                        e.preventDefault();
                        showPedigree(pigeonId);
                    }
                }
            });
        };

        // Close modals when clicking outside - with proper event handling
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                if (event.target.id === 'authModal') {
                    closeAuthModal();
                } else if (event.target.id === 'pigeonModal') {
                    closePigeonModal();
                } else if (event.target.id === 'qrModal') {
                    closeQRModal();
                }
            }
        };

        // Show Health Records
        // Show Health Records - OLD LOCALSTORAGE VERSION (Commented out)
        /*
        function showHealthRecords() {
            if (!checkAuth()) return;
            cleanupPreviousViews();
            updateActiveTab(3);
            const userPigeons = storage.pigeons.filter(p => p.userId === storage.currentUser.id);
            const userHealthRecords = storage.healthRecords.filter(h => 
                userPigeons.some(p => p.id === h.pigeonId)
            );
            const t = translations[currentLang];
            
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                <div class="glass p-8 rounded-3xl">`
                +
                `
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold">${t.health_records}</h2>
                    <button onclick="showAddHealthRecord()" class="btn-primary">
                        <i class="fas fa-plus mr-2"></i> ${t.add_record}
                    </button>
                </div>
                
                <div class="space-y-4">
                    ${userHealthRecords.map(record => {
                        const pigeon = userPigeons.find(p => p.id === record.pigeonId);
                        const typeIcons = {
                            vaccination: 'fa-syringe',
                            illness: 'fa-virus',
                            treatment: 'fa-pills',
                            checkup: 'fa-stethoscope',
                            medication: 'fa-prescription'
                        };
                        const typeColors = {
                            vaccination: 'from-green-400 to-teal-500',
                            illness: 'from-red-400 to-pink-500',
                            treatment: 'from-yellow-400 to-orange-500',
                            checkup: 'from-blue-400 to-cyan-500',
                            medication: 'from-purple-400 to-indigo-500'
                        };
                        return `
                            <div class="glass p-6 rounded-2xl flex items-center gap-4">
                                <div class="bg-gradient-to-r ${typeColors[record.type]} w-16 h-16 rounded-full flex items-center justify-center">
                                    <i class="fas ${typeIcons[record.type]} text-2xl"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-lg">${pigeon?.name || t.unknown} - ${pigeon?.bandNumber || ''}</h4>
                                    <p class="text-gray-300">${t[record.type] || record.type} - ${record.description}</p>
                                    <div class="flex gap-4 mt-2 text-sm text-gray-400">
                                        <span><i class="fas fa-calendar mr-1"></i> ${formatDate(record.date)}</span>
                                        ${record.veterinarian ? `<span><i class="fas fa-user-md mr-1"></i> ${record.veterinarian}</span>` : ''}
                                        ${record.cost ? `<span><i class="fas fa-lira-sign mr-1"></i> ${record.cost}</span>` : ''}
                                    </div>
                                </div>
                                ${record.nextDueDate ? `
                                    <div class="text-right">
                                        <p class="text-sm text-gray-400">${t.next_check}</p>
                                        <p class="font-bold">${new Date(record.nextDueDate).toLocaleDateString('tr-TR')}</p>
                                    </div>
                                ` : ''}
                            </div>
                            </div>
                </div>
            `;
                    }).join('') || `<p class="text-gray-400 text-center">${t.no_health_records}</p>`}
                </div>
                </div>
                </div>
            `;
        }
        */

        // Show Health Records - SUPABASE VERSION
        async function showHealthRecords() {
            if (!checkAuth()) return;
            cleanupPreviousViews();
            updateActiveTab(3);
            const t = translations[currentLang];
            
            // Loading göster
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                    <div class="glass p-8 rounded-3xl text-center">
                        <i class="fas fa-spinner fa-spin text-4xl text-cyan-400 mb-4"></i>
                        <p class="text-xl">Sağlık kayıtları yükleniyor...</p>
                    </div>
                </div>
            `;
            
            try {
                // Kullanıcının güvercinlerini getir
                const pigeonsResult = await SupabaseDB.getPigeons(storage.currentUser.id);
                if (!pigeonsResult.success) {
                    throw new Error('Güvercinler yüklenemedi');
                }
                
                const userPigeons = pigeonsResult.data || [];
                const pigeonIds = userPigeons.map(p => p.id);
                
                // Sağlık kayıtlarını getir
                const healthRecordsResult = await Promise.all(
                    pigeonIds.map(id => SupabaseDB.getHealthRecords(id))
                );
                
                const userHealthRecords = [];
                healthRecordsResult.forEach(result => {
                    if (result.success && result.data) {
                        userHealthRecords.push(...result.data);
                    }
                });
                
                // Tarihe göre sırala
                userHealthRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                document.getElementById('content').innerHTML = `
                    <div class="container mx-auto">
                    <div class="glass p-8 rounded-3xl">
                    <div class="flex justify-between items-center mb-8">
                        <h2 class="text-3xl font-bold">${t.health_records}</h2>
                        <button onclick="showAddHealthRecord()" class="btn-primary">
                            <i class="fas fa-plus mr-2"></i> ${t.add_record}
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        ${userHealthRecords.map(record => {
                            const pigeon = userPigeons.find(p => p.id === record.pigeon_id);
                            const typeIcons = {
                                vaccination: 'fa-syringe',
                                illness: 'fa-virus',
                                treatment: 'fa-pills',
                                checkup: 'fa-stethoscope',
                                medication: 'fa-prescription'
                            };
                            const typeColors = {
                                vaccination: 'from-green-400 to-teal-500',
                                illness: 'from-red-400 to-pink-500',
                                treatment: 'from-yellow-400 to-orange-500',
                                checkup: 'from-blue-400 to-cyan-500',
                                medication: 'from-purple-400 to-indigo-500'
                            };
                            return `
                                <div class="glass p-6 rounded-2xl flex items-center gap-4">
                                    <div class="bg-gradient-to-r ${typeColors[record.type]} w-16 h-16 rounded-full flex items-center justify-center">
                                        <i class="fas ${typeIcons[record.type]} text-2xl"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-bold text-lg">${pigeon?.name || t.unknown} - ${pigeon?.band_number || ''}</h4>
                                        <p class="text-gray-300">${t[record.type] || record.type} - ${record.description || ''}</p>
                                        <div class="flex gap-4 mt-2 text-sm text-gray-400">
                                            <span><i class="fas fa-calendar mr-1"></i> ${formatDate(record.date)}</span>
                                            ${record.veterinarian ? `<span><i class="fas fa-user-md mr-1"></i> ${record.veterinarian}</span>` : ''}
                                            ${record.cost ? `<span><i class="fas fa-lira-sign mr-1"></i> ${record.cost}</span>` : ''}
                                        </div>
                                    </div>
                                    ${record.next_due_date ? `
                                        <div class="text-right">
                                            <p class="text-sm text-gray-400">${t.next_check}</p>
                                            <p class="font-bold">${new Date(record.next_due_date).toLocaleDateString('tr-TR')}</p>
                                        </div>
                                    ` : ''}
                                    <div class="flex gap-2">
                                        <button onclick="deleteHealthRecord('${record.id}')" class="text-red-400 hover:text-red-300 transition">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            `;
                        }).join('') || `<p class="text-gray-400 text-center">${t.no_health_records}</p>`}
                    </div>
                    </div>
                    </div>
                `;
            } catch (error) {
                console.error('Health records error:', error);
                document.getElementById('content').innerHTML = `
                    <div class="container mx-auto">
                        <div class="glass p-8 rounded-3xl text-center">
                            <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                            <h2 class="text-2xl font-bold mb-4 text-red-400">Hata Oluştu</h2>
                            <p class="text-xl mb-4">${error.message || 'Sağlık kayıtları yüklenirken bir hata oluştu.'}</p>
                            <button onclick="showHomepage()" class="px-6 py-3 bg-gray-600 rounded-full hover:bg-gray-700 transition">
                                <i class="fas fa-arrow-left mr-2"></i> Geri Dön
                            </button>
                        </div>
                    </div>
                `;
                showNotification(error.message || 'Sağlık kayıtları yüklenemedi', 'error');
            }
        }

        // Show Add Health Record Form - OLD LOCALSTORAGE VERSION (Commented out)
        /*
        function showAddHealthRecord() {
            const userPigeons = storage.pigeons.filter(p => p.userId === storage.currentUser.id);
            const t = translations[currentLang];
            
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                <div class="glass p-8 rounded-3xl">`
                +
                `
                <h2 class="text-3xl font-bold mb-8">Yeni Sağlık Kaydı</h2>
                
                <form onsubmit="handleAddHealthRecord(event)" class="max-w-2xl mx-auto">
                    <div class="mb-4">
                        <label class="block text-gray-300 mb-2">${t.name}*</label>
                        <select id="healthPigeonId" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                            <option value="">${t.select}</option>
                            ${userPigeons.map(p => `<option value="${p.id}">${p.name} - ${p.bandNumber}</option>`).join('')}
                        </select>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-300 mb-2">${t.record_type}*</label>
                            <select id="healthType" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                                <option value="">${t.select}</option>
                                <option value="vaccination">${t.vaccination}</option>
                                <option value="illness">${t.illness}</option>
                                <option value="treatment">${t.treatment}</option>
                                <option value="checkup">${t.checkup}</option>
                                <option value="medication">${t.medication}</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-300 mb-2">${t.date}*</label>
                            <input type="date" id="healthDate" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-300 mb-2">${t.description}*</label>
                        <textarea id="healthDescription" rows="3" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required></textarea>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div>
                            <label class="block text-gray-300 mb-2">${t.veterinarian}</label>
                            <input type="text" id="veterinarian" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                        </div>
                        <div>
                            <label class="block text-gray-300 mb-2">${t.cost} (₺)</label>
                            <input type="number" id="healthCost" step="0.01" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                        </div>
                        <div>
                            <label class="block text-gray-300 mb-2">${t.next_check}</label>
                            <input type="date" id="nextDueDate" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                        </div>
                    </div>
                    
                    <div class="flex gap-4">
                        <button type="submit" class="btn-primary flex-1">
                            <i class="fas fa-save mr-2"></i> ${t.save}
                        </button>
                        <button type="button" onclick="showHealthRecords()" class="flex-1 px-6 py-3 bg-gray-600 rounded-full hover:bg-gray-700 transition">
                            ${t.cancel}
                        </button>
                    </div>
                </form>
                </div>
                </div>
            `;
        }
        */

        // Show Add Health Record Form - SUPABASE VERSION
        async function showAddHealthRecord() {
            if (!checkAuth()) return;
            cleanupPreviousViews();
            const t = translations[currentLang];
            
            // Loading göster
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                    <div class="glass p-8 rounded-3xl text-center">
                        <i class="fas fa-spinner fa-spin text-4xl text-cyan-400 mb-4"></i>
                        <p class="text-xl">Form hazırlanıyor...</p>
                    </div>
                </div>
            `;
            
            try {
                // Kullanıcının güvercinlerini getir
                const pigeonsResult = await SupabaseDB.getPigeons(storage.currentUser.id);
                if (!pigeonsResult.success) {
                    throw new Error('Güvercinler yüklenemedi');
                }
                
                const userPigeons = pigeonsResult.data || [];
                
                document.getElementById('content').innerHTML = `
                    <div class="container mx-auto">
                    <div class="glass p-8 rounded-3xl">
                    <h2 class="text-3xl font-bold mb-8">Yeni Sağlık Kaydı</h2>
                    
                    <form onsubmit="handleAddHealthRecord(event)" class="max-w-2xl mx-auto">
                        <div class="mb-4">
                            <label class="block text-gray-300 mb-2">${t.name}*</label>
                            <select id="healthPigeonId" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                                <option value="">${t.select}</option>
                                ${userPigeons.map(p => `<option value="${p.id}">${p.name} - ${p.band_number}</option>`).join('')}
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-gray-300 mb-2">${t.record_type}*</label>
                                <select id="healthType" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                                    <option value="">${t.select}</option>
                                    <option value="vaccination">${t.vaccination}</option>
                                    <option value="illness">${t.illness}</option>
                                    <option value="treatment">${t.treatment}</option>
                                    <option value="checkup">${t.checkup}</option>
                                    <option value="medication">${t.medication}</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-300 mb-2">${t.date}*</label>
                                <input type="date" id="healthDate" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-300 mb-2">${t.description}*</label>
                            <textarea id="healthDescription" rows="3" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required></textarea>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-4 mb-6">
                            <div>
                                <label class="block text-gray-300 mb-2">${t.veterinarian}</label>
                                <input type="text" id="veterinarian" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                            </div>
                            <div>
                                <label class="block text-gray-300 mb-2">${t.cost} (₺)</label>
                                <input type="number" id="healthCost" step="0.01" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                            </div>
                            <div>
                                <label class="block text-gray-300 mb-2">${t.next_check}</label>
                                <input type="date" id="nextDueDate" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                            </div>
                        </div>
                        
                        <div class="flex gap-4">
                            <button type="submit" class="btn-primary flex-1">
                                <i class="fas fa-save mr-2"></i> ${t.save}
                            </button>
                            <button type="button" onclick="showHealthRecords()" class="flex-1 px-6 py-3 bg-gray-600 rounded-full hover:bg-gray-700 transition">
                                ${t.cancel}
                            </button>
                        </div>
                    </form>
                    </div>
                    </div>
                `;
            } catch (error) {
                console.error('Show add health record error:', error);
                showNotification(error.message || 'Form yüklenemedi', 'error');
                showHealthRecords();
            }
        }

        // Handle Add Health Record - OLD LOCALSTORAGE VERSION (Commented out)
        /*
        function handleAddHealthRecord(event) {
            event.preventDefault();
            
            const newHealthRecord = {
                id: Date.now().toString(),
                pigeonId: document.getElementById('healthPigeonId').value,
                type: document.getElementById('healthType').value,
                date: document.getElementById('healthDate').value,
                description: document.getElementById('healthDescription').value,
                veterinarian: document.getElementById('veterinarian').value || null,
                cost: document.getElementById('healthCost').value || null,
                nextDueDate: document.getElementById('nextDueDate').value || null,
                createdAt: new Date().toISOString()
            };
            
            storage.healthRecords.push(newHealthRecord);
            saveToStorage();
            showNotification(translations[currentLang].success + '!', 'success');
            showHealthRecords();
        }
        */

        // Handle Add Health Record - SUPABASE VERSION
        async function handleAddHealthRecord(event) {
            event.preventDefault();
            
            // Loading göster
            showNotification('Sağlık kaydı ekleniyor...', 'info');
            
            try {
                const healthData = {
                    pigeonId: document.getElementById('healthPigeonId').value,
                    type: document.getElementById('healthType').value,
                    date: document.getElementById('healthDate').value,
                    description: document.getElementById('healthDescription').value,
                    veterinarian: document.getElementById('veterinarian').value || null,
                    cost: document.getElementById('healthCost').value || null,
                    nextDueDate: document.getElementById('nextDueDate').value || null
                };
                
                // Supabase'e sağlık kaydını ekle
                const result = await SupabaseDB.addHealthRecord(healthData);
                
                if (!result.success) {
                    throw new Error(result.error);
                }
                
                showNotification(translations[currentLang].success + '!', 'success');
                showHealthRecords();
            } catch (error) {
                console.error('Add health record error:', error);
                showNotification(error.message || 'Sağlık kaydı eklenemedi', 'error');
            }
        }

        // Delete Health Record - SUPABASE VERSION
        async function deleteHealthRecord(recordId) {
            if (!confirm('Bu sağlık kaydını silmek istediğinizden emin misiniz?')) {
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('health_records')
                    .delete()
                    .eq('id', recordId);
                
                if (error) throw error;
                
                showNotification('Sağlık kaydı silindi', 'success');
                showHealthRecords();
            } catch (error) {
                console.error('Delete health record error:', error);
                showNotification(error.message || 'Sağlık kaydı silinemedi', 'error');
            }
        }

        // Make all navigation functions globally accessible
        window.showHomepage = showHomepage;
        window.showPigeons = showPigeons;
        window.showMatings = showMatings;
        window.showHealthRecords = showHealthRecords;
        window.showPigeonDetail = showPigeonDetail;
        window.showPedigree = showPedigree;
        window.printPedigree = printPedigree;
        window.exportPedigreePDF = exportPedigreePDF;
        window.exportSVGPedigreePDF = exportSVGPedigreePDF;
        window.showAddPigeon = showAddPigeon;
        window.showAddMating = showAddMating;
        window.showAddHealthRecord = showAddHealthRecord;
        window.handleAddPigeon = handleAddPigeon;
        window.handleAddMating = handleAddMating;
        window.handleAddHealthRecord = handleAddHealthRecord;
        window.deleteHealthRecord = deleteHealthRecord;
        window.previewImage = previewImage;
        window.generateQRCode = generateQRCode;
        window.closeQRModal = closeQRModal;
        window.downloadQRCode = downloadQRCode;
        window.exportPigeonPDF = exportPigeonPDF;
        window.exportPedigreePDF = exportPedigreePDF;
        window.exportToExcel = exportToExcel;
        window.printReport = printReport;
        // These are already assigned in the function definitions
        // window.changeLanguage = changeLanguage;
        // window.toggleMobileMenu = toggleMobileMenu;
        // window.openAuthModal = openAuthModal;
        // window.closeAuthModal = closeAuthModal;
        window.closePigeonModal = closePigeonModal;
        window.showPigeonDetail = showPigeonDetail;
        window.showPedigree = showPedigree;
        window.showEditPigeon = showEditPigeon;
        window.previewImageEdit = previewImageEdit;
        window.handleEditPigeon = handleEditPigeon;
        window.deletePigeon = deletePigeon;
        window.renderModernPedigree = renderModernPedigree;
        window.renderPigeonNode = renderPigeonNode;
        window.drawConnectionLines = drawConnectionLines;
        window.drawLine = drawLine;
        window.printPedigree = printPedigree;
        window.cleanupPreviousViews = cleanupPreviousViews;
        window.logout = logout;
        window.updateNavigation = updateNavigation;
        
        // Performans fonksiyonları
        window.showAddPerformance = showAddPerformance;
        window.showPerformanceFields = showPerformanceFields;
        window.showPerformanceRecords = showPerformanceRecords;
        window.handleAddPerformance = handleAddPerformance;
        window.calculatePerformanceByType = calculatePerformanceByType;
        window.calculateTumblingScore = calculateTumblingScore;
        window.calculatePostalScore = calculatePostalScore;
        window.calculateButterflyScore = calculateButterflyScore;
        window.calculateRacingScore = calculateRacingScore;
        
        // Performans analiz fonksiyonları
        async function showPerformanceAnalysis(pigeonId) {
            const contentDiv = document.getElementById('content');
            contentDiv.innerHTML = '<div class="text-center py-20"><i class="fas fa-spinner fa-spin text-4xl text-cyan-400"></i></div>';
            
            try {
                // Placeholder for performance analysis functionality
                contentDiv.innerHTML = `
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        <h2 class="text-3xl font-bold mb-6">${translations[currentLang].performance_analysis || 'Performans Analizi'}</h2>
                        <p class="text-gray-300">Bu özellik yakında eklenecek.</p>
                    </div>
                `;
            } catch (error) {
                console.error('Performance analysis error:', error);
                showError(translations[currentLang].error_loading || 'Yüklenirken hata oluştu');
            }
        }
        
        async function showTrendAnalysis() {
            console.log('Trend analysis placeholder');
        }
        
        function updateTrendChart() {
            console.log('Update trend chart placeholder');
        }
        
        async function showComparativeAnalysis() {
            console.log('Comparative analysis placeholder');
        }
        
        function updateComparisonChart() {
            console.log('Update comparison chart placeholder');
        }
        
        async function showDetailedStatistics() {
            console.log('Detailed statistics placeholder');
        }
        
        function updateStatistics() {
            console.log('Update statistics placeholder');
        }
        
        function calculateDetailedStats() {
            console.log('Calculate detailed stats placeholder');
        }
        
        async function showPerformanceReporting() {
            console.log('Performance reporting placeholder');
        }
        
        async function generatePDFReport() {
            console.log('Generate PDF report placeholder');
        }
        
        async function generateExcelReport() {
            console.log('Generate Excel report placeholder');
        }
        
        window.showPerformanceAnalysis = showPerformanceAnalysis;
        window.showTrendAnalysis = showTrendAnalysis;
        window.updateTrendChart = updateTrendChart;
        window.showComparativeAnalysis = showComparativeAnalysis;
        window.updateComparisonChart = updateComparisonChart;
        window.showDetailedStatistics = showDetailedStatistics;
        window.updateStatistics = updateStatistics;
        window.calculateDetailedStats = calculateDetailedStats;
        window.showPerformanceReporting = showPerformanceReporting;
        window.generatePDFReport = generatePDFReport;
        window.generateExcelReport = generateExcelReport;
        window.prepareReportData = prepareReportData;

        // Show Add Mating Form - SUPABASE VERSION
        async function showAddMating() {
            // Loading göster
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                    <div class="glass p-8 rounded-3xl text-center">
                        <i class="fas fa-spinner fa-spin text-4xl text-cyan-400 mb-4"></i>
                        <p class="text-xl">Form hazırlanıyor...</p>
                    </div>
                </div>
            `;
            
            try {
                // Güvercinleri getir
                const pigeonsResult = await SupabaseDB.getPigeons(storage.currentUser.id);
                if (!pigeonsResult.success) {
                    throw new Error('Güvercin listesi yüklenemedi');
                }
                
                const userPigeons = pigeonsResult.data || [];
                const males = userPigeons.filter(p => p.gender === 'male');
                const females = userPigeons.filter(p => p.gender === 'female');
                const t = translations[currentLang];
                
                document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                <div class="glass p-8 rounded-3xl">`
                +
                `
                <h2 class="text-3xl font-bold mb-8">${t.new_mating}</h2>
                
                <form onsubmit="handleAddMating(event)" class="max-w-2xl mx-auto">
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-300 mb-2">${t.male_pigeon}*</label>
                            <select id="maleId" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                                <option value="">${t.select}</option>
                                ${males.map(p => `<option value="${p.id}">${p.name} - ${p.band_number}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-300 mb-2">${t.female_pigeon}*</label>
                            <select id="femaleId" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                                <option value="">${t.select}</option>
                                ${females.map(p => `<option value="${p.id}">${p.name} - ${p.band_number}</option>`).join('')}
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-300 mb-2">${t.mating_date}*</label>
                        <input type="date" id="matingDate" onchange="updateDates()" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-300 mb-2">
                                ${t.egg_laying_date}
                                <span class="text-xs text-gray-500">(Otomatik: +7 gün)</span>
                            </label>
                            <input type="date" id="eggLayingDate" onchange="updateHatchDate()" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                        </div>
                        <div>
                            <label class="block text-gray-300 mb-2">
                                ${t.expected_hatch}
                                <span class="text-xs text-gray-500">(Otomatik: +18 gün)</span>
                            </label>
                            <input type="date" id="expectedHatchDate" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="flex items-center">
                            <input type="checkbox" id="hatched" class="mr-3 w-4 h-4 text-cyan-600 bg-black/50 border-gray-600 rounded focus:ring-cyan-500">
                            <span class="text-gray-300">${t.hatched}</span>
                        </label>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-300 mb-2">${t.notes}</label>
                        <textarea id="matingNotes" rows="3" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none"></textarea>
                    </div>
                    
                    <div class="flex gap-4">
                        <button type="submit" class="btn-primary flex-1">
                            <i class="fas fa-save mr-2"></i> ${t.save}
                        </button>
                        <button type="button" onclick="showMatings()" class="flex-1 px-6 py-3 bg-gray-600 rounded-full hover:bg-gray-700 transition">
                            ${t.cancel}
                        </button>
                    </div>
                </form>
                </div>
                </div>
            `;
            } catch (error) {
                console.error('Form yükleme hatası:', error);
                showNotification(error.message || 'Form yüklenemedi', 'error');
                showMatings();
            }
        }

        // Date calculation functions
        function calculateEggLayingDate(matingDate) {
            const date = new Date(matingDate);
            date.setDate(date.getDate() + 7);
            return date.toISOString().split('T')[0];
        }

        function calculateHatchDate(eggLayingDate) {
            const date = new Date(eggLayingDate);
            date.setDate(date.getDate() + 18);
            return date.toISOString().split('T')[0];
        }

        function updateDates() {
            const matingDate = document.getElementById('matingDate').value;
            if (matingDate) {
                const eggLayingDate = calculateEggLayingDate(matingDate);
                document.getElementById('eggLayingDate').value = eggLayingDate;
                updateHatchDate();
            }
        }

        function updateHatchDate() {
            const eggLayingDate = document.getElementById('eggLayingDate').value;
            if (eggLayingDate) {
                const hatchDate = calculateHatchDate(eggLayingDate);
                document.getElementById('expectedHatchDate').value = hatchDate;
            }
        }

        // Handle Add Mating - SUPABASE VERSION
        async function handleAddMating(event) {
            event.preventDefault();
            
            // Loading göster
            showNotification('Eşleştirme ekleniyor...', 'info');
            
            try {
                // Form verilerini topla
                const matingData = {
                    maleId: document.getElementById('maleId').value,
                    femaleId: document.getElementById('femaleId').value,
                    matingDate: document.getElementById('matingDate').value,
                    eggLayingDate: document.getElementById('eggLayingDate').value || null,
                    expectedHatchDate: document.getElementById('expectedHatchDate').value || null,
                    hatched: document.getElementById('hatched').checked,
                    notes: document.getElementById('matingNotes').value
                };
                
                // Supabase'e eşleştirmeyi ekle
                const result = await SupabaseDB.addMating(matingData);
                
                if (!result.success) {
                    throw new Error(result.error);
                }
                
                showNotification(translations[currentLang].success + '!', 'success');
                showMatings();
                
            } catch (error) {
                console.error('Eşleştirme ekleme hatası:', error);
                showNotification(error.message || 'Eşleştirme eklenemedi', 'error');
            }
        }

        // Edit Mating - SUPABASE VERSION
        async function editMating(matingId) {
            // Loading göster
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                    <div class="glass p-8 rounded-3xl text-center">
                        <i class="fas fa-spinner fa-spin text-4xl text-cyan-400 mb-4"></i>
                        <p class="text-xl">Eşleştirme bilgileri yükleniyor...</p>
                    </div>
                </div>
            `;
            
            try {
                // Eşleştirme bilgilerini getir
                const matingResult = await SupabaseDB.getMating(matingId);
                if (!matingResult.success || !matingResult.data) {
                    throw new Error('Eşleştirme bulunamadı');
                }
                
                const mating = matingResult.data;
                
                // Güvercinleri getir
                const pigeonsResult = await SupabaseDB.getPigeons(storage.currentUser.id);
                if (!pigeonsResult.success) {
                    throw new Error('Güvercin listesi yüklenemedi');
                }
                
                const userPigeons = pigeonsResult.data || [];
                const males = userPigeons.filter(p => p.gender === 'male');
                const females = userPigeons.filter(p => p.gender === 'female');
                const t = translations[currentLang];
                
                document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                <div class="glass p-8 rounded-3xl">
                <h2 class="text-3xl font-bold mb-8">Kuluçka Kaydını Düzenle</h2>
                
                <form onsubmit="handleEditMating(event, '${matingId}')" class="max-w-2xl mx-auto">
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-300 mb-2">${t.male_pigeon}*</label>
                            <select id="maleIdEdit" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                                <option value="">${t.select}</option>
                                ${males.map(p => `<option value="${p.id}" ${p.id === mating.male_id ? 'selected' : ''}>${p.name} - ${p.band_number}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-300 mb-2">${t.female_pigeon}*</label>
                            <select id="femaleIdEdit" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                                <option value="">${t.select}</option>
                                ${females.map(p => `<option value="${p.id}" ${p.id === mating.female_id ? 'selected' : ''}>${p.name} - ${p.band_number}</option>`).join('')}
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-300 mb-2">${t.mating_date}*</label>
                        <input type="date" id="matingDateEdit" value="${mating.mating_date}" onchange="updateDatesEdit()" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-300 mb-2">
                                ${t.egg_laying_date}
                                <span class="text-xs text-gray-500">(Otomatik: +7 gün)</span>
                            </label>
                            <input type="date" id="eggLayingDateEdit" value="${mating.egg_laying_date || ''}" onchange="updateHatchDateEdit()" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                        </div>
                        <div>
                            <label class="block text-gray-300 mb-2">
                                ${t.expected_hatch}
                                <span class="text-xs text-gray-500">(Otomatik: +18 gün)</span>
                            </label>
                            <input type="date" id="expectedHatchDateEdit" value="${mating.expected_hatch_date || ''}" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="flex items-center">
                            <input type="checkbox" id="hatchedEdit" ${mating.hatched ? 'checked' : ''} class="mr-3 w-4 h-4 text-cyan-600 bg-black/50 border-gray-600 rounded focus:ring-cyan-500">
                            <span class="text-gray-300">${t.hatched}</span>
                        </label>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-300 mb-2">${t.notes}</label>
                        <textarea id="matingNotesEdit" rows="3" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">${mating.notes || ''}</textarea>
                    </div>
                    
                    <div class="flex gap-4">
                        <button type="submit" class="btn-primary flex-1">
                            <i class="fas fa-save mr-2"></i> ${t.save}
                        </button>
                        <button type="button" onclick="showMatings()" class="flex-1 px-6 py-3 bg-gray-600 rounded-full hover:bg-gray-700 transition">
                            ${t.cancel}
                        </button>
                    </div>
                </form>
                </div>
                </div>
            `;
            } catch (error) {
                console.error('Eşleştirme yükleme hatası:', error);
                showNotification(error.message || 'Eşleştirme bilgileri yüklenemedi', 'error');
                showMatings();
            }
        }

        // Handle Edit Mating - SUPABASE VERSION
        async function handleEditMating(event, matingId) {
            event.preventDefault();
            
            // Loading göster
            showNotification('Eşleştirme güncelleniyor...', 'info');
            
            try {
                // Form verilerini topla
                const updateData = {
                    maleId: document.getElementById('maleIdEdit').value,
                    femaleId: document.getElementById('femaleIdEdit').value,
                    matingDate: document.getElementById('matingDateEdit').value,
                    eggLayingDate: document.getElementById('eggLayingDateEdit').value || null,
                    expectedHatchDate: document.getElementById('expectedHatchDateEdit').value || null,
                    hatched: document.getElementById('hatchedEdit').checked,
                    notes: document.getElementById('matingNotesEdit').value
                };
                
                // Supabase'de güncelle
                const result = await SupabaseDB.updateMating(matingId, updateData);
                
                if (!result.success) {
                    throw new Error(result.error);
                }
                
                showNotification('Kuluçka kaydı güncellendi!', 'success');
                showMatings();
                
            } catch (error) {
                console.error('Eşleştirme güncelleme hatası:', error);
                showNotification(error.message || 'Eşleştirme güncellenemedi', 'error');
            }
        }

        // Delete Mating - SUPABASE VERSION
        async function deleteMating(matingId) {
            if (confirm('Bu kuluçka kaydını silmek istediğinizden emin misiniz?')) {
                showNotification('Kuluçka kaydı siliniyor...', 'info');
                
                try {
                    const result = await SupabaseDB.deleteMating(matingId);
                    
                    if (!result.success) {
                        throw new Error(result.error);
                    }
                    
                    showNotification('Kuluçka kaydı silindi!', 'success');
                    showMatings();
                    
                } catch (error) {
                    console.error('Eşleştirme silme hatası:', error);
                    showNotification(error.message || 'Eşleştirme silinemedi', 'error');
                }
            }
        }

        // Date calculation functions for edit form
        function updateDatesEdit() {
            const matingDate = document.getElementById('matingDateEdit').value;
            if (matingDate) {
                const eggLayingDate = calculateEggLayingDate(matingDate);
                document.getElementById('eggLayingDateEdit').value = eggLayingDate;
                updateHatchDateEdit();
            }
        }

        function updateHatchDateEdit() {
            const eggLayingDate = document.getElementById('eggLayingDateEdit').value;
            if (eggLayingDate) {
                const hatchDate = calculateHatchDate(eggLayingDate);
                document.getElementById('expectedHatchDateEdit').value = hatchDate;
            }
        }

        // Show Add Race Form
        // Performans kayıtları listesi
        // Show Performance Records - OLD LOCALSTORAGE VERSION (Commented out)
        /*
        function showPerformanceRecords() {
            if (!checkAuth()) return;
            cleanupPreviousViews();
            updateActiveTab(6);
            
            const userPigeons = storage.pigeons.filter(p => p.userId === storage.currentUser.id);
            const userPerformanceRecords = storage.performanceRecords
                .filter(r => userPigeons.some(p => p.id === r.pigeonId))
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            const t = translations[currentLang];
            
            // Dashboard istatistiklerini hesapla
            const totalRecords = userPerformanceRecords.length;
            const averageScore = totalRecords > 0 ? userPerformanceRecords.reduce((sum, r) => sum + (r.overallScore || 0), 0) / totalRecords : 0;
            const thisMonthRecords = userPerformanceRecords.filter(r => {
                const recordMonth = new Date(r.date).getMonth();
                const currentMonth = new Date().getMonth();
                return recordMonth === currentMonth;
            }).length;
            const maxScore = totalRecords > 0 ? Math.max(...userPerformanceRecords.map(r => r.overallScore || 0)) : 0;
            
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                    <div class="glass p-8 rounded-3xl">
                        <div class="flex justify-between items-center mb-8">
                            <div>
                                <h2 class="text-3xl font-bold">${t.nav_performance || 'Performanslar'}</h2>
                                <p class="text-gray-400 mt-1">Güvercinlerinizin performansını analiz edin ve karşılaştırın</p>
                            </div>
                            <button onclick="showAddPerformance()" class="btn-primary">
                                <i class="fas fa-plus mr-2"></i> ${t.add_performance_record || 'Performans Kaydı Ekle'}
                            </button>
                        </div>
                        <!-- Dashboard İstatistik Kartı -->
                        <div class="mb-8">
                            <!-- Toplam Kayıt -->
                            <div class="group relative overflow-hidden bg-gradient-to-br from-blue-500/10 via-cyan-500/5 to-blue-600/10 backdrop-blur-sm border border-blue-500/20 rounded-2xl p-6 hover:border-blue-400/40 transition-all duration-300 max-w-sm">
                                <div class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-br from-blue-400/20 to-cyan-500/20 rounded-full blur-xl transform translate-x-8 -translate-y-8"></div>
                                <div class="relative z-10">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="p-3 bg-blue-500/20 rounded-lg">
                                            <i class="fas fa-chart-bar text-blue-400 text-xl"></i>
                                        </div>
                                        <span class="text-sm text-blue-300 font-medium">Toplam</span>
                                    </div>
                                    <div class="text-3xl font-bold text-blue-100 mb-1">${totalRecords}</div>
                                    <div class="text-sm text-blue-300/80">Performans Kaydı</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ana İçerik - Enhanced Responsive Grid -->
                        <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 lg:gap-8">
                            <!-- Sol: Modern Performans Listesi -->
                            <div class="xl:col-span-2">
                                <div class="relative overflow-hidden bg-gradient-to-br from-slate-800/50 via-slate-900/30 to-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-3xl p-6 lg:p-8 hover:border-slate-600/60 transition-all duration-500">
                                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500"></div>
                                    
                                    <div class="flex items-center justify-between mb-6">
                                        <h3 class="text-xl lg:text-2xl font-bold bg-gradient-to-r from-slate-100 to-slate-300 bg-clip-text text-transparent flex items-center">
                                            <i class="fas fa-list-alt mr-3 text-cyan-400"></i>
                                            ${t.nav_performance || 'Performanslar'} Kayıtları
                                        </h3>
                                        <span class="px-3 py-1 bg-cyan-500/20 text-cyan-300 rounded-full text-sm font-medium">
                                            ${totalRecords} kayıt
                                        </span>
                                    </div>
                                    
                                    <div id="performanceList" class="space-y-4 max-h-[500px] lg:max-h-[600px] overflow-y-auto custom-scrollbar">
                                        ${renderPerformanceList(userPerformanceRecords, userPigeons, t)}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Sağ: Enhanced Karşılaştırma Paneli -->
                            <div class="xl:col-span-1">
                                <div class="relative overflow-hidden bg-gradient-to-br from-slate-800/50 via-slate-900/30 to-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-3xl p-6 lg:p-8 hover:border-slate-600/60 transition-all duration-500">
                                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-purple-500 via-pink-500 to-red-500"></div>
                                    
                                    <h3 class="text-xl lg:text-2xl font-bold bg-gradient-to-r from-slate-100 to-slate-300 bg-clip-text text-transparent flex items-center mb-6">
                                        <i class="fas fa-balance-scale mr-3 text-purple-400"></i>
                                        Detaylı Karşılaştırma
                                    </h3>
                                    
                                    <!-- Enhanced Güvercin Seçimi -->
                                    <div class="space-y-4 mb-6">
                                        <div class="relative group">
                                            <select id="pigeon1" class="w-full bg-slate-800/50 backdrop-blur-sm border border-slate-600/50 rounded-xl px-4 py-3 text-slate-100 focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 outline-none transition-all duration-300 group-hover:border-slate-500">
                                                <option value="" class="bg-slate-800">1. Güvercin Seçin</option>
                                                ${userPigeons.map(p => `<option value="${p.id}" class="bg-slate-800">${p.name} (${p.bandNumber})</option>`).join('')}
                                            </select>
                                            <div class="absolute inset-0 bg-gradient-to-r from-cyan-500/10 to-purple-500/10 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"></div>
                                        </div>
                                        
                                        <div class="relative group">
                                            <select id="pigeon2" class="w-full bg-slate-800/50 backdrop-blur-sm border border-slate-600/50 rounded-xl px-4 py-3 text-slate-100 focus:border-purple-400 focus:ring-2 focus:ring-purple-400/20 outline-none transition-all duration-300 group-hover:border-slate-500">
                                                <option value="" class="bg-slate-800">2. Güvercin Seçin</option>
                                                ${userPigeons.map(p => `<option value="${p.id}" class="bg-slate-800">${p.name} (${p.bandNumber})</option>`).join('')}
                                            </select>
                                            <div class="absolute inset-0 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"></div>
                                        </div>
                                        
                                        <button onclick="generateDetailedComparison()" class="w-full group relative overflow-hidden bg-gradient-to-r from-cyan-500 to-purple-600 hover:from-cyan-600 hover:to-purple-700 text-white px-6 py-4 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-purple-500/25">
                                            <span class="relative z-10 flex items-center justify-center">
                                                <i class="fas fa-chart-line mr-2"></i>
                                                Detaylı Karşılaştır
                                            </span>
                                            <div class="absolute inset-0 bg-gradient-to-r from-purple-600 to-cyan-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                                        </button>
                                    </div>
                                    
                                    <!-- Enhanced Karşılaştırma Sonuçları -->
                                    <div id="detailedComparisonResult" class="space-y-4">
                                        <div class="text-center text-slate-400 py-12">
                                            <div class="relative mb-4">
                                                <i class="fas fa-chart-bar text-6xl opacity-20"></i>
                                                <div class="absolute inset-0 bg-gradient-to-r from-cyan-500/20 to-purple-500/20 rounded-full blur-xl"></div>
                                            </div>
                                            <p class="text-sm lg:text-base">İki güvercin seçin ve<br>detaylı karşılaştırmaya başlayın</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Enhanced Hızlı Analiz Butonları -->
                                    <div class="mt-8 pt-6 border-t border-slate-700/50">
                                        <h4 class="font-semibold mb-4 text-slate-300 flex items-center">
                                            <i class="fas fa-bolt mr-2 text-yellow-400"></i>
                                            Hızlı Analiz
                                        </h4>
                                        <div class="space-y-3">
                                            <button onclick="showTopPerformers()" class="w-full group relative overflow-hidden bg-gradient-to-r from-emerald-500/10 to-green-500/10 hover:from-emerald-500/20 hover:to-green-500/20 border border-emerald-500/20 hover:border-emerald-400/40 text-emerald-300 px-4 py-3 rounded-xl transition-all duration-300 transform hover:scale-105">
                                                <span class="relative z-10 flex items-center justify-center text-sm font-medium">
                                                    <i class="fas fa-trophy mr-2"></i>
                                                    En İyi Performanslar
                                                </span>
                                            </button>
                                            
                                            <button onclick="showPerformanceTrends()" class="w-full group relative overflow-hidden bg-gradient-to-r from-blue-500/10 to-cyan-500/10 hover:from-blue-500/20 hover:to-cyan-500/20 border border-blue-500/20 hover:border-blue-400/40 text-blue-300 px-4 py-3 rounded-xl transition-all duration-300 transform hover:scale-105">
                                                <span class="relative z-10 flex items-center justify-center text-sm font-medium">
                                                    <i class="fas fa-trending-up mr-2"></i>
                                                    Performans Trendleri
                                                </span>
                                            </button>
                                            
                                            <button onclick="showBreedAnalysis()" class="w-full group relative overflow-hidden bg-gradient-to-r from-purple-500/10 to-pink-500/10 hover:from-purple-500/20 hover:to-pink-500/20 border border-purple-500/20 hover:border-purple-400/40 text-purple-300 px-4 py-3 rounded-xl transition-all duration-300 transform hover:scale-105">
                                                <span class="relative z-10 flex items-center justify-center text-sm font-medium">
                                                    <i class="fas fa-dna mr-2"></i>
                                                    Irk Analizi
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                
                <!-- Custom CSS for enhanced styling -->
                <style>
                    .custom-scrollbar::-webkit-scrollbar {
                        width: 6px;
                    }
                    .custom-scrollbar::-webkit-scrollbar-track {
                        background: rgba(51, 65, 85, 0.3);
                        border-radius: 10px;
                    }
                    .custom-scrollbar::-webkit-scrollbar-thumb {
                        background: linear-gradient(to bottom, #06b6d4, #8b5cf6);
                        border-radius: 10px;
                    }
                    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                        background: linear-gradient(to bottom, #0891b2, #7c3aed);
                    }
                </style>
            `;
        }
        
        // Detaylı karşılaştırma fonksiyonu
        function generateDetailedComparison() {
            const pigeon1Id = document.getElementById('pigeon1').value;
            const pigeon2Id = document.getElementById('pigeon2').value;
            
            if (!pigeon1Id || !pigeon2Id) {
                showNotification('Lütfen iki güvercin seçin', 'warning');
                return;
            }
            
            if (pigeon1Id === pigeon2Id) {
                showNotification('Farklı güvercinler seçin', 'warning');
                return;
            }
            
            const pigeon1 = storage.pigeons.find(p => p.id === pigeon1Id);
            const pigeon2 = storage.pigeons.find(p => p.id === pigeon2Id);
            
            if (!pigeon1 || !pigeon2) {
                showNotification('Güvercinler bulunamadı', 'error');
                return;
            }
            
            const comparison = compareDetailedPigeonPerformance(pigeon1, pigeon2);
            displayDetailedComparison(comparison, pigeon1, pigeon2);
        }
        
        // Performans listesi render fonksiyonu
        function renderPerformanceList(records, pigeons, t) {
            if (records.length === 0) {
                return `<p class="text-gray-400 text-center py-8">${t.no_performance || 'Henüz performans kaydı bulunmuyor'}</p>`;
            }
            
            return records.map(record => {
                const pigeon = pigeons.find(p => p.id === record.pigeonId);
                if (!pigeon) return '';
                
                let detailText = '';
                let icon = '';
                let color = '';
                let score = 0;
                
                switch(record.performanceType) {
                    case 'tumbling':
                        detailText = `${record.tumbleCount || 0} takla/${record.sessionCount || 0} sefer, ${record.flightDuration || 0} dk uçuş`;
                        icon = 'fa-dove';
                        color = 'text-cyan-400';
                        score = calculateTumblingScore(record.pigeonId);
                        break;
                    case 'postal':
                        detailText = `${record.flightSpeed || 0} km/h, ${record.flightDistance || 0} km, ${record.navigationAccuracy || 0}/10 navigasyon`;
                        icon = 'fa-paper-plane';
                        color = 'text-blue-400';
                        score = calculatePostalScore(record.pigeonId);
                        break;
                    case 'butterfly':
                        detailText = `Bonkörlük: ${record.bonkorluk || 0}/10, Uçuş: ${record.flightTimeDistance || 0} dk`;
                        icon = 'fa-butterfly';
                        color = 'text-yellow-400';
                        score = calculateButterflyScore(record.pigeonId);
                        break;
                    case 'racing':
                        detailText = 'Yarış performansı';
                        icon = 'fa-flag-checkered';
                        color = 'text-red-400';
                        score = calculateRacingScore(record.pigeonId);
                        break;
                }
                
                return `
                    <div class="glass p-4 rounded-2xl hover:scale-[1.02] transition-transform">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                ${pigeon.image ? `
                                    <img src="${pigeon.image}" alt="${pigeon.name}" class="w-12 h-12 rounded-full object-cover">
                                ` : `
                                    <div class="bg-gradient-to-r from-cyan-400 to-purple-400 w-12 h-12 rounded-full flex items-center justify-center">
                                        <i class="fas ${icon} ${color}"></i>
                                    </div>
                                `}
                                <div>
                                    <div class="flex items-center gap-2">
                                        <h4 class="font-bold">${pigeon.name}</h4>
                                        <span class="text-xs px-2 py-1 bg-black/30 rounded-full">${t[pigeon.breed] || pigeon.breed}</span>
                                    </div>
                                    <p class="text-xs text-gray-400">${t[record.performanceType + '_performance'] || 'Performans'}</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <div class="text-center">
                                    <div class="text-2xl font-bold ${color}">${score}</div>
                                    <div class="text-xs text-gray-400">Skor</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-sm">${record.weatherConditions === 'sunny' ? '☀️' : record.weatherConditions === 'rainy' ? '🌧️' : record.weatherConditions === 'cloudy' ? '☁️' : '💨'}</div>
                                    <div class="text-xs text-gray-400">${formatDate(record.date)}</div>
                                </div>
                                <div class="flex gap-1">
                                    <button onclick="deletePerformance('${record.id}')" class="p-2 bg-black/30 rounded-lg hover:bg-red-500/30 transition" title="Sil">
                                        <i class="fas fa-trash text-sm"></i>
                                    </button>
                                    <button onclick="addToComparison('${record.pigeonId}')" class="p-2 bg-black/30 rounded-lg hover:bg-black/50 transition" title="Karşılaştır">
                                        <i class="fas fa-balance-scale text-sm"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 pt-3 border-t border-gray-700">
                            <p class="text-sm text-gray-300">${detailText}</p>
                            ${record.notes ? `<p class="text-xs text-gray-400 mt-1">${record.notes}</p>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Güvercin karşılaştırma fonksiyonu
        function comparePigeons() {
            const pigeon1Id = document.getElementById('pigeon1').value;
            const pigeon2Id = document.getElementById('pigeon2').value;
            
            if (!pigeon1Id || !pigeon2Id) {
                showNotification('Lütfen karşılaştırmak için iki güvercin seçin', 'error');
                return;
            }
            
            if (pigeon1Id === pigeon2Id) {
                showNotification('Aynı güvercini karşılaştıramazsınız', 'error');
                return;
            }
            
            const pigeon1 = storage.pigeons.find(p => p.id === pigeon1Id);
            const pigeon2 = storage.pigeons.find(p => p.id === pigeon2Id);
            
            if (!pigeon1 || !pigeon2) return;
            
            // Performans skorlarını hesapla
            const types = ['tumbling', 'postal', 'butterfly', 'racing'];
            const scores1 = {};
            const scores2 = {};
            
            types.forEach(type => {
                scores1[type] = calculatePerformanceByType(pigeon1Id, type);
                scores2[type] = calculatePerformanceByType(pigeon2Id, type);
            });
            
            const t = translations[currentLang];
            
            document.getElementById('comparisonResult').innerHTML = `
                <div class="space-y-3">
                    <div class="text-center">
                        <div class="flex justify-around items-center mb-3">
                            <div class="text-center">
                                ${pigeon1.image ? `<img src="${pigeon1.image}" class="w-16 h-16 rounded-full mx-auto mb-1">` : '<i class="fas fa-dove text-3xl"></i>'}
                                <h5 class="font-bold">${pigeon1.name}</h5>
                            </div>
                            <div class="text-2xl">VS</div>
                            <div class="text-center">
                                ${pigeon2.image ? `<img src="${pigeon2.image}" class="w-16 h-16 rounded-full mx-auto mb-1">` : '<i class="fas fa-dove text-3xl"></i>'}
                                <h5 class="font-bold">${pigeon2.name}</h5>
                            </div>
                        </div>
                    </div>
                    
                    ${types.map(type => {
                        const score1 = scores1[type];
                        const score2 = scores2[type];
                        const diff = score1 - score2;
                        const winner = diff > 0 ? 1 : diff < 0 ? 2 : 0;
                        
                        return `
                            <div class="flex items-center justify-between p-3 bg-black/30 rounded-lg">
                                <div class="flex-1 text-center ${winner === 1 ? 'text-green-400' : ''}">${score1}</div>
                                <div class="flex-1 text-center">
                                    <span class="text-xs text-gray-400">${t[type + '_performance'] || type}</span>
                                </div>
                                <div class="flex-1 text-center ${winner === 2 ? 'text-green-400' : ''}">${score2}</div>
                            </div>
                        `;
                    }).join('')}
                    
                    <div class="text-center mt-4">
                        <button onclick="showDetailedComparison('${pigeon1Id}', '${pigeon2Id}')" class="btn-secondary text-sm">
                            <i class="fas fa-chart-radar mr-1"></i> Detaylı Karşılaştırma
                        </button>
                    </div>
                </div>
            `;
        }
        */
        
        // Yeni Supabase versiyonu - Show Performance Records
        async function showPerformanceRecords() {
            if (!checkAuth()) return;
            cleanupPreviousViews();
            updateActiveTab(5);
            
            const t = translations[currentLang];
            
            // Loading göster
            document.getElementById('content').innerHTML = `
                <div class="text-center py-20">
                    <i class="fas fa-spinner fa-spin text-4xl text-cyan-400"></i>
                    <p class="mt-4">${t.loading || 'Yükleniyor...'}</p>
                </div>
            `;
            
            try {
                // Önce kullanıcının güvercinlerini al
                const pigeonsResult = await SupabaseDB.getPigeons(storage.currentUser.id);
                if (!pigeonsResult.success) {
                    throw new Error(pigeonsResult.error);
                }
                
                const userPigeons = pigeonsResult.data || [];
                const pigeonIds = userPigeons.map(p => p.id);
                
                // Tüm performans kayıtlarını getir
                let allPerformanceRecords = [];
                for (const pigeonId of pigeonIds) {
                    const performanceResult = await SupabaseDB.getPerformanceRecords(pigeonId);
                    if (performanceResult.success && performanceResult.data) {
                        allPerformanceRecords = allPerformanceRecords.concat(performanceResult.data);
                    }
                }
                
                // Tarihe göre sırala
                const userPerformanceRecords = allPerformanceRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Dashboard istatistiklerini hesapla
                const totalRecords = userPerformanceRecords.length;
                const averageScore = totalRecords > 0 ? userPerformanceRecords.reduce((sum, r) => sum + (r.overall_score || 0), 0) / totalRecords : 0;
                const thisMonthRecords = userPerformanceRecords.filter(r => {
                    const recordMonth = new Date(r.date).getMonth();
                    const currentMonth = new Date().getMonth();
                    return recordMonth === currentMonth;
                }).length;
                const maxScore = totalRecords > 0 ? Math.max(...userPerformanceRecords.map(r => r.overall_score || 0)) : 0;
                
                // UI'yi oluştur
                document.getElementById('content').innerHTML = `
                    <div class="container mx-auto">
                        <div class="glass p-8 rounded-3xl">
                            <div class="flex justify-between items-center mb-8">
                                <div>
                                    <h2 class="text-3xl font-bold">${t.nav_performance || 'Performanslar'}</h2>
                                    <p class="text-gray-400 mt-1">${t.performance_description || 'Güvercinlerinizin performansını analiz edin ve karşılaştırın'}</p>
                                </div>
                                <button onclick="showAddPerformance()" class="btn-primary">
                                    <i class="fas fa-plus mr-2"></i> ${t.add_performance_record || 'Performans Kaydı Ekle'}
                                </button>
                            </div>
                            
                            ${userPerformanceRecords.length === 0 ? `
                                <div class="text-center py-12">
                                    <i class="fas fa-chart-line text-6xl text-gray-600 mb-4"></i>
                                    <p class="text-gray-400">${t.no_performance || 'Henüz performans kaydı bulunmuyor'}</p>
                                </div>
                            ` : `
                                <!-- İstatistik Kartları -->
                                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                                    <div class="bg-gradient-to-br from-blue-500/10 to-blue-600/10 backdrop-blur-sm border border-blue-500/20 rounded-2xl p-6">
                                        <div class="flex items-center justify-between mb-2">
                                            <i class="fas fa-chart-bar text-blue-400 text-xl"></i>
                                            <span class="text-sm text-blue-300">${t.total || 'Toplam'}</span>
                                        </div>
                                        <div class="text-2xl font-bold text-blue-100">${totalRecords}</div>
                                        <div class="text-sm text-blue-300/80">${t.performance_record || 'Performans Kaydı'}</div>
                                    </div>
                                    
                                    <div class="bg-gradient-to-br from-green-500/10 to-green-600/10 backdrop-blur-sm border border-green-500/20 rounded-2xl p-6">
                                        <div class="flex items-center justify-between mb-2">
                                            <i class="fas fa-chart-line text-green-400 text-xl"></i>
                                            <span class="text-sm text-green-300">${t.average || 'Ortalama'}</span>
                                        </div>
                                        <div class="text-2xl font-bold text-green-100">${averageScore.toFixed(1)}</div>
                                        <div class="text-sm text-green-300/80">${t.performance_score || 'Performans Skoru'}</div>
                                    </div>
                                    
                                    <div class="bg-gradient-to-br from-purple-500/10 to-purple-600/10 backdrop-blur-sm border border-purple-500/20 rounded-2xl p-6">
                                        <div class="flex items-center justify-between mb-2">
                                            <i class="fas fa-calendar-alt text-purple-400 text-xl"></i>
                                            <span class="text-sm text-purple-300">${t.this_month || 'Bu Ay'}</span>
                                        </div>
                                        <div class="text-2xl font-bold text-purple-100">${thisMonthRecords}</div>
                                        <div class="text-sm text-purple-300/80">${t.new_records || 'Yeni Kayıt'}</div>
                                    </div>
                                    
                                    <div class="bg-gradient-to-br from-yellow-500/10 to-yellow-600/10 backdrop-blur-sm border border-yellow-500/20 rounded-2xl p-6">
                                        <div class="flex items-center justify-between mb-2">
                                            <i class="fas fa-trophy text-yellow-400 text-xl"></i>
                                            <span class="text-sm text-yellow-300">${t.best || 'En İyi'}</span>
                                        </div>
                                        <div class="text-2xl font-bold text-yellow-100">${maxScore.toFixed(1)}</div>
                                        <div class="text-sm text-yellow-300/80">${t.max_score || 'Maksimum Skor'}</div>
                                    </div>
                                </div>
                                
                                <!-- Performans Listesi -->
                                <div class="space-y-4">
                                    ${userPerformanceRecords.map(record => {
                                        const pigeon = record.pigeon || { name: 'Bilinmeyen', band_number: '-' };
                                        const performanceData = record.performance_data || {};
                                        const typeLabel = t[record.performance_type + '_performance'] || record.performance_type;
                                        
                                        return `
                                            <div class="glass p-6 rounded-2xl hover:bg-white/5 transition-all">
                                                <div class="flex justify-between items-start">
                                                    <div>
                                                        <h4 class="text-xl font-bold mb-1">${pigeon.name} - ${pigeon.band_number}</h4>
                                                        <p class="text-gray-400 text-sm mb-2">${typeLabel} • ${formatDate(record.date)}</p>
                                                        ${record.notes ? `<p class="text-gray-300 text-sm">${record.notes}</p>` : ''}
                                                    </div>
                                                    <div class="text-right">
                                                        <div class="text-2xl font-bold text-cyan-400">${record.overall_score || 0}</div>
                                                        <p class="text-sm text-gray-400">${t.score || 'Puan'}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            `}
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Performance records error:', error);
                showNotification(t.error_loading_performance || 'Performans kayıtları yüklenirken hata oluştu', 'error');
                document.getElementById('content').innerHTML = `
                    <div class="text-center py-20">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                        <p class="text-gray-400">${t.error_loading_performance || 'Performans kayıtları yüklenirken hata oluştu'}</p>
                    </div>
                `;
            }
        }
        
        // Analiz sistemi açıklama fonksiyonu
        function showAnalysisExplanation(type) {
            const t = translations[currentLang];
            let content = '';
            
            switch(type) {
                case 'tumbling':
                    content = `
                        <div class="space-y-4">
                            <h4 class="text-lg font-bold text-cyan-400">🏃 ${t.tumbler_performance_analysis || 'Tumbler Performance Analysis'}</h4>
                            <div class="bg-black/30 rounded-lg p-4">
                                <h5 class="font-semibold mb-2">Hesaplama Formülü:</h5>
                                <p class="text-sm font-mono bg-black/50 p-2 rounded">
                                    Skor = (Takla/Sefer × 40%) + (Uçuş Süresi × 40%) + (Disiplin × 20%)
                                </p>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span>📊 Takla/Sefer Oranı:</span>
                                    <span class="text-gray-400">%40 ağırlık</span>
                                </div>
                                <p class="text-xs text-gray-400">Sefer başına düşen takla sayısı. Yüksek oran, iyi performans gösterir.</p>
                                
                                <div class="flex justify-between text-sm">
                                    <span>⏱️ Uçuş Süresi:</span>
                                    <span class="text-gray-400">%40 ağırlık</span>
                                </div>
                                <p class="text-xs text-gray-400">Havada kalma süresi (dakika). Dayanıklılık göstergesi.</p>
                                
                                <div class="flex justify-between text-sm">
                                    <span>🎯 Disiplin Skoru:</span>
                                    <span class="text-gray-400">%20 ağırlık</span>
                                </div>
                                <p class="text-xs text-gray-400">Takla düzeni ve kontrol (1-10 arası).</p>
                            </div>
                            <div class="bg-cyan-500/20 rounded-lg p-3 text-xs">
                                <strong>İpucu:</strong> En iyi sonuçlar için düzenli antrenman ve hava koşullarını takip edin.
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'postal':
                    content = `
                        <div class="space-y-4">
                            <h4 class="text-lg font-bold text-blue-400">📮 ${t.postal_performance_analysis || 'Postal Performance Analysis'}</h4>
                            <div class="bg-black/30 rounded-lg p-4">
                                <h5 class="font-semibold mb-2">Hesaplama Formülü:</h5>
                                <p class="text-sm font-mono bg-black/50 p-2 rounded">
                                    Skor = (Hız × 30%) + (Mesafe × 30%) + (Navigasyon × 20%) + (Dayanıklılık × 20%)
                                </p>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span>🚀 Uçuş Hızı:</span>
                                    <span class="text-gray-400">%30 ağırlık</span>
                                </div>
                                <p class="text-xs text-gray-400">Ortalama hız (km/saat). Yarış performansının temel göstergesi.</p>
                                
                                <div class="flex justify-between text-sm">
                                    <span>📍 Mesafe Performansı:</span>
                                    <span class="text-gray-400">%30 ağırlık</span>
                                </div>
                                <p class="text-xs text-gray-400">Kat edilen toplam mesafe (km).</p>
                                
                                <div class="flex justify-between text-sm">
                                    <span>🧭 Navigasyon Doğruluğu:</span>
                                    <span class="text-gray-400">%20 ağırlık</span>
                                </div>
                                <p class="text-xs text-gray-400">Rota takibi ve eve dönüş başarısı (1-10).</p>
                                
                                <div class="flex justify-between text-sm">
                                    <span>💪 Dayanıklılık:</span>
                                    <span class="text-gray-400">%20 ağırlık</span>
                                </div>
                                <p class="text-xs text-gray-400">Uzun mesafe uçuş kapasitesi (1-10).</p>
                            </div>
                            <div class="bg-blue-500/20 rounded-lg p-3 text-xs">
                                <strong>İpucu:</strong> Kademeli mesafe artışı ve düzenli beslenme programı uygulayın.
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'butterfly':
                    content = `
                        <div class="space-y-4">
                            <h4 class="text-lg font-bold text-yellow-400">🦋 ${t.butterfly_performance_analysis || 'Butterfly Performance Analysis'}</h4>
                            <div class="bg-black/30 rounded-lg p-4">
                                <h5 class="font-semibold mb-2">Hesaplama Formülü:</h5>
                                <p class="text-sm font-mono bg-black/50 p-2 rounded">
                                    Skor = (Bonkörlük × 25%) + (Oyun Estetiği × 20%) + (Uçuş Stili × 20%) + (İstikrar × 20%) + (Ev Sadakati × 15%)
                                </p>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span>🎭 Bonkörlük:</span>
                                    <span class="text-gray-400">%25 ağırlık</span>
                                </div>
                                <p class="text-xs text-gray-400">Oyun sıklığı ve istekliliği (1-10).</p>
                                
                                <div class="flex justify-between text-sm">
                                    <span>✨ Oyun Şekli ve Estetiği:</span>
                                    <span class="text-gray-400">%20 ağırlık</span>
                                </div>
                                <p class="text-xs text-gray-400">Görsel güzellik ve akıcılık (1-10).</p>
                                
                                <div class="flex justify-between text-sm">
                                    <span>🕊️ Uçuş Stili:</span>
                                    <span class="text-gray-400">%20 ağırlık</span>
                                </div>
                                <p class="text-xs text-gray-400">Havadaki duruş ve hareket kalitesi (1-10).</p>
                                
                                <div class="flex justify-between text-sm">
                                    <span>📈 İstikrar:</span>
                                    <span class="text-gray-400">%20 ağırlık</span>
                                </div>
                                <p class="text-xs text-gray-400">Performans sürekliliği (1-10).</p>
                                
                                <div class="flex justify-between text-sm">
                                    <span>🏠 Ev Sadakati:</span>
                                    <span class="text-gray-400">%15 ağırlık</span>
                                </div>
                                <p class="text-xs text-gray-400">Eve bağlılık ve kontrol (1-10).</p>
                            </div>
                            <div class="bg-yellow-500/20 rounded-lg p-3 text-xs">
                                <strong>İpucu:</strong> Grup halinde uçuş ve düzenli oyun seansları performansı artırır.
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'racing':
                    content = `
                        <div class="space-y-4">
                            <h4 class="text-lg font-bold text-red-400">🏁 ${t.racing_performance_analysis || 'Racing Performance Analysis'}</h4>
                            <div class="bg-black/30 rounded-lg p-4">
                                <h5 class="font-semibold mb-2">Hesaplama Formülü:</h5>
                                <p class="text-sm font-mono bg-black/50 p-2 rounded">
                                    Skor = (Başarı Oranı × 60%) + (Ortalama Sıralama × 40%)
                                </p>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span>🏆 Başarı Oranı:</span>
                                    <span class="text-gray-400">%60 ağırlık</span>
                                </div>
                                <p class="text-xs text-gray-400">Yarışları tamamlama yüzdesi. Güvenilirlik göstergesi.</p>
                                
                                <div class="flex justify-between text-sm">
                                    <span>📊 Ortalama Sıralama:</span>
                                    <span class="text-gray-400">%40 ağırlık</span>
                                </div>
                                <p class="text-xs text-gray-400">Yarışlardaki ortalama bitiş pozisyonu.</p>
                            </div>
                            <div class="space-y-1 mt-3">
                                <p class="text-xs"><strong>Veri Kaynağı:</strong> Yarış sonuçları otomatik olarak hesaplanır.</p>
                                <p class="text-xs"><strong>Minimum Yarış:</strong> En az 3 yarış sonucu gereklidir.</p>
                            </div>
                            <div class="bg-red-500/20 rounded-lg p-3 text-xs">
                                <strong>İpucu:</strong> Düzenli antrenman ve yarış deneyimi performansı yükseltir.
                            </div>
                        </div>
                    `;
                    break;
            }
            
            // Modal göster
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-gray-900 rounded-3xl p-6 max-w-md w-full max-h-[80vh] overflow-y-auto">
                    ${content}
                    <button onclick="this.closest('.fixed').remove()" class="btn-secondary w-full mt-4">
                        <i class="fas fa-times mr-2"></i> Kapat
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // ========== YARIŞ PERFORMANS YÖNETİMİ ==========
        
        // Ana yarış performans sayfası
        async function showRacingPerformance() {
            if (!checkAuth()) return;
            
            const contentDiv = document.getElementById('content');
            contentDiv.innerHTML = '<div class="text-center py-20"><i class="fas fa-spinner fa-spin text-4xl text-cyan-400"></i></div>';
            
            try {
                cleanupPreviousViews();
                updateActiveTab(6); // Racing tab index
                
                // Kullanıcının güvercinlerini çek
                const { data: pigeons, error: pigeonsError } = await supabase
                    .from('pigeons')
                    .select('*')
                    .eq('user_id', storage.currentUser.id)
                    .order('name');
                    
                if (pigeonsError) throw pigeonsError;
                
                // Yarış performans kayıtlarını çek
                const { data: raceRecords, error: recordsError } = await supabase
                    .from('performance_records')
                    .select('*')
                    .eq('user_id', storage.currentUser.id)
                    .eq('performance_type', 'racing')
                    .order('date', { ascending: false });
                    
                if (recordsError) throw recordsError;
                
                // İstatistikleri hesapla
                const totalRaces = raceRecords?.length || 0;
                const avgSpeed = totalRaces > 0 
                    ? (raceRecords.reduce((sum, r) => sum + (r.performance_data?.speed || 0), 0) / totalRaces).toFixed(1)
                    : 0;
                const topRanks = raceRecords?.filter(r => r.performance_data?.rank <= 3).length || 0;
                const successRate = totalRaces > 0 ? ((topRanks / totalRaces) * 100).toFixed(1) : 0;
                
                contentDiv.innerHTML = `
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        <!-- Başlık ve Eylemler -->
                        <div class="mb-8">
                            <h1 class="text-4xl font-bold mb-4 bg-gradient-to-r from-red-400 to-orange-500 bg-clip-text text-transparent">
                                <i class="fas fa-flag-checkered mr-3"></i>
                                ${translations[currentLang].racing_performance_title || 'Yarış Performans Yönetimi'}
                            </h1>
                            <p class="text-gray-400 text-lg">
                                GPS destekli hız takibi, rota analizi ve yarış istatistikleri
                            </p>
                        </div>
                        
                        <!-- İstatistik Kartları -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <!-- Toplam Yarış -->
                            <div class="glass p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-red-500 to-orange-500 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-flag text-white text-xl"></i>
                                    </div>
                                    <span class="text-2xl font-bold text-red-400">${totalRaces}</span>
                                </div>
                                <h3 class="text-gray-300 font-medium">Toplam Yarış</h3>
                                <p class="text-sm text-gray-500 mt-1">Kayıtlı yarış sayısı</p>
                            </div>
                            
                            <!-- Ortalama Hız -->
                            <div class="glass p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-tachometer-alt text-white text-xl"></i>
                                    </div>
                                    <span class="text-2xl font-bold text-blue-400">${avgSpeed} km/h</span>
                                </div>
                                <h3 class="text-gray-300 font-medium">Ortalama Hız</h3>
                                <p class="text-sm text-gray-500 mt-1">Tüm yarışlar</p>
                            </div>
                            
                            <!-- İlk 3 Giriş -->
                            <div class="glass p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-yellow-500 to-amber-500 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-trophy text-white text-xl"></i>
                                    </div>
                                    <span class="text-2xl font-bold text-yellow-400">${topRanks}</span>
                                </div>
                                <h3 class="text-gray-300 font-medium">Podyum</h3>
                                <p class="text-sm text-gray-500 mt-1">İlk 3'e girişler</p>
                            </div>
                            
                            <!-- Başarı Oranı -->
                            <div class="glass p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-500 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-percentage text-white text-xl"></i>
                                    </div>
                                    <span class="text-2xl font-bold text-green-400">%${successRate}</span>
                                </div>
                                <h3 class="text-gray-300 font-medium">Başarı Oranı</h3>
                                <p class="text-sm text-gray-500 mt-1">İlk 3'e girme oranı</p>
                            </div>
                        </div>
                        
                        <!-- Sekmeler -->
                        <div class="flex flex-wrap gap-2 mb-6">
                            <button onclick="showRacingDashboard()" class="px-6 py-3 bg-gradient-to-r from-red-500 to-orange-500 rounded-xl font-semibold hover:scale-105 transition">
                                <i class="fas fa-chart-line mr-2"></i> Özet
                            </button>
                            <button onclick="showRaceAnalytics()" class="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl font-semibold transition">
                                <i class="fas fa-chart-bar mr-2"></i> Analizler
                            </button>
                        </div>
                        
                        <!-- İçerik Alanı -->
                        <div id="racingContent">
                            ${await getRacingDashboardContent(pigeons, raceRecords)}
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Racing performance error:', error);
                showNotification(translations[currentLang].error_loading || 'Yüklenirken hata oluştu', 'error');
                contentDiv.innerHTML = `
                    <div class="text-center py-20">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                        <p class="text-gray-400">${translations[currentLang].error_loading || 'Yüklenirken hata oluştu'}</p>
                    </div>
                `;
            }
        }
        
        // Yarış dashboard içeriği
        async function getRacingDashboardContent(pigeons, raceRecords) {
            const recentRaces = raceRecords?.slice(0, 5) || [];
            
            return `
                <div class="space-y-6">
                    <!-- Hızlı Eylemler -->
                    <div class="glass p-6 rounded-2xl">
                        <h3 class="text-xl font-bold mb-4">
                            <i class="fas fa-bolt text-yellow-400 mr-2"></i>
                            Hızlı İşlemler
                        </h3>
                        <button onclick="showAddPerformance('racing')" class="w-full max-w-md mx-auto block p-6 bg-gradient-to-r from-red-500/20 to-orange-500/20 hover:from-red-500/30 hover:to-orange-500/30 rounded-xl transition">
                            <i class="fas fa-plus-circle text-3xl text-red-400 mb-3"></i>
                            <div class="text-xl font-semibold">Yarış Ekle</div>
                            <div class="text-gray-400">Yeni yarış kaydı oluştur</div>
                        </button>
                    </div>
                    
                    <!-- Son Yarışlar -->
                    <div class="glass p-6 rounded-2xl">
                        <h3 class="text-xl font-bold mb-4">
                            <i class="fas fa-history text-cyan-400 mr-2"></i>
                            Son Yarışlar
                        </h3>
                        ${recentRaces.length > 0 ? `
                            <div class="space-y-3">
                                ${recentRaces.map(race => {
                                    const pigeon = pigeons.find(p => p.id === race.pigeon_id);
                                    const data = race.performance_data || {};
                                    return `
                                        <div class="glass p-4 rounded-xl hover:scale-[1.02] transition-transform">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-12 h-12 rounded-full bg-gradient-to-r from-red-400 to-orange-400 flex items-center justify-center">
                                                        <i class="fas fa-dove text-white"></i>
                                                    </div>
                                                    <div>
                                                        <div class="font-semibold">${pigeon?.name || 'Bilinmeyen'}</div>
                                                        <div class="text-sm text-gray-400">${formatDate(race.date)}</div>
                                                    </div>
                                                </div>
                                                <div class="text-right">
                                                    <div class="flex items-center gap-4">
                                                        <div>
                                                            <div class="text-sm text-gray-400">Sıralama</div>
                                                            <div class="font-bold text-lg">${data.rank || '-'}/${data.totalParticipants || '-'}</div>
                                                        </div>
                                                        <div>
                                                            <div class="text-sm text-gray-400">Hız</div>
                                                            <div class="font-bold text-lg">${data.speed || 0} km/h</div>
                                                        </div>
                                                        <div>
                                                            <div class="text-sm text-gray-400">Mesafe</div>
                                                            <div class="font-bold text-lg">${data.distance || 0} km</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        ` : `
                            <div class="text-center py-8 text-gray-400">
                                <i class="fas fa-flag-checkered text-4xl mb-3 opacity-50"></i>
                                <p>Henüz yarış kaydı bulunmuyor</p>
                                <button onclick="showAddPerformance('racing')" class="mt-4 px-6 py-2 bg-red-500 hover:bg-red-600 rounded-lg transition">
                                    <i class="fas fa-plus mr-2"></i> İlk Yarışı Ekle
                                </button>
                            </div>
                        `}
                    </div>
                    
                    <!-- Performans Grafiği Placeholder -->
                    <div class="glass p-6 rounded-2xl">
                        <h3 class="text-xl font-bold mb-4">
                            <i class="fas fa-chart-area text-purple-400 mr-2"></i>
                            Hız Trend Analizi
                        </h3>
                        <div class="h-64 flex items-center justify-center text-gray-500">
                            <div class="text-center">
                                <i class="fas fa-chart-line text-6xl mb-3 opacity-30"></i>
                                <p>Grafik özelliği yakında eklenecek</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        // Diğer placeholder fonksiyonlar
        function showRacingDashboard() {
            showRacingPerformance();
        }
        async function showRaceAnalytics() {
            const content = document.getElementById('racingContent');
            content.innerHTML = '<div class="text-center py-20"><i class="fas fa-spinner fa-spin text-4xl text-cyan-400"></i></div>';
            
            try {
                // Yarış verilerini çek
                const { data: raceRecords, error } = await supabase
                    .from('performance_records')
                    .select('*')
                    .eq('user_id', storage.currentUser.id)
                    .eq('performance_type', 'racing')
                    .order('date', { ascending: false });
                    
                if (error) throw error;
                
                // Güvercinleri çek
                const { data: pigeons } = await supabase
                    .from('pigeons')
                    .select('*')
                    .eq('user_id', storage.currentUser.id);
                
                // Analiz verilerini hazırla
                const analyticsData = prepareAnalyticsData(raceRecords, pigeons);
                
                content.innerHTML = `
                    <div class="space-y-6">
                        <!-- Filtreler -->
                        <div class="glass p-6 rounded-2xl">
                            <div class="flex flex-wrap gap-4 items-center">
                                <div class="flex-1 min-w-[200px]">
                                    <label class="block text-sm text-gray-400 mb-1 lang-text" data-tr="racing_analytics_date_range">Tarih Aralığı</label>
                                    <select id="dateRange" onchange="updateAnalytics()" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2">
                                        <option value="all" class="lang-text" data-tr="racing_analytics_all_time">Tüm Zamanlar</option>
                                        <option value="30" class="lang-text" data-tr="racing_analytics_last_30_days">Son 30 Gün</option>
                                        <option value="90" class="lang-text" data-tr="racing_analytics_last_3_months">Son 3 Ay</option>
                                        <option value="180" class="lang-text" data-tr="racing_analytics_last_6_months">Son 6 Ay</option>
                                        <option value="365" class="lang-text" data-tr="racing_analytics_last_year">Son 1 Yıl</option>
                                    </select>
                                </div>
                                <div class="flex-1 min-w-[200px]">
                                    <label class="block text-sm text-gray-400 mb-1 lang-text" data-tr="racing_analytics_pigeon">Güvercin</label>
                                    <select id="pigeonFilter" onchange="updateAnalytics()" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2">
                                        <option value="all" class="lang-text" data-tr="racing_analytics_all_pigeons">Tüm Güvercinler</option>
                                        ${pigeons?.map(p => `<option value="${p.id}">${p.name}</option>`).join('') || ''}
                                    </select>
                                </div>
                                <button onclick="exportAnalytics()" class="btn-primary px-6 py-2">
                                    <i class="fas fa-download mr-2"></i> <span class="lang-text" data-tr="racing_analytics_export_report">Rapor İndir</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Özet İstatistikler -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="glass p-6 rounded-2xl">
                                <div class="text-3xl font-bold text-cyan-400">${analyticsData.avgSpeed.toFixed(1)} km/h</div>
                                <div class="text-gray-400 mt-1 lang-text" data-tr="racing_analytics_avg_speed">Ortalama Hız</div>
                                <div class="text-sm text-gray-500 mt-2">
                                    <i class="fas fa-arrow-up text-green-400"></i> <span class="lang-text" data-tr="racing_analytics_best">En iyi</span>: ${analyticsData.maxSpeed} km/h
                                </div>
                            </div>
                            <div class="glass p-6 rounded-2xl">
                                <div class="text-3xl font-bold text-green-400">${analyticsData.winRate.toFixed(1)}%</div>
                                <div class="text-gray-400 mt-1 lang-text" data-tr="racing_analytics_win_rate">Kazanma Oranı</div>
                                <div class="text-sm text-gray-500 mt-2">
                                    ${analyticsData.wins} <span class="lang-text" data-tr="racing_analytics_wins">birincilik</span> / ${analyticsData.totalRaces} <span class="lang-text" data-tr="racing_analytics_race">yarış</span>
                                </div>
                            </div>
                            <div class="glass p-6 rounded-2xl">
                                <div class="text-3xl font-bold text-yellow-400">${analyticsData.avgRank.toFixed(1)}</div>
                                <div class="text-gray-400 mt-1 lang-text" data-tr="racing_analytics_avg_rank">Ortalama Sıralama</div>
                                <div class="text-sm text-gray-500 mt-2">
                                    <i class="fas fa-trophy text-yellow-400"></i> ${analyticsData.podiumCount} <span class="lang-text" data-tr="racing_analytics_podium">podyum</span>
                                </div>
                            </div>
                            <div class="glass p-6 rounded-2xl">
                                <div class="text-3xl font-bold text-purple-400">${analyticsData.avgDistance.toFixed(0)} km</div>
                                <div class="text-gray-400 mt-1 lang-text" data-tr="racing_analytics_avg_distance">Ortalama Mesafe</div>
                                <div class="text-sm text-gray-500 mt-2">
                                    <span class="lang-text" data-tr="racing_analytics_total">Toplam</span>: ${analyticsData.totalDistance.toFixed(0)} km
                                </div>
                            </div>
                        </div>
                        
                        <!-- Kompakt Analiz Görünümü -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Hız Trend Özeti -->
                            <div class="glass p-6 rounded-2xl bg-gradient-to-br from-cyan-500/10 to-blue-500/10">
                                <div class="flex items-center justify-between mb-4">
                                    <div>
                                        <h3 class="text-lg font-bold mb-1">
                                            <i class="fas fa-tachometer-alt text-cyan-400 mr-2"></i>
                                            <span class="lang-text" data-tr="racing_analytics_speed_performance">Hız Performansı</span>
                                        </h3>
                                        <div class="text-3xl font-bold">${analyticsData.avgSpeed.toFixed(1)} km/h</div>
                                        <div class="text-sm text-gray-400 lang-text" data-tr="racing_analytics_avg_speed">Ortalama Hız</div>
                                    </div>
                                    <div class="relative w-24 h-24">
                                        <!-- Hız Göstergesi -->
                                        <svg class="w-full h-full transform -rotate-90">
                                            <circle cx="48" cy="48" r="40" stroke="#374151" stroke-width="8" fill="none"></circle>
                                            <circle cx="48" cy="48" r="40" stroke="url(#speedGradient)" stroke-width="8" fill="none"
                                                stroke-dasharray="${Math.PI * 80}" 
                                                stroke-dashoffset="${Math.PI * 80 * (1 - (analyticsData.avgSpeed / 120))}"
                                                stroke-linecap="round"></circle>
                                            <defs>
                                                <linearGradient id="speedGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                                    <stop offset="0%" style="stop-color:#06b6d4;stop-opacity:1" />
                                                    <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:1" />
                                                </linearGradient>
                                            </defs>
                                        </svg>
                                        <div class="absolute inset-0 flex items-center justify-center">
                                            <div class="text-center">
                                                <div class="text-xs text-gray-400">MAX</div>
                                                <div class="text-sm font-bold">${analyticsData.maxSpeed}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Son 5 Yarış Mini Trend -->
                                <div class="mt-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-sm text-gray-400 lang-text" data-tr="racing_analytics_last_races">Son Yarışlar</span>
                                        <span class="text-xs text-gray-500">km/h</span>
                                    </div>
                                    <div class="grid grid-cols-5 gap-2">
                                        ${analyticsData.records.slice(0, 5).reverse().map((r, idx) => {
                                            const speed = r.performance_data?.speed || 0;
                                            const heightPercent = speed > 0 ? (speed / analyticsData.maxSpeed) * 100 : 10;
                                            const isLast = idx === 4;
                                            return `
                                                <div class="flex flex-col items-center">
                                                    <div class="text-xs font-medium mb-1 ${isLast ? 'text-cyan-400' : 'text-gray-400'}">${speed}</div>
                                                    <div class="w-full h-16 bg-gray-700 rounded relative overflow-hidden">
                                                        <div class="absolute bottom-0 w-full ${isLast ? 'bg-gradient-to-t from-cyan-400 to-cyan-300' : 'bg-gradient-to-t from-gray-600 to-gray-500'} rounded transition-all duration-500" 
                                                             style="height: ${heightPercent}%"></div>
                                                    </div>
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Sıralama Dağılımı - Medal Sistemi -->
                            <div class="glass p-6 rounded-2xl bg-gradient-to-br from-yellow-500/10 to-orange-500/10">
                                <h3 class="text-lg font-bold mb-4">
                                    <i class="fas fa-trophy text-yellow-400 mr-2"></i>
                                    <span class="lang-text" data-tr="racing_analytics_ranking_performance">Sıralama Performansı</span>
                                </h3>
                                <div class="space-y-3">
                                    ${(() => {
                                        const ranks = {
                                            gold: analyticsData.records.filter(r => r.performance_data?.rank === 1).length,
                                            silver: analyticsData.records.filter(r => r.performance_data?.rank === 2).length,
                                            bronze: analyticsData.records.filter(r => r.performance_data?.rank === 3).length,
                                            top10: analyticsData.records.filter(r => r.performance_data?.rank > 3 && r.performance_data?.rank <= 10).length,
                                            other: analyticsData.records.filter(r => r.performance_data?.rank > 10).length
                                        };
                                        const total = analyticsData.totalRaces || 1;
                                        
                                        return [
                                            { icon: 'fa-medal', color: 'yellow', label: '${translations[currentLang].racing_analytics_1st_place || "1. Sıra"}', count: ranks.gold, gradient: 'from-yellow-400 to-amber-500' },
                                            { icon: 'fa-medal', color: 'gray', label: '${translations[currentLang].racing_analytics_2nd_place || "2. Sıra"}', count: ranks.silver, gradient: 'from-gray-300 to-gray-400' },
                                            { icon: 'fa-medal', color: 'orange', label: '${translations[currentLang].racing_analytics_3rd_place || "3. Sıra"}', count: ranks.bronze, gradient: 'from-orange-400 to-orange-600' },
                                            { icon: 'fa-certificate', color: 'blue', label: '${translations[currentLang].racing_analytics_top_10 || "İlk 10"}', count: ranks.top10, gradient: 'from-blue-400 to-blue-600' },
                                            { icon: 'fa-flag-checkered', color: 'gray', label: '${translations[currentLang].racing_analytics_other || "Diğer"}', count: ranks.other, gradient: 'from-gray-500 to-gray-600' }
                                        ].map(item => `
                                            <div class="flex items-center gap-3">
                                                <i class="fas ${item.icon} text-2xl text-${item.color}-400"></i>
                                                <div class="flex-1">
                                                    <div class="flex justify-between items-center mb-1">
                                                        <span class="text-sm font-medium">${item.label}</span>
                                                        <span class="text-xs text-gray-400">${item.count} yarış (${((item.count / total) * 100).toFixed(0)}%)</span>
                                                    </div>
                                                    <div class="h-2 bg-gray-700 rounded-full overflow-hidden">
                                                        <div class="h-full bg-gradient-to-r ${item.gradient} transition-all duration-500" 
                                                             style="width: ${(item.count / total) * 100}%"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('');
                                    })()}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Diğer Grafikler - Daha Kompakt -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                            <!-- Mesafe Performansı -->
                            <div class="glass p-6 rounded-2xl">
                                <h3 class="text-lg font-bold mb-4">
                                    <i class="fas fa-route text-green-400 mr-2"></i>
                                    Mesafe-Hız İlişkisi
                                </h3>
                                <canvas id="distancePerformanceChart" style="max-height: 200px"></canvas>
                            </div>
                            
                            <!-- Aylık Performans -->
                            <div class="glass p-6 rounded-2xl">
                                <h3 class="text-lg font-bold mb-4">
                                    <i class="fas fa-calendar-alt text-orange-400 mr-2"></i>
                                    Aylık Performans
                                </h3>
                                <canvas id="monthlyPerformanceChart" style="max-height: 200px"></canvas>
                            </div>
                        </div>
                        
                        <!-- Detaylı Analiz -->
                        <div class="glass p-6 rounded-2xl">
                            <h3 class="text-xl font-bold mb-4">
                                <i class="fas fa-microscope text-blue-400 mr-2"></i>
                                Detaylı Analiz
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- En İyi Performanslar -->
                                <div>
                                    <h4 class="font-semibold mb-3 text-green-400">En İyi Performanslar</h4>
                                    <div class="space-y-2">
                                        ${analyticsData.topPerformances.map(p => `
                                            <div class="flex items-center justify-between p-3 bg-gray-800/50 rounded-lg">
                                                <div>
                                                    <div class="font-medium">${p.pigeonName}</div>
                                                    <div class="text-sm text-gray-400">${formatDate(p.date)}</div>
                                                </div>
                                                <div class="text-right">
                                                    <div class="font-bold text-green-400">${p.speed} km/h</div>
                                                    <div class="text-sm text-gray-400">${p.distance} km - ${p.rank}. sıra</div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                
                                <!-- Gelişim Önerileri -->
                                <div>
                                    <h4 class="font-semibold mb-3 text-yellow-400">Gelişim Önerileri</h4>
                                    <div class="space-y-3">
                                        ${generateSuggestions(analyticsData).map(s => `
                                            <div class="flex items-start gap-3 p-3 bg-gray-800/50 rounded-lg">
                                                <i class="${s.icon} text-${s.color}-400 mt-1"></i>
                                                <div>
                                                    <div class="font-medium">${s.title}</div>
                                                    <div class="text-sm text-gray-400">${s.description}</div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Grafikleri çiz
                setTimeout(() => {
                    renderAnalyticsCharts(analyticsData);
                }, 100);
                
            } catch (error) {
                console.error('Analytics error:', error);
                content.innerHTML = `
                    <div class="glass p-8 rounded-2xl text-center">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                        <p class="text-gray-400">Analizler yüklenirken hata oluştu</p>
                    </div>
                `;
            }
        }
        
        // Analiz verilerini hazırlama fonksiyonu
        function prepareAnalyticsData(records, pigeons) {
            const validRecords = records?.filter(r => r.performance_data) || [];
            
            // Temel istatistikler
            const totalRaces = validRecords.length;
            const speeds = validRecords.map(r => r.performance_data.speed || 0);
            const ranks = validRecords.map(r => r.performance_data.rank || 999);
            const distances = validRecords.map(r => r.performance_data.distance || 0);
            
            const avgSpeed = speeds.length > 0 ? speeds.reduce((a, b) => a + b, 0) / speeds.length : 0;
            const maxSpeed = speeds.length > 0 ? Math.max(...speeds) : 0;
            const avgRank = ranks.length > 0 ? ranks.reduce((a, b) => a + b, 0) / ranks.length : 0;
            const avgDistance = distances.length > 0 ? distances.reduce((a, b) => a + b, 0) / distances.length : 0;
            const totalDistance = distances.reduce((a, b) => a + b, 0);
            
            const wins = validRecords.filter(r => r.performance_data.rank === 1).length;
            const podiumCount = validRecords.filter(r => r.performance_data.rank <= 3).length;
            const winRate = totalRaces > 0 ? (wins / totalRaces) * 100 : 0;
            
            // En iyi performanslar
            const topPerformances = validRecords
                .sort((a, b) => (b.performance_data.speed || 0) - (a.performance_data.speed || 0))
                .slice(0, 5)
                .map(r => {
                    const pigeon = pigeons?.find(p => p.id === r.pigeon_id);
                    return {
                        pigeonName: pigeon?.name || 'Bilinmeyen',
                        date: r.date,
                        speed: r.performance_data.speed || 0,
                        distance: r.performance_data.distance || 0,
                        rank: r.performance_data.rank || 0
                    };
                });
            
            // Aylık performans
            const monthlyData = {};
            validRecords.forEach(r => {
                const month = new Date(r.date).toLocaleDateString('tr-TR', { year: 'numeric', month: 'short' });
                if (!monthlyData[month]) {
                    monthlyData[month] = { races: 0, avgSpeed: 0, speeds: [] };
                }
                monthlyData[month].races++;
                monthlyData[month].speeds.push(r.performance_data.speed || 0);
            });
            
            Object.keys(monthlyData).forEach(month => {
                const speeds = monthlyData[month].speeds;
                monthlyData[month].avgSpeed = speeds.reduce((a, b) => a + b, 0) / speeds.length;
            });
            
            return {
                totalRaces,
                avgSpeed,
                maxSpeed,
                avgRank,
                avgDistance,
                totalDistance,
                wins,
                winRate,
                podiumCount,
                topPerformances,
                monthlyData,
                records: validRecords,
                pigeons
            };
        }
        
        // Öneri üretme fonksiyonu
        function generateSuggestions(data) {
            const suggestions = [];
            
            // Hız önerisi
            if (data.avgSpeed < 60) {
                suggestions.push({
                    icon: 'fas fa-tachometer-alt',
                    color: 'red',
                    title: getTranslation('suggestion_speed_improvement'),
                    description: getTranslation('suggestion_speed_improvement_desc')
                });
            } else if (data.avgSpeed > 80) {
                suggestions.push({
                    icon: 'fas fa-star',
                    color: 'green',
                    title: getTranslation('suggestion_excellent_speed'),
                    description: getTranslation('suggestion_excellent_speed_desc')
                });
            }
            
            // Sıralama önerisi
            if (data.avgRank > 10) {
                suggestions.push({
                    icon: 'fas fa-chart-line',
                    color: 'yellow',
                    title: getTranslation('suggestion_ranking_improvement'),
                    description: getTranslation('suggestion_ranking_improvement_desc')
                });
            }
            
            // Başarı oranı önerisi
            if (data.winRate < 10) {
                suggestions.push({
                    icon: 'fas fa-trophy',
                    color: 'orange',
                    title: getTranslation('suggestion_competitive_power'),
                    description: getTranslation('suggestion_competitive_power_desc')
                });
            }
            
            // Mesafe önerisi
            if (data.avgDistance > 500) {
                suggestions.push({
                    icon: 'fas fa-route',
                    color: 'blue',
                    title: getTranslation('suggestion_long_distance'),
                    description: getTranslation('suggestion_long_distance_desc')
                });
            }
            
            return suggestions;
        }
        
        // Grafik çizme fonksiyonu
        function renderAnalyticsCharts(data) {
            // Mevcut grafikleri temizle
            Chart.helpers.each(Chart.instances, (instance) => {
                instance.destroy();
            });
            
            // Mesafe-Hız ilişkisi
            const distanceCtx = document.getElementById('distancePerformanceChart')?.getContext('2d');
            if (distanceCtx) {
                new Chart(distanceCtx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'Yarışlar',
                            data: data.records.map(r => ({
                                x: r.performance_data.distance || 0,
                                y: r.performance_data.speed || 0
                            })),
                            backgroundColor: 'rgba(168, 85, 247, 0.6)',
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Mesafe: ${context.parsed.x} km, Hız: ${context.parsed.y} km/h`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: { display: true, text: 'Mesafe (km)', color: '#9ca3af' },
                                grid: { color: '#374151' }
                            },
                            y: {
                                title: { display: true, text: 'Hız (km/h)', color: '#9ca3af' },
                                grid: { color: '#374151' }
                            }
                        }
                    }
                });
            }
            
            // Aylık performans
            const monthlyCtx = document.getElementById('monthlyPerformanceChart')?.getContext('2d');
            if (monthlyCtx && data.monthlyData) {
                const months = Object.keys(data.monthlyData).slice(-6);
                new Chart(monthlyCtx, {
                    type: 'bar',
                    data: {
                        labels: months,
                        datasets: [{
                            label: 'Yarış Sayısı',
                            data: months.map(m => data.monthlyData[m].races),
                            backgroundColor: 'rgba(251, 146, 60, 0.8)',
                            borderRadius: 8,
                            yAxisID: 'y'
                        }, {
                            label: 'Ort. Hız',
                            data: months.map(m => data.monthlyData[m].avgSpeed),
                            type: 'line',
                            borderColor: 'rgb(34, 211, 238)',
                            borderWidth: 3,
                            pointBackgroundColor: 'rgb(34, 211, 238)',
                            pointRadius: 5,
                            tension: 0.3,
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false
                        },
                        plugins: {
                            legend: { 
                                display: true,
                                position: 'top',
                                labels: { color: '#9ca3af' }
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: { display: true, text: 'Yarış Sayısı', color: '#9ca3af' },
                                grid: { color: '#374151' }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: { display: true, text: 'Ortalama Hız (km/h)', color: '#9ca3af' },
                                grid: { drawOnChartArea: false }
                            },
                            x: {
                                grid: { color: '#374151' }
                            }
                        }
                    }
                });
            }
        }
        
        // Analiz güncelleme fonksiyonu
        async function updateAnalytics() {
            const dateRange = document.getElementById('dateRange').value;
            const pigeonFilter = document.getElementById('pigeonFilter').value;
            
            // Filtreleri uygula ve yeniden yükle
            await showRaceAnalytics();
        }
        
        // Analiz raporu dışa aktarma
        async function exportAnalytics() {
            showNotification('Rapor hazırlanıyor...', 'info');
            
            try {
                // HTML2PDF kullanarak PDF oluştur (kütüphane eklenmeli)
                const element = document.getElementById('racingContent');
                const opt = {
                    margin: 1,
                    filename: 'yaris-analiz-raporu.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
                };
                
                // Basit CSV export alternatifi
                const csvContent = await generateAnalyticsCSV();
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'yaris-analiz-raporu.csv';
                a.click();
                
                showNotification('Rapor indirildi', 'success');
            } catch (error) {
                console.error('Export error:', error);
                showNotification('Rapor oluşturulurken hata oluştu', 'error');
            }
        }
        
        // CSV oluşturma fonksiyonu
        async function generateAnalyticsCSV() {
            try {
                // Yarış verilerini çek
                const { data: records } = await supabase
                    .from('performance_records')
                    .select('*')
                    .eq('user_id', storage.currentUser.id)
                    .eq('performance_type', 'racing')
                    .order('date', { ascending: false });
                
                // Güvercinleri çek
                const { data: pigeons } = await supabase
                    .from('pigeons')
                    .select('*')
                    .eq('user_id', storage.currentUser.id);
                
                let csv = 'Tarih,Güvercin,Hız (km/h),Mesafe (km),Sıralama,Toplam Katılımcı\n';
                
                records?.forEach(r => {
                    const pigeon = pigeons?.find(p => p.id === r.pigeon_id);
                    const data = r.performance_data || {};
                    csv += `${r.date},${pigeon?.name || 'Bilinmeyen'},${data.speed || 0},${data.distance || 0},${data.rank || 0},${data.totalParticipants || 0}\n`;
                });
                
                return csv;
            } catch (error) {
                console.error('CSV generation error:', error);
                return 'Tarih,Güvercin,Hız (km/h),Mesafe (km),Sıralama,Toplam Katılımcı\n';
            }
        }
        
        // Performans silme fonksiyonu
        function deletePerformance(recordId) {
            if (!confirm('Bu performans kaydını silmek istediğinizden emin misiniz?')) return;
            
            const index = storage.performanceRecords.findIndex(r => r.id === recordId);
            if (index > -1) {
                storage.performanceRecords.splice(index, 1);
                saveToStorage();
                showPerformanceRecords();
                showNotification('Performans kaydı silindi', 'success');
            }
        }
        
        // Karşılaştırmaya ekle fonksiyonu
        function addToComparison(pigeonId) {
            const select1 = document.getElementById('pigeon1');
            const select2 = document.getElementById('pigeon2');
            
            if (!select1.value) {
                select1.value = pigeonId;
            } else if (!select2.value && select2.value !== pigeonId) {
                select2.value = pigeonId;
                comparePigeons();
            }
        }
        
        // AI Güvercin Eşleştirme Sistemi
        async function showAIBreeding() {
            if (!checkAuth()) return;
            cleanupPreviousViews();
            updateActiveTab(6);
            
            const t = translations[currentLang];
            
            // Loading göster
            document.getElementById('content').innerHTML = `
                <div class="text-center py-20">
                    <i class="fas fa-spinner fa-spin text-4xl text-cyan-400"></i>
                    <p class="mt-4">${t.loading || 'Yükleniyor...'}</p>
                </div>
            `;
            
            try {
                // Kullanıcının güvercinlerini al
                const pigeonsResult = await SupabaseDB.getPigeons(storage.currentUser.id);
                if (!pigeonsResult.success) {
                    throw new Error(pigeonsResult.error);
                }
                
                const userPigeons = pigeonsResult.data || [];
                
                // Erkek ve dişi güvercinleri ayır
                const malePigeons = userPigeons.filter(p => p.gender === 'male');
                const femalePigeons = userPigeons.filter(p => p.gender === 'female');
                
                // AI Eşleştirme arayüzünü göster
                document.getElementById('content').innerHTML = `
                    <div class="container mx-auto max-w-7xl">
                        <!-- Başlık -->
                        <div class="text-center mb-8">
                            <h1 class="text-4xl font-bold mb-4">
                                <i class="fas fa-robot text-cyan-400 mr-3"></i>
                                <span class="bg-gradient-to-r from-cyan-400 to-purple-600 bg-clip-text text-transparent">
                                    ${t.ai_breeding_title || 'AI Güvercin Eşleştirme Sistemi'}
                                </span>
                            </h1>
                            <p class="text-gray-400 text-lg">
                                ${t.ai_breeding_subtitle || 'Yapay zeka destekli genetik analiz ve optimal eşleştirme önerileri'}
                            </p>
                        </div>
                        
                        <!-- Ana Eşleştirme Paneli -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                            <!-- Erkek Seçimi -->
                            <div class="glass p-6 rounded-2xl border-2 border-blue-500/30">
                                <h3 class="text-xl font-bold mb-4 text-center text-blue-400">
                                    <i class="fas fa-mars mr-2"></i>${t.select_male || 'Erkek Seç'}
                                </h3>
                                <select id="aiMaleSelect" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-600 mb-4" onchange="updateMalePreview()">
                                    <option value="">${t.select_pigeon || 'Güvercin Seçin'}</option>
                                    ${malePigeons.map(p => `
                                        <option value="${p.id}">${p.name} - ${p.band_number || p.bandNumber}</option>
                                    `).join('')}
                                </select>
                                <div id="malePreview" class="text-center">
                                    <div class="w-32 h-32 mx-auto bg-gray-700 rounded-full flex items-center justify-center">
                                        <i class="fas fa-dove text-4xl text-gray-500"></i>
                                    </div>
                                    <div class="mt-4 text-sm text-gray-400" id="maleInfo"></div>
                                </div>
                            </div>
                            
                            <!-- Eşleştirme Kontrolleri -->
                            <div class="glass p-6 rounded-2xl">
                                <h3 class="text-xl font-bold mb-4 text-center text-purple-400">
                                    <i class="fas fa-dna mr-2"></i>${t.breeding_preferences || 'Eşleştirme Tercihleri'}
                                </h3>
                                <div class="space-y-3">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="priorityHealth" checked class="mr-2">
                                        <span>${t.priority_health || 'Sağlık öncelikli'}</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="priorityPerformance" checked class="mr-2">
                                        <span>${t.priority_performance || 'Performans öncelikli'}</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="priorityDiversity" checked class="mr-2">
                                        <span>${t.priority_diversity || 'Genetik çeşitlilik öncelikli'}</span>
                                    </label>
                                    <div class="mt-4">
                                        <label class="text-sm text-gray-400">${t.inbreeding_tolerance || 'Akrabalık toleransı'}</label>
                                        <input type="range" id="inbreedingTolerance" min="0" max="25" value="12.5" step="0.5" class="w-full">
                                        <div class="flex justify-between text-xs text-gray-500">
                                            <span>0%</span>
                                            <span id="toleranceValue">12.5%</span>
                                            <span>25%</span>
                                        </div>
                                    </div>
                                </div>
                                <button onclick="runAIAnalysis()" class="w-full mt-6 py-3 bg-gradient-to-r from-cyan-500 to-purple-600 rounded-lg font-bold hover:from-cyan-400 hover:to-purple-500 transition">
                                    <i class="fas fa-robot mr-2"></i>${t.run_ai_analysis || 'AI Analiz Et'}
                                </button>
                            </div>
                            
                            <!-- Dişi Seçimi -->
                            <div class="glass p-6 rounded-2xl border-2 border-pink-500/30">
                                <h3 class="text-xl font-bold mb-4 text-center text-pink-400">
                                    <i class="fas fa-venus mr-2"></i>${t.select_female || 'Dişi Seç'}
                                </h3>
                                <select id="aiFemaleSelect" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-600 mb-4" onchange="updateFemalePreview()">
                                    <option value="">${t.select_pigeon || 'Güvercin Seçin'}</option>
                                    ${femalePigeons.map(p => `
                                        <option value="${p.id}">${p.name} - ${p.band_number || p.bandNumber}</option>
                                    `).join('')}
                                </select>
                                <div id="femalePreview" class="text-center">
                                    <div class="w-32 h-32 mx-auto bg-gray-700 rounded-full flex items-center justify-center">
                                        <i class="fas fa-dove text-4xl text-gray-500"></i>
                                    </div>
                                    <div class="mt-4 text-sm text-gray-400" id="femaleInfo"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Analiz Sonuçları -->
                        <div id="aiAnalysisResults" class="hidden">
                            <!-- Sonuçlar buraya gelecek -->
                        </div>
                        
                        <!-- Otomatik Öneriler - ENHANCED -->
                        <div class="glass p-8 rounded-3xl mb-8 bg-gradient-to-br from-yellow-900/20 via-transparent to-orange-900/20 border-2 border-yellow-500/30 shadow-2xl">
                            <h3 class="text-3xl font-bold mb-8 text-center bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent">
                                <i class="fas fa-magic mr-3 text-yellow-400 text-4xl"></i>
                                ${t.smart_recommendations || 'Akıllı Öneriler'}
                            </h3>
                            <div class="text-center mb-6">
                                <p class="text-lg mb-6">${t.select_pigeon_for_recommendations || 'Bir güvercin seçin, size en uygun eşleri önerelim'}</p>
                                <select id="recommendationTarget" class="p-4 rounded-xl bg-gray-800 border-2 border-yellow-500/50 mb-4 text-lg font-semibold hover:border-yellow-400 transition-all duration-300 cursor-pointer" onchange="getSmartRecommendations()">
                                    <option value="">${t.select_pigeon || 'Güvercin Seçin'}</option>
                                    ${userPigeons.map(p => `
                                        <option value="${p.id}">${p.name} - ${p.band_number || p.bandNumber} (${p.gender === 'male' ? '♂' : '♀'})</option>
                                    `).join('')}
                                </select>
                            </div>
                            <div id="smartRecommendations" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <!-- Öneriler buraya gelecek - Enhanced cards will appear here -->
                            </div>
                        </div>
                        
                        <!-- Toplu Eşleştirme Planı -->
                        <div class="glass p-6 rounded-2xl">
                            <h3 class="text-2xl font-bold mb-6 text-center">
                                <i class="fas fa-calendar-alt mr-2 text-green-400"></i>
                                ${t.season_planning || 'Sezon Planlama'}
                            </h3>
                            <div class="text-center">
                                <p class="text-gray-400 mb-4">${t.optimal_pairing_description || 'Tüm güvercinleriniz için optimal eşleştirme planı oluşturun'}</p>
                                <button onclick="generateOptimalPairings()" class="py-3 px-6 bg-gradient-to-r from-green-500 to-emerald-600 rounded-lg font-bold hover:from-green-400 hover:to-emerald-500 transition">
                                    <i class="fas fa-project-diagram mr-2"></i>${t.generate_optimal_plan || 'Optimal Plan Oluştur'}
                                </button>
                            </div>
                            <div id="optimalPairingResults" class="mt-6 hidden">
                                <!-- Toplu plan sonuçları -->
                            </div>
                        </div>
                    </div>
                `;
                
                // Event listener'ları ekle
                document.getElementById('inbreedingTolerance').addEventListener('input', function(e) {
                    document.getElementById('toleranceValue').textContent = e.target.value + '%';
                });
                
            } catch (error) {
                console.error('AI Breeding error:', error);
                document.getElementById('content').innerHTML = `
                    <div class="text-center py-20">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                        <p class="text-xl">${t.error_occurred || 'Bir hata oluştu'}</p>
                        <p class="text-gray-400 mt-2">${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Erkek güvercin önizleme
        async function updateMalePreview() {
            const select = document.getElementById('aiMaleSelect');
            const pigeonId = select.value;
            const preview = document.getElementById('malePreview');
            const info = document.getElementById('maleInfo');
            
            if (!pigeonId) {
                preview.innerHTML = `
                    <div class="w-32 h-32 mx-auto bg-gray-700 rounded-full flex items-center justify-center">
                        <i class="fas fa-dove text-4xl text-gray-500"></i>
                    </div>
                `;
                info.innerHTML = '';
                return;
            }
            
            try {
                const result = await SupabaseDB.getPigeon(pigeonId);
                if (result.success && result.data) {
                    const pigeon = result.data;
                    const colorHex = window.ColorPatternSystem?.turkishPigeonColors[pigeon.color]?.hex || '#4169E1';
                    
                    preview.innerHTML = `
                        <div class="w-32 h-32 mx-auto bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center">
                            ${pigeon.image_url ? 
                                `<img src="${pigeon.image_url}" class="w-full h-full rounded-full object-cover">` :
                                `<i class="fas fa-dove text-4xl text-white" style="color: ${colorHex};"></i>`
                            }
                        </div>
                    `;
                    info.innerHTML = `
                        <p class="font-bold">${pigeon.name}</p>
                        <p class="text-xs">${pigeon.breed || 'Bilinmiyor'}</p>
                        ${pigeon.color ? `<p class="text-xs flex items-center justify-center gap-1">
                            <span class="w-3 h-3 rounded-full border border-gray-400" style="background-color: ${colorHex}"></span>
                            ${window.ColorPatternSystem?.getColorDisplayName(pigeon.color) || pigeon.color}
                        </p>` : ''}
                        <p class="text-xs">Doğum: ${pigeon.birth_date ? formatDate(pigeon.birth_date) : 'Bilinmiyor'}</p>
                    `;
                }
            } catch (error) {
                console.error('Male preview error:', error);
            }
        }
        
        // Dişi güvercin önizleme
        async function updateFemalePreview() {
            const select = document.getElementById('aiFemaleSelect');
            const pigeonId = select.value;
            const preview = document.getElementById('femalePreview');
            const info = document.getElementById('femaleInfo');
            
            if (!pigeonId) {
                preview.innerHTML = `
                    <div class="w-32 h-32 mx-auto bg-gray-700 rounded-full flex items-center justify-center">
                        <i class="fas fa-dove text-4xl text-gray-500"></i>
                    </div>
                `;
                info.innerHTML = '';
                return;
            }
            
            try {
                const result = await SupabaseDB.getPigeon(pigeonId);
                if (result.success && result.data) {
                    const pigeon = result.data;
                    const colorHex = window.ColorPatternSystem?.turkishPigeonColors[pigeon.color]?.hex || '#EC4899';
                    
                    preview.innerHTML = `
                        <div class="w-32 h-32 mx-auto bg-gradient-to-br from-pink-400 to-pink-600 rounded-full flex items-center justify-center">
                            ${pigeon.image_url ? 
                                `<img src="${pigeon.image_url}" class="w-full h-full rounded-full object-cover">` :
                                `<i class="fas fa-dove text-4xl text-white" style="color: ${colorHex};"></i>`
                            }
                        </div>
                    `;
                    info.innerHTML = `
                        <p class="font-bold">${pigeon.name}</p>
                        <p class="text-xs">${pigeon.breed || 'Bilinmiyor'}</p>
                        ${pigeon.color ? `<p class="text-xs flex items-center justify-center gap-1">
                            <span class="w-3 h-3 rounded-full border border-gray-400" style="background-color: ${colorHex}"></span>
                            ${window.ColorPatternSystem?.getColorDisplayName(pigeon.color) || pigeon.color}
                        </p>` : ''}
                        <p class="text-xs">Doğum: ${pigeon.birth_date ? formatDate(pigeon.birth_date) : 'Bilinmiyor'}</p>
                    `;
                }
            } catch (error) {
                console.error('Female preview error:', error);
            }
        }
        
        // AI Analiz çalıştır
        async function runAIAnalysis() {
            const maleId = document.getElementById('aiMaleSelect').value;
            const femaleId = document.getElementById('aiFemaleSelect').value;
            
            if (!maleId || !femaleId) {
                alert(translations[currentLang].please_select_both || 'Lütfen hem erkek hem dişi güvercin seçin');
                return;
            }
            
            // Loading göster
            const resultsDiv = document.getElementById('aiAnalysisResults');
            resultsDiv.classList.remove('hidden');
            resultsDiv.innerHTML = `
                <div class="text-center py-12">
                    <i class="fas fa-spinner fa-spin text-4xl text-cyan-400"></i>
                    <p class="mt-4 text-lg">AI analiz yapıyor...</p>
                </div>
            `;
            
            try {
                // Güvercinleri Supabase'den al
                const maleResult = await SupabaseDB.getPigeon(maleId);
                const femaleResult = await SupabaseDB.getPigeon(femaleId);
                
                if (!maleResult.success || !femaleResult.success) {
                    throw new Error('Güvercin bilgileri alınamadı');
                }
                
                const male = maleResult.data;
                const female = femaleResult.data;
                
                // Tercihleri topla
                const preferences = {
                    priorityHealth: document.getElementById('priorityHealth').checked,
                    priorityPerformance: document.getElementById('priorityPerformance').checked,
                    priorityDiversity: document.getElementById('priorityDiversity').checked,
                    inbreedingTolerance: parseFloat(document.getElementById('inbreedingTolerance').value) / 100
                };
                
                // Uyumluluk skorunu hesapla
                const compatibility = await CompatibilityScorer.calculateBreedingScore(male, female, preferences);
                
                // Akrabalık analizi
                const kinshipReport = KinshipAnalyzer.generateKinshipReport(male, female, {});
                
                // Renk tahminleri
                let colorPredictions = null;
                if (male.color && female.color && window.ColorPatternSystem) {
                    colorPredictions = window.ColorPatternSystem.predictOffspringColors(male.color, female.color);
                }
                
                // Mock genetik verileri oluştur (şimdilik)
                const mockMaleGenetics = [{ trait_id: '1', trait_code: 'B', allele1: 'B', allele2: 'B+' }];
                const mockFemaleGenetics = [{ trait_id: '1', trait_code: 'B', allele1: 'B+', allele2: 'B+' }];
                
                // Simülasyon çalıştır
                const simulations = window.GeneticCalculator.simulateOffspring(
                    mockMaleGenetics, 
                    mockFemaleGenetics, 
                    10, 
                    male.color, 
                    female.color
                );
                const summary = window.GeneticCalculator.summarizeSimulations(simulations);
                
                // Sonuçları göster
                displayAIAnalysisResults(compatibility, kinshipReport, colorPredictions, male, female, summary);
                
            } catch (error) {
                console.error('AI Analysis error:', error);
                resultsDiv.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-400"></i>
                        <p class="mt-4 text-lg">Analiz sırasında hata oluştu</p>
                        <p class="text-sm text-gray-400 mt-2">${error.message}</p>
                    </div>
                `;
            }
        }
        
        // AI Analiz sonuçlarını göster
        function displayAIAnalysisResults(compatibility, kinshipReport, colorPredictions, male, female, summary) {
            const t = translations[currentLang];
            const resultsDiv = document.getElementById('aiAnalysisResults');
            
            const scoreColor = compatibility.totalScore >= 80 ? 'green' : 
                             compatibility.totalScore >= 60 ? 'blue' : 
                             compatibility.totalScore >= 40 ? 'yellow' : 'red';
            
            resultsDiv.innerHTML = `
                <div class="space-y-6">
                    <!-- Ana Skor -->
                    <div class="glass p-8 rounded-2xl text-center border-2 border-${scoreColor}-500/50">
                        <h2 class="text-3xl font-bold mb-4">
                            ${t.compatibility_score || 'Uyumluluk Skoru'}
                        </h2>
                        <div class="relative w-48 h-48 mx-auto mb-4">
                            <svg class="w-48 h-48 transform -rotate-90">
                                <circle cx="96" cy="96" r="88" stroke="#374151" stroke-width="12" fill="none"/>
                                <circle cx="96" cy="96" r="88" 
                                    stroke="url(#scoreGradient)" 
                                    stroke-width="12" 
                                    fill="none"
                                    stroke-dasharray="${2 * Math.PI * 88}"
                                    stroke-dashoffset="${2 * Math.PI * 88 * (1 - compatibility.totalScore / 100)}"
                                    stroke-linecap="round"/>
                                <defs>
                                    <linearGradient id="scoreGradient">
                                        <stop offset="0%" stop-color="#10b981"/>
                                        <stop offset="100%" stop-color="#3b82f6"/>
                                    </linearGradient>
                                </defs>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div>
                                    <div class="text-5xl font-bold text-${scoreColor}-400">${Math.round(compatibility.totalScore)}</div>
                                    <div class="text-sm text-gray-400">/100</div>
                                </div>
                            </div>
                        </div>
                        <p class="text-xl text-${scoreColor}-400 font-semibold">
                            ${compatibility.recommendation.text}
                        </p>
                    </div>
                    
                    <!-- Detaylı Skorlar -->
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                        ${Object.entries(compatibility.scores).map(([key, scoreData]) => `
                            <div class="glass p-4 rounded-xl text-center">
                                <div class="text-3xl font-bold text-cyan-400">${Math.round(scoreData.score)}</div>
                                <div class="text-xs text-gray-400 mt-1">${t[`score_${key}`] || key}</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <!-- Akrabalık Analizi -->
                    <div class="glass p-6 rounded-2xl">
                        <h3 class="text-xl font-bold mb-4">
                            <i class="fas fa-sitemap mr-2 text-purple-400"></i>
                            ${t.kinship_analysis || 'Akrabalık Analizi'}
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <p class="text-gray-400">${t.relationship || 'İlişki'}:</p>
                                <p class="font-bold text-lg">${kinshipReport.relationship.relation}</p>
                            </div>
                            <div>
                                <p class="text-gray-400">${t.kinship_coefficient || 'Akrabalık Katsayısı'}:</p>
                                <p class="font-bold text-lg text-${kinshipReport.risk.color}-400">
                                    ${kinshipReport.coefficientPercentage}%
                                </p>
                            </div>
                        </div>
                        ${kinshipReport.commonAncestors.length > 0 ? `
                            <div class="mt-4">
                                <p class="text-gray-400 mb-2">${t.common_ancestors || 'Ortak Atalar'}:</p>
                                <div class="space-y-1">
                                    ${kinshipReport.commonAncestors.map(ancestor => `
                                        <div class="text-sm">
                                            • ${ancestor.name} (${ancestor.bandNumber})
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <!-- Renk Tahminleri -->
                    ${(colorPredictions && colorPredictions.length > 0) || summary?.colorDistribution ? `
                        <div class="glass p-6 rounded-2xl">
                            <h3 class="text-xl font-bold mb-4">
                                <i class="fas fa-palette mr-2 text-purple-400"></i>
                                ${t.color_predictions || 'Yavru Renk Tahminleri'}
                            </h3>
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                ${summary?.colorDistribution ? 
                                    Object.entries(summary.colorDistribution).map(([color, percentage]) => {
                                        const colorData = window.ColorPatternSystem?.turkishPigeonColors[color];
                                        return `
                                            <div class="glass p-4 rounded-xl text-center">
                                                <div class="w-16 h-16 mx-auto mb-2 rounded-full border-2 border-gray-600 flex items-center justify-center" 
                                                     style="background-color: ${colorData?.hex || '#808080'}">
                                                    <i class="fas fa-dove text-2xl" style="color: ${colorData?.secondary_hex || '#FFFFFF'}"></i>
                                                </div>
                                                <p class="font-semibold text-sm">${colorData?.name_tr || color}</p>
                                                <p class="text-cyan-400 font-bold">%${Math.round(percentage)}</p>
                                            </div>
                                        `;
                                    }).join('') :
                                    colorPredictions.map(pred => {
                                        const colorData = window.ColorPatternSystem?.turkishPigeonColors[pred.color];
                                        return `
                                            <div class="glass p-4 rounded-xl text-center">
                                                <div class="w-16 h-16 mx-auto mb-2 rounded-full border-2 border-gray-600 flex items-center justify-center" 
                                                     style="background-color: ${colorData?.hex || '#808080'}">
                                                    <i class="fas fa-dove text-2xl" style="color: ${colorData?.secondary_hex || '#FFFFFF'}"></i>
                                                </div>
                                                <p class="font-semibold text-sm">${colorData?.name_tr || pred.color}</p>
                                                <p class="text-cyan-400 font-bold">%${Math.round(pred.probability)}</p>
                                            </div>
                                        `;
                                    }).join('')
                                }
                            </div>
                            ${male.color && female.color ? `
                                <div class="mt-4 p-4 bg-black/30 rounded-lg">
                                    <p class="text-sm text-gray-400">
                                        <i class="fas fa-info-circle mr-2"></i>
                                        Ebeveyn renkleri: 
                                        <span class="text-white">${window.ColorPatternSystem?.getColorDisplayName(male.color)} (♂)</span> x 
                                        <span class="text-white">${window.ColorPatternSystem?.getColorDisplayName(female.color)} (♀)</span>
                                    </p>
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}
                    
                    <!-- Uyarılar ve Avantajlar -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        ${compatibility.warnings && compatibility.warnings.length > 0 ? `
                            <div class="glass p-6 rounded-2xl border-2 border-orange-500/30">
                                <h3 class="text-xl font-bold mb-4 text-orange-400">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>
                                    ${t.warnings || 'Uyarılar'}
                                </h3>
                                <div class="space-y-2">
                                    ${compatibility.warnings.map(warning => `
                                        <div class="flex items-start">
                                            <i class="fas fa-info-circle mr-2 text-orange-400 mt-1"></i>
                                            <p class="text-sm">${warning.text}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${compatibility.advantages && compatibility.advantages.length > 0 ? `
                            <div class="glass p-6 rounded-2xl border-2 border-green-500/30">
                                <h3 class="text-xl font-bold mb-4 text-green-400">
                                    <i class="fas fa-check-circle mr-2"></i>
                                    ${t.advantages || 'Avantajlar'}
                                </h3>
                                <div class="space-y-2">
                                    ${compatibility.advantages.map(advantage => `
                                        <div class="flex items-start">
                                            <i class="fas fa-star mr-2 text-green-400 mt-1"></i>
                                            <p class="text-sm">${advantage.text}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <!-- Aksiyon Butonları -->
                    <div class="text-center space-x-4">
                        <button onclick="saveBreedingRecommendation('${male.id}', '${female.id}')" class="py-3 px-6 bg-gradient-to-r from-green-500 to-emerald-600 rounded-lg font-bold hover:from-green-400 hover:to-emerald-500 transition">
                            <i class="fas fa-save mr-2"></i>${t.save_recommendation || 'Öneriyi Kaydet'}
                        </button>
                        <button onclick="createMatingFromRecommendation('${male.id}', '${female.id}')" class="py-3 px-6 bg-gradient-to-r from-purple-500 to-pink-600 rounded-lg font-bold hover:from-purple-400 hover:to-pink-500 transition">
                            <i class="fas fa-heart mr-2"></i>${t.create_mating || 'Eşleştirme Oluştur'}
                        </button>
                        <button onclick="printAIReport('${male.id}', '${female.id}')" class="py-3 px-6 bg-gray-700 rounded-lg font-bold hover:bg-gray-600 transition">
                            <i class="fas fa-print mr-2"></i>${t.print_report || 'Rapor Yazdır'}
                        </button>
                    </div>
                </div>
            `;
        }
        
        // Akıllı öneriler al
        async function getSmartRecommendations() {
            const targetId = document.getElementById('recommendationTarget').value;
            if (!targetId) return;
            
            const t = translations[currentLang];
            const recommendationsDiv = document.getElementById('smartRecommendations');
            
            // Loading göster
            recommendationsDiv.innerHTML = `
                <div class="col-span-full text-center py-8">
                    <i class="fas fa-spinner fa-spin text-3xl text-cyan-400"></i>
                    <p class="mt-2">${t.loading_recommendations || 'Öneriler hazırlanıyor...'}</p>
                </div>
            `;
            
            try {
                const targetPigeon = storage.pigeons.find(p => p.id === targetId);
                const candidatePigeons = storage.pigeons.filter(p => 
                    p.userId === storage.currentUser.id && 
                    p.gender !== targetPigeon.gender &&
                    p.id !== targetId
                );
                
                // Önerileri al
                const recommendations = await RecommendationEngine.getBreedingRecommendations(
                    targetPigeon,
                    candidatePigeons,
                    {},
                    6
                );
                
                // Önerileri göster
                if (recommendations.recommendations.length === 0) {
                    recommendationsDiv.innerHTML = `
                        <div class="col-span-full text-center py-8 text-gray-400">
                            ${t.no_recommendations || 'Uygun öneri bulunamadı'}
                        </div>
                    `;
                    return;
                }
                
                recommendationsDiv.innerHTML = recommendations.recommendations.map((rec, index) => {
                    const scoreColor = rec.compatibility.totalScore >= 80 ? 'green' : rec.compatibility.totalScore >= 60 ? 'blue' : 'yellow';
                    const isBestMatch = index === 0;
                    return `
                    <div class="glass p-6 rounded-2xl hover:scale-[1.03] transition-all duration-300 cursor-pointer 
                         ${isBestMatch ? 'ring-2 ring-yellow-400 shadow-lg shadow-yellow-400/20' : ''} 
                         bg-gradient-to-br from-gray-800/50 to-gray-900/50 hover:from-gray-700/50 hover:to-gray-800/50"
                         onclick="selectRecommendation('${targetPigeon.id}', '${rec.candidatePigeon.id}')">
                        
                        ${isBestMatch ? `
                            <div class="absolute -top-3 -right-3 bg-gradient-to-r from-yellow-400 to-orange-400 p-2 rounded-full shadow-lg animate-pulse">
                                <i class="fas fa-star text-white text-lg"></i>
                            </div>
                        ` : ''}
                        
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center">
                                <div class="w-16 h-16 rounded-full bg-gradient-to-br ${rec.candidatePigeon.gender === 'male' ? 'from-blue-400 to-blue-600' : 'from-pink-400 to-pink-600'} flex items-center justify-center mr-4 shadow-lg">
                                    ${rec.candidatePigeon.image_url ? 
                                        `<img src="${rec.candidatePigeon.image_url}" class="w-full h-full rounded-full object-cover">` :
                                        `<i class="fas fa-dove text-white text-xl"></i>`
                                    }
                                </div>
                                <div>
                                    <p class="font-bold text-lg">${rec.candidatePigeon.name}</p>
                                    <p class="text-sm text-gray-400">${rec.candidatePigeon.band_number || rec.candidatePigeon.bandNumber}</p>
                                    <p class="text-xs text-gray-500">${rec.candidatePigeon.breed || ''}</p>
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-${scoreColor}-400">
                                    ${Math.round(rec.compatibility.totalScore)}
                                </div>
                                <div class="text-sm text-gray-400 font-semibold">PUAN</div>
                                <div class="mt-1">
                                    <div class="w-16 h-2 bg-gray-700 rounded-full overflow-hidden">
                                        <div class="h-full bg-gradient-to-r from-${scoreColor}-500 to-${scoreColor}-400 rounded-full" 
                                             style="width: ${rec.compatibility.totalScore}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="space-y-2 mb-4">
                            ${rec.matchReasons.slice(0, 3).map(reason => `
                                <div class="flex items-center bg-gray-800/50 rounded-lg px-3 py-2">
                                    <i class="${reason.icon} mr-2 ${reason.color} text-lg"></i>
                                    <span class="text-sm">${reason.text}</span>
                                </div>
                            `).join('')}
                        </div>
                        
                        ${isBestMatch ? `
                            <div class="text-center bg-gradient-to-r from-yellow-500/20 to-orange-500/20 rounded-xl py-2 border border-yellow-500/30">
                                <span class="text-sm font-bold text-yellow-400">
                                    <i class="fas fa-crown mr-2"></i>${t.best_match || 'EN İYİ EŞLEŞTİRME'}
                                </span>
                            </div>
                        ` : `
                            <div class="text-center">
                                <button class="w-full py-2 bg-gradient-to-r from-cyan-600/20 to-blue-600/20 hover:from-cyan-600/30 hover:to-blue-600/30 
                                         rounded-lg text-sm font-semibold transition-all duration-300 border border-cyan-500/30">
                                    <i class="fas fa-arrow-right mr-2"></i>Seç ve Analiz Et
                                </button>
                            </div>
                        `}
                    </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Smart recommendations error:', error);
                recommendationsDiv.innerHTML = `
                    <div class="col-span-full text-center py-8 text-red-400">
                        ${t.error_loading_recommendations || 'Öneriler yüklenirken hata oluştu'}
                    </div>
                `;
            }
        }
        
        // Öneri seçildiğinde
        function selectRecommendation(targetId, candidateId) {
            const targetPigeon = storage.pigeons.find(p => p.id === targetId);
            const candidatePigeon = storage.pigeons.find(p => p.id === candidateId);
            
            if (targetPigeon.gender === 'male') {
                document.getElementById('aiMaleSelect').value = targetId;
                document.getElementById('aiFemaleSelect').value = candidateId;
                updateMalePreview();
                updateFemalePreview();
            } else {
                document.getElementById('aiMaleSelect').value = candidateId;
                document.getElementById('aiFemaleSelect').value = targetId;
                updateMalePreview();
                updateFemalePreview();
            }
            
            // Otomatik analiz başlat
            runAIAnalysis();
        }
        
        // Optimal eşleştirme planı oluştur
        async function generateOptimalPairings() {
            const t = translations[currentLang];
            const resultsDiv = document.getElementById('optimalPairingResults');
            
            resultsDiv.classList.remove('hidden');
            resultsDiv.innerHTML = `
                <div class="text-center py-8">
                    <i class="fas fa-spinner fa-spin text-3xl text-cyan-400"></i>
                    <p class="mt-2">${t.generating_optimal_plan || 'Optimal plan oluşturuluyor...'}</p>
                </div>
            `;
            
            try {
                const allPigeons = storage.pigeons.filter(p => p.userId === storage.currentUser.id);
                const optimalPlan = await RecommendationEngine.generateOptimalPairings(allPigeons, {});
                
                if (!optimalPlan.success) {
                    resultsDiv.innerHTML = `
                        <div class="text-center py-8 text-gray-400">
                            ${optimalPlan.message}
                        </div>
                    `;
                    return;
                }
                
                // Planı göster
                resultsDiv.innerHTML = `
                    <div class="space-y-6">
                        <!-- İstatistikler -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center">
                                <div class="text-3xl font-bold text-cyan-400">${optimalPlan.pairings.length}</div>
                                <div class="text-sm text-gray-400">${t.total_pairings || 'Toplam Eşleştirme'}</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-green-400">${optimalPlan.statistics.averageScore}</div>
                                <div class="text-sm text-gray-400">${t.average_score || 'Ortalama Skor'}</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-purple-400">${optimalPlan.statistics.geneticDiversity}%</div>
                                <div class="text-sm text-gray-400">${t.genetic_diversity || 'Genetik Çeşitlilik'}</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-yellow-400">${optimalPlan.statistics.expectedOffspring}</div>
                                <div class="text-sm text-gray-400">${t.expected_offspring || 'Beklenen Yavru'}</div>
                            </div>
                        </div>
                        
                        <!-- Sezon Planı -->
                        <div class="space-y-4">
                            ${optimalPlan.seasonPlan.phases.map(phase => `
                                <div class="glass p-4 rounded-xl">
                                    <h4 class="font-bold text-lg mb-3">
                                        ${t.phase || 'Faz'} ${phase.phaseNumber} - ${phase.focus}
                                    </h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        ${phase.pairings.map(pairing => `
                                            <div class="bg-black/30 p-3 rounded-lg flex items-center justify-between">
                                                <div class="flex items-center">
                                                    <div class="flex -space-x-2 mr-3">
                                                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center border-2 border-gray-800">
                                                            <i class="fas fa-mars text-xs text-white"></i>
                                                        </div>
                                                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-pink-400 to-pink-600 flex items-center justify-center border-2 border-gray-800">
                                                            <i class="fas fa-venus text-xs text-white"></i>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <p class="text-sm font-semibold">${pairing.male.name} × ${pairing.female.name}</p>
                                                        <p class="text-xs text-gray-400">${t.priority || 'Öncelik'} #${pairing.priority}</p>
                                                    </div>
                                                </div>
                                                <div class="text-right">
                                                    <div class="text-lg font-bold text-${pairing.score >= 80 ? 'green' : pairing.score >= 60 ? 'blue' : 'yellow'}-400">
                                                        ${Math.round(pairing.score)}
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- Aksiyon Butonları -->
                        <div class="text-center space-x-4">
                            <button onclick="applyOptimalPlan()" class="py-3 px-6 bg-gradient-to-r from-green-500 to-emerald-600 rounded-lg font-bold hover:from-green-400 hover:to-emerald-500 transition">
                                <i class="fas fa-check mr-2"></i>${t.apply_plan || 'Planı Uygula'}
                            </button>
                            <button onclick="exportOptimalPlan()" class="py-3 px-6 bg-gray-700 rounded-lg font-bold hover:bg-gray-600 transition">
                                <i class="fas fa-download mr-2"></i>${t.export_plan || 'Planı İndir'}
                            </button>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Optimal pairing error:', error);
                resultsDiv.innerHTML = `
                    <div class="text-center py-8 text-red-400">
                        ${t.error_generating_plan || 'Plan oluşturulurken hata oluştu'}
                    </div>
                `;
            }
        }
        
        // Eşleştirme önerisini kaydet
        async function saveBreedingRecommendation(maleId, femaleId) {
            const t = translations[currentLang];
            try {
                // TODO: Supabase'e kaydet
                alert(t.recommendation_saved || 'Öneri kaydedildi!');
            } catch (error) {
                console.error('Save recommendation error:', error);
                alert(t.error_saving || 'Kaydetme hatası!');
            }
        }
        
        // Öneriden eşleştirme oluştur
        async function createMatingFromRecommendation(maleId, femaleId) {
            const t = translations[currentLang];
            try {
                const today = new Date().toISOString().split('T')[0];
                const matingData = {
                    maleId: maleId,
                    femaleId: femaleId,
                    matingDate: today,
                    notes: 'AI önerisi ile oluşturuldu'
                };
                
                const result = await SupabaseDB.addMating(matingData);
                if (result.success) {
                    alert(t.mating_created || 'Eşleştirme oluşturuldu!');
                    showMatings();
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('Create mating error:', error);
                alert(t.error_creating_mating || 'Eşleştirme oluşturma hatası!');
            }
        }
        
        // AI raporunu yazdır
        function printAIReport(maleId, femaleId) {
            window.print();
        }
        
        // Optimal planı uygula
        async function applyOptimalPlan() {
            const t = translations[currentLang];
            if (confirm(t.confirm_apply_plan || 'Tüm eşleştirmeler oluşturulacak. Onaylıyor musunuz?')) {
                // TODO: Planı uygula
                alert(t.plan_applied || 'Plan uygulandı!');
            }
        }
        
        // Optimal planı dışa aktar
        function exportOptimalPlan() {
            // TODO: PDF veya Excel olarak dışa aktar
            alert('Plan dışa aktarma özelliği yakında!');
        }
        
        // Detaylı karşılaştırma göster
        function showDetailedComparison(pigeon1Id, pigeon2Id) {
            showComparativeAnalysis();
            setTimeout(() => {
                document.getElementById('comparisonPigeon1').value = pigeon1Id;
                document.getElementById('comparisonPigeon2').value = pigeon2Id;
                comparePerformances();
            }, 100);
        }
        
        // Güvercin Seçimi Modal
        function showPigeonSelectionModal() {
            if (!checkAuth()) return;
            
            const t = translations[currentLang];
            const userPigeons = storage.pigeons.filter(p => p.userId === storage.currentUser.id);
            
            if (userPigeons.length === 0) {
                showNotification('PDF raporu oluşturmak için önce güvercin eklemelisiniz', 'error');
                return;
            }
            
            // Modal oluştur
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-gray-900 rounded-3xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold">📄 PDF Raporu İçin Güvercin Seçin</h3>
                        <button onclick="this.closest('.fixed').remove()" class="p-2 hover:bg-gray-800 rounded-lg transition">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        ${userPigeons.map(pigeon => {
                            const performanceCount = storage.performanceRecords.filter(r => r.pigeonId === pigeon.id).length;
                            return `
                                <div class="glass p-4 rounded-xl hover:scale-[1.02] hover:bg-gray-800/50 transition-all duration-200 cursor-pointer group" 
                                     onclick="this.classList.add('scale-95', 'opacity-50'); generatePDFReportForPigeon('${pigeon.id}'); setTimeout(() => this.closest('.fixed').remove(), 200);">
                                    <div class="flex items-center gap-4">
                                        ${pigeon.image ? `
                                            <img src="${pigeon.image}" alt="${pigeon.name}" class="w-16 h-16 rounded-full object-cover">
                                        ` : `
                                            <div class="w-16 h-16 rounded-full bg-gradient-to-r from-cyan-400 to-purple-400 flex items-center justify-center">
                                                <i class="fas fa-dove text-2xl text-white"></i>
                                            </div>
                                        `}
                                        <div class="flex-1">
                                            <h4 class="font-bold text-lg">${pigeon.name}</h4>
                                            <p class="text-sm text-gray-400">
                                                ${pigeon.bandNumber} • ${t[pigeon.breed] || pigeon.breed}
                                            </p>
                                            <p class="text-xs text-gray-500 mt-1">
                                                ${performanceCount} performans kaydı
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <div class="mt-6 text-center">
                        <button onclick="this.closest('.fixed').remove()" class="btn-secondary">
                            <i class="fas fa-times mr-2"></i> İptal
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // PDF Rapor Oluşturma (Tek güvercin için)
        function generatePDFReportForPigeon(pigeonId) {
            if (!checkAuth()) return;
            
            // Loading spinner göster
            const loadingModal = document.createElement('div');
            loadingModal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center';
            loadingModal.innerHTML = `
                <div class="bg-gray-900 rounded-3xl p-8 flex flex-col items-center">
                    <div class="relative">
                        <div class="w-20 h-20 border-4 border-cyan-500/30 rounded-full animate-pulse"></div>
                        <div class="absolute inset-0 w-20 h-20 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin"></div>
                    </div>
                    <p class="mt-4 text-lg font-semibold">PDF raporu hazırlanıyor...</p>
                    <p class="text-sm text-gray-400">Lütfen bekleyin</p>
                </div>
            `;
            document.body.appendChild(loadingModal);
            
            try {
                const t = translations[currentLang];
                const pigeon = storage.pigeons.find(p => p.id === pigeonId);
                
                if (!pigeon) {
                    throw new Error('Güvercin bulunamadı');
                }
                
                const pigeonPerformanceRecords = storage.performanceRecords
                    .filter(r => r.pigeonId === pigeonId)
                    .sort((a, b) => new Date(b.date) - new Date(a.date));
                
                if (pigeonPerformanceRecords.length === 0) {
                    throw new Error('Bu güvercin için performans kaydı bulunmuyor');
                }
            
            // jsPDF instance oluştur
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });
            
            
            let yPosition = 20;
            
            // Başlık
            doc.setFontSize(24);
            doc.setTextColor(44, 62, 80);
            const title = `${pigeon.name} Performance Report`;
            const titleWidth = doc.getTextWidth(title);
            doc.text(title, (210 - titleWidth) / 2, yPosition);
            yPosition += 15;
            
            // Alt başlık çizgisi
            doc.setDrawColor(52, 152, 219);
            doc.setLineWidth(0.5);
            doc.line(20, yPosition, 190, yPosition);
            yPosition += 10;
            
            // Güvercin Bilgileri Bölümü
            doc.setFontSize(16);
            doc.setTextColor(44, 62, 80);
            doc.text('Güvercin Bilgileri', 20, yPosition);
            yPosition += 10;
            
            // Fotoğraf ve bilgiler yan yana
            const photoX = 20;
            const photoY = yPosition;
            const photoSize = 40;
            const infoX = photoX + photoSize + 10;
            
            // Fotoğraf çerçevesi
            doc.setDrawColor(200, 200, 200);
            doc.setLineWidth(0.5);
            doc.rect(photoX, photoY, photoSize, photoSize);
            
            // Fotoğraf varsa ekle
            if (pigeon.image) {
                try {
                    doc.addImage(pigeon.image, 'JPEG', photoX, photoY, photoSize, photoSize);
                } catch (error) {
                    // Fotoğraf eklenemezse placeholder göster
                    doc.setFontSize(10);
                    doc.setTextColor(150, 150, 150);
                    doc.text('Fotoğraf', photoX + photoSize/2, photoY + photoSize/2, { align: 'center' });
                }
            } else {
                // Placeholder
                doc.setFontSize(10);
                doc.setTextColor(150, 150, 150);
                doc.text('Fotoğraf Yok', photoX + photoSize/2, photoY + photoSize/2, { align: 'center' });
            }
            
            // Güvercin detay bilgileri
            doc.setFontSize(11);
            doc.setTextColor(44, 62, 80);
            let infoY = photoY;
            
            const infoItems = [
                { label: 'İsim:', value: pigeon.name },
                { label: 'Künye No:', value: pigeon.bandNumber },
                { label: 'Doğum Tarihi:', value: pigeon.birthDate || 'Belirtilmemiş' },
                { label: 'Irk:', value: t[pigeon.breed] || pigeon.breed },
                { label: 'Cinsiyet:', value: pigeon.gender === 'male' ? 'Erkek' : 'Dişi' },
                { label: 'Renk:', value: pigeon.color || 'Belirtilmemiş' }
            ];
            
            infoItems.forEach(item => {
                doc.setFont('Roboto', 'bold');
                doc.text(item.label, infoX, infoY);
                doc.setFont('Roboto', 'normal');
                doc.text(item.value, infoX + 30, infoY);
                infoY += 7;
            });
            
            yPosition = photoY + photoSize + 15;
            
            // Performans Kayıtları Başlığı
            doc.setFontSize(16);
            doc.setTextColor(44, 62, 80);
            doc.text('Performans Kayıtları', 20, yPosition);
            yPosition += 10;
            
            if (pigeonPerformanceRecords.length === 0) {
                doc.setFontSize(11);
                doc.setTextColor(150, 150, 150);
                doc.text('Henüz performans kaydı bulunmamaktadır.', 20, yPosition);
            } else {
                // Tablo başlıkları
                const tableHeaders = ['Tarih', 'Tür', 'Detaylar', 'Skor'];
                const colWidths = [35, 30, 85, 20];
                let tableX = 20;
                
                // Tablo başlık arka planı
                doc.setFillColor(52, 152, 219);
                doc.rect(tableX, yPosition - 5, 170, 8, 'F');
                
                // Tablo başlıkları
                doc.setFontSize(10);
                doc.setTextColor(255, 255, 255);
                doc.setFont('Roboto', 'bold');
                
                let currentX = tableX;
                tableHeaders.forEach((header, index) => {
                    doc.text(header, currentX + 2, yPosition);
                    currentX += colWidths[index];
                });
                
                yPosition += 10;
                
                // Tablo satırları
                doc.setFont('Roboto', 'normal');
                pigeonPerformanceRecords.forEach((record, index) => {
                    if (yPosition > 270) {
                        doc.addPage();
                        yPosition = 20;
                        
                        // Yeni sayfada tablo başlıklarını tekrarla
                        doc.setFillColor(52, 152, 219);
                        doc.rect(tableX, yPosition - 5, 170, 8, 'F');
                        doc.setFontSize(10);
                        doc.setTextColor(255, 255, 255);
                        doc.setFont('Roboto', 'bold');
                        
                        currentX = tableX;
                        tableHeaders.forEach((header, idx) => {
                            doc.text(header, currentX + 2, yPosition);
                            currentX += colWidths[idx];
                        });
                        
                        yPosition += 10;
                        doc.setFont('Roboto', 'normal');
                    }
                    
                    // Satır arka planı (zebra pattern)
                    if (index % 2 === 0) {
                        doc.setFillColor(245, 245, 245);
                        doc.rect(tableX, yPosition - 5, 170, 8, 'F');
                    }
                    
                    doc.setTextColor(44, 62, 80);
                    doc.setFontSize(9);
                    
                    currentX = tableX;
                    
                    // Tarih
                    doc.text(formatDate(record.date), currentX + 2, yPosition);
                    currentX += colWidths[0];
                    
                    // Tür
                    const typeMap = {
                        'tumbling': 'Taklacı',
                        'postal': 'Posta',
                        'butterfly': 'Kelebek',
                        'racing': 'Yarış'
                    };
                    doc.text(typeMap[record.performanceType] || record.performanceType, currentX + 2, yPosition);
                    currentX += colWidths[1];
                    
                    // Detaylar
                    let details = '';
                    switch(record.performanceType) {
                        case 'tumbling':
                            details = `Takla: ${record.tumbleCount || 0}/${record.sessionCount || 0}, Süre: ${record.flightDuration || 0} dk`;
                            break;
                        case 'postal':
                            details = `Hız: ${record.flightSpeed || 0} km/h, Mesafe: ${record.flightDistance || 0} km`;
                            break;
                        case 'butterfly':
                            details = `Bonkörlük: ${record.bonkorluk || 0}/10, Uçuş: ${record.flightTimeDistance || 0} dk`;
                            if (record.gameDirection) {
                                const dirMap = { 'right': 'Sağ', 'left': 'Sol', 'double': 'Çift' };
                                details += `, Yön: ${dirMap[record.gameDirection]}`;
                            }
                            break;
                        case 'racing':
                            details = 'Yarış performansı';
                            break;
                    }
                    
                    // Uzun metni kısalt
                    if (details.length > 50) {
                        details = details.substring(0, 47) + '...';
                    }
                    doc.text(details, currentX + 2, yPosition);
                    currentX += colWidths[2];
                    
                    // Skor
                    const score = calculatePerformanceByType(pigeonId, record.performanceType);
                    doc.text(score.toString(), currentX + 2, yPosition);
                    
                    yPosition += 8;
                });
            }
            
            // Alt bilgi
            doc.setFontSize(8);
            doc.setTextColor(150, 150, 150);
            doc.text(`Oluşturulma Tarihi: ${new Date().toLocaleDateString('tr-TR')} ${new Date().toLocaleTimeString('tr-TR')}`, 105, 290, { align: 'center' });
            
            // PDF'i kaydet
            const fileName = `${pigeon.name.replace(/[^a-z0-9ğüşıöçĞÜŞİÖÇ ]/gi, '_')}_Performance_Report.pdf`;
            doc.save(fileName);
            
            // Başarı mesajı göster
            setTimeout(() => {
                showNotification(`${pigeon.name} için PDF raporu oluşturuldu`, 'success');
            }, 500);
            
            } catch (error) {
                console.error('PDF oluşturma hatası:', error);
                showNotification(error.message || 'PDF raporu oluşturulurken bir hata oluştu', 'error');
            } finally {
                // Loading modal'ı kaldır
                loadingModal.remove();
            }
        }
        
        // PDF Rapor Oluşturma (Ana fonksiyon - güvercin seçimi modalını açar)
        function generatePDFReport() {
            showPigeonSelectionModal();
        }
        
        // Excel Rapor Oluşturma
        function generateExcelReport() {
            if (!checkAuth()) return;
            
            const t = translations[currentLang];
            const userPigeons = storage.pigeons.filter(p => p.userId === storage.currentUser.id);
            const userPerformanceRecords = storage.performanceRecords
                .filter(r => userPigeons.some(p => p.id === r.pigeonId))
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (userPerformanceRecords.length === 0) {
                showNotification('Rapor oluşturmak için performans kaydı bulunamadı', 'error');
                return;
            }
            
            // Excel verilerini hazırla
            const excelData = [];
            
            // Başlık satırı
            excelData.push([
                'Güvercin Adı',
                'Küpe No',
                'Irk',
                'Performans Türü',
                'Tarih',
                'Hava Durumu',
                'Skor',
                'Detaylar'
            ]);
            
            // Veri satırları
            userPerformanceRecords.forEach(record => {
                const pigeon = userPigeons.find(p => p.id === record.pigeonId);
                if (pigeon) {
                    let detailText = '';
                    let score = 0;
                    
                    switch(record.performanceType) {
                        case 'tumbling':
                            detailText = `Takla: ${record.tumbleCount || 0}/${record.sessionCount || 0} sefer, ${record.flightDuration || 0} dk uçuş`;
                            score = calculateTumblingScore(record.pigeonId);
                            break;
                        case 'postal':
                            detailText = `Hız: ${record.flightSpeed || 0} km/h, Mesafe: ${record.flightDistance || 0} km`;
                            score = calculatePostalScore(record.pigeonId);
                            break;
                        case 'butterfly':
                            detailText = `Bonkörlük: ${record.bonkorluk || 0}/10, Uçuş: ${record.flightTimeDistance || 0} dk`;
                            score = calculateButterflyScore(record.pigeonId);
                            break;
                        case 'racing':
                            detailText = 'Yarış performansı';
                            score = calculateRacingScore(record.pigeonId);
                            break;
                    }
                    
                    excelData.push([
                        pigeon.name,
                        pigeon.bandNumber,
                        t[pigeon.breed] || pigeon.breed,
                        t[record.performanceType + '_performance'] || record.performanceType,
                        formatDate(record.date),
                        record.weatherConditions,
                        score,
                        detailText
                    ]);
                }
            });
            
            // CSV formatına dönüştür
            let csvContent = '\ufeff'; // UTF-8 BOM
            excelData.forEach(row => {
                csvContent += row.map(cell => `"${cell}"`).join(',') + '\n';
            });
            
            // Dosyayı indir
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `guvercin-performans-raporu-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            showNotification('Excel raporu başarıyla oluşturuldu', 'success');
        }
        
        // Performans kaydı ekleme formu göster
        async function showAddPerformance(pigeonIdOrType = null, performanceType = null) {
            // Handle both old usage showAddPerformance(pigeonId) and new usage showAddPerformance('racing')
            let pigeonId = null;
            if (typeof pigeonIdOrType === 'string' && ['racing', 'tumbling', 'postal', 'butterfly'].includes(pigeonIdOrType)) {
                performanceType = pigeonIdOrType;
            } else {
                pigeonId = pigeonIdOrType;
            }
            
            console.log('showAddPerformance called with pigeonId:', pigeonId, 'performanceType:', performanceType);
            console.log('Current user:', storage.currentUser);
            
            if (!checkAuth()) return;
            cleanupPreviousViews();
            
            // Supabase'den güvercinleri yükle
            let userPigeons = [];
            try {
                const result = await SupabaseDB.getPigeons(storage.currentUser.id);
                if (result.success) {
                    userPigeons = result.data || [];
                    storage.pigeons = userPigeons; // Storage'ı güncelle
                } else {
                    console.error('Failed to load pigeons:', result.error);
                }
            } catch (error) {
                console.error('Error loading pigeons:', error);
            }
            
            console.log('User pigeons:', userPigeons);
            const t = translations[currentLang];
            
            // Güvercin kontrolü
            if (userPigeons.length === 0) {
                showNotification(t.no_pigeons || 'Önce güvercin eklemeniz gerekiyor', 'warning');
                return;
            }
            
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                <div class="glass p-8 rounded-3xl">
                    <h2 class="text-3xl font-bold mb-8">${t.add_performance_record || 'Performans Kaydı Ekle'}</h2>
                    
                    <form onsubmit="handleAddPerformance(event)" class="max-w-2xl mx-auto">
                        <!-- Temel Bilgiler -->
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-gray-300 mb-2">${t.pigeon || 'Güvercin'}*</label>
                                <select id="performancePigeonId" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                                    <option value="">${t.select || 'Seçiniz'}</option>
                                    ${userPigeons.map(p => `<option value="${p.id}" ${pigeonId === p.id ? 'selected' : ''}>${p.name} - ${p.bandNumber}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-300 mb-2">${t.performance_type || 'Performans Türü'}*</label>
                                <select id="performanceType" onchange="showPerformanceFields()" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                                    <option value="">${t.select || 'Seçiniz'}</option>
                                    <option value="tumbling" ${performanceType === 'tumbling' ? 'selected' : ''}>${t.tumbling_performance || 'Taklacı Performansı'}</option>
                                    <option value="postal" ${performanceType === 'postal' ? 'selected' : ''}>${t.postal_performance || 'Posta Performansı'}</option>
                                        <option value="butterfly" ${performanceType === 'butterfly' ? 'selected' : ''}>${t.butterfly_performance || 'Kelebek Güvercini Performansı'}</option>
                                    <option value="racing" ${performanceType === 'racing' ? 'selected' : ''}>${t.racing_performance || 'Yarış Performansı'}</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Tarih ve Hava -->
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-gray-300 mb-2">${t.performance_date || 'Performans Tarihi'}*</label>
                                <input type="date" id="performanceDate" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none" required>
                            </div>
                            <div>
                                <label class="block text-gray-300 mb-2">${t.weather_conditions || 'Hava Koşulları'}</label>
                                <select id="weatherConditions" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                    <option value="sunny">☀️ Güneşli</option>
                                    <option value="cloudy">☁️ Bulutlu</option>
                                    <option value="rainy">🌧️ Yağmurlu</option>
                                    <option value="windy">💨 Rüzgarlı</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Dinamik performans alanları -->
                        <div id="performanceFields"></div>
                        
                        <!-- Notlar -->
                        <div class="mb-6">
                            <label class="block text-gray-300 mb-2">${t.notes || 'Notlar'}</label>
                            <textarea id="performanceNotes" rows="3" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none"></textarea>
                        </div>
                        
                        <div class="flex gap-4">
                            <button type="submit" class="btn-primary flex-1">
                                <i class="fas fa-save mr-2"></i> ${t.save || 'Kaydet'}
                            </button>
                            <button type="button" onclick="showPigeons()" class="flex-1 px-6 py-3 bg-gray-600 rounded-full hover:bg-gray-700 transition">
                                ${t.cancel || 'İptal'}
                            </button>
                        </div>
                    </form>
                </div>
                </div>
            `;
            
            // If performanceType was pre-selected, show the fields
            if (performanceType) {
                setTimeout(() => {
                    showPerformanceFields();
                }, 100);
            }
        }
        
        // Performans türüne göre form alanlarını göster
        function showPerformanceFields() {
            const type = document.getElementById('performanceType').value;
            const container = document.getElementById('performanceFields');
            const t = translations[currentLang];
            
            let fieldsHTML = '';
            
            switch(type) {
                case 'tumbling':
                    fieldsHTML = `
                        <div id="tumblingFields">
                            <h4 class="text-lg font-bold mb-4 text-cyan-400">${t.tumbling_performance || 'Taklacı Performansı'}</h4>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-300 mb-2">${t.tumble_count || 'Takla Sayısı (sefer başına)'}</label>
                                    <input type="number" id="tumbleCount" min="0" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2">${t.session_count || 'Sefer Sayısı'}</label>
                                    <input type="number" id="sessionCount" min="1" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-300 mb-2">${t.flight_duration || 'Uçuş Süresi'} (dakika)</label>
                                    <input type="number" id="flightDuration" min="0" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2">${t.discipline_score || 'Disiplin Skoru'} (1-10)</label>
                                    <input type="number" min="1" max="10" id="disciplineScore" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'postal':
                    fieldsHTML = `
                        <div id="postalFields">
                            <h4 class="text-lg font-bold mb-4 text-blue-400">${t.postal_performance || 'Posta Performansı'}</h4>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-300 mb-2">${t.flight_speed || 'Uçuş Hızı'} (km/h)</label>
                                    <input type="number" id="flightSpeed" min="0" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2">${t.distance_performance || 'Mesafe Performansı'} (km)</label>
                                    <input type="number" id="flightDistance" min="0" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-300 mb-2">${t.navigation_accuracy || 'Navigasyon Doğruluğu'} (1-10)</label>
                                    <input type="number" min="1" max="10" id="navigationAccuracy" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2">${t.endurance_score || 'Dayanıklılık Skoru'} (1-10)</label>
                                    <input type="number" min="1" max="10" id="enduranceScore" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                    
                case 'racing':
                    fieldsHTML = `
                        <div id="racingFields">
                            <h4 class="text-lg font-bold mb-4 text-red-400">${t.racing_performance || 'Yarış Performansı'}</h4>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-300 mb-2">${t.race_speed || 'Hız'} (km/h)</label>
                                    <input type="number" id="raceSpeed" min="0" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2">${t.race_distance || 'Mesafe'} (km)</label>
                                    <input type="number" id="raceDistance" min="0" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-300 mb-2">${t.race_rank || 'Sıralama'}</label>
                                    <input type="number" id="raceRank" min="1" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2">${t.total_participants || 'Toplam Katılımcı'}</label>
                                    <input type="number" id="totalParticipants" min="1" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'butterfly':
                    fieldsHTML = `
                        <div id="butterflyFields">
                            <h4 class="text-lg font-bold mb-4 text-yellow-400">${t.butterfly_performance || 'Kelebek Güvercini Performansı'}</h4>
                            <p class="text-gray-400 mb-4">Kelebek güvercinlerinin oyun ve uçuş performanslarını değerlendirin.</p>
                            
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-300 mb-2">${t.bonkorluk || 'Bonkörlük (Oyun Sıklığı)'} (1-10)</label>
                                    <select id="bonkorluk" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                        ${[...Array(10)].map((_, i) => `<option value="${i+1}">${i+1}</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2">${t.flight_time_distance || 'Uçuş Süresi'} (dakika)</label>
                                    <input type="number" min="0" id="flightTimeDistance" placeholder="Örn: 45 dakika" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-300 mb-2">${t.game_direction || 'Oyun Yönü'}</label>
                                    <select id="gameDirection" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                        <option value="right">Sağ</option>
                                        <option value="left">Sol</option>
                                        <option value="double">Çift Kanat</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2">${t.game_style_aesthetics || 'Oyun Şekli ve Estetiği'} (1-10)</label>
                                    <select id="gameStyleAesthetics" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                        ${[...Array(10)].map((_, i) => `<option value="${i+1}">${i+1}</option>`).join('')}
                                    </select>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-300 mb-2">${t.flight_style || 'Uçuş Stili'} (1-10)</label>
                                    <select id="flightStyle" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                        ${[...Array(10)].map((_, i) => `<option value="${i+1}">${i+1}</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2">${t.consistency || 'İstikrar (Performans Sürekliliği)'} (1-10)</label>
                                    <select id="consistency" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                        ${[...Array(10)].map((_, i) => `<option value="${i+1}">${i+1}</option>`).join('')}
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-gray-300 mb-2">${t.home_loyalty_control || 'Ev Sadakati ve Kontrol'} (1-10)</label>
                                <select id="homeLoyaltyControl" class="w-full px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                                    ${[...Array(10)].map((_, i) => `<option value="${i+1}">${i+1}</option>`).join('')}
                                </select>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            container.innerHTML = fieldsHTML;
        }
        
        // Performans kaydı ekleme
        async function handleAddPerformance(event) {
            event.preventDefault();
            
            const performanceType = document.getElementById('performanceType').value;
            let performanceData = {};
            let overallScore = 0;
            
            // Performans türüne göre veri topla ve skor hesapla
            switch(performanceType) {
                case 'tumbling':
                    performanceData = {
                        tumbleCount: parseInt(document.getElementById('tumbleCount').value) || 0,
                        sessionCount: parseInt(document.getElementById('sessionCount').value) || 0,
                        flightDuration: parseInt(document.getElementById('flightDuration').value) || 0,
                        disciplineScore: parseInt(document.getElementById('disciplineScore').value) || 0
                    };
                    // Skor hesapla: takla/sefer oranı %50, süre %30, disiplin %20
                    const tumblePerSession = performanceData.sessionCount > 0 ? performanceData.tumbleCount / performanceData.sessionCount : 0;
                    overallScore = Math.min(10, 
                        (tumblePerSession * 0.5) + 
                        (performanceData.flightDuration / 60 * 0.3 * 10) + 
                        (performanceData.disciplineScore * 0.2)
                    ).toFixed(1);
                    break;
                    
                case 'postal':
                    performanceData = {
                        flightSpeed: parseInt(document.getElementById('flightSpeed').value) || 0,
                        flightDistance: parseInt(document.getElementById('flightDistance').value) || 0,
                        navigationAccuracy: parseInt(document.getElementById('navigationAccuracy').value) || 0,
                        enduranceScore: parseInt(document.getElementById('enduranceScore').value) || 0
                    };
                    // Skor hesapla: hız %40, navigasyon %30, dayanıklılık %30
                    overallScore = Math.min(10,
                        (performanceData.flightSpeed / 80 * 4) +
                        (performanceData.navigationAccuracy * 0.3) +
                        (performanceData.enduranceScore * 0.3)
                    ).toFixed(1);
                    break;
                    
                case 'butterfly':
                    performanceData = {
                        bonkorluk: parseInt(document.getElementById('bonkorluk').value) || 0,
                        flightTimeDistance: parseInt(document.getElementById('flightTimeDistance').value) || 0,
                        gameDirection: document.getElementById('gameDirection').value || 'right',
                        gameStyleAesthetics: parseInt(document.getElementById('gameStyleAesthetics').value) || 0,
                        flightStyle: parseInt(document.getElementById('flightStyle').value) || 0,
                        consistency: parseInt(document.getElementById('consistency').value) || 0,
                        homeLoyaltyControl: parseInt(document.getElementById('homeLoyaltyControl').value) || 0
                    };
                    // Skor hesapla: bonkörlük %30, estetik %25, istikrar %25, eve bağlılık %20
                    overallScore = Math.min(10,
                        (performanceData.bonkorluk * 0.3) +
                        (performanceData.gameStyleAesthetics * 0.25) +
                        (performanceData.consistency * 0.25) +
                        (performanceData.homeLoyaltyControl * 0.2)
                    ).toFixed(1);
                    break;
                    
                case 'racing':
                    performanceData = {
                        speed: parseInt(document.getElementById('raceSpeed').value) || 0,
                        distance: parseInt(document.getElementById('raceDistance').value) || 0,
                        rank: parseInt(document.getElementById('raceRank').value) || 0,
                        totalParticipants: parseInt(document.getElementById('totalParticipants').value) || 0
                    };
                    // Skor hesapla: sıralama %60, hız %40
                    const rankScore = performanceData.totalParticipants > 0 ? 
                        ((performanceData.totalParticipants - performanceData.rank + 1) / performanceData.totalParticipants) * 10 : 0;
                    const speedScore = Math.min(10, performanceData.speed / 80 * 10);
                    overallScore = Math.min(10, rankScore * 0.6 + speedScore * 0.4).toFixed(1);
                    break;
            }
            
            // Supabase'e kaydet
            const recordData = {
                pigeonId: document.getElementById('performancePigeonId').value,
                performanceType: performanceType,
                date: document.getElementById('performanceDate').value,
                notes: document.getElementById('performanceNotes').value,
                overallScore: parseFloat(overallScore),
                performanceData: {
                    ...performanceData,
                    weatherConditions: document.getElementById('weatherConditions').value
                }
            };
            
            try {
                const result = await SupabaseDB.addPerformanceRecord(recordData);
                
                if (result.success) {
                    showNotification(translations[currentLang].success + '!', 'success');
                    showPigeonDetail(recordData.pigeonId);
                } else {
                    showNotification('Hata: ' + result.error, 'error');
                    console.error('Performance record save error:', result.error);
                }
            } catch (error) {
                showNotification('Hata: ' + error.message, 'error');
                console.error('Performance record error:', error);
            }
        }
        
        // Performans hesaplama fonksiyonları
        function calculatePerformanceByType(pigeonId, type) {
            switch(type) {
                case 'tumbling': return calculateTumblingScore(pigeonId);
                case 'postal': return calculatePostalScore(pigeonId);
                case 'butterfly': return calculateButterflyScore(pigeonId);
                case 'racing': return calculateRacingScore(pigeonId);
                default: return 0;
            }
        }
        
        function calculateTumblingScore(pigeonId) {
            const records = storage.performanceRecords
                .filter(r => r.pigeonId === pigeonId && r.performanceType === 'tumbling');
            
            if (records.length === 0) return 0;
            
            // Sefer başına takla oranını hesapla
            const avgTumblePerSession = records.reduce((sum, r) => {
                const perSession = r.sessionCount > 0 ? r.tumbleCount / r.sessionCount : 0;
                return sum + perSession;
            }, 0) / records.length;
            
            const avgDuration = records.reduce((sum, r) => sum + r.flightDuration, 0) / records.length;
            const avgDiscipline = records.reduce((sum, r) => sum + r.disciplineScore, 0) / records.length;
            
            return Math.round(
                (avgTumblePerSession * 2) +       // Sefer başına takla %50
                (avgDuration / 60 * 30) +         // Süre %30
                (avgDiscipline * 10 * 0.2)        // Disiplin %20
            );
        }
        
        function calculatePostalScore(pigeonId) {
            const records = storage.performanceRecords
                .filter(r => r.pigeonId === pigeonId && r.performanceType === 'postal');
            
            if (records.length === 0) return 0;
            
            const avgSpeed = records.reduce((sum, r) => sum + r.flightSpeed, 0) / records.length;
            const avgNavigation = records.reduce((sum, r) => sum + r.navigationAccuracy, 0) / records.length;
            const avgEndurance = records.reduce((sum, r) => sum + r.enduranceScore, 0) / records.length;
            
            return Math.round(
                (avgSpeed / 80 * 40) +           // Hız %40
                (avgNavigation * 10 * 0.25) +    // Navigasyon %25
                (avgEndurance * 10 * 0.25) +     // Dayanıklılık %25
                10                               // Taban puan %10
            );
        }
        
        function calculateButterflyScore(pigeonId) {
            const records = storage.performanceRecords
                .filter(r => r.pigeonId === pigeonId && r.performanceType === 'butterfly');
            
            if (records.length === 0) return 0;
            
            const avgBonkorluk = records.reduce((sum, r) => sum + (r.bonkorluk || 0), 0) / records.length;
            const avgGameStyleAesthetics = records.reduce((sum, r) => sum + (r.gameStyleAesthetics || 0), 0) / records.length;
            const avgFlightStyle = records.reduce((sum, r) => sum + (r.flightStyle || 0), 0) / records.length;
            const avgConsistency = records.reduce((sum, r) => sum + (r.consistency || 0), 0) / records.length;
            const avgHomeLoyaltyControl = records.reduce((sum, r) => sum + (r.homeLoyaltyControl || 0), 0) / records.length;
            
            return Math.round(
                (avgBonkorluk * 10 * 0.25) +           // Bonkörlük %25
                (avgGameStyleAesthetics * 10 * 0.20) + // Oyun şekli ve estetiği %20
                (avgFlightStyle * 10 * 0.20) +         // Uçuş stili %20
                (avgConsistency * 10 * 0.20) +         // İstikrar %20
                (avgHomeLoyaltyControl * 10 * 0.15)    // Ev sadakati %15
            );
        }
        
        function calculateRacingScore(pigeonId) {
            // Get racing performance records from storage
            const raceRecords = storage.performanceRecords
                .filter(r => r.pigeonId === pigeonId && r.performanceType === 'racing');
            
            if (raceRecords.length === 0) return 0;
            
            // Calculate metrics from performance_data
            let totalSpeed = 0;
            let topRanks = 0;
            let validRecords = 0;
            
            raceRecords.forEach(record => {
                // Supabase snake_case formatında döndürüyor
                const data = record.performance_data || record.performanceData || {};
                if (data.speed) {
                    totalSpeed += data.speed;
                    validRecords++;
                }
                if (data.rank && data.totalParticipants) {
                    // Consider top 3 as success
                    if (data.rank <= 3) {
                        topRanks++;
                    }
                }
            });
            
            // Calculate average speed score (max 100 km/h = 10 points)
            const avgSpeed = validRecords > 0 ? totalSpeed / validRecords : 0;
            const speedScore = Math.min(10, (avgSpeed / 100) * 10);
            
            // Calculate success rate (top 3 finishes)
            const successRate = raceRecords.length > 0 ? (topRanks / raceRecords.length) : 0;
            const successScore = successRate * 10;
            
            // Combined score: 60% success rate, 40% speed
            return Math.round((successScore * 0.6) + (speedScore * 0.4));
        }
        
        // ========== PERFORMANS ANALİZ FONKSİYONLARI ==========
        
        // Trend grafiğini güncelle
        function updateTrendChart() {
            const pigeonId = document.getElementById('trendPigeonSelect').value;
            if (!pigeonId) return;
            
            const records = storage.performanceRecords
                .filter(r => r.pigeonId === pigeonId)
                .sort((a, b) => new Date(a.date) - new Date(b.date));
            
            if (records.length === 0) {
                document.getElementById('trendAnalysisResults').innerHTML = `
                    <p class="text-gray-400 text-center">${translations[currentLang].no_performance_data || 'Performans verisi bulunamadı'}</p>
                `;
                return;
            }
            
            const ctx = document.getElementById('trendChart').getContext('2d');
            const labels = records.map(r => new Date(r.date).toLocaleDateString('tr-TR'));
            const scores = records.map(r => calculatePerformanceByType(r.pigeonId, r.performanceType));
            
            // Mevcut grafiği yok et
            if (window.trendChartInstance) {
                window.trendChartInstance.destroy();
            }
            
            window.trendChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Performans Skoru',
                        data: scores,
                        borderColor: 'rgb(6, 182, 212)',
                        backgroundColor: 'rgba(6, 182, 212, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Zaman İçindeki Performans Değişimi',
                            color: '#fff'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
            
            // Trend analizi sonuçları
            const avgScore = scores.reduce((a, b) => a + b, 0) / scores.length;
            const trend = scores[scores.length - 1] > scores[0] ? 'Yükseliş' : 'Düşüş';
            const improvement = ((scores[scores.length - 1] - scores[0]) / scores[0] * 100).toFixed(1);
            
            document.getElementById('trendAnalysisResults').innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                    <div class="glass p-4 rounded-xl text-center">
                        <p class="text-gray-400">Ortalama Skor</p>
                        <p class="text-2xl font-bold text-cyan-400">${avgScore.toFixed(1)}</p>
                    </div>
                    <div class="glass p-4 rounded-xl text-center">
                        <p class="text-gray-400">Trend</p>
                        <p class="text-2xl font-bold ${trend === 'Yükseliş' ? 'text-green-400' : 'text-red-400'}">${trend}</p>
                    </div>
                    <div class="glass p-4 rounded-xl text-center">
                        <p class="text-gray-400">Gelişim</p>
                        <p class="text-2xl font-bold ${improvement > 0 ? 'text-green-400' : 'text-red-400'}">${improvement > 0 ? '+' : ''}${improvement}%</p>
                    </div>
                </div>
            `;
        }
        
        // Karşılaştırmalı Analiz
        function showComparativeAnalysis() {
            if (!checkAuth()) return;
            cleanupPreviousViews();
            updateActiveTab(6);
            
            const t = translations[currentLang];
            const userPigeons = storage.pigeons.filter(p => p.userId === storage.currentUser.id);
            
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                <div class="glass p-8 rounded-3xl">
                    <div class="flex justify-between items-center mb-8">
                        <h2 class="text-3xl font-bold">${t.comparative_analysis || 'Karşılaştırmalı Analiz'}</h2>
                        <button onclick="showPerformanceAnalysis()" class="btn-secondary">
                            <i class="fas fa-arrow-left mr-2"></i> ${t.back || 'Geri'}
                        </button>
                    </div>
                    
                    <!-- Performans türü seçimi -->
                    <div class="mb-6">
                        <label class="block text-gray-300 mb-2">${t.performance_type || 'Performans Türü'}</label>
                        <select id="compareTypeSelect" onchange="updateComparisonChart()" class="w-full max-w-md px-4 py-3 bg-black/50 rounded-lg border border-gray-600 focus:border-cyan-400 outline-none">
                            <option value="">${t.select || 'Seçiniz'}</option>
                            <option value="tumbling">${t.tumbling_performance || 'Taklacı Performansı'}</option>
                            <option value="postal">${t.postal_performance || 'Posta Performansı'}</option>
                            <option value="butterfly">${t.butterfly_performance || 'Kelebek Güvercini Performansı'}</option>
                            <option value="racing">${t.racing_performance || 'Yarış Performansı'}</option>
                        </select>
                    </div>
                    
                    <!-- Grafik alanı -->
                    <div class="glass p-6 rounded-2xl">
                        <canvas id="compareChart" width="800" height="400"></canvas>
                    </div>
                    
                    <!-- Detaylı karşılaştırma tablosu -->
                    <div id="comparisonTable" class="mt-6"></div>
                </div>
                </div>
            `;
        }
        
        // Karşılaştırma grafiğini güncelle
        function updateComparisonChart() {
            const performanceType = document.getElementById('compareTypeSelect').value;
            if (!performanceType) return;
            
            const userPigeons = storage.pigeons.filter(p => p.userId === storage.currentUser.id);
            const pigeonScores = userPigeons.map(pigeon => {
                const score = calculatePerformanceByType(pigeon.id, performanceType);
                return { pigeon, score };
            }).filter(item => item.score > 0).sort((a, b) => b.score - a.score);
            
            if (pigeonScores.length === 0) {
                document.getElementById('comparisonTable').innerHTML = `
                    <p class="text-gray-400 text-center">${translations[currentLang].no_performance_data || 'Performans verisi bulunamadı'}</p>
                `;
                return;
            }
            
            const ctx = document.getElementById('compareChart').getContext('2d');
            const labels = pigeonScores.map(item => item.pigeon.name);
            const scores = pigeonScores.map(item => item.score);
            
            // Mevcut grafiği yok et
            if (window.compareChartInstance) {
                window.compareChartInstance.destroy();
            }
            
            window.compareChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Performans Skoru',
                        data: scores,
                        backgroundColor: [
                            'rgba(6, 182, 212, 0.8)',
                            'rgba(147, 51, 234, 0.8)',
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(251, 146, 60, 0.8)',
                            'rgba(239, 68, 68, 0.8)'
                        ],
                        borderColor: [
                            'rgb(6, 182, 212)',
                            'rgb(147, 51, 234)',
                            'rgb(34, 197, 94)',
                            'rgb(251, 146, 60)',
                            'rgb(239, 68, 68)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Güvercinler Arası Performans Karşılaştırması',
                            color: '#fff'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
            
            // Detaylı karşılaştırma tablosu
            const t = translations[currentLang];
            const typeLabels = {
                tumbling: t.tumbling_performance || 'Taklacı',
                postal: t.postal_performance || 'Posta',
                butterfly: t.butterfly_performance || 'Kelebek',
                racing: t.racing_performance || 'Yarış'
            };
            
            document.getElementById('comparisonTable').innerHTML = `
                <h3 class="text-xl font-bold mb-4">${t.detailed_comparison || 'Detaylı Karşılaştırma'}</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="border-b border-gray-600">
                                <th class="py-2 px-4">${t.rank || 'Sıra'}</th>
                                <th class="py-2 px-4">${t.pigeon || 'Güvercin'}</th>
                                <th class="py-2 px-4">${t.score || 'Skor'}</th>
                                <th class="py-2 px-4">${t.performance_count || 'Kayıt Sayısı'}</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${pigeonScores.map((item, index) => {
                                const recordCount = storage.performanceRecords.filter(r => 
                                    r.pigeonId === item.pigeon.id && r.performanceType === performanceType
                                ).length;
                                
                                return `
                                    <tr class="border-b border-gray-700">
                                        <td class="py-2 px-4">${index + 1}</td>
                                        <td class="py-2 px-4">${item.pigeon.name}</td>
                                        <td class="py-2 px-4 font-bold text-cyan-400">${item.score.toFixed(1)}</td>
                                        <td class="py-2 px-4">${recordCount}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        // Detaylı istatistik hesaplama
        function calculateDetailedStats(records) {
            const t = translations[currentLang];
            const stats = {};
            
            // Performans türlerine göre gruplama
            const groupedByType = {};
            records.forEach(r => {
                if (!groupedByType[r.performanceType]) {
                    groupedByType[r.performanceType] = [];
                }
                groupedByType[r.performanceType].push(r);
            });
            
            // Her performans türü için istatistikler
            Object.entries(groupedByType).forEach(([type, typeRecords]) => {
                const typeStats = {};
                
                switch(type) {
                    case 'tumbling':
                        const tumbleCounts = typeRecords.map(r => r.tumbleCount || 0);
                        const sessionCounts = typeRecords.map(r => r.sessionCount || 0);
                        const durations = typeRecords.map(r => r.flightDuration || 0);
                        
                        typeStats.tumbleStats = {
                            title: t.tumble_statistics || 'Tumbler Statistics',
                            data: {
                                avgTumbles: { label: t.avg_tumbles || 'Avg. Tumbles', value: (average(tumbleCounts)).toFixed(1) },
                                maxTumbles: { label: t.max_tumbles || 'Max Tumbles', value: Math.max(...tumbleCounts) },
                                avgSessions: { label: t.avg_sessions || 'Avg. Sessions', value: (average(sessionCounts)).toFixed(1) },
                                avgDuration: { label: t.avg_duration_min || 'Avg. Duration (min)', value: (average(durations)).toFixed(1) }
                            }
                        };
                        break;
                        
                    case 'postal':
                        const speeds = typeRecords.map(r => r.flightSpeed || 0);
                        const distances = typeRecords.map(r => r.flightDistance || 0);
                        const navigations = typeRecords.map(r => r.navigationAccuracy || 0);
                        
                        typeStats.postalStats = {
                            title: t.postal_statistics || 'Postal Statistics',
                            data: {
                                avgSpeed: { label: t.avg_speed_kmh || 'Avg. Speed (km/h)', value: (average(speeds)).toFixed(1) },
                                maxSpeed: { label: t.max_speed || 'Max Speed', value: Math.max(...speeds) },
                                totalDistance: { label: t.total_distance_km || 'Total Distance (km)', value: sum(distances) },
                                avgNavigation: { label: t.avg_navigation || 'Avg. Navigation', value: (average(navigations)).toFixed(1) + '/10' }
                            }
                        };
                        break;
                }
                
                Object.assign(stats, typeStats);
            });
            
            // Genel istatistikler
            const allScores = records.map(r => calculatePerformanceByType(r.pigeonId, r.performanceType));
            stats.generalStats = {
                title: t.general_statistics || 'General Statistics',
                data: {
                    totalRecords: { label: t.total_records || 'Total Records', value: records.length },
                    avgScore: { label: t.avg_performance || 'Avg. Performance', value: (average(allScores)).toFixed(1) },
                    medianScore: { label: 'Medyan Performans', value: median(allScores).toFixed(1) },
                    stdDev: { label: 'Standart Sapma', value: standardDeviation(allScores).toFixed(2) }
                }
            };
            
            return stats;
        }
        
        // Yardımcı istatistik fonksiyonları
        function average(arr) {
            return arr.length ? arr.reduce((a, b) => a + b, 0) / arr.length : 0;
        }
        
        function sum(arr) {
            return arr.reduce((a, b) => a + b, 0);
        }
        
        function median(arr) {
            if (arr.length === 0) return 0;
            const sorted = [...arr].sort((a, b) => a - b);
            const mid = Math.floor(sorted.length / 2);
            return sorted.length % 2 ? sorted[mid] : (sorted[mid - 1] + sorted[mid]) / 2;
        }
        
        function standardDeviation(arr) {
            if (arr.length === 0) return 0;
            const avg = average(arr);
            const squaredDiffs = arr.map(x => Math.pow(x - avg, 2));
            return Math.sqrt(average(squaredDiffs));
        }
        
        // Performans Raporlama
        function showPerformanceReporting() {
            if (!checkAuth()) return;
            cleanupPreviousViews();
            updateActiveTab(6);
            
            const t = translations[currentLang];
            const userPigeons = storage.pigeons.filter(p => p.userId === storage.currentUser.id);
            
            document.getElementById('content').innerHTML = `
                <div class="container mx-auto">
                <div class="glass p-8 rounded-3xl">
                    <div class="flex justify-between items-center mb-8">
                        <h2 class="text-3xl font-bold">${t.performance_reporting || 'Performans Raporlama'}</h2>
                        <button onclick="showPerformanceAnalysis()" class="btn-secondary">
                            <i class="fas fa-arrow-left mr-2"></i> ${t.back || 'Geri'}
                        </button>
                    </div>
                    
                    <!-- Rapor seçenekleri -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="glass p-6 rounded-2xl">
                            <h3 class="text-xl font-bold mb-4 text-cyan-400">${t.pdf_report || 'PDF Raporu'}</h3>
                            <p class="text-gray-400 mb-4">${t.pdf_report_desc || 'Detaylı performans raporu PDF formatında'}</p>
                            
                            <div class="space-y-3 mb-4">
                                <label class="flex items-center">
                                    <input type="checkbox" id="pdfIncludeTrends" class="mr-2" checked>
                                    <span>${t.include_trends || 'Trend analizini dahil et'}</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="pdfIncludeComparison" class="mr-2" checked>
                                    <span>${t.include_comparison || 'Karşılaştırmalı analizi dahil et'}</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="pdfIncludeStats" class="mr-2" checked>
                                    <span>${t.include_statistics || 'Detaylı istatistikleri dahil et'}</span>
                                </label>
                            </div>
                            
                            <button onclick="generatePDFReport()" class="btn-primary w-full">
                                <i class="fas fa-file-pdf mr-2"></i> ${t.generate_pdf || 'PDF Oluştur'}
                            </button>
                        </div>
                        
                        <div class="glass p-6 rounded-2xl">
                            <h3 class="text-xl font-bold mb-4 text-green-400">${t.excel_report || 'Excel Raporu'}</h3>
                            <p class="text-gray-400 mb-4">${t.excel_report_desc || 'Ham veri ve analizler Excel formatında'}</p>
                            
                            <div class="space-y-3 mb-4">
                                <label class="flex items-center">
                                    <input type="checkbox" id="excelIncludeRawData" class="mr-2" checked>
                                    <span>${t.include_raw_data || 'Ham verileri dahil et'}</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="excelIncludeSummary" class="mr-2" checked>
                                    <span>${t.include_summary || 'Özet tabloları dahil et'}</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="excelIncludeCharts" class="mr-2" checked>
                                    <span>${t.include_charts || 'Grafikleri dahil et'}</span>
                                </label>
                            </div>
                            
                            <button onclick="generateExcelReport()" class="btn-primary w-full">
                                <i class="fas fa-file-excel mr-2"></i> ${t.generate_excel || 'Excel Oluştur'}
                            </button>
                        </div>
                    </div>
                    
                    <!-- Rapor önizleme alanı -->
                    <div id="reportPreview" class="mt-8"></div>
                </div>
                </div>
            `;
        }
        
        // PDF raporu oluştur
        function generatePDFReport() {
            const t = translations[currentLang];
            showNotification(t.generating_report || 'Rapor oluşturuluyor...', 'info');
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // PDF için veri hazırla
                const reportData = prepareReportData();
                
                // Sayfa genişliği
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const margin = 20;
                const contentWidth = pageWidth - 2 * margin;
                let currentY = margin;
                
                // Başlık - Canvas yöntemi ile
                const titleImg = createTextImage('PERFORMANS RAPORU', {
                    fontSize: 24,
                    fontFamily: 'Arial',
                    color: '#00BCD4'
                });
                doc.addImage(titleImg, 'PNG', (pageWidth - 120) / 2, currentY, 120, 12);
                currentY += 15;
                
                // Tarih
                const dateImg = createTextImage(`Oluşturulma Tarihi: ${new Date().toLocaleDateString('tr-TR')}`, {
                    fontSize: 10,
                    fontFamily: 'Arial',
                    color: '#969696'
                });
                doc.addImage(dateImg, 'PNG', (pageWidth - 100) / 2, currentY, 100, 6);
                currentY += 20;
                
                // Özet Bölümü
                const ozetImg = createTextImage('ÖZET', {
                    fontSize: 16,
                    fontFamily: 'Arial',
                    color: '#00BCD4'
                });
                doc.addImage(ozetImg, 'PNG', margin, currentY, 30, 8);
                currentY += 10;
                
                // Özet kutusu
                doc.setFillColor(240, 240, 240);
                doc.roundedRect(margin, currentY - 5, contentWidth, 30, 3, 3, 'F');
                
                // Özet metinleri
                const summary1Img = createTextImage(`${t.total_pigeons || 'Total Pigeons'}: ${reportData.totalPigeons}`, {
                    fontSize: 12,
                    fontFamily: 'Arial',
                    color: '#000000'
                });
                doc.addImage(summary1Img, 'PNG', margin + 10, currentY + 2, 80, 6);
                
                const summary2Img = createTextImage(`Toplam Performans Kaydı: ${reportData.totalRecords}`, {
                    fontSize: 12,
                    fontFamily: 'Arial',
                    color: '#000000'
                });
                doc.addImage(summary2Img, 'PNG', margin + contentWidth / 2, currentY + 2, 80, 6);
                currentY += 40;
                
                // Performans Türlerine Göre Dağılım
                const dagılımImg = createTextImage('PERFORMANS TÜRLERİNE GÖRE DAĞILIM', {
                    fontSize: 16,
                    fontFamily: 'Arial',
                    color: '#00BCD4'
                });
                doc.addImage(dagılımImg, 'PNG', margin, currentY, 150, 8);
                currentY += 10;
                
                // Dağılım verileri
                const performanceData = [
                    { type: 'Taklacı', count: reportData.tumblingCount, color: [255, 99, 132] },
                    { type: 'Posta', count: reportData.postalCount, color: [54, 162, 235] },
                    { type: 'Yarış', count: reportData.racingCount, color: [75, 192, 192] }
                ];
                
                // Performans kutucukları
                let xOffset = margin;
                performanceData.forEach((perf, index) => {
                    const boxWidth = contentWidth / 4 - 5;
                    
                    // Kutucuk arka planı
                    doc.setFillColor(...perf.color, 50);
                    doc.roundedRect(xOffset, currentY, boxWidth, 40, 3, 3, 'F');
                    
                    // Başlık
                    const typeImg = createTextImage(perf.type, {
                        fontSize: 10,
                        fontFamily: 'Arial',
                        color: '#505050'
                    });
                    doc.addImage(typeImg, 'PNG', xOffset + (boxWidth - 30) / 2, currentY + 10, 30, 6);
                    
                    // Sayı
                    const countImg = createTextImage(perf.count.toString(), {
                        fontSize: 18,
                        fontFamily: 'Arial',
                        color: `rgb(${perf.color[0]}, ${perf.color[1]}, ${perf.color[2]})`
                    });
                    doc.addImage(countImg, 'PNG', xOffset + (boxWidth - 20) / 2, currentY + 22, 20, 10);
                    
                    xOffset += boxWidth + 5;
                });
                currentY += 55;
                
                // En İyi Performanslar
                const enIyiImg = createTextImage('EN İYİ PERFORMANSLAR', {
                    fontSize: 16,
                    fontFamily: 'Arial',
                    color: '#00BCD4'
                });
                doc.addImage(enIyiImg, 'PNG', margin, currentY, 100, 8);
                currentY += 10;
                
                // Performans tablosu
                if (reportData.topPerformers.length > 0) {
                    // Tablo başlığı
                    doc.setFillColor(0, 188, 212);
                    doc.rect(margin, currentY, contentWidth, 10, 'F');
                    
                    // Tablo başlık metinleri
                    const siraImg = createTextImage('Sıra', {
                        fontSize: 12,
                        fontFamily: 'Arial',
                        color: '#FFFFFF'
                    });
                    doc.addImage(siraImg, 'PNG', margin + 5, currentY + 2, 20, 6);
                    
                    const guvAdImg = createTextImage('Güvercin Adı', {
                        fontSize: 12,
                        fontFamily: 'Arial',
                        color: '#FFFFFF'
                    });
                    doc.addImage(guvAdImg, 'PNG', margin + 30, currentY + 2, 50, 6);
                    
                    const puanImg = createTextImage('Puan', {
                        fontSize: 12,
                        fontFamily: 'Arial',
                        color: '#FFFFFF'
                    });
                    doc.addImage(puanImg, 'PNG', margin + contentWidth - 40, currentY + 2, 25, 6);
                    currentY += 10;
                    
                    // Tablo satırları
                    reportData.topPerformers.forEach((performer, index) => {
                        if (index % 2 === 0) {
                            doc.setFillColor(245, 245, 245);
                            doc.rect(margin, currentY, contentWidth, 10, 'F');
                        }
                        
                        // Sıra numarası
                        const siraNumImg = createTextImage(`${index + 1}.`, {
                            fontSize: 11,
                            fontFamily: 'Arial',
                            color: '#000000'
                        });
                        doc.addImage(siraNumImg, 'PNG', margin + 5, currentY + 2, 15, 6);
                        
                        // Güvercin adı
                        const nameImg = createTextImage(performer.name, {
                            fontSize: 11,
                            fontFamily: 'Arial',
                            color: '#000000'
                        });
                        doc.addImage(nameImg, 'PNG', margin + 30, currentY + 2, 80, 6);
                        
                        // Puan
                        const scoreImg = createTextImage(`${performer.score} puan`, {
                            fontSize: 11,
                            fontFamily: 'Arial',
                            color: '#000000'
                        });
                        doc.addImage(scoreImg, 'PNG', margin + contentWidth - 50, currentY + 2, 40, 6);
                        currentY += 10;
                    });
                }
                
                // Alt bilgi
                currentY = pageHeight - 20;
                const altBilgiImg = createTextImage('Güvercin Soyağacı Takip Sistemi', {
                    fontSize: 8,
                    fontFamily: 'Arial',
                    color: '#969696'
                });
                doc.addImage(altBilgiImg, 'PNG', (pageWidth - 80) / 2, currentY, 80, 5);
                
                const sayfaImg = createTextImage('Sayfa 1 / 1', {
                    fontSize: 8,
                    fontFamily: 'Arial',
                    color: '#969696'
                });
                doc.addImage(sayfaImg, 'PNG', pageWidth - margin - 30, currentY, 30, 5);
                
                // PDF'i kaydet
                doc.save(`performans-raporu-${new Date().toISOString().split('T')[0]}.pdf`);
                showNotification(t.report_generated || 'PDF raporu oluşturuldu!', 'success');
                
            } catch (error) {
                console.error('PDF oluşturma hatası:', error);
                showNotification(t.error_generating_report || 'Rapor oluşturulurken hata oluştu!', 'error');
            }
        }
        
        // Excel raporu oluştur
        function generateExcelReport() {
            const t = translations[currentLang];
            showNotification(t.generating_report || 'Rapor oluşturuluyor...', 'info');
            
            // Excel için veri hazırla
            const reportData = prepareReportData();
            
            // CSV formatında veri oluştur (BOM for UTF-8 encoding)
            let csvContent = '\ufeff'; // UTF-8 BOM for Excel to recognize UTF-8
            csvContent += 'Güvercin,Küpe No,Performans Türü,Tarih,Skor\n';
            
            reportData.records.forEach(record => {
                const pigeon = storage.pigeons.find(p => p.id === record.pigeonId);
                if (pigeon) {
                    const score = calculatePerformanceByType(record.pigeonId, record.performanceType);
                    csvContent += `${pigeon.name},${pigeon.bandNumber},${record.performanceType},${record.date},${score}\n`;
                }
            });
            
            // CSV'yi indir
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `performans-raporu-${Date.now()}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showNotification(t.report_generated || 'Rapor oluşturuldu!', 'success');
        }
        
        // Export performance report (PDF or Excel)
        function exportPerformanceReport(format) {
            const t = translations[currentLang];
            
            if (format === 'pdf') {
                generatePDFReport();
            } else if (format === 'excel') {
                generateExcelReport();
            } else {
                showNotification(t.invalid_format || 'Geçersiz format!', 'error');
            }
        }
        
        // Rapor verilerini hazırla
        function prepareReportData() {
            const userPigeons = storage.pigeons.filter(p => p.userId === storage.currentUser.id);
            const userRecords = storage.performanceRecords.filter(r => 
                userPigeons.some(p => p.id === r.pigeonId)
            );
            
            // En iyi performans gösteren güvercinler
            const pigeonScores = userPigeons.map(pigeon => {
                const scores = ['tumbling', 'postal', 'butterfly', 'racing'].map(type => 
                    calculatePerformanceByType(pigeon.id, type)
                );
                const maxScore = Math.max(...scores);
                return { name: pigeon.name, score: maxScore };
            }).sort((a, b) => b.score - a.score).slice(0, 5);
            
            return {
                totalPigeons: userPigeons.length,
                totalRecords: userRecords.length,
                tumblingCount: userRecords.filter(r => r.performanceType === 'tumbling').length,
                postalCount: userRecords.filter(r => r.performanceType === 'postal').length,
                racingCount: userRecords.filter(r => r.performanceType === 'racing').length,
                topPerformers: pigeonScores,
                records: userRecords
            };
        }

        // Detaylı performans karşılaştırması
        function compareDetailedPigeonPerformance(pigeon1, pigeon2) {
            const records1 = storage.performanceRecords.filter(r => r.pigeonId === pigeon1.id);
            const records2 = storage.performanceRecords.filter(r => r.pigeonId === pigeon2.id);
            
            // Performans tiplerini belirle
            const getPerformanceType = (breed) => {
                const typeMap = {
                    taklaci: 'tumbling', adana: 'tumbling', bursa_oynari: 'tumbling',
                    dolapci: 'tumbling', hunkari: 'tumbling', sebap: 'tumbling', van: 'tumbling',
                    posta: 'postal', kelebek: 'butterfly'
                };
                return typeMap[breed] || 'tumbling';
            };
            
            const type1 = getPerformanceType(pigeon1.breed);
            const type2 = getPerformanceType(pigeon2.breed);
            
            // Temel istatistikler
            const comparison = {
                pigeon1: {
                    totalRecords: records1.length,
                    averageScore: calculatePerformanceByType(pigeon1.id, type1),
                    recentPerformance: records1.slice(0, 5),
                    performanceType: type1
                },
                pigeon2: {
                    totalRecords: records2.length,
                    averageScore: calculatePerformanceByType(pigeon2.id, type2),
                    recentPerformance: records2.slice(0, 5),
                    performanceType: type2
                },
                winner: null,
                metrics: {}
            };
            
            // Kazananı belirle
            if (comparison.pigeon1.averageScore > comparison.pigeon2.averageScore) {
                comparison.winner = 'pigeon1';
            } else if (comparison.pigeon2.averageScore > comparison.pigeon1.averageScore) {
                comparison.winner = 'pigeon2';
            } else {
                comparison.winner = 'tie';
            }
            
            return comparison;
        }
        
        // Karşılaştırma sonuçlarını göster
        function displayDetailedComparison(comparison, pigeon1, pigeon2) {
            const container = document.getElementById('detailedComparisonResult');
            if (!container) return;
            
            const scoreDiff = Math.abs(comparison.pigeon1.averageScore - comparison.pigeon2.averageScore);
            const winnerText = comparison.winner === 'pigeon1' ? pigeon1.name : 
                             comparison.winner === 'pigeon2' ? pigeon2.name : 'Berabere';
            
            container.innerHTML = `
                <!-- Kazanan Kutusu -->
                <div class="bg-gradient-to-r ${comparison.winner === 'tie' ? 'from-yellow-500/20 to-yellow-600/20' : 'from-green-500/20 to-emerald-600/20'} rounded-lg p-4 text-center">
                    <i class="fas ${comparison.winner === 'tie' ? 'fa-handshake' : 'fa-trophy'} text-2xl mb-2 ${comparison.winner === 'tie' ? 'text-yellow-400' : 'text-green-400'}"></i>
                    <div class="font-bold text-lg">${winnerText}</div>
                    ${comparison.winner !== 'tie' ? `<div class="text-sm opacity-80">${scoreDiff.toFixed(1)} puan farkla</div>` : ''}
                </div>
                
                <!-- Performans Kartları -->
                <div class="grid grid-cols-1 gap-3">
                    <!-- Güvercin 1 -->
                    <div class="bg-black/30 rounded-lg p-3 ${comparison.winner === 'pigeon1' ? 'ring-2 ring-green-400' : ''}">
                        <div class="flex items-center gap-3 mb-2">
                            ${pigeon1.image ? `<img src="${pigeon1.image}" class="w-8 h-8 rounded-full object-cover">` : `<div class="w-8 h-8 rounded-full bg-black/40 flex items-center justify-center"><i class="fas fa-dove text-xs"></i></div>`}
                            <div class="flex-1">
                                <div class="font-semibold text-sm">${pigeon1.name}</div>
                                <div class="text-xs text-gray-400">${pigeon1.bandNumber}</div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-cyan-400">${comparison.pigeon1.averageScore.toFixed(1)}</div>
                                <div class="text-xs text-gray-400">${comparison.pigeon1.totalRecords} kayıt</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Güvercin 2 -->
                    <div class="bg-black/30 rounded-lg p-3 ${comparison.winner === 'pigeon2' ? 'ring-2 ring-green-400' : ''}">
                        <div class="flex items-center gap-3 mb-2">
                            ${pigeon2.image ? `<img src="${pigeon2.image}" class="w-8 h-8 rounded-full object-cover">` : `<div class="w-8 h-8 rounded-full bg-black/40 flex items-center justify-center"><i class="fas fa-dove text-xs"></i></div>`}
                            <div class="flex-1">
                                <div class="font-semibold text-sm">${pigeon2.name}</div>
                                <div class="text-xs text-gray-400">${pigeon2.bandNumber}</div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-cyan-400">${comparison.pigeon2.averageScore.toFixed(1)}</div>
                                <div class="text-xs text-gray-400">${comparison.pigeon2.totalRecords} kayıt</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Radar Chart Container -->
                <div class="bg-black/30 rounded-lg p-3">
                    <h4 class="font-semibold mb-3 text-sm text-center">Performans Karşılaştırması</h4>
                    <div class="h-48">
                        <canvas id="comparisonRadarChart"></canvas>
                    </div>
                </div>
                
                <!-- Detay Butonu -->
                <div class="w-full">
                    <button onclick="showDetailedMetrics('${pigeon1.id}', '${pigeon2.id}')" class="w-full p-3 bg-gradient-to-r from-purple-600/20 to-blue-600/20 text-purple-300 rounded-lg hover:from-purple-600/30 hover:to-blue-600/30 transition text-sm font-medium">
                        <i class="fas fa-chart-line mr-2"></i> Detaylı Metrikler
                    </button>
                </div>
            `;
            
            // Radar chart oluştur
            setTimeout(() => {
                createComparisonRadarChart(pigeon1, pigeon2, comparison);
            }, 100);
        }
        
        // Karşılaştırma radar chart
        function createComparisonRadarChart(pigeon1, pigeon2, comparison) {
            const ctx = document.getElementById('comparisonRadarChart');
            if (!ctx) return;
            
            const getPerformanceMetrics = (pigeon, type) => {
                const records = storage.performanceRecords.filter(r => r.pigeonId === pigeon.id && r.performanceType === type);
                if (records.length === 0) return {};
                
                const metrics = {};
                records.forEach(record => {
                    Object.keys(record).forEach(key => {
                        if (typeof record[key] === 'number' && key !== 'pigeonId') {
                            if (!metrics[key]) metrics[key] = [];
                            metrics[key].push(record[key]);
                        }
                    });
                });
                
                // Ortalama hesapla
                Object.keys(metrics).forEach(key => {
                    metrics[key] = metrics[key].reduce((a, b) => a + b, 0) / metrics[key].length;
                });
                
                return metrics;
            };
            
            const metrics1 = getPerformanceMetrics(pigeon1, comparison.pigeon1.performanceType);
            const metrics2 = getPerformanceMetrics(pigeon2, comparison.pigeon2.performanceType);
            
            // Ortak metrikler
            const commonKeys = Object.keys(metrics1).filter(key => Object.keys(metrics2).includes(key));
            const labels = commonKeys.slice(0, 6); // Maksimum 6 metrik
            
            const data1 = labels.map(key => metrics1[key] || 0);
            const data2 = labels.map(key => metrics2[key] || 0);
            
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: pigeon1.name,
                        data: data1,
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        pointBackgroundColor: 'rgba(59, 130, 246, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(59, 130, 246, 1)'
                    }, {
                        label: pigeon2.name,
                        data: data2,
                        backgroundColor: 'rgba(16, 185, 129, 0.2)',
                        borderColor: 'rgba(16, 185, 129, 1)',
                        pointBackgroundColor: 'rgba(16, 185, 129, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(16, 185, 129, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: 'rgba(255, 255, 255, 0.2)' },
                            grid: { color: 'rgba(255, 255, 255, 0.2)' },
                            pointLabels: { color: '#fff', font: { size: 9 } },
                            ticks: { display: false },
                            suggestedMin: 0
                        }
                    },
                    plugins: {
                        legend: { 
                            display: true,
                            position: 'bottom',
                            labels: { color: '#fff', font: { size: 10 } }
                        }
                    }
                }
            });
        }
        
        // Hızlı analiz fonksiyonları
        function showTopPerformers() {
            const userPigeons = storage.pigeons.filter(p => p.userId === storage.currentUser.id);
            const performers = userPigeons.map(pigeon => {
                const getPerformanceType = (breed) => {
                    const typeMap = {
                        taklaci: 'tumbling', adana: 'tumbling', bursa_oynari: 'tumbling',
                        dolapci: 'tumbling', hunkari: 'tumbling', sebap: 'tumbling', van: 'tumbling',
                        posta: 'postal', kelebek: 'butterfly'
                    };
                    return typeMap[breed] || 'tumbling';
                };
                
                const score = calculatePerformanceByType(pigeon.id, getPerformanceType(pigeon.breed));
                return { pigeon, score };
            }).sort((a, b) => b.score - a.score).slice(0, 5);
            
            const container = document.getElementById('detailedComparisonResult');
            container.innerHTML = `
                <div class="space-y-3">
                    <h4 class="font-bold text-center text-green-400">🏆 En İyi Performanslar</h4>
                    ${performers.map((item, index) => `
                        <div class="bg-black/30 rounded-lg p-3 flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 flex items-center justify-center font-bold text-black text-sm">
                                ${index + 1}
                            </div>
                            ${item.pigeon.image ? `<img src="${item.pigeon.image}" class="w-10 h-10 rounded-full object-cover">` : `<div class="w-10 h-10 rounded-full bg-black/40 flex items-center justify-center"><i class="fas fa-dove"></i></div>`}
                            <div class="flex-1">
                                <div class="font-semibold">${item.pigeon.name}</div>
                                <div class="text-xs text-gray-400">${item.pigeon.breed}</div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-cyan-400">${item.score.toFixed(1)}</div>
                                <div class="text-xs text-gray-400">puan</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function showPerformanceTrends() {
            const container = document.getElementById('detailedComparisonResult');
            const userPigeons = storage.pigeons.filter(p => p.userId === storage.currentUser.id);
            const recentRecords = storage.performanceRecords
                .filter(r => userPigeons.some(p => p.id === r.pigeonId))
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 10);
                
            container.innerHTML = `
                <div class="space-y-3">
                    <h4 class="font-bold text-center text-blue-400">📈 Performans Trendleri</h4>
                    <div class="bg-black/30 rounded-lg p-3">
                        <canvas id="trendChart" class="w-full h-32"></canvas>
                    </div>
                    <div class="text-center text-sm text-gray-400">
                        Son 10 performans kaydı
                    </div>
                </div>
            `;
            
            // Trend chart oluştur
            setTimeout(() => {
                const ctx = document.getElementById('trendChart');
                if (ctx) {
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: recentRecords.map((_, i) => `${i + 1}`),
                            datasets: [{
                                label: 'Performans',
                                data: recentRecords.map(r => r.overallScore || 0),
                                borderColor: 'rgba(59, 130, 246, 1)',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: { display: false },
                                x: { display: false }
                            },
                            plugins: { legend: { display: false } }
                        }
                    });
                }
            }, 100);
        }
        
        function showBreedAnalysis() {
            const userPigeons = storage.pigeons.filter(p => p.userId === storage.currentUser.id);
            const breedStats = {};
            
            userPigeons.forEach(pigeon => {
                if (!breedStats[pigeon.breed]) {
                    breedStats[pigeon.breed] = { count: 0, totalScore: 0 };
                }
                breedStats[pigeon.breed].count++;
                
                const getPerformanceType = (breed) => {
                    const typeMap = {
                        taklaci: 'tumbling', adana: 'tumbling', bursa_oynari: 'tumbling',
                        dolapci: 'tumbling', hunkari: 'tumbling', sebap: 'tumbling', van: 'tumbling',
                        posta: 'postal', kelebek: 'butterfly'
                    };
                    return typeMap[breed] || 'tumbling';
                };
                
                breedStats[pigeon.breed].totalScore += calculatePerformanceByType(pigeon.id, getPerformanceType(pigeon.breed));
            });
            
            const breeds = Object.keys(breedStats).map(breed => ({
                breed,
                count: breedStats[breed].count,
                averageScore: breedStats[breed].totalScore / breedStats[breed].count
            })).sort((a, b) => b.averageScore - a.averageScore);
            
            const container = document.getElementById('detailedComparisonResult');
            container.innerHTML = `
                <div class="space-y-3">
                    <h4 class="font-bold text-center text-purple-400">🧬 Irk Analizi</h4>
                    ${breeds.map(item => `
                        <div class="bg-black/30 rounded-lg p-3">
                            <div class="flex justify-between items-center mb-2">
                                <div class="font-semibold">${item.breed}</div>
                                <div class="text-sm text-cyan-400">${item.averageScore.toFixed(1)} puan</div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-400">
                                <span>${item.count} güvercin</span>
                                <span>Ortalama performans</span>
                            </div>
                            <div class="w-full bg-black/50 rounded-full h-2 mt-2">
                                <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full" style="width: ${Math.min(100, (item.averageScore / 10) * 100)}%"></div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        
        function showDetailedMetrics(pigeon1Id, pigeon2Id) {
            const pigeon1 = storage.pigeons.find(p => p.id === pigeon1Id);
            const pigeon2 = storage.pigeons.find(p => p.id === pigeon2Id);
            
            if (!pigeon1 || !pigeon2) return;
            
            const records1 = storage.performanceRecords.filter(r => r.pigeonId === pigeon1Id).slice(0, 5);
            const records2 = storage.performanceRecords.filter(r => r.pigeonId === pigeon2Id).slice(0, 5);
            
            const container = document.getElementById('detailedComparisonResult');
            container.innerHTML = `
                <div class="space-y-3">
                    <h4 class="font-bold text-center text-cyan-400">📊 Detaylı Metrikler</h4>
                    
                    <!-- Güvercin 1 Detayları -->
                    <div class="bg-black/30 rounded-lg p-3">
                        <h5 class="font-semibold mb-2 text-blue-300">${pigeon1.name}</h5>
                        <div class="space-y-1 text-sm">
                            ${records1.map(record => `
                                <div class="flex justify-between">
                                    <span class="text-gray-400">${formatDate(record.date)}</span>
                                    <span class="text-white">${record.overallScore || 0} puan</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- Güvercin 2 Detayları -->
                    <div class="bg-black/30 rounded-lg p-3">
                        <h5 class="font-semibold mb-2 text-green-300">${pigeon2.name}</h5>
                        <div class="space-y-1 text-sm">
                            ${records2.map(record => `
                                <div class="flex justify-between">
                                    <span class="text-gray-400">${formatDate(record.date)}</span>
                                    <span class="text-white">${record.overallScore || 0} puan</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        // Add missing navigation functions
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            if (mobileMenu) {
                mobileMenu.classList.toggle('active');
            }
        }
        
        function changeLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('language', lang);
            updateLanguage();
            showHomepage();
        }
        
        
        // Make all functions globally accessible immediately
        window.openAuthModal = openAuthModal;
        window.closeAuthModal = closeAuthModal;
        window.handleLogin = handleLogin;
        window.handleRegister = handleRegister;
        window.showHomepage = showHomepage;
        window.showPigeons = showPigeons;
        window.showMatings = showMatings;
        window.showHealthRecords = showHealthRecords;
        window.showPerformanceRecords = showPerformanceRecords;
        window.showRacingPerformance = showRacingPerformance;
        window.getRacingDashboardContent = getRacingDashboardContent;
        window.showRacingDashboard = showRacingDashboard;
        window.showRaceAnalytics = showRaceAnalytics;
        window.showAIBreeding = showAIBreeding;
        window.showPricing = showPricing;
        window.toggleMobileMenu = toggleMobileMenu;
        window.handleBreedChange = handleBreedChange;
        window.handleColorChange = handleColorChange;
        window.handleWhiteTypeChange = handleWhiteTypeChange;
        window.handleAddPigeon = handleAddPigeon;
        window.showAddPigeon = showAddPigeon;
        window.updateMalePreview = updateMalePreview;
        window.updateFemalePreview = updateFemalePreview;
        window.runAIAnalysis = runAIAnalysis;
        window.displayAIAnalysisResults = displayAIAnalysisResults;
        window.changeLanguage = changeLanguage;
        window.updateNavigation = updateNavigation;
        window.showNotification = showNotification;
        
        // Initialize application when DOM is ready
        // Global premium purchase handler
        window.handlePremiumPurchaseLocal = async function() {
            console.log('handlePremiumPurchaseLocal called');
            
            // Try multiple times to find the function
            let attempts = 0;
            const maxAttempts = 3;
            
            while (attempts < maxAttempts) {
                if (typeof window.handlePremiumPurchase === 'function') {
                    console.log('handlePremiumPurchase found, calling it...');
                    await window.handlePremiumPurchase();
                    return;
                }
                
                console.log(`Attempt ${attempts + 1}: handlePremiumPurchase not found, waiting...`);
                attempts++;
                
                if (attempts < maxAttempts) {
                    // Wait a bit and try again
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
            }
            
            // If still not found after attempts
            console.error('handlePremiumPurchase not found after multiple attempts');
            
            // Fallback - inline implementation
            if (!checkAuth()) {
                openAuthModal('login');
                showNotification(
                    currentLang === 'tr' ? 
                        'Premium üyelik için giriş yapmanız gerekiyor' : 
                        'You need to login for premium membership',
                    'warning'
                );
                return;
            }
            showNotification(
                currentLang === 'tr' ? 
                    'Premium sistem yükleniyor, lütfen tekrar deneyin.' : 
                    'Premium system is loading, please try again.',
                'error'
            );
        };

        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing application...');
            
            // Initialize auth state
            checkAuthState();
            
            // Show homepage by default
            showHomepage();
            
            console.log('Application initialized successfully!');
        });
        
        // Check auth state on load
        async function checkAuthState() {
            try {
                const session = await supabaseClient.checkSession();
                if (session) {
                    const user = await SupabaseAuth.getCurrentUser();
                    if (user) {
                        storage.currentUser = user;
                        updateNavigation();
                        // Premium badge kontrolü
                        updateNavbarForPremium();
                    }
                }
            } catch (error) {
                console.error('Auth check error:', error);
            }
        }
    </script>
    
    <!-- AI Breeding Modules -->
    <script src="js/ai-breeding/color-pattern-system.js"></script>
    <script src="js/ai-breeding/phenotype-predictor.js"></script>
    <script src="js/ai-breeding/genetic-calculator.js"></script>
    <script src="js/ai-breeding/kinship-analyzer.js"></script>
    <script src="js/ai-breeding/compatibility-scorer.js"></script>
    <script src="js/ai-breeding/recommendation-engine.js"></script>
</body>
</html>
                